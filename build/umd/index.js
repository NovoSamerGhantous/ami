/*! For license information please see index.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.exampleTypescriptPackage=e():t.exampleTypescriptPackage=e()}(this,(()=>(()=>{var t={9099:t=>{var e={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},i=function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,n=799,r=3406,s=2276,a=1567,o=3784,l=5793,h=2896;function c(t,e){for(var i,n,r=0,s=[],a=16;a>0&&!t[a-1];)a--;s.push({children:[],index:0});var o,l=s[0];for(i=0;i<a;i++){for(n=0;n<t[i];n++){for((l=s.pop()).children[l.index]=e[r];l.index>0;)l=s.pop();for(l.index++,s.push(l);s.length<=i;)s.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;r++}i+1<a&&(s.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return s[0].children}function u(t,e,i){return 64*((t.blocksPerLine+1)*e+i)}function d(e,i,n,r,s,a,o,l,h){n.precision,n.samplesPerLine,n.scanLines;var c=n.mcusPerLine,d=n.progressive,p=(n.maxH,n.maxV,i),f=0,m=0;function _(){if(m>0)return m--,f>>m&1;if(255==(f=e[i++])){var t=e[i++];if(t)throw"unexpected marker: "+(f<<8|t).toString(16)}return m=7,f>>>7}function g(t){for(var e,i=t;null!==(e=_());){if("number"==typeof(i=i[e]))return i;if("object"!=typeof i)throw"invalid huffman sequence"}return null}function y(t){for(var e=0;t>0;){var i=_();if(null===i)return;e=e<<1|i,t--}return e}function v(t){var e=y(t);return e>=1<<t-1?e:e+(-1<<t)+1}var x,b=0,w=0;function M(t,e,i,n,r){var s=i%c;e(t,u(t,(i/c|0)*t.v+n,s*t.h+r))}function S(t,e,i){e(t,u(t,i/t.blocksPerLine|0,i%t.blocksPerLine))}var E,T,A,P,C,L,R=r.length;L=d?0===a?0===l?function(t,e){var i=g(t.huffmanTableDC),n=0===i?0:v(i)<<h;t.blockData[e]=t.pred+=n}:function(t,e){t.blockData[e]|=_()<<h}:0===l?function(e,i){if(b>0)b--;else for(var n=a,r=o;n<=r;){var s=g(e.huffmanTableAC),l=15&s,c=s>>4;if(0!==l){var u=t[n+=c];e.blockData[i+u]=v(l)*(1<<h),n++}else{if(c<15){b=y(c)+(1<<c)-1;break}n+=16}}}:function(e,i){for(var n=a,r=o,s=0;n<=r;){var l=t[n];switch(w){case 0:var c=g(e.huffmanTableAC),u=15&c;if(s=c>>4,0===u)s<15?(b=y(s)+(1<<s),w=4):(s=16,w=1);else{if(1!==u)throw"invalid ACn encoding";x=v(u),w=s?2:3}continue;case 1:case 2:e.blockData[i+l]?e.blockData[i+l]+=_()<<h:0==--s&&(w=2==w?3:0);break;case 3:e.blockData[i+l]?e.blockData[i+l]+=_()<<h:(e.blockData[i+l]=x<<h,w=0);break;case 4:e.blockData[i+l]&&(e.blockData[i+l]+=_()<<h)}n++}4===w&&0==--b&&(w=0)}:function(e,i){var n=g(e.huffmanTableDC),r=0===n?0:v(n);e.blockData[i]=e.pred+=r;for(var s=1;s<64;){var a=g(e.huffmanTableAC),o=15&a,l=a>>4;if(0!==o){var h=t[s+=l];e.blockData[i+h]=v(o),s++}else{if(l<15)break;s+=16}}};var I,D,O,N,F=0;for(D=1==R?r[0].blocksPerLine*r[0].blocksPerColumn:c*n.mcusPerColumn,s||(s=D);F<D;){for(T=0;T<R;T++)r[T].pred=0;if(b=0,1==R)for(E=r[0],C=0;C<s;C++)S(E,L,F),F++;else for(C=0;C<s;C++){for(T=0;T<R;T++)for(O=(E=r[T]).h,N=E.v,A=0;A<N;A++)for(P=0;P<O;P++)M(E,L,F,A,P);F++}if(m=0,(I=e[i]<<8|e[i+1])<=65280)throw"marker was not found";if(!(I>=65488&&I<=65495))break;i+=2}return i-p}function p(t,e,c){var u,d,p,f,m,_,g,y,v,x,b=t.quantizationTable;for(x=0;x<64;x++)c[x]=t.blockData[e+x]*b[x];for(x=0;x<8;++x){var w=8*x;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(u=l*c[0+w]+128>>8,d=l*c[4+w]+128>>8,p=c[2+w],f=c[6+w],m=h*(c[1+w]-c[7+w])+128>>8,y=h*(c[1+w]+c[7+w])+128>>8,_=c[3+w]<<4,g=c[5+w]<<4,v=u-d+1>>1,u=u+d+1>>1,d=v,v=p*o+f*a+128>>8,p=p*a-f*o+128>>8,f=v,v=m-g+1>>1,m=m+g+1>>1,g=v,v=y+_+1>>1,_=y-_+1>>1,y=v,v=u-f+1>>1,u=u+f+1>>1,f=v,v=d-p+1>>1,d=d+p+1>>1,p=v,v=m*s+y*r+2048>>12,m=m*r-y*s+2048>>12,y=v,v=_*n+g*i+2048>>12,_=_*i-g*n+2048>>12,g=v,c[0+w]=u+y,c[7+w]=u-y,c[1+w]=d+g,c[6+w]=d-g,c[2+w]=p+_,c[5+w]=p-_,c[3+w]=f+m,c[4+w]=f-m):(v=l*c[0+w]+512>>10,c[0+w]=v,c[1+w]=v,c[2+w]=v,c[3+w]=v,c[4+w]=v,c[5+w]=v,c[6+w]=v,c[7+w]=v)}for(x=0;x<8;++x){var M=x;0!==c[8+M]||0!==c[16+M]||0!==c[24+M]||0!==c[32+M]||0!==c[40+M]||0!==c[48+M]||0!==c[56+M]?(u=l*c[0+M]+2048>>12,d=l*c[32+M]+2048>>12,p=c[16+M],f=c[48+M],m=h*(c[8+M]-c[56+M])+2048>>12,y=h*(c[8+M]+c[56+M])+2048>>12,_=c[24+M],g=c[40+M],v=u-d+1>>1,u=u+d+1>>1,d=v,v=p*o+f*a+2048>>12,p=p*a-f*o+2048>>12,f=v,v=m-g+1>>1,m=m+g+1>>1,g=v,v=y+_+1>>1,_=y-_+1>>1,y=v,v=u-f+1>>1,u=u+f+1>>1,f=v,v=d-p+1>>1,d=d+p+1>>1,p=v,v=m*s+y*r+2048>>12,m=m*r-y*s+2048>>12,y=v,v=_*n+g*i+2048>>12,_=_*i-g*n+2048>>12,g=v,c[0+M]=u+y,c[56+M]=u-y,c[8+M]=d+g,c[48+M]=d-g,c[16+M]=p+_,c[40+M]=p-_,c[24+M]=f+m,c[32+M]=f-m):(v=l*c[x+0]+8192>>14,c[0+M]=v,c[8+M]=v,c[16+M]=v,c[24+M]=v,c[32+M]=v,c[40+M]=v,c[48+M]=v,c[56+M]=v)}for(x=0;x<64;++x){var S=e+x,E=c[x];E=E<=-2056/t.bitConversion?0:E>=2024/t.bitConversion?255/t.bitConversion:E+2056/t.bitConversion>>4,t.blockData[S]=E}}function f(t,e){for(var i=e.blocksPerLine,n=e.blocksPerColumn,r=new Int32Array(64),s=0;s<n;s++)for(var a=0;a<i;a++)p(e,u(e,s,a),r);return e.blockData}function m(t){return t<=0?0:t>=255?255:0|t}return constructor.prototype={load:function(t){var e=function(t){this.parse(t),this.onload&&this.onload()}.bind(this);if(t.indexOf("data:")>-1){for(var i=t.indexOf("base64,")+7,n=atob(t.substring(i)),r=new Uint8Array(n.length),s=n.length-1;s>=0;s--)r[s]=n.charCodeAt(s);e(n)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer",a.onload=function(){var t=new Uint8Array(a.response);e(t)}.bind(this),a.send(null)}},parse:function(i){function n(){var t=i[l]<<8|i[l+1];return l+=2,t}function r(){var t=n(),e=i.subarray(l,l+t-2);return l+=e.length,e}function s(t){for(var e=Math.ceil(t.samplesPerLine/8/t.maxH),i=Math.ceil(t.scanLines/8/t.maxV),n=0;n<t.components.length;n++){j=t.components[n];var r=Math.ceil(Math.ceil(t.samplesPerLine/8)*j.h/t.maxH),s=Math.ceil(Math.ceil(t.scanLines/8)*j.v/t.maxV),a=e*j.h,o=i*j.v*64*(a+1);j.blockData=new Int16Array(o),j.blocksPerLine=r,j.blocksPerColumn=s}t.mcusPerLine=e,t.mcusPerColumn=i}var a,o,l=0,h=(i.length,null),u=null,p=[],m=[],_=[],g=n();if(65496!=g)throw"SOI not found";for(g=n();65497!=g;){var y,v;switch(g){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var x=r();65504===g&&74===x[0]&&70===x[1]&&73===x[2]&&70===x[3]&&0===x[4]&&(h={version:{major:x[5],minor:x[6]},densityUnits:x[7],xDensity:x[8]<<8|x[9],yDensity:x[10]<<8|x[11],thumbWidth:x[12],thumbHeight:x[13],thumbData:x.subarray(14,14+3*x[12]*x[13])}),65518===g&&65===x[0]&&100===x[1]&&111===x[2]&&98===x[3]&&101===x[4]&&0===x[5]&&(u={version:x[6],flags0:x[7]<<8|x[8],flags1:x[9]<<8|x[10],transformCode:x[11]});break;case 65499:for(var b=n()+l-2;l<b;){var w=i[l++],M=new Int32Array(64);if(w>>4==0)for(y=0;y<64;y++)M[t[y]]=i[l++];else{if(w>>4!=1)throw"DQT: invalid table spec";for(y=0;y<64;y++)M[t[y]]=n()}p[15&w]=M}break;case 65472:case 65473:case 65474:if(a)throw"Only single frame JPEGs supported";n(),(a={}).extended=65473===g,a.progressive=65474===g,a.precision=i[l++],a.scanLines=n(),a.samplesPerLine=n(),a.components=[],a.componentIds={};var S,E=i[l++],T=0,A=0;for(W=0;W<E;W++){S=i[l];var P=i[l+1]>>4,C=15&i[l+1];T<P&&(T=P),A<C&&(A=C);var L=i[l+2];v=a.components.push({h:P,v:C,quantizationTable:p[L],quantizationTableId:L,bitConversion:255/((1<<a.precision)-1)}),a.componentIds[S]=v-1,l+=3}a.maxH=T,a.maxV=A,s(a);break;case 65476:var R=n();for(W=2;W<R;){var I=i[l++],D=new Uint8Array(16),O=0;for(y=0;y<16;y++,l++)O+=D[y]=i[l];var N=new Uint8Array(O);for(y=0;y<O;y++,l++)N[y]=i[l];W+=17+O,(I>>4==0?_:m)[15&I]=c(D,N)}break;case 65501:n(),o=n();break;case 65498:n();var F=i[l++],k=[];for(W=0;W<F;W++){var z=a.componentIds[i[l++]];j=a.components[z];var U=i[l++];j.huffmanTableDC=_[U>>4],j.huffmanTableAC=m[15&U],k.push(j)}var B=i[l++],H=i[l++],G=i[l++],V=d(i,l,a,k,o,B,H,G>>4,15&G);l+=V;break;default:if(255==i[l-3]&&i[l-2]>=192&&i[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+g.toString(16)}g=n()}switch(this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=h,this.adobe=u,this.components=[],a.components.length){case 1:this.colorspace=e.Grayscale;break;case 3:this.adobe?this.colorspace=e.AdobeRGB:this.colorspace=e.RGB;break;case 4:this.colorspace=e.CYMK;break;default:this.colorspace=e.Unknown}for(var W=0;W<a.components.length;W++){var j;(j=a.components[W]).quantizationTable||null===j.quantizationTableId||(j.quantizationTable=p[j.quantizationTableId]),this.components.push({output:f(0,j),scaleX:j.h/a.maxH,scaleY:j.v/a.maxV,blocksPerLine:j.blocksPerLine,blocksPerColumn:j.blocksPerColumn,bitConversion:j.bitConversion})}},getData16:function(t,e){if(1!==this.components.length)throw"Unsupported color mode";var i,n,r,s,a,o,l=this.width/t,h=this.height/e,c=0,d=this.components.length,p=new Uint16Array(t*e*d),f=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(o=0;o<d;o++){for(var m,_,g,y=(i=this.components[o]).blocksPerLine,v=i.blocksPerColumn,x=y<<3,b=0,w=0;w<v;w++)for(var M=w<<3,S=0;S<y;S++){var E=u(i,w,S),T=(c=0,S<<3);for(m=0;m<8;m++)for(b=(M+m)*x,_=0;_<8;_++)f[b+T+_]=i.output[E+c++]}for(n=i.scaleX*l,r=i.scaleY*h,c=o,a=0;a<e;a++)for(s=0;s<t;s++)g=(0|a*r)*x+(0|s*n),p[c]=f[g],c+=d}return p},getData:function(t,e){var i,n,r,s,a,o,l,h,c,d,p,f,_,g,y,v=this.width/t,x=this.height/e,b=0,w=this.components.length,M=t*e*w,S=new Uint8Array(M),E=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(o=0;o<w;o++){for(var T,A,P,C=(i=this.components[o]).blocksPerLine,L=i.blocksPerColumn,R=C<<3,I=0,D=0;D<L;D++)for(var O=D<<3,N=0;N<C;N++){var F=u(i,D,N),k=(b=0,N<<3);for(T=0;T<8;T++)for(I=(O+T)*R,A=0;A<8;A++)E[I+k+A]=i.output[F+b++]*i.bitConversion}for(n=i.scaleX*v,r=i.scaleY*x,b=o,a=0;a<e;a++)for(s=0;s<t;s++)P=(0|a*r)*R+(0|s*n),S[b]=E[P],b+=w}switch(w){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(o=0;o<M;o+=w)l=S[o],h=S[o+1],f=m(l-179.456+1.402*(c=S[o+2])),_=m(l+135.459-.344*h-.714*c),g=m(l-226.816+1.772*h),S[o]=f,S[o+1]=_,S[o+2]=g;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(o=0;o<M;o+=w)l=S[o],h=S[o+1],d=m(434.456-l-1.402*(c=S[o+2])),p=m(119.541-l+.344*h+.714*c),l=m(481.816-l-1.772*h),S[o]=d,S[o+1]=p,S[o+2]=l;break;default:throw"Unsupported color mode"}return S}},constructor}();t.exports&&(t.exports=i)},1566:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>f}),t=i.hmd(t);const n={LL:0,LH:1,HL:1,HH:2};class r{constructor(t,e){var i=W(Math.max(t,e))+1;this.levels=[];for(var n=0;n<i;n++){var r={width:t,height:e,items:[]};this.levels.push(r),t=Math.ceil(t/2),e=Math.ceil(e/2)}}reset(t,e){for(var i,n=0,r=0;n<this.levels.length;){var s=t+e*(i=this.levels[n]).width;if(void 0!==i.items[s]){r=i.items[s];break}i.index=s,t>>=1,e>>=1,n++}n--,(i=this.levels[n]).items[i.index]=r,this.currentLevel=n,delete this.value}incrementValue(){var t=this.levels[this.currentLevel];t.items[t.index]++}nextLevel(){var t=this.currentLevel,e=this.levels[t],i=e.items[e.index];return--t<0?(this.value=i,!1):(this.currentLevel=t,(e=this.levels[t]).items[e.index]=i,!0)}}class s{constructor(t,e){var i=W(Math.max(t,e))+1;this.levels=[];for(var n=0;n<i;n++){for(var r=new Uint8Array(t*e),s=new Uint8Array(t*e),a=0,o=r.length;a<o;a++)r[a]=0,s[a]=0;var l={width:t,height:e,items:r,status:s};this.levels.push(l),t=Math.ceil(t/2),e=Math.ceil(e/2)}}reset(t,e,i){this.currentStopValue=i;for(var n=0;n<this.levels.length;){var r=this.levels[n],s=t+e*r.width;r.index=s,t>>=1,e>>=1,n++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]}incrementValue(){var t=this.levels[this.currentLevel];t.items[t.index]=t.items[t.index]+1,t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index])}nextLevel(){var t=this.currentLevel;if(--t<0)return!1;this.currentLevel=t;var e=this.levels[t];return e.items[e.index]<this.minValue?e.items[e.index]=this.minValue:e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index]),!0}isLeaf(){return 0===this.currentLevel}isAboveThreshold(){var t=this.currentLevel,e=this.levels[t];return e.items[e.index]>this.currentStopValue}isKnown(){var t=this.currentLevel,e=this.levels[t];return e.status[e.index]>0}setKnown(){var t=this.currentLevel,e=this.levels[t];e.status[e.index]=1}}var a=17,o=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),l=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),h=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);class c{constructor(t,e,i,n,r){this.width=t,this.height=e,this.contextLabelTable="HH"===i?h:"HL"===i?l:o;var s=t*e;this.neighborsSignificance=new Uint8Array(s),this.coefficentsSign=new Uint8Array(s),this.coefficentsMagnitude=r>14?new Uint32Array(s):r>6?new Uint16Array(s):new Uint8Array(s),this.processingFlags=new Uint8Array(s);var a=new Uint8Array(s);if(0!==n)for(var c=0;c<s;c++)a[c]=n;this.bitsDecoded=a,this.reset()}setDecoder(t){this.decoder=t}reset(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6}setNeighborsSignificance(t,e,i){var n,r=this.neighborsSignificance,s=this.width,a=this.height,o=e>0,l=e+1<s;t>0&&(n=i-s,o&&(r[n-1]+=16),l&&(r[n+1]+=16),r[n]+=4),t+1<a&&(n=i+s,o&&(r[n-1]+=16),l&&(r[n+1]+=16),r[n]+=4),o&&(r[i-1]+=1),l&&(r[i+1]+=1),r[i]|=128}runSignificancePropogationPass(){for(var t=this.decoder,e=this.width,i=this.height,n=this.coefficentsMagnitude,r=this.coefficentsSign,s=this.neighborsSignificance,a=this.processingFlags,o=this.contexts,l=this.contextLabelTable,h=this.bitsDecoded,c=0;c<i;c+=4)for(var u=0;u<e;u++)for(var d=c*e+u,p=0;p<4;p++,d+=e){var f=c+p;if(f>=i)break;if(a[d]&=-2,!n[d]&&s[d]){var m=l[s[d]];if(t.readBit(o,m)){var _=this.decodeSignBit(f,u,d);r[d]=_,n[d]=1,this.setNeighborsSignificance(f,u,d),a[d]|=2}h[d]++,a[d]|=1}}}decodeSignBit(t,e,i){var n,r,s,a,o,l,h=this.width,c=this.height,u=this.coefficentsMagnitude,d=this.coefficentsSign;a=e>0&&0!==u[i-1],e+1<h&&0!==u[i+1]?(s=d[i+1],n=a?1-s-(r=d[i-1]):1-s-s):n=a?1-(r=d[i-1])-r:0;var p=3*n;return a=t>0&&0!==u[i-h],t+1<c&&0!==u[i+h]?(s=d[i+h],n=a?1-s-(r=d[i-h])+p:1-s-s+p):n=a?1-(r=d[i-h])-r+p:p,n>=0?(o=9+n,l=this.decoder.readBit(this.contexts,o)):(o=9-n,l=1^this.decoder.readBit(this.contexts,o)),l}runMagnitudeRefinementPass(){for(var t,e=this.decoder,i=this.width,n=this.height,r=this.coefficentsMagnitude,s=this.neighborsSignificance,a=this.contexts,o=this.bitsDecoded,l=this.processingFlags,h=i*n,c=4*i,u=0;u<h;u=t){t=Math.min(h,u+c);for(var d=0;d<i;d++)for(var p=u+d;p<t;p+=i)if(r[p]&&0==(1&l[p])){var f=16;0!=(2&l[p])&&(l[p]^=2,f=0==(127&s[p])?15:14);var m=e.readBit(a,f);r[p]=r[p]<<1|m,o[p]++,l[p]|=1}}}runCleanupPass(){for(var t,e=this.decoder,i=this.width,n=this.height,r=this.neighborsSignificance,s=this.coefficentsMagnitude,o=this.coefficentsSign,l=this.contexts,h=this.contextLabelTable,c=this.bitsDecoded,u=this.processingFlags,d=i,p=2*i,f=3*i,m=0;m<n;m=t){t=Math.min(m+4,n);for(var _=m*i,g=m+3<n,y=0;y<i;y++){var v,x=_+y,b=0,w=x,M=m;if(g&&0===u[x]&&0===u[x+d]&&0===u[x+p]&&0===u[x+f]&&0===r[x]&&0===r[x+d]&&0===r[x+p]&&0===r[x+f]){if(!e.readBit(l,18)){c[x]++,c[x+d]++,c[x+p]++,c[x+f]++;continue}0!=(b=e.readBit(l,a)<<1|e.readBit(l,a))&&(M=m+b,w+=b*i),v=this.decodeSignBit(M,y,w),o[w]=v,s[w]=1,this.setNeighborsSignificance(M,y,w),u[w]|=2,w=x;for(var S=m;S<=M;S++,w+=i)c[w]++;b++}for(M=m+b;M<t;M++,w+=i)if(!s[w]&&0==(1&u[w])){var E=h[r[w]];1===e.readBit(l,E)&&(v=this.decodeSignBit(M,y,w),o[w]=v,s[w]=1,this.setNeighborsSignificance(M,y,w),u[w]|=2),c[w]++}}}}checkSegmentationSymbol(){var t=this.decoder,e=this.contexts;if(10!=(t.readBit(e,a)<<3|t.readBit(e,a)<<2|t.readBit(e,a)<<1|t.readBit(e,a)))throw new Error("JPX Error: Invalid segmentation symbol")}}class u{constructor(){}calculate(t,e,i){for(var n=t[0],r=1,s=t.length;r<s;r++)n=this.iterate(n,t[r],e,i);return n}extend(t,e,i){var n=e-1,r=e+1,s=e+i-2,a=e+i;t[n--]=t[r++],t[a++]=t[s--],t[n--]=t[r++],t[a++]=t[s--],t[n--]=t[r++],t[a++]=t[s--],t[n]=t[r],t[a]=t[s]}iterate(t,e,i,n){var r,s,a,o,l,h,c=t.width,u=t.height,d=t.items,p=e.width,f=e.height,m=e.items;for(a=0,r=0;r<u;r++)for(o=2*r*p,s=0;s<c;s++,a++,o+=2)m[o]=d[a];d=t.items=null;var _=new Float32Array(p+8);if(1===p){if(0!=(1&i))for(h=0,a=0;h<f;h++,a+=p)m[a]*=.5}else for(h=0,a=0;h<f;h++,a+=p)_.set(m.subarray(a,a+p),4),this.extend(_,4,p),this.filter(_,4,p),m.set(_.subarray(4,4+p),a);var g=16,y=[];for(r=0;r<g;r++)y.push(new Float32Array(f+8));var v,x=0;if(t=4+f,1===f){if(0!=(1&n))for(l=0;l<p;l++)m[l]*=.5}else for(l=0;l<p;l++){if(0===x){for(g=Math.min(p-l,g),a=l,o=4;o<t;a+=p,o++)for(v=0;v<g;v++)y[v][o]=m[a+v];x=g}var b=y[--x];if(this.extend(b,4,f),this.filter(b,4,f),0===x)for(a=l-g+1,o=4;o<t;a+=p,o++)for(v=0;v<g;v++)m[a+v]=y[v][o]}return{width:p,height:f,items:m}}}class d extends u{constructor(){super()}filter(t,e,i){var n,r,s,a,o=i>>1,l=-1.586134342059924,h=-.052980118572961,c=.882911075530934,u=.443506852043971,d=1.230174104914001;for(n=(e|=0)-3,r=o+4;r--;n+=2)t[n]*=.8128930661159609;for(s=u*t[(n=e-2)-1],r=o+3;r--&&(a=u*t[n+1],t[n]=d*t[n]-s-a,r--);n+=2)s=u*t[(n+=2)+1],t[n]=d*t[n]-s-a;for(s=c*t[(n=e-1)-1],r=o+2;r--&&(a=c*t[n+1],t[n]-=s+a,r--);n+=2)s=c*t[(n+=2)+1],t[n]-=s+a;for(s=h*t[(n=e)-1],r=o+1;r--&&(a=h*t[n+1],t[n]-=s+a,r--);n+=2)s=h*t[(n+=2)+1],t[n]-=s+a;if(0!==o)for(s=l*t[(n=e+1)-1],r=o;r--&&(a=l*t[n+1],t[n]-=s+a,r--);n+=2)s=l*t[(n+=2)+1],t[n]-=s+a}}class p extends u{constructor(){super()}filter(t,e,i){var n,r,s=i>>1;for(n=e|=0,r=s+1;r--;n+=2)t[n]-=t[n-1]+t[n+1]+2>>2;for(n=e+1,r=s;r--;n+=2)t[n]+=t[n-1]+t[n+1]>>1}}class f{failOnCorruptedImage=!1;parse(t){if(65359!==j(t,0))for(var e=0,i=t.length;e<i;){var n=8,r=q(t,e),s=q(t,e+4);if(e+=n,1===r&&(r=4294967296*q(t,e)+q(t,e+4),e+=8,n+=8),0===r&&(r=i-e+n),r<n)throw new Error("JPX Error: Invalid box field size");var a=r-n,o=!0;switch(s){case 1785737832:o=!1;break;case 1668246642:var l=t[e];if(t[e+1],t[e+2],1===l){var h=q(t,e+3);switch(h){case 16:case 17:case 18:break;default:k("Unknown colorspace "+h)}}else 2===l&&(c="ICC profile not supported",PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+c));break;case 1785737827:this.parseCodestream(t,e,e+a);break;case 1783636e3:218793738!==q(t,e)&&k("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:k("Unsupported header type "+s+" ("+String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s)+")")}o&&(e+=a)}else this.parseCodestream(t,0,t.length);var c}parseImageProperties(t){for(var e=t.getByte();e>=0;)if(65361==(e<<8|(e=t.getByte()))){t.skip(4);var i=t.getInt32()>>>0,n=t.getInt32()>>>0,r=t.getInt32()>>>0,s=t.getInt32()>>>0;t.skip(16);var a=t.getUint16();return this.width=i-r,this.height=n-s,this.componentsCount=a,void(this.bitsPerComponent=8)}throw new Error("JPX Error: No size marker found in JPX stream")}parseCodestream(t,e,i){var n={};try{for(var r=!1,s=e;s+1<i;){var a=j(t,s);s+=2;var o,l,h,c,u,d,p=0;switch(a){case 65359:n.mainHeader=!0;break;case 65497:break;case 65361:p=j(t,s);var f={};f.Xsiz=q(t,s+4),f.Ysiz=q(t,s+8),f.XOsiz=q(t,s+12),f.YOsiz=q(t,s+16),f.XTsiz=q(t,s+20),f.YTsiz=q(t,s+24),f.XTOsiz=q(t,s+28),f.YTOsiz=q(t,s+32);var g=j(t,s+36);f.Csiz=g;var y=[];o=s+38;for(var v=0;v<g;v++){var x={precision:1+(127&t[o]),isSigned:!!(128&t[o]),XRsiz:t[o+1],YRsiz:t[o+1]};m(x,f),y.push(x)}n.SIZ=f,n.components=y,_(n,y),n.QCC=[],n.COC=[];break;case 65372:p=j(t,s);var b={};switch(o=s+2,31&(l=t[o++])){case 0:c=8,u=!0;break;case 1:c=16,u=!1;break;case 2:c=16,u=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+l)}for(b.noQuantization=8===c,b.scalarExpounded=u,b.guardBits=l>>5,h=[];o<p+s;){var w={};8===c?(w.epsilon=t[o++]>>3,w.mu=0):(w.epsilon=t[o]>>3,w.mu=(7&t[o])<<8|t[o+1],o+=2),h.push(w)}b.SPqcds=h,n.mainHeader?n.QCD=b:(n.currentTile.QCD=b,n.currentTile.QCC=[]);break;case 65373:p=j(t,s);var M,S={};switch(o=s+2,n.SIZ.Csiz<257?M=t[o++]:(M=j(t,o),o+=2),31&(l=t[o++])){case 0:c=8,u=!0;break;case 1:c=16,u=!1;break;case 2:c=16,u=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+l)}for(S.noQuantization=8===c,S.scalarExpounded=u,S.guardBits=l>>5,h=[];o<p+s;)w={},8===c?(w.epsilon=t[o++]>>3,w.mu=0):(w.epsilon=t[o]>>3,w.mu=(7&t[o])<<8|t[o+1],o+=2),h.push(w);S.SPqcds=h,n.mainHeader?n.QCC[M]=S:n.currentTile.QCC[M]=S;break;case 65362:p=j(t,s);var E={};o=s+2;var T=t[o++];E.entropyCoderWithCustomPrecincts=!!(1&T),E.sopMarkerUsed=!!(2&T),E.ephMarkerUsed=!!(4&T),E.progressionOrder=t[o++],E.layersCount=j(t,o),o+=2,E.multipleComponentTransform=t[o++],E.decompositionLevelsCount=t[o++],E.xcb=2+(15&t[o++]),E.ycb=2+(15&t[o++]);var A=t[o++];if(E.selectiveArithmeticCodingBypass=!!(1&A),E.resetContextProbabilities=!!(2&A),E.terminationOnEachCodingPass=!!(4&A),E.verticalyStripe=!!(8&A),E.predictableTermination=!!(16&A),E.segmentationSymbolUsed=!!(32&A),E.reversibleTransformation=t[o++],E.entropyCoderWithCustomPrecincts){for(var L=[];o<p+s;){var D=t[o++];L.push({PPx:15&D,PPy:D>>4})}E.precinctsSizes=L}var O=[];if(E.selectiveArithmeticCodingBypass&&O.push("selectiveArithmeticCodingBypass"),E.resetContextProbabilities&&O.push("resetContextProbabilities"),E.terminationOnEachCodingPass&&O.push("terminationOnEachCodingPass"),E.verticalyStripe&&O.push("verticalyStripe"),E.predictableTermination&&O.push("predictableTermination"),O.length>0)throw r=!0,new Error("JPX Error: Unsupported COD options ("+O.join(", ")+")");n.mainHeader?n.COD=E:(n.currentTile.COD=E,n.currentTile.COC=[]);break;case 65424:p=j(t,s),(d={}).index=j(t,s+2),d.length=q(t,s+4),d.dataEnd=d.length+s-2,d.partIndex=t[s+8],d.partsCount=t[s+9],n.mainHeader=!1,0===d.partIndex&&(d.COD=n.COD,d.COC=n.COC.slice(0),d.QCD=n.QCD,d.QCC=n.QCC.slice(0)),n.currentTile=d;break;case 65427:0===(d=n.currentTile).partIndex&&(I(n,d.index),P(n)),C(n,t,s,p=d.dataEnd-s);break;case 65365:case 65367:case 65368:case 65380:p=j(t,s);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+a.toString(16))}s+=p}}catch(t){if(r||this.failOnCorruptedImage)throw t;k("Trying to recover from "+t.message)}this.tiles=function(t){for(var e=t.SIZ,i=t.components,n=e.Csiz,r=[],s=0,a=t.tiles.length;s<a;s++){var o,l=t.tiles[s],h=[];for(o=0;o<n;o++)h[o]=R(t,l,o);var c=h[0];if(z=i[0].isSigned)var u=new Int16Array(c.items.length*n);else u=new Uint16Array(c.items.length*n);var d,p,f,m,_,g,y,v,x,b,w,M,S,E,T,A={left:c.left,top:c.top,width:c.width,height:c.height,items:u},P=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var C=4===n,L=h[0].items,I=h[1].items,D=h[2].items,O=C?h[3].items:null;p=.5+(128<<(d=i[0].precision-8)),m=-(_=.5*(f=255*(1<<d)));var N=l.components[0],F=n-3;if(y=L.length,N.codingStyleParameters.reversibleTransformation)for(g=0;g<y;g++,P+=F)v=L[g]+p,x=I[g],w=(M=v-((b=D[g])+x>>2))+b,S=M+x,u[P++]=w<=0?0:w>=f?255:w>>d,u[P++]=M<=0?0:M>=f?255:M>>d,u[P++]=S<=0?0:S>=f?255:S>>d;else for(g=0;g<y;g++,P+=F)v=L[g]+p,x=I[g],w=v+1.402*(b=D[g]),M=v-.34413*x-.71414*b,S=v+1.772*x,u[P++]=w<=0?0:w>=f?255:w>>d,u[P++]=M<=0?0:M>=f?255:M>>d,u[P++]=S<=0?0:S>=f?255:S>>d;if(C)for(g=0,P=3;g<y;g++,P+=4)E=O[g],u[P]=E<=m?0:E>=_?255:E+p>>d}else for(o=0;o<n;o++)if(8===i[o].precision){var k=h[o].items;for(p=.5+(128<<(d=i[o].precision-8)),m=-(f=127.5*(1<<d)),P=o,g=0,y=k.length;g<y;g++)T=k[g],u[P]=T<=m?0:T>=f?255:T+p>>d,P+=n}else{var z=i[o].isSigned;if(k=h[o].items,z)for(P=o,g=0,y=k.length;g<y;g++)u[P]=k[g],P+=n;else{p=.5+(128<<(d=i[o].precision-8));var U=Math.pow(2,i[o].precision)-1;for(P=o,g=0,y=k.length;g<y;g++)T=k[g],u[P]=Math.max(Math.min(T+p,U),0),P+=n}}r.push(A)}return r}(n),this.width=n.SIZ.Xsiz-n.SIZ.XOsiz,this.height=n.SIZ.Ysiz-n.SIZ.YOsiz,this.componentsCount=n.SIZ.Csiz}}function m(t,e){t.x0=Math.ceil(e.XOsiz/t.XRsiz),t.x1=Math.ceil(e.Xsiz/t.XRsiz),t.y0=Math.ceil(e.YOsiz/t.YRsiz),t.y1=Math.ceil(e.Ysiz/t.YRsiz),t.width=t.x1-t.x0,t.height=t.y1-t.y0}function _(t,e){for(var i,n=t.SIZ,r=[],s=Math.ceil((n.Xsiz-n.XTOsiz)/n.XTsiz),a=Math.ceil((n.Ysiz-n.YTOsiz)/n.YTsiz),o=0;o<a;o++)for(var l=0;l<s;l++)(i={}).tx0=Math.max(n.XTOsiz+l*n.XTsiz,n.XOsiz),i.ty0=Math.max(n.YTOsiz+o*n.YTsiz,n.YOsiz),i.tx1=Math.min(n.XTOsiz+(l+1)*n.XTsiz,n.Xsiz),i.ty1=Math.min(n.YTOsiz+(o+1)*n.YTsiz,n.Ysiz),i.width=i.tx1-i.tx0,i.height=i.ty1-i.ty0,i.components=[],r.push(i);t.tiles=r;for(var h=0,c=n.Csiz;h<c;h++)for(var u=e[h],d=0,p=r.length;d<p;d++){var f={};i=r[d],f.tcx0=Math.ceil(i.tx0/u.XRsiz),f.tcy0=Math.ceil(i.ty0/u.YRsiz),f.tcx1=Math.ceil(i.tx1/u.XRsiz),f.tcy1=Math.ceil(i.ty1/u.YRsiz),f.width=f.tcx1-f.tcx0,f.height=f.tcy1-f.tcy0,i.components[h]=f}}function g(t,e,i){var n=e.codingStyleParameters,r={};return n.entropyCoderWithCustomPrecincts?(r.PPx=n.precinctsSizes[i].PPx,r.PPy=n.precinctsSizes[i].PPy):(r.PPx=15,r.PPy=15),r.xcb_=i>0?Math.min(n.xcb,r.PPx-1):Math.min(n.xcb,r.PPx),r.ycb_=i>0?Math.min(n.ycb,r.PPy-1):Math.min(n.ycb,r.PPy),r}function y(t,e,i){var n=1<<i.PPx,r=1<<i.PPy,s=0===e.resLevel,a=1<<i.PPx+(s?0:-1),o=1<<i.PPy+(s?0:-1),l=e.trx1>e.trx0?Math.ceil(e.trx1/n)-Math.floor(e.trx0/n):0,h=e.try1>e.try0?Math.ceil(e.try1/r)-Math.floor(e.try0/r):0,c=l*h;e.precinctParameters={precinctWidth:n,precinctHeight:r,numprecinctswide:l,numprecinctshigh:h,numprecincts:c,precinctWidthInSubband:a,precinctHeightInSubband:o}}function v(t,e,i){var n,r,s,a,o=i.xcb_,l=i.ycb_,h=1<<o,c=1<<l,u=e.tbx0>>o,d=e.tby0>>l,p=e.tbx1+h-1>>o,f=e.tby1+c-1>>l,m=e.resolution.precinctParameters,_=[],g=[];for(r=d;r<f;r++)for(n=u;n<p;n++)if((s={cbx:n,cby:r,tbx0:h*n,tby0:c*r,tbx1:h*(n+1),tby1:c*(r+1)}).tbx0_=Math.max(e.tbx0,s.tbx0),s.tby0_=Math.max(e.tby0,s.tby0),s.tbx1_=Math.min(e.tbx1,s.tbx1),s.tby1_=Math.min(e.tby1,s.tby1),a=Math.floor((s.tbx0_-e.tbx0)/m.precinctWidthInSubband)+Math.floor((s.tby0_-e.tby0)/m.precinctHeightInSubband)*m.numprecinctswide,s.precinctNumber=a,s.subbandType=e.type,s.Lblock=3,!(s.tbx1_<=s.tbx0_||s.tby1_<=s.tby0_)){_.push(s);var y=g[a];void 0!==y?(n<y.cbxMin?y.cbxMin=n:n>y.cbxMax&&(y.cbxMax=n),r<y.cbyMin?y.cbxMin=r:r>y.cbyMax&&(y.cbyMax=r)):g[a]=y={cbxMin:n,cbyMin:r,cbxMax:n,cbyMax:r},s.precinct=y}e.codeblockParameters={codeblockWidth:o,codeblockHeight:l,numcodeblockwide:p-u+1,numcodeblockhigh:f-d+1},e.codeblocks=_,e.precincts=g}function x(t,e,i){for(var n=[],r=t.subbands,s=0,a=r.length;s<a;s++)for(var o=r[s].codeblocks,l=0,h=o.length;l<h;l++){var c=o[l];c.precinctNumber===e&&n.push(c)}return{layerNumber:i,codeblocks:n}}function b(t){for(var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,s=e.Csiz,a=0,o=0;o<s;o++)a=Math.max(a,n.components[o].codingStyleParameters.decompositionLevelsCount);var l=0,h=0,c=0,u=0;this.nextPacket=function(){for(;l<r;l++){for(;h<=a;h++){for(;c<s;c++){var t=n.components[c];if(!(h>t.codingStyleParameters.decompositionLevelsCount)){for(var e=t.resolutions[h],i=e.precinctParameters.numprecincts;u<i;){var o=x(e,u,l);return u++,o}u=0}}c=0}h=0}}}function w(t){for(var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,s=e.Csiz,a=0,o=0;o<s;o++)a=Math.max(a,n.components[o].codingStyleParameters.decompositionLevelsCount);var l=0,h=0,c=0,u=0;this.nextPacket=function(){for(;l<=a;l++){for(;h<r;h++){for(;c<s;c++){var t=n.components[c];if(!(l>t.codingStyleParameters.decompositionLevelsCount)){for(var e=t.resolutions[l],i=e.precinctParameters.numprecincts;u<i;){var o=x(e,u,h);return u++,o}u=0}}c=0}h=0}}}function M(t){var e,i,n,r,s=t.SIZ,a=t.currentTile.index,o=t.tiles[a],l=o.codingStyleDefaultParameters.layersCount,h=s.Csiz,c=0;for(n=0;n<h;n++){var u=o.components[n];c=Math.max(c,u.codingStyleParameters.decompositionLevelsCount)}var d=new Int32Array(c+1);for(i=0;i<=c;++i){var p=0;for(n=0;n<h;++n){var f=o.components[n].resolutions;i<f.length&&(p=Math.max(p,f[i].precinctParameters.numprecincts))}d[i]=p}e=0,i=0,n=0,r=0,this.nextPacket=function(){for(;i<=c;i++){for(;r<d[i];r++){for(;n<h;n++){var t=o.components[n];if(!(i>t.codingStyleParameters.decompositionLevelsCount)){var s=t.resolutions[i],a=s.precinctParameters.numprecincts;if(!(r>=a)){for(;e<l;){var u=x(s,r,e);return e++,u}e=0}}}n=0}r=0}}}function S(t){var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,s=e.Csiz,a=A(n),o=a,l=0,h=0,c=0,u=0,d=0;this.nextPacket=function(){for(;d<o.maxNumHigh;d++){for(;u<o.maxNumWide;u++){for(;c<s;c++){for(var t=n.components[c],e=t.codingStyleParameters.decompositionLevelsCount;h<=e;h++){var i=t.resolutions[h],p=a.components[c].resolutions[h],f=T(u,d,p,o,i);if(null!==f){for(;l<r;){var m=x(i,f,l);return l++,m}l=0}}h=0}c=0}u=0}}}function E(t){var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,s=e.Csiz,a=A(n),o=0,l=0,h=0,c=0,u=0;this.nextPacket=function(){for(;h<s;++h){for(var t=n.components[h],e=a.components[h],i=t.codingStyleParameters.decompositionLevelsCount;u<e.maxNumHigh;u++){for(;c<e.maxNumWide;c++){for(;l<=i;l++){var d=t.resolutions[l],p=e.resolutions[l],f=T(c,u,p,e,d);if(null!==f){for(;o<r;){var m=x(d,f,o);return o++,m}o=0}}l=0}c=0}u=0}}}function T(t,e,i,n,r){var s=t*n.minWidth,a=e*n.minHeight;if(s%i.width!=0||a%i.height!=0)return null;var o=a/i.width*r.precinctParameters.numprecinctswide;return s/i.height+o}function A(t){for(var e=t.components.length,i=Number.MAX_VALUE,n=Number.MAX_VALUE,r=0,s=0,a=new Array(e),o=0;o<e;o++){for(var l=t.components[o],h=l.codingStyleParameters.decompositionLevelsCount,c=new Array(h+1),u=Number.MAX_VALUE,d=Number.MAX_VALUE,p=0,f=0,m=1,_=h;_>=0;--_){var g=l.resolutions[_],y=m*g.precinctParameters.precinctWidth,v=m*g.precinctParameters.precinctHeight;u=Math.min(u,y),d=Math.min(d,v),p=Math.max(p,g.precinctParameters.numprecinctswide),f=Math.max(f,g.precinctParameters.numprecinctshigh),c[_]={width:y,height:v},m<<=1}i=Math.min(i,u),n=Math.min(n,d),r=Math.max(r,p),s=Math.max(s,f),a[o]={resolutions:c,minWidth:u,minHeight:d,maxNumWide:p,maxNumHigh:f}}return{components:a,minWidth:i,minHeight:n,maxNumWide:r,maxNumHigh:s}}function P(t){for(var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=e.Csiz,s=0;s<r;s++){for(var a=n.components[s],o=a.codingStyleParameters.decompositionLevelsCount,l=[],h=[],c=0;c<=o;c++){var u,d=g(0,a,c),p={},f=1<<o-c;if(p.trx0=Math.ceil(a.tcx0/f),p.try0=Math.ceil(a.tcy0/f),p.trx1=Math.ceil(a.tcx1/f),p.try1=Math.ceil(a.tcy1/f),p.resLevel=c,y(0,p,d),l.push(p),0===c)(u={}).type="LL",u.tbx0=Math.ceil(a.tcx0/f),u.tby0=Math.ceil(a.tcy0/f),u.tbx1=Math.ceil(a.tcx1/f),u.tby1=Math.ceil(a.tcy1/f),u.resolution=p,v(0,u,d),h.push(u),p.subbands=[u];else{var m=1<<o-c+1,_=[];(u={}).type="HL",u.tbx0=Math.ceil(a.tcx0/m-.5),u.tby0=Math.ceil(a.tcy0/m),u.tbx1=Math.ceil(a.tcx1/m-.5),u.tby1=Math.ceil(a.tcy1/m),u.resolution=p,v(0,u,d),h.push(u),_.push(u),(u={}).type="LH",u.tbx0=Math.ceil(a.tcx0/m),u.tby0=Math.ceil(a.tcy0/m-.5),u.tbx1=Math.ceil(a.tcx1/m),u.tby1=Math.ceil(a.tcy1/m-.5),u.resolution=p,v(0,u,d),h.push(u),_.push(u),(u={}).type="HH",u.tbx0=Math.ceil(a.tcx0/m-.5),u.tby0=Math.ceil(a.tcy0/m-.5),u.tbx1=Math.ceil(a.tcx1/m-.5),u.tby1=Math.ceil(a.tcy1/m-.5),u.resolution=p,v(0,u,d),h.push(u),_.push(u),p.subbands=_}}a.resolutions=l,a.subbands=h}var x=n.codingStyleDefaultParameters.progressionOrder;switch(x){case 0:n.packetsIterator=new b(t);break;case 1:n.packetsIterator=new w(t);break;case 2:n.packetsIterator=new M(t);break;case 3:n.packetsIterator=new S(t);break;case 4:n.packetsIterator=new E(t);break;default:throw new Error("JPX Error: Unsupported progression order "+x)}}function C(t,e,i,n){var a,o=0,l=0,h=!1;function c(t){for(;l<t;){if(i+o>=e.length)throw new Error("Unexpected EOF");var n=e[i+o];o++,h?(a=a<<7|n,l+=7,h=!1):(a=a<<8|n,l+=8),255===n&&(h=!0)}return a>>>(l-=t)&(1<<t)-1}function u(t){return 255===e[i+o-1]&&e[i+o]===t?(d(1),!0):255===e[i+o]&&e[i+o+1]===t&&(d(2),!0)}function d(t){o+=t}function p(){l=0,h&&(o++,h=!1)}function f(){if(0===c(1))return 1;if(0===c(1))return 2;var t=c(2);return t<3?t+3:(t=c(5))<31?t+6:(t=c(7))+37}for(var m=t.currentTile.index,_=t.tiles[m],g=t.COD.sopMarkerUsed,y=t.COD.ephMarkerUsed,v=_.packetsIterator;o<n;)try{p(),g&&u(145)&&d(4);var x=v.nextPacket();if(void 0===x)return;if(!c(1))continue;for(var b,w=x.layerNumber,M=[],S=0,E=x.codeblocks.length;S<E;S++){var T=(b=x.codeblocks[S]).precinct,A=b.cbx-T.cbxMin,P=b.cby-T.cbyMin,C=!1,L=!1;if(void 0!==b.included)C=!!c(1);else{var R,I;if(void 0!==(T=b.precinct).inclusionTree)R=T.inclusionTree;else{var D=T.cbxMax-T.cbxMin+1,O=T.cbyMax-T.cbyMin+1;R=new s(D,O),I=new r(D,O),T.inclusionTree=R,T.zeroBitPlanesTree=I}for(R.reset(A,P,w);;){if(o>=e.length)return;if(R.isAboveThreshold())break;if(R.isKnown())R.nextLevel();else if(c(1)){if(R.setKnown(),R.isLeaf()){b.included=!0,C=L=!0;break}R.nextLevel()}else R.incrementValue()}}if(C){if(L){for((I=T.zeroBitPlanesTree).reset(A,P);;){if(o>=e.length)return;if(c(1)){if(!I.nextLevel())break}else I.incrementValue()}b.zeroBitPlanes=I.value}for(var N=f();c(1);)b.Lblock++;var F=W(N),k=c((N<1<<F?F-1:F)+b.Lblock);M.push({codeblock:b,codingpasses:N,dataLength:k})}}for(p(),y&&u(146);M.length>0;){var z=M.shift();void 0===(b=z.codeblock).data&&(b.data=[]),b.data.push({data:e,start:i+o,end:i+o+z.dataLength,codingpasses:z.codingpasses}),o+=z.dataLength}}catch(t){return}return o}function L(t,e,i,n,r,s,a,o){for(var l=n.tbx0,h=n.tby0,u=n.tbx1-n.tbx0,d=n.codeblocks,p="H"===n.type.charAt(0)?1:0,f="H"===n.type.charAt(1)?e:0,m=0,_=d.length;m<_;++m){var g=d[m],y=g.tbx1_-g.tbx0_,v=g.tby1_-g.tby0_;if(0!==y&&0!==v&&void 0!==g.data){var x,b;x=new c(y,v,g.subbandType,g.zeroBitPlanes,s),b=2;var w,M,S,E=g.data,T=0,A=0;for(w=0,M=E.length;w<M;w++)T+=(S=E[w]).end-S.start,A+=S.codingpasses;var P=new Int16Array(T),C=0;for(w=0,M=E.length;w<M;w++){var L=(S=E[w]).data.subarray(S.start,S.end);P.set(L,C),C+=L.length}var R=new O(P,0,T);for(x.setDecoder(R),w=0;w<A;w++){switch(b){case 0:x.runSignificancePropogationPass();break;case 1:x.runMagnitudeRefinementPass();break;case 2:x.runCleanupPass(),o&&x.checkSegmentationSymbol()}b=(b+1)%3}var I,D,N,F=g.tbx0_-l+(g.tby0_-h)*u,k=x.coefficentsSign,z=x.coefficentsMagnitude,U=x.bitsDecoded,B=a?0:.5;C=0;var H="LL"!==n.type;for(w=0;w<v;w++){var G=2*(F/u|0)*(e-u)+p+f;for(I=0;I<y;I++){if(0!==(D=z[C]))D=(D+B)*r,0!==k[C]&&(D=-D),N=U[C],t[H?G+(F<<1):F]=a&&N>=s?D:D*(1<<s-N);F++,C++}F+=u-y}}}}function R(t,e,i){for(var r=e.components[i],s=r.codingStyleParameters,a=r.quantizationParameters,o=s.decompositionLevelsCount,l=a.SPqcds,h=a.scalarExpounded,c=a.guardBits,u=s.segmentationSymbolUsed,f=t.components[i].precision,m=s.reversibleTransformation,_=m?new p:new d,g=[],y=0,v=0;v<=o;v++){for(var x=r.resolutions[v],b=x.trx1-x.trx0,w=x.try1-x.try0,M=new Float32Array(b*w),S=0,E=x.subbands.length;S<E;S++){var T,A;h?(T=l[y].mu,A=l[y].epsilon,y++):(T=l[0].mu,A=l[0].epsilon+(v>0?1-v:0));var P=x.subbands[S],C=n[P.type];L(M,b,0,P,m?1:Math.pow(2,f+C-A)*(1+T/2048),c+A-1,m,u)}g.push({width:b,height:w,items:M})}var R=_.calculate(g,r.tcx0,r.tcy0);return{left:r.tcx0,top:r.tcy0,width:R.width,height:R.height,items:R.items}}function I(t,e){for(var i=t.SIZ.Csiz,n=t.tiles[e],r=0;r<i;r++){var s=n.components[r],a=void 0!==t.currentTile.QCC[r]?t.currentTile.QCC[r]:t.currentTile.QCD;s.quantizationParameters=a;var o=void 0!==t.currentTile.COC[r]?t.currentTile.COC[r]:t.currentTile.COD;s.codingStyleParameters=o}n.codingStyleDefaultParameters=t.currentTile.COD}var D=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];class O{constructor(t,e,i){this.data=t,this.bp=e,this.dataEnd=i,this.chigh=t[e],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}byteIn(){var t=this.data,e=this.bp;255===t[e]?t[e+1]>143?(this.clow+=65280,this.ct=8):(e++,this.clow+=t[e]<<9,this.ct=7,this.bp=e):(e++,this.clow+=e<this.dataEnd?t[e]<<8:65280,this.ct=8,this.bp=e),this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)}readBit(t,e){var i,n=t[e]>>1,r=1&t[e],s=D[n],a=s.qe,o=this.a-a;if(this.chigh<a)o<a?(o=a,i=r,n=s.nmps):(o=a,i=1^r,1===s.switchFlag&&(r=i),n=s.nlps);else{if(this.chigh-=a,0!=(32768&o))return this.a=o,r;o<a?(i=1^r,1===s.switchFlag&&(r=i),n=s.nlps):(i=r,n=s.nmps)}do{0===this.ct&&this.byteIn(),o<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&o));return this.a=o,t[e]=n<<1|r,i}}var N,F="undefined"==typeof window?void 0:window;function k(t){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+t)}function z(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!1}),i}F.PDFJS||(F.PDFJS={}),F.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5},PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},PDFJS.UnsupportedManager=(N=[],{listen:function(t){N.push(t)},notify:function(t){k('Unsupported feature "'+t+'"');for(var e=0,i=N.length;e<i;e++)N[e](t)}}),PDFJS.isValidUrl=function(t,e){if(!t)return!1;var i=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(t);if(!i)return e;switch(i=i[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}},PDFJS.shadow=z,PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var U=function(){function t(t,e){this.name="PasswordException",this.message=t,this.code=e}return t.prototype=new Error,t.constructor=t,t}();PDFJS.PasswordException=U;var B=function(){function t(t,e){this.name="UnknownErrorException",this.message=t,this.details=e}return t.prototype=new Error,t.constructor=t,t}();PDFJS.UnknownErrorException=B;var H=function(){function t(t){this.name="InvalidPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}();PDFJS.InvalidPDFException=H;var G=function(){function t(t){this.name="MissingPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}();PDFJS.MissingPDFException=G;var V=function(){function t(t,e){this.name="UnexpectedResponseException",this.message=t,this.status=e}return t.prototype=new Error,t.constructor=t,t}();function W(t){for(var e=1,i=0;t>e;)e<<=1,i++;return i}function j(t,e){return t[e]<<8|t[e+1]}function q(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}PDFJS.UnexpectedResponseException=V,function(){function t(t){this.message=t}t.prototype=new Error,t.prototype.name="NotImplementedException",t.constructor=t}(),function(){function t(t,e){this.begin=t,this.end=e,this.message="Missing data ["+t+", "+e+")"}t.prototype=new Error,t.prototype.name="MissingDataException",t.constructor=t}(),function(){function t(t){this.message=t}t.prototype=new Error,t.prototype.name="XRefParseException",t.constructor=t}(),Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return z(PDFJS,"isLittleEndian",((t=new Uint8Array(2))[0]=1,1===new Uint16Array(t.buffer)[0]));var t}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return z(PDFJS,"hasCanvasTypedArrays",((t=document.createElement("canvas")).width=t.height=1,void 0!==t.getContext("2d").createImageData(1,1).data.buffer));var t}}),Object.create(null);var X,Y=PDFJS.Util=function(){function t(){}var e=["rgb(",0,",",0,",",0,")"];return t.makeCssRgb=function(t,i,n){return e[1]=t,e[3]=i,e[5]=n,e.join("")},t.transform=function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},t.applyTransform=function(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]},t.applyInverseTransform=function(t,e){var i=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i]},t.getAxialAlignedBoundingBox=function(e,i){var n=t.applyTransform(e,i),r=t.applyTransform(e.slice(2,4),i),s=t.applyTransform([e[0],e[3]],i),a=t.applyTransform([e[2],e[1]],i);return[Math.min(n[0],r[0],s[0],a[0]),Math.min(n[1],r[1],s[1],a[1]),Math.max(n[0],r[0],s[0],a[0]),Math.max(n[1],r[1],s[1],a[1])]},t.inverseTransform=function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]},t.apply3dTransform=function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]},t.singularValueDecompose2dScale=function(t){var e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2],s=t[2]*e[1]+t[3]*e[3],a=(i+s)/2,o=Math.sqrt((i+s)*(i+s)-4*(i*s-r*n))/2,l=a+o||1,h=a-o||1;return[Math.sqrt(l),Math.sqrt(h)]},t.normalizeRect=function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e},t.intersect=function(e,i){function n(t,e){return t-e}var r=[e[0],e[2],i[0],i[2]].sort(n),s=[e[1],e[3],i[1],i[3]].sort(n),a=[];return e=t.normalizeRect(e),i=t.normalizeRect(i),(r[0]===e[0]&&r[1]===i[0]||r[0]===i[0]&&r[1]===e[0])&&(a[0]=r[1],a[2]=r[2],(s[0]===e[1]&&s[1]===i[1]||s[0]===i[1]&&s[1]===e[1])&&(a[1]=s[1],a[3]=s[2],a))},t.sign=function(t){return t<0?-1:1},t.appendToArray=function(t,e){Array.prototype.push.apply(t,e)},t.prependToArray=function(t,e){Array.prototype.unshift.apply(t,e)},t.extendObj=function(t,e){for(var i in e)t[i]=e[i]},t.getInheritableProperty=function(t,e){for(;t&&!t.has(e);)t=t.get("Parent");return t?t.get(e):null},t.inherit=function(t,e,i){for(var n in t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i)t.prototype[n]=i[n]},t.loadScript=function(t,e){var i=document.createElement("script"),n=!1;i.setAttribute("src",t),e&&(i.onload=function(){n||e(),n=!0}),document.getElementsByTagName("head")[0].appendChild(i)},t}();PDFJS.PageViewport=function(){function t(t,e,i,n,r,s){this.viewBox=t,this.scale=e,this.rotation=i,this.offsetX=n,this.offsetY=r;var a,o,l,h,c,u,d,p,f=(t[2]+t[0])/2,m=(t[3]+t[1])/2;switch(i=(i%=360)<0?i+360:i){case 180:a=-1,o=0,l=0,h=1;break;case 90:a=0,o=1,l=1,h=0;break;case 270:a=0,o=-1,l=-1,h=0;break;default:a=1,o=0,l=0,h=-1}s&&(l=-l,h=-h),0===a?(c=Math.abs(m-t[1])*e+n,u=Math.abs(f-t[0])*e+r,d=Math.abs(t[3]-t[1])*e,p=Math.abs(t[2]-t[0])*e):(c=Math.abs(f-t[0])*e+n,u=Math.abs(m-t[1])*e+r,d=Math.abs(t[2]-t[0])*e,p=Math.abs(t[3]-t[1])*e),this.transform=[a*e,o*e,l*e,h*e,c-a*e*f-l*e*m,u-o*e*f-h*e*m],this.width=d,this.height=p,this.fontScale=e}return t.prototype={clone:function(e){var i="scale"in(e=e||{})?e.scale:this.scale,n="rotation"in e?e.rotation:this.rotation;return new t(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,e.dontFlip)},convertToViewportPoint:function(t,e){return Y.applyTransform([t,e],this.transform)},convertToViewportRectangle:function(t){var e=Y.applyTransform([t[0],t[1]],this.transform),i=Y.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]},convertToPdfPoint:function(t,e){return Y.applyInverseTransform([t,e],this.transform)}},t}(),PDFJS.createPromiseCapability=function(){var t={};return t.promise=new Promise((function(e,i){t.resolve=e,t.reject=i})),t},function(){if(F.Promise)return"function"!=typeof F.Promise.all&&(F.Promise.all=function(t){var e,i,n=0,r=[],s=new F.Promise((function(t,n){e=t,i=n}));return t.forEach((function(t,s){n++,t.then((function(t){r[s]=t,0==--n&&e(r)}),i)})),0===n&&e(r),s}),"function"!=typeof F.Promise.resolve&&(F.Promise.resolve=function(t){return new F.Promise((function(e){e(t)}))}),"function"!=typeof F.Promise.reject&&(F.Promise.reject=function(t){return new F.Promise((function(e,i){i(t)}))}),void("function"!=typeof F.Promise.prototype.catch&&(F.Promise.prototype.catch=function(t){return F.Promise.prototype.then(void 0,t)}));var t={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(t){0!==t._status&&(this.handlers=this.handlers.concat(t._handlers),t._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var t=Date.now()+1;this.handlers.length>0;){var e=this.handlers.shift(),i=e.thisPromise._status,n=e.thisPromise._value;try{1===i?"function"==typeof e.onResolve&&(n=e.onResolve(n)):"function"==typeof e.onReject&&(n=e.onReject(n),i=1,e.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(e.thisPromise))}catch(t){i=2,n=t}if(e.nextPromise._updateStatus(i,n),Date.now()>=t)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(t){this.unhandledRejections.push({promise:t,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(t){t._unhandledRejection=!1;for(var e=0;e<this.unhandledRejections.length;e++)this.unhandledRejections[e].promise===t&&(this.unhandledRejections.splice(e),e--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var t=Date.now(),e=0;e<this.unhandledRejections.length;e++)if(t-this.unhandledRejections[e].time>500){var i=this.unhandledRejections[e].promise._value,n="Unhandled rejection: "+i;i.stack&&(n+="\n"+i.stack),k(n),this.unhandledRejections.splice(e),e--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};function e(t){this._status=0,this._handlers=[];try{t.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(t){this._reject(t)}}e.all=function(t){var i,n,r=new e((function(t,e){i=t,n=e})),s=t.length,a=[];if(0===s)return i(a),r;function o(t){2!==r._status&&(a=[],n(t))}for(var l=0,h=t.length;l<h;++l){var c=t[l],u=function(t){return function(e){2!==r._status&&(a[t]=e,0==--s&&i(a))}}(l);e.isPromise(c)?c.then(u,o):u(c)}return r},e.isPromise=function(t){return t&&"function"==typeof t.then},e.resolve=function(t){return new e((function(e){e(t)}))},e.reject=function(t){return new e((function(e,i){i(t)}))},e.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(i,n){1!==this._status&&2!==this._status&&(1===i&&e.isPromise(n)?n.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,2)):(this._status=i,this._value=n,2===i&&0===this._handlers.length&&(this._unhandledRejection=!0,t.addUnhandledRejection(this)),t.scheduleHandlers(this)))},_resolve:function(t){this._updateStatus(1,t)},_reject:function(t){this._updateStatus(2,t)},then:function(i,n){var r=new e((function(t,e){this.resolve=t,this.reject=e}));return this._handlers.push({thisPromise:this,onResolve:i,onReject:n,nextPromise:r}),t.scheduleHandlers(this),r},catch:function(t){return this.then(void 0,t)}},F.Promise=e}(),PDFJS.createBlob=function(t,e){if("undefined"!=typeof Blob)return new Blob([t],{type:e});var i=new MozBlobBuilder;return i.append(t),i.getBlob(e)},PDFJS.createObjectURL=(X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",function(t,e){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var i=PDFJS.createBlob(t,e);return URL.createObjectURL(i)}for(var n="data:"+e+";base64,",r=0,s=t.length;r<s;r+=3){var a=255&t[r],o=255&t[r+1],l=255&t[r+2];n+=X[a>>2]+X[(3&a)<<4|o>>4]+X[r+1<s?(15&o)<<2|l>>6:64]+X[r+2<s?63&l:64]}return n}),t.exports&&(t.exports=f)},8583:(t,e,i)=>{"use strict";function n(t,e){if(t===e)return 0;for(var i=t.length,n=e.length,r=0,s=Math.min(i,n);r<s;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0}function r(t){return i.g.Buffer&&"function"==typeof i.g.Buffer.isBuffer?i.g.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var s=i(69),a=Object.prototype.hasOwnProperty,o=Array.prototype.slice,l="foo"===function(){}.name;function h(t){return Object.prototype.toString.call(t)}function c(t){return!r(t)&&"function"==typeof i.g.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}var u=t.exports=g,d=/\s*function\s+([^\(\s]*)\s*/;function p(t){if(s.isFunction(t)){if(l)return t.name;var e=t.toString().match(d);return e&&e[1]}}function f(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function m(t){if(l||!s.isFunction(t))return s.inspect(t);var e=p(t);return"[Function"+(e?": "+e:"")+"]"}function _(t,e,i,n,r){throw new u.AssertionError({message:i,actual:t,expected:e,operator:n,stackStartFunction:r})}function g(t,e){t||_(t,!0,e,"==",u.ok)}function y(t,e,i,a){if(t===e)return!0;if(r(t)&&r(e))return 0===n(t,e);if(s.isDate(t)&&s.isDate(e))return t.getTime()===e.getTime();if(s.isRegExp(t)&&s.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(c(t)&&c(e)&&h(t)===h(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===n(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(r(t)!==r(e))return!1;var l=(a=a||{actual:[],expected:[]}).actual.indexOf(t);return-1!==l&&l===a.expected.indexOf(e)||(a.actual.push(t),a.expected.push(e),function(t,e,i,n){if(null==t||null==e)return!1;if(s.isPrimitive(t)||s.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=v(t),a=v(e);if(r&&!a||!r&&a)return!1;if(r)return y(t=o.call(t),e=o.call(e),i);var l,h,c=w(t),u=w(e);if(c.length!==u.length)return!1;for(c.sort(),u.sort(),h=c.length-1;h>=0;h--)if(c[h]!==u[h])return!1;for(h=c.length-1;h>=0;h--)if(!y(t[l=c[h]],e[l],i,n))return!1;return!0}(t,e,i,a))}return i?t===e:t==e}function v(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function x(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function b(t,e,i,n){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),r=function(t){var e;try{t()}catch(t){e=t}return e}(e),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),t&&!r&&_(r,i,"Missing expected exception"+n);var a="string"==typeof n,o=!t&&r&&!i;if((!t&&s.isError(r)&&a&&x(r,i)||o)&&_(r,i,"Got unwanted exception"+n),t&&r&&i&&!x(r,i)||!t&&r)throw r}u.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=function(t){return f(m(t.actual),128)+" "+t.operator+" "+f(m(t.expected),128)}(this),this.generatedMessage=!0);var e=t.stackStartFunction||_;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var i=new Error;if(i.stack){var n=i.stack,r=p(e),s=n.indexOf("\n"+r);if(s>=0){var a=n.indexOf("\n",s+1);n=n.substring(a+1)}this.stack=n}}},s.inherits(u.AssertionError,Error),u.fail=_,u.ok=g,u.equal=function(t,e,i){t!=e&&_(t,e,i,"==",u.equal)},u.notEqual=function(t,e,i){t==e&&_(t,e,i,"!=",u.notEqual)},u.deepEqual=function(t,e,i){y(t,e,!1)||_(t,e,i,"deepEqual",u.deepEqual)},u.deepStrictEqual=function(t,e,i){y(t,e,!0)||_(t,e,i,"deepStrictEqual",u.deepStrictEqual)},u.notDeepEqual=function(t,e,i){y(t,e,!1)&&_(t,e,i,"notDeepEqual",u.notDeepEqual)},u.notDeepStrictEqual=function t(e,i,n){y(e,i,!0)&&_(e,i,n,"notDeepStrictEqual",t)},u.strictEqual=function(t,e,i){t!==e&&_(t,e,i,"===",u.strictEqual)},u.notStrictEqual=function(t,e,i){t===e&&_(t,e,i,"!==",u.notStrictEqual)},u.throws=function(t,e,i){b(!0,t,e,i)},u.doesNotThrow=function(t,e,i){b(!1,t,e,i)},u.ifError=function(t){if(t)throw t};var w=Object.keys||function(t){var e=[];for(var i in t)a.call(t,i)&&e.push(i);return e}},6076:t=>{"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},2014:t=>{t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},69:(t,e,i)=>{var n=/%[sdj%]/g;e.format=function(t){if(!_(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var r=arguments,s=r.length,o=String(t).replace(n,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(t){return"[Circular]"}default:return t}})),l=r[i];i<s;l=r[++i])f(l)||!v(l)?o+=" "+l:o+=" "+a(l);return o},e.deprecate=function(t,n){if(g(i.g.process))return function(){return e.deprecate(t,n).apply(this,arguments)};if(!0===process.noDeprecation)return t;var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation?console.trace(n):console.error(n),r=!0}return t.apply(this,arguments)}};var r,s={};function a(t,i){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(i)?n.showHidden=i:i&&e._extend(n,i),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),h(n,t,n.depth)}function o(t,e){var i=a.styles[e];return i?"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m":t}function l(t,e){return t}function h(t,i,n){if(t.customInspect&&i&&w(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(n,t);return _(r)||(r=h(t,r,n)),r}var s=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(_(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return m(e)?t.stylize(""+e,"number"):p(e)?t.stylize(""+e,"boolean"):f(e)?t.stylize("null","null"):void 0}(t,i);if(s)return s;var a=Object.keys(i),o=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(i)),b(i)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return c(i);if(0===a.length){if(w(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(y(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return t.stylize(Date.prototype.toString.call(i),"date");if(b(i))return c(i)}var v,M="",S=!1,E=["{","}"];return d(i)&&(S=!0,E=["[","]"]),w(i)&&(M=" [Function"+(i.name?": "+i.name:"")+"]"),y(i)&&(M=" "+RegExp.prototype.toString.call(i)),x(i)&&(M=" "+Date.prototype.toUTCString.call(i)),b(i)&&(M=" "+c(i)),0!==a.length||S&&0!=i.length?n<0?y(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),v=S?function(t,e,i,n,r){for(var s=[],a=0,o=e.length;a<o;++a)A(e,String(a))?s.push(u(t,e,i,n,String(a),!0)):s.push("");return r.forEach((function(r){r.match(/^\d+$/)||s.push(u(t,e,i,n,r,!0))})),s}(t,i,n,o,a):a.map((function(e){return u(t,i,n,o,e,S)})),t.seen.pop(),function(t,e,i){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}(v,M,E)):E[0]+M+E[1]}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function u(t,e,i,n,r,s){var a,o,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),A(n,r)||(a="["+r+"]"),o||(t.seen.indexOf(l.value)<0?(o=f(i)?h(t,l.value,null):h(t,l.value,i-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+o.split("\n").map((function(t){return"   "+t})).join("\n")):o=t.stylize("[Circular]","special")),g(a)){if(s&&r.match(/^\d+$/))return o;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+o}function d(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function f(t){return null===t}function m(t){return"number"==typeof t}function _(t){return"string"==typeof t}function g(t){return void 0===t}function y(t){return v(t)&&"[object RegExp]"===M(t)}function v(t){return"object"==typeof t&&null!==t}function x(t){return v(t)&&"[object Date]"===M(t)}function b(t){return v(t)&&("[object Error]"===M(t)||t instanceof Error)}function w(t){return"function"==typeof t}function M(t){return Object.prototype.toString.call(t)}function S(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(g(r)&&(r=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(r)){var i=process.pid;s[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,n)}}else s[t]=function(){};return s[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=p,e.isNull=f,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=_,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=y,e.isObject=v,e.isDate=x,e.isError=b,e.isFunction=w,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i(2014);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),E[t.getMonth()],e].join(" ")}function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",T(),e.format.apply(e,arguments))},e.inherits=i(6076),e._extend=function(t,e){if(!e||!v(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}},9284:t=>{"use strict";var e=new Float32Array(1);new Uint32Array(e.buffer)[0]=4286578688,t.exports=e[0]},789:t=>{"use strict";var e=new Float32Array(1);new Uint32Array(e.buffer)[0]=2139095040,t.exports=e[0]},4705:function(t){t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=79)}([function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";(function(t){var n=i(73),r=i(72),s=i(38);function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,i){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return h(this,t,e,i)}function h(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n),l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=d(t,e),t}(t,e,i,n):"string"==typeof e?function(t,e,i){if("string"==typeof i&&""!==i||(i="utf8"),!l.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(e,i),r=(t=o(t,n)).write(e,i);return r!==n&&(t=t.slice(0,r)),t}(t,e,i):function(t,e){if(l.isBuffer(e)){var i=0|p(e.length);return 0===(t=o(t,i)).length||e.copy(t,0,0,i),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?o(t,0):d(t,e);if("Buffer"===e.type&&s(e.data))return d(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e){if(c(e),t=o(t,e<0?0:0|p(e)),!l.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function d(t,e){var i=e.length<0?0:0|p(e.length);t=o(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function p(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function f(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return B(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return H(t).length;default:if(n)return B(t).length;e=(""+e).toLowerCase(),n=!0}}function m(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function _(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=l.from(e,n)),l.isBuffer(e))return 0===e.length?-1:g(t,e,i,n,r);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):g(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function g(t,e,i,n,r){var s,a=1,o=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,o/=2,l/=2,i/=2}function h(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(r){var c=-1;for(s=i;s<o;s++)if(h(t,s)===h(e,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*a}else-1!==c&&(s-=s-c),c=-1}else for(i+l>o&&(i=o-l),s=i;s>=0;s--){for(var u=!0,d=0;d<l;d++)if(h(t,s+d)!==h(e,d)){u=!1;break}if(u)return s}return-1}function y(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(e.substr(2*a,2),16);if(isNaN(o))return a;t[i+a]=o}return a}function v(t,e,i,n){return G(B(e,t.length-i),t,i,n)}function x(t,e,i,n){return G(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function b(t,e,i,n){return x(t,e,i,n)}function w(t,e,i,n){return G(H(e),t,i,n)}function M(t,e,i,n){return G(function(t,e){for(var i,n,r,s=[],a=0;a<t.length&&!((e-=2)<0);++a)n=(i=t.charCodeAt(a))>>8,r=i%256,s.push(r),s.push(n);return s}(e,t.length-i),t,i,n)}function S(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function E(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var s,a,o,l,h=t[r],c=null,u=h>239?4:h>223?3:h>191?2:1;if(r+u<=i)switch(u){case 1:h<128&&(c=h);break;case 2:128==(192&(s=t[r+1]))&&(l=(31&h)<<6|63&s)>127&&(c=l);break;case 3:s=t[r+1],a=t[r+2],128==(192&s)&&128==(192&a)&&(l=(15&h)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=t[r+1],a=t[r+2],o=t[r+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(l=(15&h)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),r+=u}return function(t){var e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);for(var i="",n=0;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=T));return i}(n)}e.Buffer=l,e.SlowBuffer=function(t){return+t!=t&&(t=0),l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,i){return h(null,t,e,i)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,i){return function(t,e,i,n){return c(e),e<=0?o(t,e):void 0!==i?"string"==typeof n?o(t,e).fill(i,n):o(t,e).fill(i):o(t,e)}(null,t,e,i)},l.allocUnsafe=function(t){return u(null,t)},l.allocUnsafeSlow=function(t){return u(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,s=Math.min(i,n);r<s;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=l.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var a=t[i];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,r),r+=a.length}return n},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,i);case"utf8":case"utf-8":return E(this,e,i);case"ascii":return A(this,e,i);case"latin1":case"binary":return P(this,e,i);case"base64":return S(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,i,n,r){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(this===t)return 0;for(var s=(r>>>=0)-(n>>>=0),a=(i>>>=0)-(e>>>=0),o=Math.min(s,a),h=this.slice(n,r),c=t.slice(e,i),u=0;u<o;++u)if(h[u]!==c[u]){s=h[u],a=c[u];break}return s<a?-1:a<s?1:0},l.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},l.prototype.indexOf=function(t,e,i){return _(this,t,e,i,!0)},l.prototype.lastIndexOf=function(t,e,i){return _(this,t,e,i,!1)},l.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return y(this,t,e,i);case"utf8":case"utf-8":return v(this,t,e,i);case"ascii":return x(this,t,e,i);case"latin1":case"binary":return b(this,t,e,i);case"base64":return w(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function A(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function P(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function C(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",s=e;s<i;++s)r+=U(t[s]);return r}function L(t,e,i){for(var n=t.slice(e,i),r="",s=0;s<n.length;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}function R(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,i,n,r,s){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<s)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function D(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,s=Math.min(t.length-i,2);r<s;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function O(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,s=Math.min(t.length-i,4);r<s;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function N(t,e,i,n,r,s){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function F(t,e,i,n,s){return s||N(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function k(t,e,i,n,s){return s||N(t,0,i,8),r.write(t,e,i,n,52,8),i+8}l.prototype.slice=function(t,e){var i,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=l.prototype;else{var r=e-t;i=new l(r,void 0);for(var s=0;s<r;++s)i[s]=this[s+t]}return i},l.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n},l.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},l.prototype.readUInt8=function(t,e){return e||R(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||R(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||R(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},l.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=e,r=1,s=this[t+--n];n>0&&(r*=256);)s+=this[t+--n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},l.prototype.readInt8=function(t,e){return e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||R(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(t,e){e||R(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(t,e){return e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||R(t,4,this.length),r.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||R(t,4,this.length),r.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||R(t,8,this.length),r.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||R(t,8,this.length),r.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,i,n){t=+t,e|=0,i|=0,n||I(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,s=0;for(this[e]=255&t;++s<i&&(r*=256);)this[e+s]=t/r&255;return e+i},l.prototype.writeUIntBE=function(t,e,i,n){t=+t,e|=0,i|=0,n||I(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,s=1;for(this[e+r]=255&t;--r>=0&&(s*=256);)this[e+r]=t/s&255;return e+i},l.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):O(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);I(this,t,e,i,r-1,-r)}var s=0,a=1,o=0;for(this[e]=255&t;++s<i&&(a*=256);)t<0&&0===o&&0!==this[e+s-1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+i},l.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);I(this,t,e,i,r-1,-r)}var s=i-1,a=1,o=0;for(this[e+s]=255&t;--s>=0&&(a*=256);)t<0&&0===o&&0!==this[e+s+1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+i},l.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):O(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,i){return F(this,t,e,!0,i)},l.prototype.writeFloatBE=function(t,e,i){return F(this,t,e,!1,i)},l.prototype.writeDoubleLE=function(t,e,i){return k(this,t,e,!0,i)},l.prototype.writeDoubleBE=function(t,e,i){return k(this,t,e,!1,i)},l.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,s=n-i;if(this===t&&i<e&&e<n)for(r=s-1;r>=0;--r)t[r+e]=this[r+i];else if(s<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+s),e);return s},l.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var s;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(s=e;s<i;++s)this[s]=t;else{var a=l.isBuffer(t)?t:B(new l(t,n).toString()),o=a.length;for(s=0;s<i-e;++s)this[s+e]=a[s%o]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function U(t){return t<16?"0"+t.toString(16):t.toString(16)}function B(t,e){var i;e=e||1/0;for(var n=t.length,r=null,s=[],a=0;a<n;++a){if((i=t.charCodeAt(a))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function H(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(z,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(this,i(0))},function(t,e,i){"use strict";var n=i(10),r=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};t.exports=u;var s=i(6);s.inherits=i(5);var a=i(35),o=i(18);s.inherits(u,a);for(var l=r(o.prototype),h=0;h<l.length;h++){var c=l[h];u.prototype[c]||(u.prototype[c]=o.prototype[c])}function u(t){if(!(this instanceof u))return new u(t);a.call(this,t),o.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||n.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},function(t,e){var i,n,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var l,h=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&p())}function p(){if(!c){var t=o(d);c=!0;for(var e=h.length;e;){for(l=h,h=[];++u<e;)l&&l[u].run();u=-1,e=h.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new f(t,e)),1!==h.length||c||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if(void 0===t)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*t.readUint16()*256+t.readUint16()).toString(16)).substr(-8)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){(function(t){function i(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===i(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===i(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===i(t)},e.isError=function(t){return"[object Error]"===i(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,i(1).Buffer)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=i(14);function s(t,e){return void 0!==t.parser?t.parser:e}var a=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.byteArrayParser=e,this.byteArray=i,this.elements=n}return n(t,[{key:"uint16",value:function(t,e){var i=this.elements[t];if(e=void 0!==e?e:0,i&&0!==i.length)return s(i,this.byteArrayParser).readUint16(this.byteArray,i.dataOffset+2*e)}},{key:"int16",value:function(t,e){var i=this.elements[t];if(e=void 0!==e?e:0,i&&0!==i.length)return s(i,this.byteArrayParser).readInt16(this.byteArray,i.dataOffset+2*e)}},{key:"uint32",value:function(t,e){var i=this.elements[t];if(e=void 0!==e?e:0,i&&0!==i.length)return s(i,this.byteArrayParser).readUint32(this.byteArray,i.dataOffset+4*e)}},{key:"int32",value:function(t,e){var i=this.elements[t];if(e=void 0!==e?e:0,i&&0!==i.length)return s(i,this.byteArrayParser).readInt32(this.byteArray,i.dataOffset+4*e)}},{key:"float",value:function(t,e){var i=this.elements[t];if(e=void 0!==e?e:0,i&&0!==i.length)return s(i,this.byteArrayParser).readFloat(this.byteArray,i.dataOffset+4*e)}},{key:"double",value:function(t,e){var i=this.elements[t];if(e=void 0!==e?e:0,i&&0!==i.length)return s(i,this.byteArrayParser).readDouble(this.byteArray,i.dataOffset+8*e)}},{key:"numStringValues",value:function(t){var e=this.elements[t];if(e&&e.length>0){var i=(0,r.readFixedString)(this.byteArray,e.dataOffset,e.length).match(/\\/g);return null===i?1:i.length+1}}},{key:"string",value:function(t,e){var i=this.elements[t];if(i&&i.length>0){var n=(0,r.readFixedString)(this.byteArray,i.dataOffset,i.length);return e>=0?n.split("\\")[e].trim():n.trim()}}},{key:"text",value:function(t,e){var i=this.elements[t];if(i&&i.length>0){var n=(0,r.readFixedString)(this.byteArray,i.dataOffset,i.length);return e>=0?n.split("\\")[e].replace(/ +$/,""):n.replace(/ +$/,"")}}},{key:"floatString",value:function(t,e){var i=this.elements[t];if(i&&i.length>0){e=void 0!==e?e:0;var n=this.string(t,e);if(void 0!==n)return parseFloat(n)}}},{key:"intString",value:function(t,e){var i=this.elements[t];if(i&&i.length>0){e=void 0!==e?e:0;var n=this.string(t,e);if(void 0!==n)return parseInt(n)}}},{key:"attributeTag",value:function(t){var e=this.elements[t];if(e&&4===e.length){var i=s(e,this.byteArrayParser).readUint16,n=this.byteArray,r=e.dataOffset;return"x"+("00000000"+(256*i(n,r)*256+i(n,r+2)).toString(16)).substr(-8)}}}]),t}();e.default=a},function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var s=0;s<n;s++)t[r+s]=e[i+s]},flattenChunks:function(t){var e,i,n,r,s,a;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(a=new Uint8Array(n),r=0,e=0,i=t.length;e<i;e++)s=t[e],a.set(s,r),r+=s.length;return a}},a={arraySet:function(t,e,i,n,r){for(var s=0;s<n;s++)t[r+s]=e[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(n)},function(t,e,i){var n=i(1),r=n.Buffer;function s(t,e){for(var i in t)e[i]=t[i]}function a(t,e,i){return r(t,e,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(s(n,e),e.Buffer=a),s(r,a),a.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return r(t,e,i)},a.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=r(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},a.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r(t)},a.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,i){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,i,n,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,a,o=arguments.length;switch(o){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,i)}));case 3:return e.nextTick((function(){t.call(null,i,n)}));case 4:return e.nextTick((function(){t.call(null,i,n,r)}));default:for(s=new Array(o-1),a=0;a<s.length;)s[a++]=arguments[a];return e.nextTick((function(){t.apply(null,s)}))}}}:t.exports=e}).call(this,i(3))},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,i,n){if(void 0!==t&&e instanceof t)return e.slice(i,i+n);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+i,n);throw"dicomParser.from: unknown type for byteArray"}}).call(this,i(1).Buffer)},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(n=i(11))&&n.__esModule?n:{default:n},a=i(14),o=function(){function e(i,n,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===i)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===n)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(n instanceof Uint8Array==0&&n instanceof t==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(r<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(r>=n.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=i,this.byteArray=n,this.position=r||0,this.warnings=[]}return r(e,[{key:"seek",value:function(t){if(this.position+t<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=t}},{key:"readByteStream",value:function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var i=(0,s.default)(this.byteArray,this.position,t);return this.position+=t,new e(this.byteArrayParser,i)}},{key:"readUint16",value:function(){var t=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,t}},{key:"readUint32",value:function(){var t=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,t}},{key:"readFixedString",value:function(t){var e=(0,a.readFixedString)(this.byteArray,this.position,t);return this.position+=t,e}}]),e}();e.default=o}).call(this,i(1).Buffer)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var e={tag:(0,r.default)(t),length:t.readUint32(),dataOffset:t.position};if("xfffee000"!==e.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+t.position;return e};var n,r=(n=i(4))&&n.__esModule?n:{default:n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.readFixedString=function(t,e,i){if(i<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(e+i>t.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var n,r="",s=0;s<i;s++){if(0===(n=t[e+s]))return e+=i,r;r+=String.fromCharCode(n)}return r}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(void 0===t)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var l={tag:(0,a.default)(t),vr:t.readFixedString(2)};return 2===h(l.vr)?(l.length=t.readUint16(),l.dataOffset=t.position):(t.seek(2),l.length=t.readUint32(),l.dataOffset=t.position),4294967295===l.length&&(l.hadUndefinedLength=!0),l.tag===i?l:"SQ"===l.vr?((0,o.default)(t,l,e),l):4294967295===l.length?"x7fe00010"===l.tag?((0,n.default)(t,l,e),l):"UN"===l.vr?((0,r.default)(t,l),l):((0,s.default)(t,l),l):(t.seek(l.length),l)};var n=l(i(42)),r=l(i(41)),s=l(i(24)),a=l(i(4)),o=l(i(40));function l(t){return t&&t.__esModule?t:{default:t}}var h=function(t){return"OB"===t||"OW"===t||"SQ"===t||"OF"===t||"UT"===t||"UN"===t?4:2}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseDicomDataSetExplicit=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(i=void 0===i?e.byteArray.length:i,void 0===e)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(i<e.position||i>e.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var s=t.elements;e.position<i;){var a=(0,n.default)(e,t.warnings,r.untilTag);if(s[a.tag]=a,a.tag===r.untilTag)return}if(e.position>i)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},e.parseDicomDataSetImplicit=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(i=void 0===i?t.byteArray.length:i,void 0===e)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(i<e.position||i>e.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var s=t.elements;e.position<i;){var a=(0,r.default)(e,n.untilTag,n.vrCallback);if(s[a.tag]=a,a.tag===n.untilTag)return}};var n=s(i(15)),r=s(i(23));function s(t){return t&&t.__esModule?t:{default:t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i,o,h){if(o=o||1,h=h||e.fragments,void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===i)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===o)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==e.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==e.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==e.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(e.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(i<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(i>=e.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(o<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(i+o>e.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var c=new r.default(t.byteArrayParser,t.byteArray,e.dataOffset),u=(0,s.default)(c);if("xfffee000"!==u.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";c.seek(u.length);var d=c.position;if(1===o)return(0,a.default)(c.byteArray,d+h[i].offset+8,h[i].length);for(var p=l(h,i,o),f=(0,n.default)(c.byteArray,p),m=0,_=i;_<i+o;_++)for(var g=d+h[_].offset+8,y=0;y<h[_].length;y++)f[m++]=c.byteArray[g++];return f};var n=o(i(22)),r=o(i(12)),s=o(i(13)),a=o(i(11));function o(t){return t&&t.__esModule?t:{default:t}}var l=function(t,e,i){for(var n=0,r=e;r<e+i;r++)n+=t[r].length;return n}},function(t,e,i){"use strict";(function(e,n,r){var s=i(10);function a(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var n=t.entry;for(t.entry=null;n;){var r=n.callback;e.pendingcb--,r(undefined),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=y;var o,l=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?n:s.nextTick;y.WritableState=g;var h=i(6);h.inherits=i(5);var c,u={deprecate:i(61)},d=i(34),p=i(9).Buffer,f=r.Uint8Array||function(){},m=i(33);function _(){}function g(t,e){o=o||i(2),t=t||{};var n=e instanceof o;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,h=t.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(h||0===h)?h:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,n=i.sync,r=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,n,r){--e.pendingcb,i?(s.nextTick(r,n),s.nextTick(S,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(r(n),t._writableState.errorEmitted=!0,t.emit("error",n),S(t,e))}(t,i,n,e,r);else{var a=w(i);a||i.corked||i.bufferProcessing||!i.bufferedRequest||b(t,i),n?l(x,t,i,a,r):x(t,i,a,r)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function y(t){if(o=o||i(2),!(c.call(y,this)||this instanceof o))return new y(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),d.call(this)}function v(t,e,i,n,r,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,i?t._writev(r,e.onwrite):t._write(r,s,e.onwrite),e.sync=!1}function x(t,e,i,n){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),S(t,e)}function b(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var n=e.bufferedRequestCount,r=new Array(n),s=e.corkedRequestsFree;s.entry=i;for(var o=0,l=!0;i;)r[o]=i,i.isBuf||(l=!1),i=i.next,o+=1;r.allBuffers=l,v(t,e,!0,e.length,r,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new a(e),e.bufferedRequestCount=0}else{for(;i;){var h=i.chunk,c=i.encoding,u=i.callback;if(v(t,e,!1,e.objectMode?1:h.length,h,c,u),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function w(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function M(t,e){t._final((function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),S(t,e)}))}function S(t,e){var i=w(e);return i&&(function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,s.nextTick(M,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}h.inherits(y,d),g.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(g.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(t){return!!c.call(this,t)||this===y&&t&&t._writableState instanceof g}})):c=function(t){return t instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(t,e,i){var n,r=this._writableState,a=!1,o=!r.objectMode&&(n=t,p.isBuffer(n)||n instanceof f);return o&&!p.isBuffer(t)&&(t=function(t){return p.from(t)}(t)),"function"==typeof e&&(i=e,e=null),o?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof i&&(i=_),r.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),s.nextTick(e,i)}(this,i):(o||function(t,e,i,n){var r=!0,a=!1;return null===i?a=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),s.nextTick(n,a),r=!1),r}(this,r,t,i))&&(r.pendingcb++,a=function(t,e,i,n,r,s){if(!i){var a=function(t,e,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=p.from(e,i)),e}(e,n,r);n!==a&&(i=!0,r="buffer",n=a)}var o=e.objectMode?1:n.length;e.length+=o;var l=e.length<e.highWaterMark;if(l||(e.needDrain=!0),e.writing||e.corked){var h=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:r,isBuf:i,callback:s,next:null},h?h.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else v(t,e,!1,o,n,r,s);return l}(this,r,o,t,e,i)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||b(this,t))},y.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},y.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(t,e,i){var n=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(t,e,i){e.ending=!0,S(t,e),i&&(e.finished?s.nextTick(i):t.once("finish",i)),e.ended=!0,t.writable=!1}(this,n,i)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,i(3),i(63).setImmediate,i(0))},function(t,e,i){(e=t.exports=i(35)).Stream=e,e.Readable=e,e.Writable=i(18),e.Duplex=i(2),e.Transform=i(31),e.PassThrough=i(60)},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,a,o,l,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}if(s(i=this._events[t]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(r(i))for(o=Array.prototype.slice.call(arguments,1),a=(h=i.slice()).length,l=0;l<a;l++)h[l].apply(this,o);return!0},i.prototype.addListener=function(t,e){var a;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(a=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!n(e))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(t,r),i||(i=!0,e.apply(this,arguments))}return r.listener=e,this.on(t,r),this},i.prototype.removeListener=function(t,e){var i,s,a,o;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(i=this._events[t]).length,s=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(i)){for(o=a;o-- >0;)if(i[o]===e||i[o].listener&&i[o].listener===e){s=o;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[t]))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={readUint16:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(e+2>t.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return t[e]+256*t[e+1]},readInt16:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(e+2>t.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var i=t[e]+(t[e+1]<<8);return 32768&i&&(i=i-65535-1),i},readUint32:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(e+4>t.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return t[e]+256*t[e+1]+256*t[e+2]*256+256*t[e+3]*256*256},readInt32:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(e+4>t.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)},readFloat:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(e+4>t.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var i=new Uint8Array(4);return i[0]=t[e],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+3],new Float32Array(i.buffer)[0]},readDouble:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(e+8>t.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var i=new Uint8Array(8);return i[0]=t[e],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+3],i[4]=t[e+4],i[5]=t[e+5],i[6]=t[e+6],i[7]=t[e+7],new Float64Array(i.buffer)[0]}}},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,i){if(void 0!==t&&e instanceof t)return t.alloc(i);if(e instanceof Uint8Array)return new Uint8Array(i);throw"dicomParser.alloc: unknown type for byteArray"}}).call(this,i(1).Buffer)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var a={tag:(0,s.default)(t),length:t.readUint32(),dataOffset:t.position};return 4294967295===a.length&&(a.hadUndefinedLength=!0),a.tag===e?a:o(a,t,i)?((0,r.default)(t,a),a):a.hadUndefinedLength?((0,n.default)(t,a),a):(t.seek(a.length),a)};var n=a(i(24)),r=a(i(39)),s=a(i(4));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(t,e,i){if(void 0!==i)return"SQ"===i(t.tag);if(e.position+4<=e.byteArray.length){var n=(0,s.default)(e);return e.seek(-4),"xfffee000"===n||"xfffee0dd"===n}return e.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var i=t.byteArray.length-8;t.position<=i;)if(65534===t.readUint16()&&57357===t.readUint16())return 0!==t.readUint32()&&t.warnings("encountered non zero length following item delimiter at position "+(t.position-4)+" while reading element of undefined length with tag "+e.tag),void(e.length=t.position-e.dataOffset);e.length=t.byteArray.length-e.dataOffset,t.seek(t.byteArray.length-t.position)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};e.isStringVr=function(t){return n[t]},e.isPrivateTag=function(t){return parseInt(t[4],10)%2==1},e.parsePN=function(t){if(void 0!==t){var e=t.split("^");return{familyName:e[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i,n,o){if(n=n||e.basicOffsetTable,o=o||e.fragments,void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===i)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==e.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==e.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==e.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===e.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===n.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(i<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(i>=n.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var l=n[i],h=s(o,l);if(void 0===h)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var c=a(i,n,o,h);return(0,r.default)(t,e,h,c,o)};var n,r=(n=i(17))&&n.__esModule?n:{default:n},s=function(t,e){for(var i=0;i<t.length;i++)if(t[i].offset===e)return i},a=function(t,e,i,n){if(t===e.length-1)return i.length-n;for(var r=e[t+1],s=n+1;s<i.length;s++)if(i[s].offset===r)return s-n;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}},function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,e,i,r){var s=n,a=r+i;t^=-1;for(var o=r;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}},function(t,e,i){"use strict";t.exports=function(t,e,i,n){for(var r=65535&t|0,s=t>>>16&65535|0,a=0;0!==i;){i-=a=i>2e3?2e3:i;do{s=s+(r=r+e[n++]|0)|0}while(--a);r%=65521,s%=65521}return r|s<<16|0}},function(t,e,i){(function(t,n){var r=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(o(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,s=n.length,a=String(t).replace(r,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}})),l=n[i];i<s;l=n[++i])m(l)||!x(l)?a+=" "+l:a+=" "+o(l);return a},e.deprecate=function(i,r){if(y(t.process))return function(){return e.deprecate(i,r).apply(this,arguments)};if(!0===n.noDeprecation)return i;var s=!1;return function(){if(!s){if(n.throwDeprecation)throw new Error(r);n.traceDeprecation?console.trace(r):console.error(r),s=!0}return i.apply(this,arguments)}};var s,a={};function o(t,i){var n={seen:[],stylize:h};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(i)?n.showHidden=i:i&&e._extend(n,i),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,t,n.depth)}function l(t,e){var i=o.styles[e];return i?"["+o.colors[i][0]+"m"+t+"["+o.colors[i][1]+"m":t}function h(t,e){return t}function c(t,i,n){if(t.customInspect&&i&&M(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(n,t);return g(r)||(r=c(t,r,n)),r}var s=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(g(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return _(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}(t,i);if(s)return s;var a=Object.keys(i),o=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(i)),w(i)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return u(i);if(0===a.length){if(M(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(v(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(b(i))return t.stylize(Date.prototype.toString.call(i),"date");if(w(i))return u(i)}var h,x="",S=!1,E=["{","}"];return p(i)&&(S=!0,E=["[","]"]),M(i)&&(x=" [Function"+(i.name?": "+i.name:"")+"]"),v(i)&&(x=" "+RegExp.prototype.toString.call(i)),b(i)&&(x=" "+Date.prototype.toUTCString.call(i)),w(i)&&(x=" "+u(i)),0!==a.length||S&&0!=i.length?n<0?v(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),h=S?function(t,e,i,n,r){for(var s=[],a=0,o=e.length;a<o;++a)A(e,String(a))?s.push(d(t,e,i,n,String(a),!0)):s.push("");return r.forEach((function(r){r.match(/^\d+$/)||s.push(d(t,e,i,n,r,!0))})),s}(t,i,n,o,a):a.map((function(e){return d(t,i,n,o,e,S)})),t.seen.pop(),function(t,e,i){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}(h,x,E)):E[0]+x+E[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,i,n,r,s){var a,o,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),A(n,r)||(a="["+r+"]"),o||(t.seen.indexOf(l.value)<0?(o=m(i)?c(t,l.value,null):c(t,l.value,i-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+o.split("\n").map((function(t){return"   "+t})).join("\n")):o=t.stylize("[Circular]","special")),y(a)){if(s&&r.match(/^\d+$/))return o;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+o}function p(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function _(t){return"number"==typeof t}function g(t){return"string"==typeof t}function y(t){return void 0===t}function v(t){return x(t)&&"[object RegExp]"===S(t)}function x(t){return"object"==typeof t&&null!==t}function b(t){return x(t)&&"[object Date]"===S(t)}function w(t){return x(t)&&("[object Error]"===S(t)||t instanceof Error)}function M(t){return"function"==typeof t}function S(t){return Object.prototype.toString.call(t)}function E(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(y(s)&&(s=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!a[t])if(new RegExp("\\b"+t+"\\b","i").test(s)){var i=n.pid;a[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,n)}}else a[t]=function(){};return a[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=f,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=_,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=y,e.isRegExp=v,e.isObject=x,e.isDate=b,e.isError=w,e.isFunction=M,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i(54);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,i;console.log("%s - %s",(i=[E((t=new Date).getHours()),E(t.getMinutes()),E(t.getSeconds())].join(":"),[t.getDate(),T[t.getMonth()],i].join(" ")),e.format.apply(e,arguments))},e.inherits=i(53),e._extend=function(t,e){if(!e||!x(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(this,i(0),i(3))},function(t,e,i){"use strict";(function(e){function n(t,e){if(t===e)return 0;for(var i=t.length,n=e.length,r=0,s=Math.min(i,n);r<s;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0}function r(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var s=i(29),a=Object.prototype.hasOwnProperty,o=Array.prototype.slice,l="foo"===function(){}.name;function h(t){return Object.prototype.toString.call(t)}function c(t){return!r(t)&&"function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}var u=t.exports=g,d=/\s*function\s+([^\(\s]*)\s*/;function p(t){if(s.isFunction(t)){if(l)return t.name;var e=t.toString().match(d);return e&&e[1]}}function f(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function m(t){if(l||!s.isFunction(t))return s.inspect(t);var e=p(t);return"[Function"+(e?": "+e:"")+"]"}function _(t,e,i,n,r){throw new u.AssertionError({message:i,actual:t,expected:e,operator:n,stackStartFunction:r})}function g(t,e){t||_(t,!0,e,"==",u.ok)}function y(t,e,i,a){if(t===e)return!0;if(r(t)&&r(e))return 0===n(t,e);if(s.isDate(t)&&s.isDate(e))return t.getTime()===e.getTime();if(s.isRegExp(t)&&s.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(c(t)&&c(e)&&h(t)===h(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===n(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(r(t)!==r(e))return!1;var l=(a=a||{actual:[],expected:[]}).actual.indexOf(t);return-1!==l&&l===a.expected.indexOf(e)||(a.actual.push(t),a.expected.push(e),function(t,e,i,n){if(null==t||null==e)return!1;if(s.isPrimitive(t)||s.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=v(t),a=v(e);if(r&&!a||!r&&a)return!1;if(r)return y(t=o.call(t),e=o.call(e),i);var l,h,c=w(t),u=w(e);if(c.length!==u.length)return!1;for(c.sort(),u.sort(),h=c.length-1;h>=0;h--)if(c[h]!==u[h])return!1;for(h=c.length-1;h>=0;h--)if(!y(t[l=c[h]],e[l],i,n))return!1;return!0}(t,e,i,a))}return i?t===e:t==e}function v(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function x(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function b(t,e,i,n){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),r=function(t){var e;try{t()}catch(t){e=t}return e}(e),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),t&&!r&&_(r,i,"Missing expected exception"+n);var a="string"==typeof n,o=!t&&r&&!i;if((!t&&s.isError(r)&&a&&x(r,i)||o)&&_(r,i,"Got unwanted exception"+n),t&&r&&i&&!x(r,i)||!t&&r)throw r}u.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=f(m(this.actual),128)+" "+this.operator+" "+f(m(this.expected),128),this.generatedMessage=!0);var e=t.stackStartFunction||_;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var i=new Error;if(i.stack){var n=i.stack,r=p(e),s=n.indexOf("\n"+r);if(s>=0){var a=n.indexOf("\n",s+1);n=n.substring(a+1)}this.stack=n}}},s.inherits(u.AssertionError,Error),u.fail=_,u.ok=g,u.equal=function(t,e,i){t!=e&&_(t,e,i,"==",u.equal)},u.notEqual=function(t,e,i){t==e&&_(t,e,i,"!=",u.notEqual)},u.deepEqual=function(t,e,i){y(t,e,!1)||_(t,e,i,"deepEqual",u.deepEqual)},u.deepStrictEqual=function(t,e,i){y(t,e,!0)||_(t,e,i,"deepStrictEqual",u.deepStrictEqual)},u.notDeepEqual=function(t,e,i){y(t,e,!1)&&_(t,e,i,"notDeepEqual",u.notDeepEqual)},u.notDeepStrictEqual=function t(e,i,n){y(e,i,!0)&&_(e,i,n,"notDeepStrictEqual",t)},u.strictEqual=function(t,e,i){t!==e&&_(t,e,i,"===",u.strictEqual)},u.notStrictEqual=function(t,e,i){t===e&&_(t,e,i,"!==",u.notStrictEqual)},u.throws=function(t,e,i){b(!0,t,e,i)},u.doesNotThrow=function(t,e,i){b(!1,t,e,i)},u.ifError=function(t){if(t)throw t};var w=Object.keys||function(t){var e=[];for(var i in t)a.call(t,i)&&e.push(i);return e}}).call(this,i(0))},function(t,e,i){"use strict";t.exports=s;var n=i(2),r=i(6);function s(t){if(!(this instanceof s))return new s(t);n.call(this,t),this._transformState={afterTransform:function(t,e){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),n(t);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush((function(e,i){o(t,e,i)})):o(this,null,null)}function o(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}r.inherits=i(5),r.inherits(s,n),s.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},s.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},s.prototype._write=function(t,e,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=e,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},s.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},s.prototype._destroy=function(t,e){var i=this;n.prototype._destroy.call(this,t,(function(t){e(t),i.emit("close")}))}},function(t,e,i){"use strict";var n=i(9).Buffer,r=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===r||!r(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=l,this.end=h,e=4;break;case"utf8":this.fillLast=o,e=4;break;case"base64":this.text=c,this.end=u,e=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function a(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:-1}function o(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"�".repeat(i);if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�".repeat(i+1);if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�".repeat(i+2)}}(this,t,e);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function l(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function h(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function c(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function u(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function d(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}e.StringDecoder=s,s.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},s.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�".repeat(this.lastTotal-this.lastNeed):e},s.prototype.text=function(t,e){var i=function(t,e,i){var n=e.length-1;if(n<i)return 0;var r=a(e[n]);return r>=0?(r>0&&(t.lastNeed=r-1),r):--n<i?0:(r=a(e[n]))>=0?(r>0&&(t.lastNeed=r-2),r):--n<i?0:(r=a(e[n]))>=0?(r>0&&(2===r?r=0:t.lastNeed=r-3),r):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var n=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,i){"use strict";var n=i(10);function r(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var i=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(r,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?(n.nextTick(r,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):e&&e(t)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,i){t.exports=i(20).EventEmitter},function(t,e,i){"use strict";(function(e,n){var r=i(10);t.exports=v;var s,a=i(38);v.ReadableState=y,i(20).EventEmitter;var o=function(t,e){return t.listeners(e).length},l=i(34),h=i(9).Buffer,c=e.Uint8Array||function(){},u=i(6);u.inherits=i(5);var d=i(66),p=void 0;p=d&&d.debuglog?d.debuglog("stream"):function(){};var f,m=i(65),_=i(33);u.inherits(v,l);var g=["error","close","destroy","pause","resume"];function y(t,e){t=t||{};var n=e instanceof(s=s||i(2));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,a=t.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(a||0===a)?a:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=i(32).StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function v(t){if(s=s||i(2),!(this instanceof v))return new v(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function x(t,e,i,n,r){var s,a=t._readableState;return null===e?(a.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,S(t)}}(t,a)):(r||(s=function(t,e){var i,n;return n=e,h.isBuffer(n)||n instanceof c||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(a,e)),s?t.emit("error",s):a.objectMode||e&&e.length>0?("string"==typeof e||a.objectMode||Object.getPrototypeOf(e)===h.prototype||(e=function(t){return h.from(t)}(e)),n?a.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):b(t,a,e,!0):a.ended?t.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!i?(e=a.decoder.write(e),a.objectMode||0!==e.length?b(t,a,e,!1):T(t,a)):b(t,a,e,!1))):n||(a.reading=!1)),function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(a)}function b(t,e,i,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&S(t)),T(t,e)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),v.prototype.destroy=_.destroy,v.prototype._undestroy=_.undestroy,v.prototype._destroy=function(t,e){this.push(null),e(t)},v.prototype.push=function(t,e){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=h.from(t,e),e=""),i=!0),x(this,t,e,!1,i)},v.prototype.unshift=function(t){return x(this,t,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(t){return f||(f=i(32).StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var w=8388608;function M(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=w?t=w:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function S(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(p("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(E,t):E(t))}function E(t){p("emit readable"),t.emit("readable"),L(t)}function T(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(A,t,e))}function A(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(p("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function P(t){p("readable nexttick read 0"),t.read(0)}function C(t,e){e.reading||(p("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),L(t),e.flowing&&!e.reading&&t.read(0)}function L(t){var e=t._readableState;for(p("flow",e.flowing);e.flowing&&null!==t.read(););}function R(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var n;return t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,n=1,r=i.data;for(t-=r.length;i=i.next;){var s=i.data,a=t>s.length?s.length:t;if(a===s.length?r+=s:r+=s.slice(0,t),0==(t-=a)){a===s.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=s.slice(a));break}++n}return e.length-=n,r}(t,e):function(t,e){var i=h.allocUnsafe(t),n=e.head,r=1;for(n.data.copy(i),t-=n.data.length;n=n.next;){var s=n.data,a=t>s.length?s.length:t;if(s.copy(i,i.length-t,0,a),0==(t-=a)){a===s.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=s.slice(a));break}++r}return e.length-=r,i}(t,e),n}(t,e.buffer,e.decoder),i);var i}function I(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(D,e,t))}function D(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function O(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}v.prototype.read=function(t){p("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return p("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?I(this):S(this),null;if(0===(t=M(t,e))&&e.ended)return 0===e.length&&I(this),null;var n,r=e.needReadable;return p("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&p("length less than watermark",r=!0),e.ended||e.reading?p("reading or ended",r=!1):r&&(p("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=M(i,e))),null===(n=t>0?R(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&I(this)),null!==n&&this.emit("data",n),n},v.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(t,e){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,p("pipe count=%d opts=%j",s.pipesCount,e);var l=e&&!1===e.end||t===n.stdout||t===n.stderr?y:h;function h(){p("onend"),t.end()}s.endEmitted?r.nextTick(l):i.once("end",l),t.on("unpipe",(function e(n,r){p("onunpipe"),n===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,p("cleanup"),t.removeListener("close",_),t.removeListener("finish",g),t.removeListener("drain",c),t.removeListener("error",m),t.removeListener("unpipe",e),i.removeListener("end",h),i.removeListener("end",y),i.removeListener("data",f),u=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||c())}));var c=function(t){return function(){var e=t._readableState;p("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&o(t,"data")&&(e.flowing=!0,L(t))}}(i);t.on("drain",c);var u=!1,d=!1;function f(e){p("ondata"),d=!1,!1!==t.write(e)||d||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==O(s.pipes,t))&&!u&&(p("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,d=!0),i.pause())}function m(e){p("onerror",e),y(),t.removeListener("error",m),0===o(t,"error")&&t.emit("error",e)}function _(){t.removeListener("finish",g),y()}function g(){p("onfinish"),t.removeListener("close",_),y()}function y(){p("unpipe"),i.unpipe(t)}return i.on("data",f),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?a(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",m),t.once("close",_),t.once("finish",g),t.emit("pipe",i),s.flowing||(p("pipe resume"),i.resume()),t},v.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<r;s++)n[s].emit("unpipe",this,i);return this}var a=O(e.pipes,t);return-1===a||(e.pipes.splice(a,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i)),this},v.prototype.on=function(t,e){var i=l.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&S(this):r.nextTick(P,this))}return i},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var t=this._readableState;return t.flowing||(p("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(C,t,e))}(this,t)),this},v.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(t){var e=this,i=this._readableState,n=!1;for(var r in t.on("end",(function(){if(p("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(r){p("wrapped data"),i.decoder&&(r=i.decoder.write(r)),(!i.objectMode||null!=r)&&(i.objectMode||r&&r.length)&&(e.push(r)||(n=!0,t.pause()))})),t)void 0===this[r]&&"function"==typeof t[r]&&(this[r]=function(e){return function(){return t[e].apply(t,arguments)}}(r));for(var s=0;s<g.length;s++)t.on(g[s],this.emit.bind(this,g[s]));return this._read=function(e){p("wrapped _read",e),n&&(n=!1,t.resume())},this},v._fromList=R}).call(this,i(0),i(3))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(void 0===t)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var i=new n.default(s.default,t);return function(){!function(){if(i.seek(128),"DICM"!==i.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var t=[],e={};i.position<i.byteArray.length;){var n=i.position,o=(0,a.default)(i,t);if(o.tag>"x0002ffff"){i.position=n;break}o.parser=s.default,e[o.tag]=o}var l=new r.default(i.byteArrayParser,i.byteArray,e);return l.warnings=i.warnings,l.position=i.position,l}()};var n=o(i(12)),r=o(i(7)),s=o(i(21)),a=o(i(15));function o(t){return t&&t.__esModule?t:{default:t}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={readUint16:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(e+2>t.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(t[e]<<8)+t[e+1]},readInt16:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(e+2>t.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var i=(t[e]<<8)+t[e+1];return 32768&i&&(i=i-65535-1),i},readUint32:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(e+4>t.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*t[e]+t[e+1])+t[e+2])+t[e+3]},readInt32:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(e+4>t.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3]},readFloat:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(e+4>t.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var i=new Uint8Array(4);return i[3]=t[e],i[2]=t[e+1],i[1]=t[e+2],i[0]=t[e+3],new Float32Array(i.buffer)[0]},readDouble:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(e+8>t.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var i=new Uint8Array(8);return i[7]=t[e],i[6]=t[e+1],i[5]=t[e+2],i[4]=t[e+3],i[3]=t[e+4],i[2]=t[e+5],i[1]=t[e+6],i[0]=t[e+7],new Float64Array(i.buffer)[0]}}},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";e.items=[],4294967295===e.length?function(t,e,i){for(;t.position+4<=t.byteArray.length;){var n=(0,a.default)(t);if(t.seek(-4),"xfffee0dd"===n)return e.length=t.position-e.dataOffset,t.seek(8),e;var r=h(t,i);e.items.push(r)}t.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),e.length=t.byteArray.length-e.dataOffset}(t,e,i):function(t,e,i){for(var n=e.dataOffset+e.length;t.position<n;){var r=h(t,i);e.items.push(r)}}(t,e,i)};var n=l(i(7)),r=l(i(23)),s=l(i(13)),a=l(i(4)),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(16));function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){var i=(0,s.default)(t);return 4294967295===i.length?(i.hadUndefinedLength=!0,i.dataSet=function(t,e){for(var i={};t.position<t.byteArray.length;){var s=(0,r.default)(t,void 0,e);if(i[s.tag]=s,"xfffee00d"===s.tag)return new n.default(t.byteArrayParser,t.byteArray,i)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new n.default(t.byteArrayParser,t.byteArray,i)}(t,e),i.length=t.position-i.dataOffset):(i.dataSet=new n.default(t.byteArrayParser,t.byteArray,{}),o.parseDicomDataSetImplicit(i.dataSet,t,t.position+i.length,{vrCallback:e})),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";e.items=[],4294967295===e.length?function(t,e,i){for(;t.position+4<=t.byteArray.length;){var n=(0,a.default)(t);if(t.seek(-4),"xfffee0dd"===n)return e.length=t.position-e.dataOffset,t.seek(8),e;var r=h(t,i);e.items.push(r)}i.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),e.length=t.position-e.dataOffset}(t,e,i):function(t,e,i){for(var n=e.dataOffset+e.length;t.position<n;){var r=h(t,i);e.items.push(r)}}(t,e,i)};var n=l(i(7)),r=l(i(15)),s=l(i(13)),a=l(i(4)),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(16));function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){var i=(0,s.default)(t);return 4294967295===i.length?(i.hadUndefinedLength=!0,i.dataSet=function(t,e){for(var i={};t.position<t.byteArray.length;){var s=(0,r.default)(t,e);if(i[s.tag]=s,"xfffee00d"===s.tag)return new n.default(t.byteArrayParser,t.byteArray,i)}return e.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new n.default(t.byteArrayParser,t.byteArray,i)}(t,e),i.length=t.position-i.dataOffset):(i.dataSet=new n.default(t.byteArrayParser,t.byteArray,{}),o.parseDicomDataSetExplicit(i.dataSet,t,t.position+i.length)),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(void 0===t)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var i=t.byteArray.length-8;t.position<=i;)if(65534===t.readUint16()&&57565===t.readUint16())return 0!==t.readUint32()&&t.warnings("encountered non zero length following item delimiter at position "+(t.position-4)+" while reading element of undefined length with tag "+e.tag),void(e.length=t.position-e.dataOffset);e.length=t.byteArray.length-e.dataOffset,t.seek(t.byteArray.length-t.position)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(e.encapsulatedPixelData=!0,e.basicOffsetTable=[],e.fragments=[],"xfffee000"!==(0,r.default)(t))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var n=t.readUint32()/4,s=0;s<n;s++){var a=t.readUint32();e.basicOffsetTable.push(a)}for(var o=t.position;t.position<t.byteArray.length;){var l=(0,r.default)(t),h=t.readUint32();if("xfffee0dd"===l)return t.seek(h),void(e.length=t.position-e.dataOffset);if("xfffee000"!==l)return i&&i.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),h>t.byteArray.length-t.position&&(h=t.byteArray.length-t.position),e.fragments.push({offset:t.position-o-8,position:t.position,length:h}),t.seek(h),void(e.length=t.position-e.dataOffset);e.fragments.push({offset:t.position-o-8,position:t.position,length:h}),t.seek(h)}i&&i.push("pixel data element "+e.tag+" missing sequence delimiter tag xfffee0dd")};var n,r=(n=i(4))&&n.__esModule?n:{default:n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(void 0===t||void 0===e)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===e.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var i,r=e.vr,s=e.tag;function a(e,i){for(var n="",r=0;r<e;r++)0!==r&&(n+="/"),n+=i.call(t,s,r).toString();return n}if(!0===n.isStringVr(r))i=t.string(s);else{if("AT"===r){var o=t.uint32(s);if(void 0===o)return;return o<0&&(o=4294967295+o+1),"x"+o.toString(16).toUpperCase()}"US"===r?i=a(e.length/2,t.uint16):"SS"===r?i=a(e.length/2,t.int16):"UL"===r?i=a(e.length/4,t.uint32):"SL"===r?i=a(e.length/4,t.int32):"FD"===r?i=a(e.length/8,t.double):"FL"===r&&(i=a(e.length/4,t.float))}return i};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(25))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(a||(a=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===i)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==e.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==e.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==e.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(i<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==e.basicOffsetTable.length?(0,n.default)(t,e,i):(0,r.default)(t,e,0,e.fragments.length)};var n=s(i(26)),r=s(i(17));function s(t){return t&&t.__esModule?t:{default:t}}var a=!1},function(t,e,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,i){"use strict";var n=i(8),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,l,h,c,u,d){var p,f,m,_,g,y,v,x,b,w=d.bits,M=0,S=0,E=0,T=0,A=0,P=0,C=0,L=0,R=0,I=0,D=null,O=0,N=new n.Buf16(16),F=new n.Buf16(16),k=null,z=0;for(M=0;M<=15;M++)N[M]=0;for(S=0;S<l;S++)N[e[i+S]]++;for(A=w,T=15;T>=1&&0===N[T];T--);if(A>T&&(A=T),0===T)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(E=1;E<T&&0===N[E];E++);for(A<E&&(A=E),L=1,M=1;M<=15;M++)if(L<<=1,(L-=N[M])<0)return-1;if(L>0&&(0===t||1!==T))return-1;for(F[1]=0,M=1;M<15;M++)F[M+1]=F[M]+N[M];for(S=0;S<l;S++)0!==e[i+S]&&(u[F[e[i+S]]++]=S);if(0===t?(D=k=u,y=19):1===t?(D=r,O-=257,k=s,z-=257,y=256):(D=a,k=o,y=-1),I=0,S=0,M=E,g=c,P=A,C=0,m=-1,_=(R=1<<A)-1,1===t&&R>852||2===t&&R>592)return 1;for(;;){v=M-C,u[S]<y?(x=0,b=u[S]):u[S]>y?(x=k[z+u[S]],b=D[O+u[S]]):(x=96,b=0),p=1<<M-C,E=f=1<<P;do{h[g+(I>>C)+(f-=p)]=v<<24|x<<16|b|0}while(0!==f);for(p=1<<M-1;I&p;)p>>=1;if(0!==p?(I&=p-1,I+=p):I=0,S++,0==--N[M]){if(M===T)break;M=e[i+u[S]]}if(M>A&&(I&_)!==m){for(0===C&&(C=A),g+=E,L=1<<(P=M-C);P+C<T&&!((L-=N[P+C])<=0);)P++,L<<=1;if(R+=1<<P,1===t&&R>852||2===t&&R>592)return 1;h[m=I&_]=A<<24|P<<16|g-c|0}}return 0!==I&&(h[g+I]=M-C<<24|64<<16|0),d.bits=A,0}},function(t,e,i){"use strict";t.exports=function(t,e){var i,n,r,s,a,o,l,h,c,u,d,p,f,m,_,g,y,v,x,b,w,M,S,E,T;i=t.state,n=t.next_in,E=t.input,r=n+(t.avail_in-5),s=t.next_out,T=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,p=i.hold,f=i.bits,m=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;t:do{f<15&&(p+=E[n++]<<f,f+=8,p+=E[n++]<<f,f+=8),v=m[p&g];e:for(;;){if(p>>>=x=v>>>24,f-=x,0==(x=v>>>16&255))T[s++]=65535&v;else{if(!(16&x)){if(0==(64&x)){v=m[(65535&v)+(p&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}b=65535&v,(x&=15)&&(f<x&&(p+=E[n++]<<f,f+=8),b+=p&(1<<x)-1,p>>>=x,f-=x),f<15&&(p+=E[n++]<<f,f+=8,p+=E[n++]<<f,f+=8),v=_[p&y];i:for(;;){if(p>>>=x=v>>>24,f-=x,!(16&(x=v>>>16&255))){if(0==(64&x)){v=_[(65535&v)+(p&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&v,f<(x&=15)&&(p+=E[n++]<<f,(f+=8)<x&&(p+=E[n++]<<f,f+=8)),(w+=p&(1<<x)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=x,f-=x,w>(x=s-a)){if((x=w-x)>c&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(M=0,S=d,0===u){if(M+=h-x,x<b){b-=x;do{T[s++]=d[M++]}while(--x);M=s-w,S=T}}else if(u<x){if(M+=h+u-x,(x-=u)<b){b-=x;do{T[s++]=d[M++]}while(--x);if(M=0,u<b){b-=x=u;do{T[s++]=d[M++]}while(--x);M=s-w,S=T}}}else if(M+=u-x,x<b){b-=x;do{T[s++]=d[M++]}while(--x);M=s-w,S=T}for(;b>2;)T[s++]=S[M++],T[s++]=S[M++],T[s++]=S[M++],b-=3;b&&(T[s++]=S[M++],b>1&&(T[s++]=S[M++]))}else{M=s-w;do{T[s++]=T[M++],T[s++]=T[M++],T[s++]=T[M++],b-=3}while(b>2);b&&(T[s++]=T[M++],b>1&&(T[s++]=T[M++]))}break}}break}}while(n<r&&s<o);n-=b=f>>3,p&=(1<<(f-=b<<3))-1,t.next_in=n,t.next_out=s,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=s<o?o-s+257:257-(s-o),i.hold=p,i.bits=f}},function(t,e,i){"use strict";var n=i(8),r=i(28),s=i(27),a=i(47),o=i(46),l=-2,h=12,c=30;function u(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function d(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(852),e.distcode=e.distdyn=new n.Buf32(592),e.sane=1,e.back=-1,0):l}function p(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,d(t)):l}function f(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?l:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,p(t))):l}function m(t,e){var i,r;return t?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=r,r.window=null,0!==(i=f(t,e))&&(t.state=null),i):l}var _,g,y=!0;function v(t){if(y){var e;for(_=new n.Buf32(512),g=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(1,t.lens,0,288,_,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(2,t.lens,0,32,g,0,t.work,{bits:5}),y=!1}t.lencode=_,t.lenbits=9,t.distcode=g,t.distbits=5}function x(t,e,i,r){var s,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),r>=a.wsize?(n.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>r&&(s=r),n.arraySet(a.window,e,i-r,s,a.wnext),(r-=s)?(n.arraySet(a.window,e,i-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}e.inflateReset=p,e.inflateReset2=f,e.inflateResetKeep=d,e.inflateInit=function(t){return m(t,15)},e.inflateInit2=m,e.inflate=function(t,e){var i,d,p,f,m,_,g,y,b,w,M,S,E,T,A,P,C,L,R,I,D,O,N,F,k=0,z=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return l;(i=t.state).mode===h&&(i.mode=13),m=t.next_out,p=t.output,g=t.avail_out,f=t.next_in,d=t.input,_=t.avail_in,y=i.hold,b=i.bits,w=_,M=g,O=0;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;b<16;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(2&i.wrap&&35615===y){i.check=0,z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0),y=0,b=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",i.mode=c;break}if(8!=(15&y)){t.msg="unknown compression method",i.mode=c;break}if(b-=4,D=8+(15&(y>>>=4)),0===i.wbits)i.wbits=D;else if(D>i.wbits){t.msg="invalid window size",i.mode=c;break}i.dmax=1<<D,t.adler=i.check=1,i.mode=512&y?10:h,y=0,b=0;break;case 2:for(;b<16;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(i.flags=y,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=c;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=c;break}i.head&&(i.head.text=y>>8&1),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0)),y=0,b=0,i.mode=3;case 3:for(;b<32;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}i.head&&(i.head.time=y),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,z[2]=y>>>16&255,z[3]=y>>>24&255,i.check=s(i.check,z,4,0)),y=0,b=0,i.mode=4;case 4:for(;b<16;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0)),y=0,b=0,i.mode=5;case 5:if(1024&i.flags){for(;b<16;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}i.length=y,i.head&&(i.head.extra_len=y),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0)),y=0,b=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((S=i.length)>_&&(S=_),S&&(i.head&&(D=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,d,f,S,D)),512&i.flags&&(i.check=s(i.check,d,S,f)),_-=S,f+=S,i.length-=S),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===_)break t;S=0;do{D=d[f+S++],i.head&&D&&i.length<65536&&(i.head.name+=String.fromCharCode(D))}while(D&&S<_);if(512&i.flags&&(i.check=s(i.check,d,S,f)),_-=S,f+=S,D)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===_)break t;S=0;do{D=d[f+S++],i.head&&D&&i.length<65536&&(i.head.comment+=String.fromCharCode(D))}while(D&&S<_);if(512&i.flags&&(i.check=s(i.check,d,S,f)),_-=S,f+=S,D)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;b<16;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(y!==(65535&i.check)){t.msg="header crc mismatch",i.mode=c;break}y=0,b=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=h;break;case 10:for(;b<32;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}t.adler=i.check=u(y),y=0,b=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=m,t.avail_out=g,t.next_in=f,t.avail_in=_,i.hold=y,i.bits=b,2;t.adler=i.check=1,i.mode=h;case h:if(5===e||6===e)break t;case 13:if(i.last){y>>>=7&b,b-=7&b,i.mode=27;break}for(;b<3;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}switch(i.last=1&y,b-=1,3&(y>>>=1)){case 0:i.mode=14;break;case 1:if(v(i),i.mode=20,6===e){y>>>=2,b-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=c}y>>>=2,b-=2;break;case 14:for(y>>>=7&b,b-=7&b;b<32;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",i.mode=c;break}if(i.length=65535&y,y=0,b=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(S=i.length){if(S>_&&(S=_),S>g&&(S=g),0===S)break t;n.arraySet(p,d,f,S,m),_-=S,f+=S,g-=S,m+=S,i.length-=S;break}i.mode=h;break;case 17:for(;b<14;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(i.nlen=257+(31&y),y>>>=5,b-=5,i.ndist=1+(31&y),y>>>=5,b-=5,i.ncode=4+(15&y),y>>>=4,b-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=c;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;b<3;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}i.lens[U[i.have++]]=7&y,y>>>=3,b-=3}for(;i.have<19;)i.lens[U[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,N={bits:i.lenbits},O=o(0,i.lens,0,19,i.lencode,0,i.work,N),i.lenbits=N.bits,O){t.msg="invalid code lengths set",i.mode=c;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;P=(k=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,C=65535&k,!((A=k>>>24)<=b);){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(C<16)y>>>=A,b-=A,i.lens[i.have++]=C;else{if(16===C){for(F=A+2;b<F;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(y>>>=A,b-=A,0===i.have){t.msg="invalid bit length repeat",i.mode=c;break}D=i.lens[i.have-1],S=3+(3&y),y>>>=2,b-=2}else if(17===C){for(F=A+3;b<F;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}b-=A,D=0,S=3+(7&(y>>>=A)),y>>>=3,b-=3}else{for(F=A+7;b<F;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}b-=A,D=0,S=11+(127&(y>>>=A)),y>>>=7,b-=7}if(i.have+S>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=c;break}for(;S--;)i.lens[i.have++]=D}}if(i.mode===c)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=c;break}if(i.lenbits=9,N={bits:i.lenbits},O=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,N),i.lenbits=N.bits,O){t.msg="invalid literal/lengths set",i.mode=c;break}if(i.distbits=6,i.distcode=i.distdyn,N={bits:i.distbits},O=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,N),i.distbits=N.bits,O){t.msg="invalid distances set",i.mode=c;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(_>=6&&g>=258){t.next_out=m,t.avail_out=g,t.next_in=f,t.avail_in=_,i.hold=y,i.bits=b,a(t,M),m=t.next_out,p=t.output,g=t.avail_out,f=t.next_in,d=t.input,_=t.avail_in,y=i.hold,b=i.bits,i.mode===h&&(i.back=-1);break}for(i.back=0;P=(k=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,C=65535&k,!((A=k>>>24)<=b);){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(P&&0==(240&P)){for(L=A,R=P,I=C;P=(k=i.lencode[I+((y&(1<<L+R)-1)>>L)])>>>16&255,C=65535&k,!(L+(A=k>>>24)<=b);){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}y>>>=L,b-=L,i.back+=L}if(y>>>=A,b-=A,i.back+=A,i.length=C,0===P){i.mode=26;break}if(32&P){i.back=-1,i.mode=h;break}if(64&P){t.msg="invalid literal/length code",i.mode=c;break}i.extra=15&P,i.mode=22;case 22:if(i.extra){for(F=i.extra;b<F;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,b-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;P=(k=i.distcode[y&(1<<i.distbits)-1])>>>16&255,C=65535&k,!((A=k>>>24)<=b);){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(0==(240&P)){for(L=A,R=P,I=C;P=(k=i.distcode[I+((y&(1<<L+R)-1)>>L)])>>>16&255,C=65535&k,!(L+(A=k>>>24)<=b);){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}y>>>=L,b-=L,i.back+=L}if(y>>>=A,b-=A,i.back+=A,64&P){t.msg="invalid distance code",i.mode=c;break}i.offset=C,i.extra=15&P,i.mode=24;case 24:if(i.extra){for(F=i.extra;b<F;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,b-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=c;break}i.mode=25;case 25:if(0===g)break t;if(S=M-g,i.offset>S){if((S=i.offset-S)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=c;break}S>i.wnext?(S-=i.wnext,E=i.wsize-S):E=i.wnext-S,S>i.length&&(S=i.length),T=i.window}else T=p,E=m-i.offset,S=i.length;S>g&&(S=g),g-=S,i.length-=S;do{p[m++]=T[E++]}while(--S);0===i.length&&(i.mode=21);break;case 26:if(0===g)break t;p[m++]=i.length,g--,i.mode=21;break;case 27:if(i.wrap){for(;b<32;){if(0===_)break t;_--,y|=d[f++]<<b,b+=8}if(M-=g,t.total_out+=M,i.total+=M,M&&(t.adler=i.check=i.flags?s(i.check,p,M,m-M):r(i.check,p,M,m-M)),M=g,(i.flags?y:u(y))!==i.check){t.msg="incorrect data check",i.mode=c;break}y=0,b=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;b<32;){if(0===_)break t;_--,y+=d[f++]<<b,b+=8}if(y!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=c;break}y=0,b=0}i.mode=29;case 29:O=1;break t;case c:O=-3;break t;case 31:return-4;default:return l}return t.next_out=m,t.avail_out=g,t.next_in=f,t.avail_in=_,i.hold=y,i.bits=b,(i.wsize||M!==t.avail_out&&i.mode<c&&(i.mode<27||4!==e))&&x(t,t.output,t.next_out,M-t.avail_out)?(i.mode=31,-4):(w-=t.avail_in,M-=t.avail_out,t.total_in+=w,t.total_out+=M,i.total+=M,i.wrap&&M&&(t.adler=i.check=i.flags?s(i.check,p,M,t.next_out-M):r(i.check,p,M,t.next_out-M)),t.data_type=i.bits+(i.last?64:0)+(i.mode===h?128:0)+(20===i.mode||15===i.mode?256:0),(0===w&&0===M||4===e)&&0===O&&(O=-5),O)},e.inflateEnd=function(t){if(!t||!t.state)return l;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?l:(i.head=e,e.done=!1,0):l},e.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?l:11===i.mode&&r(1,e,n,0)!==i.check?-3:x(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,0):l},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,i){"use strict";var n=i(8);function r(t){for(var e=t.length;--e>=0;)t[e]=0}var s=256,a=286,o=30,l=15,h=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p=new Array(576);r(p);var f=new Array(60);r(f);var m=new Array(512);r(m);var _=new Array(256);r(_);var g=new Array(29);r(g);var y,v,x,b=new Array(o);function w(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function M(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function S(t){return t<256?m[t]:m[256+(t>>>7)]}function E(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function T(t,e,i){t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,E(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function A(t,e,i){T(t,i[2*e],i[2*e+1])}function P(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function C(t,e,i){var n,r,s=new Array(16),a=0;for(n=1;n<=l;n++)s[n]=a=a+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=P(s[o]++,o))}}function L(t){var e;for(e=0;e<a;e++)t.dyn_ltree[2*e]=0;for(e=0;e<o;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function R(t){t.bi_valid>8?E(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function I(t,e,i,n){var r=2*e,s=2*i;return t[r]<t[s]||t[r]===t[s]&&n[e]<=n[i]}function D(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&I(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!I(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function O(t,e,i){var n,r,a,o,l=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],r=t.pending_buf[t.l_buf+l],l++,0===n?A(t,r,e):(A(t,(a=_[r])+s+1,e),0!==(o=h[a])&&T(t,r-=g[a],o),A(t,a=S(--n),i),0!==(o=c[a])&&T(t,n-=b[a],o))}while(l<t.last_lit);A(t,256,e)}function N(t,e){var i,n,r,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,h=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<h;i++)0!==s[2*i]?(t.heap[++t.heap_len]=c=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)s[2*(r=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=a[2*r+1]);for(e.max_code=c,i=t.heap_len>>1;i>=1;i--)D(t,s,i);r=h;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],D(t,s,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,s[2*r]=s[2*i]+s[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,s[2*i+1]=s[2*n+1]=r,t.heap[1]=r++,D(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,s,a,o,h=e.dyn_tree,c=e.max_code,u=e.stat_desc.static_tree,d=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,m=e.stat_desc.max_length,_=0;for(s=0;s<=l;s++)t.bl_count[s]=0;for(h[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)(s=h[2*h[2*(n=t.heap[i])+1]+1]+1)>m&&(s=m,_++),h[2*n+1]=s,n>c||(t.bl_count[s]++,a=0,n>=f&&(a=p[n-f]),o=h[2*n],t.opt_len+=o*(s+a),d&&(t.static_len+=o*(u[2*n+1]+a)));if(0!==_){do{for(s=m-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[m]--,_-=2}while(_>0);for(s=m;0!==s;s--)for(n=t.bl_count[s];0!==n;)(r=t.heap[--i])>c||(h[2*r+1]!==s&&(t.opt_len+=(s-h[2*r+1])*h[2*r],h[2*r+1]=s),n--)}}(t,e),C(s,c,t.bl_count)}function F(t,e,i){var n,r,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=a,a=e[2*(n+1)+1],++o<l&&r===a||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=r,0===a?(l=138,h=3):r===a?(l=6,h=3):(l=7,h=4))}function k(t,e,i){var n,r,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),n=0;n<=i;n++)if(r=a,a=e[2*(n+1)+1],!(++o<l&&r===a)){if(o<h)do{A(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==s&&(A(t,r,t.bl_tree),o--),A(t,16,t.bl_tree),T(t,o-3,2)):o<=10?(A(t,17,t.bl_tree),T(t,o-3,3)):(A(t,18,t.bl_tree),T(t,o-11,7));o=0,s=r,0===a?(l=138,h=3):r===a?(l=6,h=3):(l=7,h=4)}}r(b);var z=!1;function U(t,e,i,r){T(t,0+(r?1:0),3),function(t,e,i,r){R(t),E(t,i),E(t,~i),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}e._tr_init=function(t){z||(function(){var t,e,i,n,r,s=new Array(16);for(i=0,n=0;n<28;n++)for(g[n]=i,t=0;t<1<<h[n];t++)_[i++]=n;for(_[i-1]=n,r=0,n=0;n<16;n++)for(b[n]=r,t=0;t<1<<c[n];t++)m[r++]=n;for(r>>=7;n<o;n++)for(b[n]=r<<7,t=0;t<1<<c[n]-7;t++)m[256+r++]=n;for(e=0;e<=l;e++)s[e]=0;for(t=0;t<=143;)p[2*t+1]=8,t++,s[8]++;for(;t<=255;)p[2*t+1]=9,t++,s[9]++;for(;t<=279;)p[2*t+1]=7,t++,s[7]++;for(;t<=287;)p[2*t+1]=8,t++,s[8]++;for(C(p,287,s),t=0;t<o;t++)f[2*t+1]=5,f[2*t]=P(t,5);y=new w(p,h,257,a,l),v=new w(f,c,0,o,l),x=new w(new Array(0),u,0,19,7)}(),z=!0),t.l_desc=new M(t.dyn_ltree,y),t.d_desc=new M(t.dyn_dtree,v),t.bl_desc=new M(t.bl_tree,x),t.bi_buf=0,t.bi_valid=0,L(t)},e._tr_stored_block=U,e._tr_flush_block=function(t,e,i,n){var r,a,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<s;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),N(t,t.l_desc),N(t,t.d_desc),o=function(t){var e;for(F(t,t.dyn_ltree,t.l_desc.max_code),F(t,t.dyn_dtree,t.d_desc.max_code),N(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*d[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==e?U(t,e,i,n):4===t.strategy||a===r?(T(t,2+(n?1:0),3),O(t,p,f)):(T(t,4+(n?1:0),3),function(t,e,i,n){var r;for(T(t,e-257,5),T(t,i-1,5),T(t,n-4,4),r=0;r<n;r++)T(t,t.bl_tree[2*d[r]+1],3);k(t,t.dyn_ltree,e-1),k(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),O(t,t.dyn_ltree,t.dyn_dtree)),L(t),n&&R(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(_[i]+s+1)]++,t.dyn_dtree[2*S(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){T(t,2,3),A(t,256,p),function(t){16===t.bi_valid?(E(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,i){"use strict";var n,r=i(8),s=i(50),a=i(28),o=i(27),l=i(49),h=-2,c=258,u=262,d=103,p=113,f=666;function m(t,e){return t.msg=l[e],e}function _(t){return(t<<1)-(t>4?9:0)}function g(t){for(var e=t.length;--e>=0;)t[e]=0}function y(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function v(t,e){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,y(t.strm)}function x(t,e){t.pending_buf[t.pending++]=e}function b(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function w(t,e){var i,n,r=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-u?t.strstart-(t.w_size-u):0,h=t.window,d=t.w_mask,p=t.prev,f=t.strstart+c,m=h[s+a-1],_=h[s+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+a]===_&&h[i+a-1]===m&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do{}while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<f);if(n=c-(f-s),s=f-c,n>a){if(t.match_start=e,a=n,n>=o)break;m=h[s+a-1],_=h[s+a]}}}while((e=p[e&d])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function M(t){var e,i,n,s,l,h,c,d,p,f,m=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-u)){r.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,e=i=t.hash_size;do{n=t.head[--e],t.head[e]=n>=m?n-m:0}while(--i);e=i=m;do{n=t.prev[--e],t.prev[e]=n>=m?n-m:0}while(--i);s+=m}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,d=t.strstart+t.lookahead,p=s,f=void 0,(f=h.avail_in)>p&&(f=p),i=0===f?0:(h.avail_in-=f,r.arraySet(c,h.input,h.next_in,f,d),1===h.state.wrap?h.adler=a(h.adler,c,f,d):2===h.state.wrap&&(h.adler=o(h.adler,c,f,d)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=3)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<u&&0!==t.strm.avail_in)}function S(t,e){for(var i,n;;){if(t.lookahead<u){if(M(t),t.lookahead<u&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-u&&(t.match_length=w(t,i)),t.match_length>=3)if(n=s._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function E(t,e){for(var i,n,r;;){if(t.lookahead<u){if(M(t),t.lookahead<u&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-u&&(t.match_length=w(t,i),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(v(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=s._tr_tally(t,0,t.window[t.strstart-1]))&&v(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function T(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function A(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:p,t.adler=2===e.wrap?0:1,e.last_flush=0,s._tr_init(e),0):m(t,h)}function P(t){var e,i=A(t);return 0===i&&((e=t.state).window_size=2*e.w_size,g(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),i}function C(t,e,i,n,s,a){if(!t)return h;var o=1;if(-1===e&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>9||8!==i||n<8||n>15||e<0||e>9||a<0||a>4)return m(t,h);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=i,P(t)}n=[new T(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(M(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,v(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-u&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(v(t,!1),t.strm.avail_out),1)})),new T(4,4,8,4,S),new T(4,5,16,8,S),new T(4,6,32,32,S),new T(4,4,16,16,E),new T(8,16,32,32,E),new T(8,16,128,128,E),new T(8,32,128,256,E),new T(32,128,258,1024,E),new T(32,258,258,4096,E)],e.deflateInit=function(t,e){return C(t,e,8,15,8,0)},e.deflateInit2=C,e.deflateReset=P,e.deflateResetKeep=A,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?h:(t.state.gzhead=e,0):h},e.deflate=function(t,e){var i,r,a,l;if(!t||!t.state||e>5||e<0)return t?m(t,h):h;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===f&&4!==e)return m(t,0===t.avail_out?-5:h);if(r.strm=t,i=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,x(r,31),x(r,139),x(r,8),r.gzhead?(x(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),x(r,255&r.gzhead.time),x(r,r.gzhead.time>>8&255),x(r,r.gzhead.time>>16&255),x(r,r.gzhead.time>>24&255),x(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),x(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(x(r,255&r.gzhead.extra.length),x(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(x(r,0),x(r,0),x(r,0),x(r,0),x(r,0),x(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),x(r,3),r.status=p);else{var u=8+(r.w_bits-8<<4)<<8;u|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(u|=32),u+=31-u%31,r.status=p,b(r,u),0!==r.strstart&&(b(r,t.adler>>>16),b(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),y(t),a=r.pending,r.pending!==r.pending_buf_size));)x(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),y(t),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,x(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),y(t),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,x(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.status=d)}else r.status=d;if(r.status===d&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&y(t),r.pending+2<=r.pending_buf_size&&(x(r,255&t.adler),x(r,t.adler>>8&255),t.adler=0,r.status=p)):r.status=p),0!==r.pending){if(y(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&_(e)<=_(i)&&4!==e)return m(t,-5);if(r.status===f&&0!==t.avail_in)return m(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&r.status!==f){var w=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(M(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var i,n,r,a,o=t.window;;){if(t.lookahead<=c){if(M(t),t.lookahead<=c&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=o[r=t.strstart-1])===o[++r]&&n===o[++r]&&n===o[++r]){a=t.strstart+c;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<a);t.match_length=c-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=s._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(r,e):n[r.level].func(r,e);if(3!==w&&4!==w||(r.status=f),1===w||3===w)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===w&&(1===e?s._tr_align(r):5!==e&&(s._tr_stored_block(r,0,0,!1),3===e&&(g(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),y(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(x(r,255&t.adler),x(r,t.adler>>8&255),x(r,t.adler>>16&255),x(r,t.adler>>24&255),x(r,255&t.total_in),x(r,t.total_in>>8&255),x(r,t.total_in>>16&255),x(r,t.total_in>>24&255)):(b(r,t.adler>>>16),b(r,65535&t.adler)),y(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&e!==d&&e!==p&&e!==f?m(t,h):(t.state=null,e===p?m(t,-3):0):h},e.deflateSetDictionary=function(t,e){var i,n,s,o,l,c,u,d,p=e.length;if(!t||!t.state)return h;if(2===(o=(i=t.state).wrap)||1===o&&42!==i.status||i.lookahead)return h;for(1===o&&(t.adler=a(t.adler,e,p,0)),i.wrap=0,p>=i.w_size&&(0===o&&(g(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new r.Buf8(i.w_size),r.arraySet(d,e,p-i.w_size,i.w_size,0),e=d,p=i.w_size),l=t.avail_in,c=t.next_in,u=t.input,t.avail_in=p,t.next_in=0,t.input=e,M(i);i.lookahead>=3;){n=i.strstart,s=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+3-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--s);i.strstart=n,i.lookahead=2,M(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=u,t.avail_in=l,i.wrap=o,0},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e,i){"use strict";(function(t,n){var r=i(30),s=i(52),a=i(51),o=i(48),l=i(45);for(var h in l)e[h]=l[h];function c(t){if("number"!=typeof t||t<e.DEFLATE||t>e.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}e.NONE=0,e.DEFLATE=1,e.INFLATE=2,e.GZIP=3,e.GUNZIP=4,e.DEFLATERAW=5,e.INFLATERAW=6,e.UNZIP=7,c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,r(this.init_done,"close before init"),r(this.mode<=e.UNZIP),this.mode===e.DEFLATE||this.mode===e.GZIP||this.mode===e.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==e.INFLATE&&this.mode!==e.GUNZIP&&this.mode!==e.INFLATERAW&&this.mode!==e.UNZIP||o.inflateEnd(this.strm),this.mode=e.NONE,this.dictionary=null)},c.prototype.write=function(t,e,i,n,r,s,a){return this._write(!0,t,e,i,n,r,s,a)},c.prototype.writeSync=function(t,e,i,n,r,s,a){return this._write(!1,t,e,i,n,r,s,a)},c.prototype._write=function(i,s,a,o,l,h,c,u){if(r.equal(arguments.length,8),r(this.init_done,"write before init"),r(this.mode!==e.NONE,"already finalized"),r.equal(!1,this.write_in_progress,"write already in progress"),r.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,r.equal(!1,void 0===s,"must provide flush value"),this.write_in_progress=!0,s!==e.Z_NO_FLUSH&&s!==e.Z_PARTIAL_FLUSH&&s!==e.Z_SYNC_FLUSH&&s!==e.Z_FULL_FLUSH&&s!==e.Z_FINISH&&s!==e.Z_BLOCK)throw new Error("Invalid flush value");if(null==a&&(a=t.alloc(0),l=0,o=0),this.strm.avail_in=l,this.strm.input=a,this.strm.next_in=o,this.strm.avail_out=u,this.strm.output=h,this.strm.next_out=c,this.flush=s,!i)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return n.nextTick((function(){d._process(),d._after()})),this},c.prototype._afterSync=function(){var t=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,t]},c.prototype._process=function(){var t=null;switch(this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case e.UNZIP:switch(this.strm.avail_in>0&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=e.INFLATE;break}if(this.gzip_id_bytes_read=1,t++,1===this.strm.avail_in)break;case 1:if(null===t)break;139===this.strm.input[t]?(this.gzip_id_bytes_read=2,this.mode=e.GUNZIP):this.mode=e.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:for(this.err=o.inflate(this.strm,this.flush),this.err===e.Z_NEED_DICT&&this.dictionary&&(this.err=o.inflateSetDictionary(this.strm,this.dictionary),this.err===e.Z_OK?this.err=o.inflate(this.strm,this.flush):this.err===e.Z_DATA_ERROR&&(this.err=e.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===e.GUNZIP&&this.err===e.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=o.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case e.Z_OK:case e.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===e.Z_FINISH)return this._error("unexpected end of file"),!1;break;case e.Z_STREAM_END:break;case e.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var t=this.strm.avail_out,e=this.strm.avail_in;this.write_in_progress=!1,this.callback(e,t),this.pending_close&&this.close()}},c.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(t,i,n,s,a){r(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),r(t>=8&&t<=15,"invalid windowBits"),r(i>=-1&&i<=9,"invalid compression level"),r(n>=1&&n<=9,"invalid memlevel"),r(s===e.Z_FILTERED||s===e.Z_HUFFMAN_ONLY||s===e.Z_RLE||s===e.Z_FIXED||s===e.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(i,t,n,s,a),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(t,i,n,r,l){switch(this.level=t,this.windowBits=i,this.memLevel=n,this.strategy=r,this.flush=e.Z_NO_FLUSH,this.err=e.Z_OK,this.mode!==e.GZIP&&this.mode!==e.GUNZIP||(this.windowBits+=16),this.mode===e.UNZIP&&(this.windowBits+=32),this.mode!==e.DEFLATERAW&&this.mode!==e.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,e.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:case e.UNZIP:this.err=o.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==e.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==e.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:case e.GZIP:this.err=a.deflateReset(this.strm);break;case e.INFLATE:case e.INFLATERAW:case e.GUNZIP:this.err=o.inflateReset(this.strm)}this.err!==e.Z_OK&&this._error("Failed to reset stream")},e.Zlib=c}).call(this,i(1).Buffer,i(3))},function(t,e,i){t.exports=i(19).PassThrough},function(t,e,i){t.exports=i(19).Transform},function(t,e,i){t.exports=i(2)},function(t,e,i){t.exports=i(18)},function(t,e,i){"use strict";t.exports=s;var n=i(31),r=i(6);function s(t){if(!(this instanceof s))return new s(t);n.call(this,t)}r.inherits=i(5),r.inherits(s,n),s.prototype._transform=function(t,e,i){i(null,t)}},function(t,e,i){(function(e){function i(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function(t,e){if(i("noDeprecation"))return t;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(this,i(0))},function(t,e,i){(function(t,e){!function(t,i){"use strict";if(!t.setImmediate){var n,r,s,a,o,l=1,h={},c=!1,u=t.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(t);d=d&&d.setTimeout?d:t,"[object process]"==={}.toString.call(t.process)?n=function(t){e.nextTick((function(){f(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(a="setImmediate$"+Math.random()+"$",o=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&f(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",o,!1):t.attachEvent("onmessage",o),n=function(e){t.postMessage(a+e,"*")}):t.MessageChannel?((s=new MessageChannel).port1.onmessage=function(t){f(t.data)},n=function(t){s.port2.postMessage(t)}):u&&"onreadystatechange"in u.createElement("script")?(r=u.documentElement,n=function(t){var e=u.createElement("script");e.onreadystatechange=function(){f(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):n=function(t){setTimeout(f,0,t)},d.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var r={callback:t,args:e};return h[l]=r,n(l),l++},d.clearImmediate=p}function p(t){delete h[t]}function f(t){if(c)setTimeout(f,0,t);else{var e=h[t];if(e){c=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(undefined,i)}}(e)}finally{p(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,i(0),i(3))},function(t,e,i){(function(t){var n=Function.prototype.apply;function r(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new r(n.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new r(n.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i(62),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,i(0))},function(t,e){},function(t,e,i){"use strict";var n=i(9).Buffer,r=i(64);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e,i,r=n.allocUnsafe(t>>>0),s=this.head,a=0;s;)e=r,i=a,s.data.copy(e,i),a+=s.data.length,s=s.next;return r},t}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var t=r.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,i){t.exports=r;var n=i(20).EventEmitter;function r(){n.call(this)}i(5)(r,n),r.Readable=i(19),r.Writable=i(59),r.Duplex=i(58),r.Transform=i(57),r.PassThrough=i(56),r.Stream=r,r.prototype.pipe=function(t,e){var i=this;function r(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function s(){i.readable&&i.resume&&i.resume()}i.on("data",r),t.on("drain",s),t._isStdio||e&&!1===e.end||(i.on("end",o),i.on("close",l));var a=!1;function o(){a||(a=!0,t.end())}function l(){a||(a=!0,"function"==typeof t.destroy&&t.destroy())}function h(t){if(c(),0===n.listenerCount(this,"error"))throw t}function c(){i.removeListener("data",r),t.removeListener("drain",s),i.removeListener("end",o),i.removeListener("close",l),i.removeListener("error",h),t.removeListener("error",h),i.removeListener("end",c),i.removeListener("close",c),t.removeListener("close",c)}return i.on("error",h),t.on("error",h),i.on("end",c),i.on("close",c),t.on("close",c),t.emit("pipe",i),t}},function(t,e,i){"use strict";(function(t){var n=i(1).Buffer,r=i(67).Transform,s=i(55),a=i(29),o=i(30).ok,l=i(1).kMaxLength,h="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";s.Z_MIN_WINDOWBITS=8,s.Z_MAX_WINDOWBITS=15,s.Z_DEFAULT_WINDOWBITS=15,s.Z_MIN_CHUNK=64,s.Z_MAX_CHUNK=1/0,s.Z_DEFAULT_CHUNK=16384,s.Z_MIN_MEMLEVEL=1,s.Z_MAX_MEMLEVEL=9,s.Z_DEFAULT_MEMLEVEL=8,s.Z_MIN_LEVEL=-1,s.Z_MAX_LEVEL=9,s.Z_DEFAULT_LEVEL=s.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(s),u=0;u<c.length;u++){var d=c[u];d.match(/^Z/)&&Object.defineProperty(e,d,{enumerable:!0,value:s[d],writable:!1})}for(var p={Z_OK:s.Z_OK,Z_STREAM_END:s.Z_STREAM_END,Z_NEED_DICT:s.Z_NEED_DICT,Z_ERRNO:s.Z_ERRNO,Z_STREAM_ERROR:s.Z_STREAM_ERROR,Z_DATA_ERROR:s.Z_DATA_ERROR,Z_MEM_ERROR:s.Z_MEM_ERROR,Z_BUF_ERROR:s.Z_BUF_ERROR,Z_VERSION_ERROR:s.Z_VERSION_ERROR},f=Object.keys(p),m=0;m<f.length;m++){var _=f[m];p[p[_]]=_}function g(t,e,i){var r=[],s=0;function a(){for(var e;null!==(e=t.read());)r.push(e),s+=e.length;t.once("readable",a)}function o(){var e,a=null;s>=l?a=new RangeError(h):e=n.concat(r,s),r=[],t.close(),i(a,e)}t.on("error",(function(e){t.removeListener("end",o),t.removeListener("readable",a),i(e)})),t.on("end",o),t.end(e),a()}function y(t,e){if("string"==typeof e&&(e=n.from(e)),!n.isBuffer(e))throw new TypeError("Not a string or buffer");var i=t._finishFlushFlag;return t._processChunk(e,i)}function v(t){if(!(this instanceof v))return new v(t);A.call(this,t,s.DEFLATE)}function x(t){if(!(this instanceof x))return new x(t);A.call(this,t,s.INFLATE)}function b(t){if(!(this instanceof b))return new b(t);A.call(this,t,s.GZIP)}function w(t){if(!(this instanceof w))return new w(t);A.call(this,t,s.GUNZIP)}function M(t){if(!(this instanceof M))return new M(t);A.call(this,t,s.DEFLATERAW)}function S(t){if(!(this instanceof S))return new S(t);A.call(this,t,s.INFLATERAW)}function E(t){if(!(this instanceof E))return new E(t);A.call(this,t,s.UNZIP)}function T(t){return t===s.Z_NO_FLUSH||t===s.Z_PARTIAL_FLUSH||t===s.Z_SYNC_FLUSH||t===s.Z_FULL_FLUSH||t===s.Z_FINISH||t===s.Z_BLOCK}function A(t,i){var a=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||e.Z_DEFAULT_CHUNK,r.call(this,t),t.flush&&!T(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!T(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||s.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:s.Z_FINISH,t.chunkSize&&(t.chunkSize<e.Z_MIN_CHUNK||t.chunkSize>e.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<e.Z_MIN_WINDOWBITS||t.windowBits>e.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<e.Z_MIN_LEVEL||t.level>e.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<e.Z_MIN_MEMLEVEL||t.memLevel>e.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=e.Z_FILTERED&&t.strategy!=e.Z_HUFFMAN_ONLY&&t.strategy!=e.Z_RLE&&t.strategy!=e.Z_FIXED&&t.strategy!=e.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!n.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new s.Zlib(i);var o=this;this._hadError=!1,this._handle.onerror=function(t,i){P(o),o._hadError=!0;var n=new Error(t);n.errno=i,n.code=e.codes[i],o.emit("error",n)};var l=e.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(l=t.level);var h=e.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(h=t.strategy),this._handle.init(t.windowBits||e.Z_DEFAULT_WINDOWBITS,l,t.memLevel||e.Z_DEFAULT_MEMLEVEL,h,t.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=h,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!a._handle},configurable:!0,enumerable:!0})}function P(e,i){i&&t.nextTick(i),e._handle&&(e._handle.close(),e._handle=null)}function C(t){t.emit("close")}Object.defineProperty(e,"codes",{enumerable:!0,value:Object.freeze(p),writable:!1}),e.Deflate=v,e.Inflate=x,e.Gzip=b,e.Gunzip=w,e.DeflateRaw=M,e.InflateRaw=S,e.Unzip=E,e.createDeflate=function(t){return new v(t)},e.createInflate=function(t){return new x(t)},e.createDeflateRaw=function(t){return new M(t)},e.createInflateRaw=function(t){return new S(t)},e.createGzip=function(t){return new b(t)},e.createGunzip=function(t){return new w(t)},e.createUnzip=function(t){return new E(t)},e.deflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new v(e),t,i)},e.deflateSync=function(t,e){return y(new v(e),t)},e.gzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new b(e),t,i)},e.gzipSync=function(t,e){return y(new b(e),t)},e.deflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new M(e),t,i)},e.deflateRawSync=function(t,e){return y(new M(e),t)},e.unzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new E(e),t,i)},e.unzipSync=function(t,e){return y(new E(e),t)},e.inflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new x(e),t,i)},e.inflateSync=function(t,e){return y(new x(e),t)},e.gunzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new w(e),t,i)},e.gunzipSync=function(t,e){return y(new w(e),t)},e.inflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),g(new S(e),t,i)},e.inflateRawSync=function(t,e){return y(new S(e),t)},a.inherits(A,r),A.prototype.params=function(i,n,r){if(i<e.Z_MIN_LEVEL||i>e.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+i);if(n!=e.Z_FILTERED&&n!=e.Z_HUFFMAN_ONLY&&n!=e.Z_RLE&&n!=e.Z_FIXED&&n!=e.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==i||this._strategy!==n){var a=this;this.flush(s.Z_SYNC_FLUSH,(function(){o(a._handle,"zlib binding closed"),a._handle.params(i,n),a._hadError||(a._level=i,a._strategy=n,r&&r())}))}else t.nextTick(r)},A.prototype.reset=function(){return o(this._handle,"zlib binding closed"),this._handle.reset()},A.prototype._flush=function(t){this._transform(n.alloc(0),"",t)},A.prototype.flush=function(e,i){var r=this,a=this._writableState;("function"==typeof e||void 0===e&&!i)&&(i=e,e=s.Z_FULL_FLUSH),a.ended?i&&t.nextTick(i):a.ending?i&&this.once("end",i):a.needDrain?i&&this.once("drain",(function(){return r.flush(e,i)})):(this._flushFlag=e,this.write(n.alloc(0),"",i))},A.prototype.close=function(e){P(this,e),t.nextTick(C,this)},A.prototype._transform=function(t,e,i){var r,a=this._writableState,o=(a.ending||a.ended)&&(!t||a.length===t.length);return null===t||n.isBuffer(t)?this._handle?(o?r=this._finishFlushFlag:(r=this._flushFlag,t.length>=a.length&&(this._flushFlag=this._opts.flush||s.Z_NO_FLUSH)),void this._processChunk(t,r,i)):i(new Error("zlib binding closed")):i(new Error("invalid input"))},A.prototype._processChunk=function(t,e,i){var r=t&&t.length,s=this._chunkSize-this._offset,a=0,c=this,u="function"==typeof i;if(!u){var d,p=[],f=0;this.on("error",(function(t){d=t})),o(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(e,t,a,r,this._buffer,this._offset,s)}while(!this._hadError&&y(m[0],m[1]));if(this._hadError)throw d;if(f>=l)throw P(this),new RangeError(h);var _=n.concat(p,f);return P(this),_}o(this._handle,"zlib binding closed");var g=this._handle.write(e,t,a,r,this._buffer,this._offset,s);function y(l,h){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var d=s-h;if(o(d>=0,"have should not go down"),d>0){var m=c._buffer.slice(c._offset,c._offset+d);c._offset+=d,u?c.push(m):(p.push(m),f+=m.length)}if((0===h||c._offset>=c._chunkSize)&&(s=c._chunkSize,c._offset=0,c._buffer=n.allocUnsafe(c._chunkSize)),0===h){if(a+=r-l,r=l,!u)return!0;var _=c._handle.write(e,t,a,r,c._buffer,c._offset,c._chunkSize);return _.callback=y,void(_.buffer=t)}if(!u)return!1;i()}}g.buffer=t,g.callback=y},a.inherits(v,A),a.inherits(x,A),a.inherits(b,A),a.inherits(w,A),a.inherits(M,A),a.inherits(S,A),a.inherits(E,A)}).call(this,i(3))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,d){if(void 0===e)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return function(t,e){for(var i in t.elements)t.elements.hasOwnProperty(i)&&(e.elements[i]=t.elements[i]);return void 0!==t.warnings&&(e.warnings=t.warnings.concat(e.warnings)),e}(p=(0,l.default)(e,d),function(l){var p=function(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var i=t.elements.x00020010;return c.readFixedString(e,i.dataOffset,i.length)}(l),f=function(t){return"1.2.840.10008.1.2"!==t}(p),m=function(a,l){if("1.2.840.10008.1.2.1.99"===a){if(d&&d.inflater){var c=d.inflater(e,l);return new s.default(o.default,c,0)}if(void 0!==t&&this.module!==t){var u=i(68),p=(0,h.default)(e,l,e.length-l),f=u.inflateRawSync(p),m=(0,n.default)(e,f.length+l);return e.copy(m,0,0,l),f.copy(m,l),new s.default(o.default,m,0)}if("undefined"!=typeof pako){var _=e.slice(l),g=pako.inflateRaw(_),y=(0,n.default)(e,g.length+l);return y.set(e.slice(0,l),0),y.set(g,l),new s.default(o.default,y,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===a?new s.default(r.default,e,l):new s.default(o.default,e,l)}(p,l.position),_=new a.default(m.byteArrayParser,m.byteArray,{});_.warnings=m.warnings;try{f?u.parseDicomDataSetExplicit(_,m,m.byteArray.length,d):u.parseDicomDataSetImplicit(_,m,m.byteArray.length,d)}catch(t){var g={exception:t,dataSet:_};throw g}return _}(p));var p};var n=p(i(22)),r=p(i(37)),s=p(i(12)),a=p(i(7)),o=p(i(21)),l=p(i(36)),h=p(i(11)),c=d(i(14)),u=d(i(16));function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function p(t){return t&&t.__esModule?t:{default:t}}}).call(this,i(69)(t))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="1.8.1"},function(t,e){e.read=function(t,e,i,n,r){var s,a,o=8*r-n-1,l=(1<<o)-1,h=l>>1,c=-7,u=i?r-1:0,d=i?-1:1,p=t[e+u];for(u+=d,s=p&(1<<-c)-1,p>>=-c,c+=o;c>0;s=256*s+t[e+u],u+=d,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=n;c>0;a=256*a+t[e+u],u+=d,c-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),s-=h}return(p?-1:1)*a*Math.pow(2,s-n)},e.write=function(t,e,i,n,r,s){var a,o,l,h=8*s-r-1,c=(1<<h)-1,u=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(a++,l/=2),a+u>=c?(o=0,a=c):a+u>=1?(o=(e*l-1)*Math.pow(2,r),a+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,r),a=0));r>=8;t[i+p]=255&o,p+=f,o/=256,r-=8);for(a=a<<r|o,h+=r;h>0;t[i+p]=255&a,p+=f,a/=256,h-=8);t[i+p-f]|=128*m}},function(t,e,i){"use strict";e.byteLength=function(t){return 3*t.length/4-h(t)},e.toByteArray=function(t){var e,i,n,a,o,l=t.length;a=h(t),o=new s(3*l/4-a),i=a>0?l-4:l;var c=0;for(e=0;e<i;e+=4)n=r[t.charCodeAt(e)]<<18|r[t.charCodeAt(e+1)]<<12|r[t.charCodeAt(e+2)]<<6|r[t.charCodeAt(e+3)],o[c++]=n>>16&255,o[c++]=n>>8&255,o[c++]=255&n;return 2===a?(n=r[t.charCodeAt(e)]<<2|r[t.charCodeAt(e+1)]>>4,o[c++]=255&n):1===a&&(n=r[t.charCodeAt(e)]<<10|r[t.charCodeAt(e+1)]<<4|r[t.charCodeAt(e+2)]>>2,o[c++]=n>>8&255,o[c++]=255&n),o},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,s="",a=[],o=0,l=i-r;o<l;o+=16383)a.push(c(t,o,o+16383>l?l:o+16383));return 1===r?(e=t[i-1],s+=n[e>>2],s+=n[e<<4&63],s+="=="):2===r&&(e=(t[i-2]<<8)+t[i-1],s+=n[e>>10],s+=n[e>>4&63],s+=n[e<<2&63],s+="="),a.push(s),a.join("")};for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=a.length;o<l;++o)n[o]=a[o],r[a.charCodeAt(o)]=o;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function c(t,e,i){for(var r,s,a=[],o=e;o<i;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),a.push(n[(s=r)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e,i){"use strict";function n(t,e){return 255===t.byteArray[e]&&217===t.byteArray[e+1]}function r(t,e,i){var r=e.fragments[i];return!(!n(t,r.position+r.length-2)&&!n(t,r.position+r.length-3))}function s(t,e,i){for(var n=i;n<e.fragments.length;n++)if(r(t,e,n))return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==e.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==e.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==e.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(e.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(i&&i.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";i=i||e.fragments;for(var n=[],r=0;;){n.push(e.fragments[r].offset);var a=s(t,e,r);if(void 0===a||a===e.fragments.length-1)return n;r=a+1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function t(e,i){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";i=i||{omitPrivateAttibutes:!0,maxElementLength:128};var n={};for(var a in e.elements){var o=e.elements[a];if(!0!==i.omitPrivateAttibutes||!s.isPrivateTag(a))if(o.items){for(var l=[],h=0;h<o.items.length;h++)l.push(t(o.items[h].dataSet,i));n[a]=l}else{var c;c=void 0,o.length<i.maxElementLength&&(c=(0,r.default)(e,o)),n[a]=void 0!==c?c:{dataOffset:o.dataOffset,length:o.length}}}return n};var n,r=(n=i(43))&&n.__esModule?n:{default:n},s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(25))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(t&&8===t.length){var i=parseInt(t.substring(0,4),10),n=parseInt(t.substring(4,6),10),r=parseInt(t.substring(6,8),10);if(e&&!0!==function(t,e,i){return!isNaN(i)&&e>0&&e<=12&&t>0&&t<=function(t,e){switch(t){case 2:return e%4==0&&e%100||e%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(e,i)}(r,n,i))throw"invalid DA '"+t+"'";return{year:i,month:n,day:r}}if(e)throw"invalid DA '"+t+"'"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(t.length>=2){var i=parseInt(t.substring(0,2),10),n=t.length>=4?parseInt(t.substring(2,4),10):void 0,r=t.length>=6?parseInt(t.substring(4,6),10):void 0,s=t.length>=8?parseInt(t.substring(7,13),10):void 0;if(e&&(isNaN(i)||void 0!==n&&isNaN(n)||void 0!==r&&isNaN(r)||void 0!==s&&isNaN(s)||i<0||i>23||n&&(n<0||n>59)||r&&(r<0||r>59)||s&&(s<0||s>999999)))throw"invalid TM '"+t+"'";return{hours:i,minutes:n,seconds:r,fractionalSeconds:s}}if(e)throw"invalid TM '"+t+"'"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(25);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));var r=i(77);Object.defineProperty(e,"parseTM",{enumerable:!0,get:function(){return h(r).default}});var s=i(76);Object.defineProperty(e,"parseDA",{enumerable:!0,get:function(){return h(s).default}});var a=i(43);Object.defineProperty(e,"explicitElementToString",{enumerable:!0,get:function(){return h(a).default}});var o=i(75);Object.defineProperty(e,"explicitDataSetToJS",{enumerable:!0,get:function(){return h(o).default}});var l=i(74);function h(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"createJPEGBasicOffsetTable",{enumerable:!0,get:function(){return h(l).default}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(78);Object.keys(n).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})}));var r=i(16);Object.keys(r).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})}));var s=i(14);Object.keys(s).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})}));var a=i(22);Object.defineProperty(e,"alloc",{enumerable:!0,get:function(){return A(a).default}});var o=i(71);Object.defineProperty(e,"version",{enumerable:!0,get:function(){return A(o).default}});var l=i(37);Object.defineProperty(e,"bigEndianByteArrayParser",{enumerable:!0,get:function(){return A(l).default}});var h=i(12);Object.defineProperty(e,"ByteStream",{enumerable:!0,get:function(){return A(h).default}});var c=i(11);Object.defineProperty(e,"sharedCopy",{enumerable:!0,get:function(){return A(c).default}});var u=i(7);Object.defineProperty(e,"DataSet",{enumerable:!0,get:function(){return A(u).default}});var d=i(41);Object.defineProperty(e,"findAndSetUNElementLength",{enumerable:!0,get:function(){return A(d).default}});var p=i(42);Object.defineProperty(e,"findEndOfEncapsulatedElement",{enumerable:!0,get:function(){return A(p).default}});var f=i(24);Object.defineProperty(e,"findItemDelimitationItemAndSetElementLength",{enumerable:!0,get:function(){return A(f).default}});var m=i(21);Object.defineProperty(e,"littleEndianByteArrayParser",{enumerable:!0,get:function(){return A(m).default}});var _=i(70);Object.defineProperty(e,"parseDicom",{enumerable:!0,get:function(){return A(_).default}});var g=i(15);Object.defineProperty(e,"readDicomElementExplicit",{enumerable:!0,get:function(){return A(g).default}});var y=i(23);Object.defineProperty(e,"readDicomElementImplicit",{enumerable:!0,get:function(){return A(y).default}});var v=i(26);Object.defineProperty(e,"readEncapsulatedImageFrame",{enumerable:!0,get:function(){return A(v).default}});var x=i(44);Object.defineProperty(e,"readEncapsulatedPixelData",{enumerable:!0,get:function(){return A(x).default}});var b=i(17);Object.defineProperty(e,"readEncapsulatedPixelDataFromFragments",{enumerable:!0,get:function(){return A(b).default}});var w=i(36);Object.defineProperty(e,"readPart10Header",{enumerable:!0,get:function(){return A(w).default}});var M=i(40);Object.defineProperty(e,"readSequenceItemsExplicit",{enumerable:!0,get:function(){return A(M).default}});var S=i(39);Object.defineProperty(e,"readSequenceItemsImplicit",{enumerable:!0,get:function(){return A(S).default}});var E=i(13);Object.defineProperty(e,"readSequenceItem",{enumerable:!0,get:function(){return A(E).default}});var T=i(4);function A(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"readTag",{enumerable:!0,get:function(){return A(T).default}})}])},7187:t=>{var e=Object.create||function(t){var e=function(){};return e.prototype=t,new e},i=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return i},n=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=e(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var s,a=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),s=0===o.x}catch(t){s=!1}function l(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function h(t,e,i){if(e)t.call(i);else for(var n=t.length,r=v(t,n),s=0;s<n;++s)r[s].call(i)}function c(t,e,i,n){if(e)t.call(i,n);else for(var r=t.length,s=v(t,r),a=0;a<r;++a)s[a].call(i,n)}function u(t,e,i,n,r){if(e)t.call(i,n,r);else for(var s=t.length,a=v(t,s),o=0;o<s;++o)a[o].call(i,n,r)}function d(t,e,i,n,r,s){if(e)t.call(i,n,r,s);else for(var a=t.length,o=v(t,a),l=0;l<a;++l)o[l].call(i,n,r,s)}function p(t,e,i,n){if(e)t.apply(i,n);else for(var r=t.length,s=v(t,r),a=0;a<r;++a)s[a].apply(i,n)}function f(t,i,n,r){var s,a,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",i,n.listener?n.listener:n),a=t._events),o=a[i]):(a=t._events=e(null),t._eventsCount=0),o){if("function"==typeof o?o=a[i]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(s=l(t))&&s>0&&o.length>s){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(i)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');h.name="MaxListenersExceededWarning",h.emitter=t,h.type=i,h.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",h.name,h.message)}}else o=a[i]=n,++t._eventsCount;return t}function m(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function _(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=n.call(m,r);return s.listener=i,r.wrapFn=s,s}function g(t,e,i){var n=t._events;if(!n)return[];var r=n[e];return r?"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):v(r,r.length):[]}function y(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function v(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}s?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');a=t}}):r.defaultMaxListeners=a,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(t){var e,i,n,r,s,a,o="error"===t;if(a=this._events)o=o&&null==a.error;else if(!o)return!1;if(o){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var l=new Error('Unhandled "error" event. ('+e+")");throw l.context=e,l}if(!(i=a[t]))return!1;var f="function"==typeof i;switch(n=arguments.length){case 1:h(i,f,this);break;case 2:c(i,f,this,arguments[1]);break;case 3:u(i,f,this,arguments[1],arguments[2]);break;case 4:d(i,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),s=1;s<n;s++)r[s-1]=arguments[s];p(i,f,this,r)}return!0},r.prototype.addListener=function(t,e){return f(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return f(this,t,e,!0)},r.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_(this,t,e)),this},r.prototype.removeListener=function(t,i){var n,r,s,a,o;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===i||n.listener===i)0==--this._eventsCount?this._events=e(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||i));else if("function"!=typeof n){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===i||n[a].listener===i){o=n[a].listener,s=a;break}if(s<0)return this;0===s?n.shift():function(t,e){for(var i=e,n=i+1,r=t.length;n<r;i+=1,n+=1)t[i]=t[n];t.pop()}(n,s),1===n.length&&(r[t]=n[0]),r.removeListener&&this.emit("removeListener",t,o||i)}return this},r.prototype.removeAllListeners=function(t){var n,r,s;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=e(null),this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=e(null):delete r[t]),this;if(0===arguments.length){var a,o=i(r);for(s=0;s<o.length;++s)"removeListener"!==(a=o[s])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=e(null),this._eventsCount=0,this}if("function"==typeof(n=r[t]))this.removeListener(t,n);else if(n)for(s=n.length-1;s>=0;s--)this.removeListener(t,n[s]);return this},r.prototype.listeners=function(t){return g(this,t,!0)},r.prototype.rawListeners=function(t){return g(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},r.prototype.listenerCount=y,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},8397:t=>{"use strict";var e=e||{};e.lossless=e.lossless||{},e.lossless.ComponentSpec=e.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0},t.exports&&(t.exports=e.lossless.ComponentSpec)},5924:t=>{"use strict";var e=e||{};e.lossless=e.lossless||{},e.lossless.DataStream=e.lossless.DataStream||function(t,e,i){this.buffer=new DataView(t,e,i),this.index=0},e.lossless.DataStream.prototype.get16=function(){var t=this.buffer.getUint16(this.index,!1);return this.index+=2,t},e.lossless.DataStream.prototype.get8=function(){var t=this.buffer.getUint8(this.index);return this.index+=1,t},t.exports&&(t.exports=e.lossless.DataStream)},2286:(t,e,i)=>{"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i(5924),n.lossless.HuffmanTable=n.lossless.HuffmanTable||i(3447),n.lossless.QuantizationTable=n.lossless.QuantizationTable||i(3506),n.lossless.ScanHeader=n.lossless.ScanHeader||i(1999),n.lossless.FrameHeader=n.lossless.FrameHeader||i(742),n.lossless.Utils=n.lossless.Utils||i(1377),n.lossless.Decoder=n.lossless.Decoder||function(t,e){this.buffer=t,this.frame=new n.lossless.FrameHeader,this.huffTable=new n.lossless.HuffmanTable,this.quantTable=new n.lossless.QuantizationTable,this.scan=new n.lossless.ScanHeader,this.DU=n.lossless.Utils.createArray(10,4,64),this.HuffTab=n.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=n.lossless.Utils.createArray(10,1),this.dcTab=n.lossless.Utils.createArray(10,1),this.qTab=n.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,void 0!==e&&(this.numBytes=e)},n.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],n.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],n.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,n.lossless.Decoder.MSB=2147483648,n.lossless.Decoder.RESTART_MARKER_BEGIN=65488,n.lossless.Decoder.RESTART_MARKER_END=65495,n.lossless.Decoder.prototype.decompress=function(t,e,i){return this.decode(t,e,i).buffer},n.lossless.Decoder.prototype.decode=function(t,e,i,r){var s,a,o,l,h=0,c=[],u=[],d=[];if(void 0!==t&&(this.buffer=t),void 0!==r&&(this.numBytes=r),this.stream=new n.lossless.DataStream(this.buffer,e,i),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(s=this.stream.get16()))throw new Error("Not a JPEG file");for(s=this.stream.get16();s>>4!=4092||65476===s;){switch(s){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,n.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(s>>8!=255)throw new Error("ERROR: format throw new IOException! (decode)")}s=this.stream.get16()}if(s<65472||s>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),s=this.stream.get16();do{for(;65498!==s;){switch(s){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,n.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(s>>8!=255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}s=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,a=0;a<this.numComp;a+=1)o=this.scanComps[a].scanCompSel,this.qTab[a]=this.quantTables[this.components[o].quantTableSel],this.nBlock[a]=this.components[o].vSamp*this.components[o].hSamp,this.dcTab[a]=this.HuffTab[this.scanComps[a].dcTabSel][0],this.acTab[a]=this.HuffTab[this.scanComps[a].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),h+=1;;){for(u[0]=0,d[0]=0,a=0;a<10;a+=1)c[a]=1<<this.precision-1;if(0===this.restartInterval){for(s=this.decodeUnit(c,u,d);0===s&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),s=this.decodeUnit(c,u,d);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,s=this.decodeUnit(c,u,d),this.output(c),0===s);l+=1);if(0===s&&(0!==this.markerIndex?(s=65280|this.marker,this.markerIndex=0):s=this.stream.get16()),!(s>=n.lossless.Decoder.RESTART_MARKER_BEGIN&&s<=n.lossless.Decoder.RESTART_MARKER_END))break}65500===s&&1===h&&(this.readNumber(),s=this.stream.get16())}while(65497!==s&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===h);return this.outputData},n.lossless.Decoder.prototype.decodeUnit=function(t,e,i){return 1==this.numComp?this.decodeSingle(t,e,i):3==this.numComp?this.decodeRGB(t,e,i):-1},n.lossless.Decoder.prototype.select1=function(t){return this.getPreviousX(t)},n.lossless.Decoder.prototype.select2=function(t){return this.getPreviousY(t)},n.lossless.Decoder.prototype.select3=function(t){return this.getPreviousXY(t)},n.lossless.Decoder.prototype.select4=function(t){return this.getPreviousX(t)+this.getPreviousY(t)-this.getPreviousXY(t)},n.lossless.Decoder.prototype.select5=function(t){return this.getPreviousX(t)+(this.getPreviousY(t)-this.getPreviousXY(t)>>1)},n.lossless.Decoder.prototype.select6=function(t){return this.getPreviousY(t)+(this.getPreviousX(t)-this.getPreviousXY(t)>>1)},n.lossless.Decoder.prototype.select7=function(t){return(this.getPreviousX(t)+this.getPreviousY(t))/2},n.lossless.Decoder.prototype.decodeRGB=function(t,e,i){var r,s,a,o,l,h,c,u;for(t[0]=this.selector(0),t[1]=this.selector(1),t[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(o=this.qTab[l],s=this.acTab[l],a=this.dcTab[l],h=0;h<this.nBlock[l];h+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if((r=this.getHuffmanValue(a,e,i))>=65280)return r;for(t[l]=this.IDCT_Source[0]=t[l]+this.getn(i,r,e,i),this.IDCT_Source[0]*=o[0],u=1;u<64;u+=1){if((r=this.getHuffmanValue(s,e,i))>=65280)return r;if(u+=r>>4,0==(15&r)){if(r>>4==0)break}else this.IDCT_Source[n.lossless.Decoder.IDCT_P[u]]=this.getn(i,15&r,e,i)*o[u]}}return 0},n.lossless.Decoder.prototype.decodeSingle=function(t,e,i){var r,s,a,o;for(this.restarting?(this.restarting=!1,t[0]=1<<this.frame.precision-1):t[0]=this.selector(),s=0;s<this.nBlock[0];s+=1){if((r=this.getHuffmanValue(this.dcTab[0],e,i))>=65280)return r;if((o=(a=this.getn(t,r,e,i))>>8)>=n.lossless.Decoder.RESTART_MARKER_BEGIN&&o<=n.lossless.Decoder.RESTART_MARKER_END)return o;t[0]+=a}return 0},n.lossless.Decoder.prototype.getHuffmanValue=function(t,e,i){var r,s;if(i[0]<8?(e[0]<<=8,255===(s=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),e[0]|=s):i[0]-=8,0!=((r=t[e[0]>>i[0]])&n.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;e[0]&=65535>>16-i[0],e[0]<<=8,255===(s=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),e[0]|=s,r=t[256*(255&r)+(e[0]>>i[0])],i[0]+=8}if(i[0]+=8-(r>>8),i[0]<0)throw new Error("index="+i[0]+" temp="+e[0]+" code="+r+" in HuffmanValue()");return i[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(e[0]&=65535>>16-i[0],255&r)},n.lossless.Decoder.prototype.getn=function(t,e,i,n){var r,s;if(0===e)return 0;if(16===e)return t[0]>=0?-32768:32768;if(n[0]-=e,n[0]>=0){if(n[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;r=i[0]>>n[0],i[0]&=65535>>16-n[0]}else{if(i[0]<<=8,255===(s=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),i[0]|=s,n[0]+=8,n[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;i[0]<<=8,255===(s=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),i[0]|=s,n[0]+=8}if(n[0]<0)throw new Error("index="+n[0]+" in getn()");if(n[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r=i[0]>>n[0],i[0]&=65535>>16-n[0]}return r<1<<e-1&&(r+=1+(-1<<e)),r},n.lossless.Decoder.prototype.getPreviousX=function(t){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,t):this.yLoc>0?this.getPreviousY(t):1<<this.frame.precision-1},n.lossless.Decoder.prototype.getPreviousXY=function(t){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,t):this.getPreviousY(t)},n.lossless.Decoder.prototype.getPreviousY=function(t){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,t):this.getPreviousX(t)},n.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},n.lossless.Decoder.prototype.outputSingle=function(t){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&t[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},n.lossless.Decoder.prototype.outputRGB=function(t){var e=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(e,t[0],0),this.setter(e,t[1],1),this.setter(e,t[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},n.lossless.Decoder.prototype.setValue16=function(t,e){this.outputData.setInt16(2*t,e,!0)},n.lossless.Decoder.prototype.getValue16=function(t){return this.outputData.getInt16(2*t,!0)},n.lossless.Decoder.prototype.setValue8=function(t,e){this.outputData.setInt8(t,e)},n.lossless.Decoder.prototype.getValue8=function(t){return this.outputData.getInt8(t)},n.lossless.Decoder.prototype.setValueRGB=function(t,e,i){this.outputData.setUint8(3*t+i,e)},n.lossless.Decoder.prototype.getValueRGB=function(t,e){return this.outputData.getUint8(3*t+e)},n.lossless.Decoder.prototype.readApp=function(){var t=0,e=this.stream.get16();for(t+=2;t<e;)this.stream.get8(),t+=1;return e},n.lossless.Decoder.prototype.readComment=function(){var t,e="",i=0;for(t=this.stream.get16(),i+=2;i<t;)e+=this.stream.get8(),i+=1;return e},n.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()},t.exports&&(t.exports=n.lossless.Decoder)},742:(t,e,i)=>{"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||i(8397),n.lossless.DataStream=n.lossless.DataStream||i(5924),n.lossless.FrameHeader=n.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},n.lossless.FrameHeader.prototype.read=function(t){var e,i,r,s,a=0;for(e=t.get16(),a+=2,this.precision=t.get8(),a+=1,this.dimY=t.get16(),a+=2,this.dimX=t.get16(),a+=2,this.numComp=t.get8(),a+=1,i=1;i<=this.numComp;i+=1){if(a>e)throw new Error("ERROR: frame format error");if(r=t.get8(),(a+=1)>=e)throw new Error("ERROR: frame format error [c>=Lf]");s=t.get8(),a+=1,this.components[r]||(this.components[r]=new n.lossless.ComponentSpec),this.components[r].hSamp=s>>4,this.components[r].vSamp=15&s,this.components[r].quantTableSel=t.get8(),a+=1}if(a!==e)throw new Error("ERROR: frame format error [Lf!=count]");return 1},t.exports&&(t.exports=n.lossless.FrameHeader)},3447:(t,e,i)=>{"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i(5924),n.lossless.Utils=n.lossless.Utils||i(1377),n.lossless.HuffmanTable=n.lossless.HuffmanTable||function(){this.l=n.lossless.Utils.createArray(4,2,16),this.th=[],this.v=n.lossless.Utils.createArray(4,2,16,200),this.tc=n.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},n.lossless.HuffmanTable.MSB=2147483648,n.lossless.HuffmanTable.prototype.read=function(t,e){var i,n,r,s,a,o,l=0;for(i=t.get16(),l+=2;l<i;){if(l+=1,(r=15&(n=t.get8()))>3)throw new Error("ERROR: Huffman table ID > 3");if((s=n>>4)>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[r]=1,this.tc[r][s]=1,a=0;a<16;a+=1)this.l[r][s][a]=t.get8(),l+=1;for(a=0;a<16;a+=1)for(o=0;o<this.l[r][s][a];o+=1){if(l>i)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[r][s][a][o]=t.get8(),l+=1}}if(l!==i)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(a=0;a<4;a+=1)for(o=0;o<2;o+=1)0!==this.tc[a][o]&&this.buildHuffTable(e[a][o],this.l[a][o],this.v[a][o]);return 1},n.lossless.HuffmanTable.prototype.buildHuffTable=function(t,e,i){var r,s,a,o,l;for(s=0,a=0;a<8;a+=1)for(o=0;o<e[a];o+=1)for(l=0;l<256>>a+1;l+=1)t[s]=i[a][o]|a+1<<8,s+=1;for(a=1;s<256;a+=1,s+=1)t[s]=a|n.lossless.HuffmanTable.MSB;for(r=1,s=0,a=8;a<16;a+=1)for(o=0;o<e[a];o+=1){for(l=0;l<256>>a-7;l+=1)t[256*r+s]=i[a][o]|a+1<<8,s+=1;if(s>=256){if(s>256)throw new Error("ERROR: Huffman table error(1)!");s=0,r+=1}}},t.exports&&(t.exports=n.lossless.HuffmanTable)},7090:(t,e,i)=>{"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||i(8397),n.lossless.DataStream=n.lossless.DataStream||i(5924),n.lossless.Decoder=n.lossless.Decoder||i(2286),n.lossless.FrameHeader=n.lossless.FrameHeader||i(742),n.lossless.HuffmanTable=n.lossless.HuffmanTable||i(3447),n.lossless.QuantizationTable=n.lossless.QuantizationTable||i(3506),n.lossless.ScanComponent=n.lossless.ScanComponent||i(2937),n.lossless.ScanHeader=n.lossless.ScanHeader||i(1999),n.lossless.Utils=n.lossless.Utils||i(1377),t.exports&&(t.exports=n)},3506:(t,e,i)=>{"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i(5924),n.lossless.Utils=n.lossless.Utils||i(1377),n.lossless.QuantizationTable=n.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=n.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},n.lossless.QuantizationTable.enhanceQuantizationTable=function(t,e){var i;for(i=0;i<8;i+=1)t[e[0+i]]*=90,t[e[32+i]]*=90,t[e[16+i]]*=118,t[e[48+i]]*=49,t[e[40+i]]*=71,t[e[8+i]]*=126,t[e[56+i]]*=25,t[e[24+i]]*=106;for(i=0;i<8;i+=1)t[e[0+8*i]]*=90,t[e[4+8*i]]*=90,t[e[2+8*i]]*=118,t[e[6+8*i]]*=49,t[e[5+8*i]]*=71,t[e[1+8*i]]*=126,t[e[7+8*i]]*=25,t[e[3+8*i]]*=106;for(i=0;i<64;i+=1)t[i]>>=6},n.lossless.QuantizationTable.prototype.read=function(t,e){var i,r,s,a,o=0;for(i=t.get16(),o+=2;o<i;){if(o+=1,(s=15&(r=t.get8()))>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[s]=r>>4,0===this.precision[s])this.precision[s]=8;else{if(1!==this.precision[s])throw new Error("ERROR: Quantization table precision error");this.precision[s]=16}if(this.tq[s]=1,8===this.precision[s]){for(a=0;a<64;a+=1){if(o>i)throw new Error("ERROR: Quantization table format error");this.quantTables[s][a]=t.get8(),o+=1}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[s],e)}else{for(a=0;a<64;a+=1){if(o>i)throw new Error("ERROR: Quantization table format error");this.quantTables[s][a]=t.get16(),o+=2}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[s],e)}}if(o!==i)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1},t.exports&&(t.exports=n.lossless.QuantizationTable)},2937:t=>{"use strict";var e=e||{};e.lossless=e.lossless||{},e.lossless.ScanComponent=e.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0},t.exports&&(t.exports=e.lossless.ScanComponent)},1999:(t,e,i)=>{"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i(5924),n.lossless.ScanComponent=n.lossless.ScanComponent||i(2937),n.lossless.ScanHeader=n.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},n.lossless.ScanHeader.prototype.read=function(t){var e,i,r,s=0;for(e=t.get16(),s+=2,this.numComp=t.get8(),s+=1,i=0;i<this.numComp;i+=1){if(this.components[i]=new n.lossless.ScanComponent,s>e)throw new Error("ERROR: scan header format error");this.components[i].scanCompSel=t.get8(),s+=1,r=t.get8(),s+=1,this.components[i].dcTabSel=r>>4,this.components[i].acTabSel=15&r}if(this.selection=t.get8(),s+=1,this.spectralEnd=t.get8(),s+=1,r=t.get8(),this.ah=r>>4,this.al=15&r,(s+=1)!==e)throw new Error("ERROR: scan header format error [count!=Ns]");return 1},t.exports&&(t.exports=n.lossless.ScanHeader)},1377:t=>{"use strict";var e=e||{};e.lossless=e.lossless||{},e.lossless.Utils=e.lossless.Utils||{},e.lossless.Utils.createArray=function(t){var i=new Array(t||0),n=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)i[t-1-n]=e.lossless.Utils.createArray.apply(this,r);return i},e.lossless.Utils.makeCRCTable=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e},e.lossless.Utils.crc32=function(t){for(var i=e.lossless.Utils.crcTable||(e.lossless.Utils.crcTable=e.lossless.Utils.makeCRCTable()),n=-1,r=0;r<t.byteLength;r++)n=n>>>8^i[255&(n^t.getUint8(r))];return(-1^n)>>>0},t.exports&&(t.exports=e.lossless.Utils)},5286:t=>{"use strict";t.exports=function(t){return t<0?-t:0===t?0:t}},7585:t=>{"use strict";t.exports=Math.ceil},9022:(t,e,i)=>{"use strict";var n=i(7840);t.exports=function(t){for(var e,i="";t>0;)i=(e=t/2)===(t=n(e))?"0"+i:"1"+i;return i}},9254:(t,e,i)=>{"use strict";var n=i(789),r=i(9284),s=i(5286),a=i(7840),o=i(1753),l=i(1119),h=i(4617),c=i(9022),u=i(3956);t.exports=function(t){var e,i,d,p,f,m,_;if(i=t<0||1/t===r?"1":"0",t===n||t===r)return i+(p=h("1",8))+h("0",23);if(t!=t)return i+(p=h("1",8))+"1"+h("0",22);if(0===t)return i+(p=h("0",8))+h("0",23);if(m=(t=s(t))-(f=a(t)),f=c(f),m=u(m),f)p=f.length-1;else{for(_=0;_<m.length;_++)if("1"===m[_]){e=_+1;break}p=-e}return d=f+m,p<0?(p<=-127&&(e=126),d=d.substring(e)):d=d.substring(1),p=c(p+127),i+(p=l(p,8,"0"))+o(d,23,"0").substring(0,23)}},3956:t=>{"use strict";t.exports=function(t){var e,i,n,r;if(e="",0===t)return e;for(r=149,n=0;n<149&&((i=2*t)>=1?(t=i-1,e+="1",149===r&&(r=n)):(t=i,e+="0"),!(1===i||n-r>24));n++);return e}},7840:t=>{"use strict";t.exports=Math.floor},4075:(t,e,i)=>{"use strict";var n=n||{};n.NIFTI1=n.NIFTI1||i(8668),n.NIFTI2=n.NIFTI2||i(3704),n.Utils=n.Utils||i(7786);var r=r||i(9591);n.isNIFTI1=function(t){var e,i,r,s;return i=(e=new DataView(t)).getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION),r=e.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+1),s=e.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(i!==n.NIFTI1.MAGIC_NUMBER[0]||r!==n.NIFTI1.MAGIC_NUMBER[1]||s!==n.NIFTI1.MAGIC_NUMBER[2])},n.isNIFTI2=function(t){var e,i,r,s;return i=(e=new DataView(t)).getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION),r=e.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+1),s=e.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(i!==n.NIFTI2.MAGIC_NUMBER[0]||r!==n.NIFTI2.MAGIC_NUMBER[1]||s!==n.NIFTI2.MAGIC_NUMBER[2])},n.isNIFTI=function(t){return n.isNIFTI1(t)||n.isNIFTI2(t)},n.isCompressed=function(t){var e,i,r;if(t){if(i=(e=new DataView(t)).getUint8(0),r=e.getUint8(1),i===n.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(r===n.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},n.decompress=function(t){return r.inflate(t).buffer},n.readHeader=function(t){var e=null;return n.isCompressed(t)&&(t=n.decompress(t)),n.isNIFTI1(t)?e=new n.NIFTI1:n.isNIFTI2(t)&&(e=new n.NIFTI2),e?e.readHeader(t):console.error("That file does not appear to be NIFTI!"),e},n.hasExtension=function(t){return 0!=t.extensionFlag[0]},n.readImage=function(t,e){var i=t.vox_offset,n=1,r=1;t.dims[4]&&(n=t.dims[4]),t.dims[5]&&(r=t.dims[5]);var s=t.dims[1]*t.dims[2]*t.dims[3]*n*r*(t.numBitsPerVoxel/8);return e.slice(i,i+s)},n.readExtension=function(t,e){var i=t.getExtensionLocation(),n=t.extensionSize;return e.slice(i,i+n)},n.readExtensionData=function(t,e){var i=t.getExtensionLocation(),n=t.extensionSize;return e.slice(i+8,i+n-8)},t.exports&&(t.exports=n)},8668:(t,e,i)=>{"use strict";var n=n||{};n.Utils=n.Utils||i(7786),n.NIFTI1=n.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},n.NIFTI1.TYPE_NONE=0,n.NIFTI1.TYPE_BINARY=1,n.NIFTI1.TYPE_UINT8=2,n.NIFTI1.TYPE_INT16=4,n.NIFTI1.TYPE_INT32=8,n.NIFTI1.TYPE_FLOAT32=16,n.NIFTI1.TYPE_COMPLEX64=32,n.NIFTI1.TYPE_FLOAT64=64,n.NIFTI1.TYPE_RGB24=128,n.NIFTI1.TYPE_INT8=256,n.NIFTI1.TYPE_UINT16=512,n.NIFTI1.TYPE_UINT32=768,n.NIFTI1.TYPE_INT64=1024,n.NIFTI1.TYPE_UINT64=1280,n.NIFTI1.TYPE_FLOAT128=1536,n.NIFTI1.TYPE_COMPLEX128=1792,n.NIFTI1.TYPE_COMPLEX256=2048,n.NIFTI1.XFORM_UNKNOWN=0,n.NIFTI1.XFORM_SCANNER_ANAT=1,n.NIFTI1.XFORM_ALIGNED_ANAT=2,n.NIFTI1.XFORM_TALAIRACH=3,n.NIFTI1.XFORM_MNI_152=4,n.NIFTI1.SPATIAL_UNITS_MASK=7,n.NIFTI1.TEMPORAL_UNITS_MASK=56,n.NIFTI1.UNITS_UNKNOWN=0,n.NIFTI1.UNITS_METER=1,n.NIFTI1.UNITS_MM=2,n.NIFTI1.UNITS_MICRON=3,n.NIFTI1.UNITS_SEC=8,n.NIFTI1.UNITS_MSEC=16,n.NIFTI1.UNITS_USEC=24,n.NIFTI1.UNITS_HZ=32,n.NIFTI1.UNITS_PPM=40,n.NIFTI1.UNITS_RADS=48,n.NIFTI1.MAGIC_COOKIE=348,n.NIFTI1.MAGIC_NUMBER_LOCATION=344,n.NIFTI1.MAGIC_NUMBER=[110,43,49],n.NIFTI1.MAGIC_NUMBER2=[110,105,49],n.NIFTI1.EXTENSION_HEADER_SIZE=8,n.NIFTI1.prototype.readHeader=function(t){var e,i,r,s,a=new DataView(t),o=n.Utils.getIntAt(a,0,this.littleEndian);if(o!==n.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=n.Utils.getIntAt(a,0,this.littleEndian)),o!==n.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=n.Utils.getByteAt(a,39),e=0;e<8;e+=1)s=40+2*e,this.dims[e]=n.Utils.getShortAt(a,s,this.littleEndian);for(this.intent_p1=n.Utils.getFloatAt(a,56,this.littleEndian),this.intent_p2=n.Utils.getFloatAt(a,60,this.littleEndian),this.intent_p3=n.Utils.getFloatAt(a,64,this.littleEndian),this.intent_code=n.Utils.getShortAt(a,68,this.littleEndian),this.datatypeCode=n.Utils.getShortAt(a,70,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(a,72,this.littleEndian),this.slice_start=n.Utils.getShortAt(a,74,this.littleEndian),e=0;e<8;e+=1)s=76+4*e,this.pixDims[e]=n.Utils.getFloatAt(a,s,this.littleEndian);for(this.vox_offset=n.Utils.getFloatAt(a,108,this.littleEndian),this.scl_slope=n.Utils.getFloatAt(a,112,this.littleEndian),this.scl_inter=n.Utils.getFloatAt(a,116,this.littleEndian),this.slice_end=n.Utils.getShortAt(a,120,this.littleEndian),this.slice_code=n.Utils.getByteAt(a,122),this.xyzt_units=n.Utils.getByteAt(a,123),this.cal_max=n.Utils.getFloatAt(a,124,this.littleEndian),this.cal_min=n.Utils.getFloatAt(a,128,this.littleEndian),this.slice_duration=n.Utils.getFloatAt(a,132,this.littleEndian),this.toffset=n.Utils.getFloatAt(a,136,this.littleEndian),this.description=n.Utils.getStringAt(a,148,228),this.aux_file=n.Utils.getStringAt(a,228,252),this.qform_code=n.Utils.getShortAt(a,252,this.littleEndian),this.sform_code=n.Utils.getShortAt(a,254,this.littleEndian),this.quatern_b=n.Utils.getFloatAt(a,256,this.littleEndian),this.quatern_c=n.Utils.getFloatAt(a,260,this.littleEndian),this.quatern_d=n.Utils.getFloatAt(a,264,this.littleEndian),this.qoffset_x=n.Utils.getFloatAt(a,268,this.littleEndian),this.qoffset_y=n.Utils.getFloatAt(a,272,this.littleEndian),this.qoffset_z=n.Utils.getFloatAt(a,276,this.littleEndian),i=0;i<3;i+=1)for(r=0;r<4;r+=1)s=280+4*(4*i+r),this.affine[i][r]=n.Utils.getFloatAt(a,s,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=n.Utils.getStringAt(a,328,344),this.magic=n.Utils.getStringAt(a,344,348),this.isHDR=this.magic===n.NIFTI1.MAGIC_NUMBER2,a.byteLength>n.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(a,348),this.extensionFlag[1]=n.Utils.getByteAt(a,349),this.extensionFlag[2]=n.Utils.getByteAt(a,350),this.extensionFlag[3]=n.Utils.getByteAt(a,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},n.NIFTI1.prototype.toFormattedString=function(){var t=n.Utils.formatNumber,e="";return e+="Dim Info = "+this.dim_info+"\n",e+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",e+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",e+="Intent Code = "+this.intent_code+"\n",e+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",e+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",e+="Slice Start = "+this.slice_start+"\n",e+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+"\n",e+="Image Offset = "+this.vox_offset+"\n",e+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+"\n",e+="Slice End = "+this.slice_end+"\n",e+="Slice Code = "+this.slice_code+"\n",e+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",e+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+"\n",e+="Slice Duration = "+this.slice_duration+"\n",e+="Time Axis Shift = "+this.toffset+"\n",e+='Description: "'+this.description+'"\n',e+='Auxiliary File: "'+this.aux_file+'"\n',e+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",e+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",e+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+"\n",e+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",e+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+"\n",e+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+"\n",e+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+"\n",e+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(e+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),e},n.NIFTI1.prototype.getDatatypeCodeString=function(t){return t===n.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":t===n.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":t===n.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":t===n.NIFTI1.TYPE_FLOAT32?"4-Byte Float":t===n.NIFTI1.TYPE_FLOAT64?"8-Byte Float":t===n.NIFTI1.TYPE_RGB24?"RGB":t===n.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":t===n.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":t===n.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":t===n.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":t===n.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},n.NIFTI1.prototype.getTransformCodeString=function(t){return t===n.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":t===n.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":t===n.NIFTI1.XFORM_TALAIRACH?"Talairach":t===n.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},n.NIFTI1.prototype.getUnitsCodeString=function(t){return t===n.NIFTI1.UNITS_METER?"Meters":t===n.NIFTI1.UNITS_MM?"Millimeters":t===n.NIFTI1.UNITS_MICRON?"Microns":t===n.NIFTI1.UNITS_SEC?"Seconds":t===n.NIFTI1.UNITS_MSEC?"Milliseconds":t===n.NIFTI1.UNITS_USEC?"Microseconds":t===n.NIFTI1.UNITS_HZ?"Hz":t===n.NIFTI1.UNITS_PPM?"PPM":t===n.NIFTI1.UNITS_RADS?"Rads":"Unknown"},n.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(t,e,i,n,r,s,a,o,l,h){var c,u,d,p,f=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=t,_=e,g=i;return f[3][0]=f[3][1]=f[3][2]=0,f[3][3]=1,(c=1-(m*m+_*_+g*g))<1e-7?(m*=c=1/Math.sqrt(m*m+_*_+g*g),_*=c,g*=c,c=0):c=Math.sqrt(c),u=a>0?a:1,d=o>0?o:1,p=l>0?l:1,h<0&&(p=-p),f[0][0]=(c*c+m*m-_*_-g*g)*u,f[0][1]=2*(m*_-c*g)*d,f[0][2]=2*(m*g+c*_)*p,f[1][0]=2*(m*_+c*g)*u,f[1][1]=(c*c+_*_-m*m-g*g)*d,f[1][2]=2*(_*g-c*m)*p,f[2][0]=2*(m*g-c*_)*u,f[2][1]=2*(_*g+c*m)*d,f[2][2]=(c*c+g*g-_*_-m*m)*p,f[0][3]=n,f[1][3]=r,f[2][3]=s,f},n.NIFTI1.prototype.convertNiftiSFormToNEMA=function(t){var e,i,n,r,s,a,o,l,h,c,u,d,p,f,m,_,g,y,v,x,b,w,M,S,E,T,A,P,C,L,R,I,D;if(f=0,T=[[0,0,0],[0,0,0],[0,0,0]],A=[[0,0,0],[0,0,0],[0,0,0]],e=t[0][0],i=t[0][1],n=t[0][2],r=t[1][0],s=t[1][1],a=t[1][2],o=t[2][0],l=t[2][1],h=t[2][2],0===(c=Math.sqrt(e*e+r*r+o*o)))return null;if(e/=c,r/=c,o/=c,0===(c=Math.sqrt(i*i+s*s+l*l)))return null;if(c=e*(i/=c)+r*(s/=c)+o*(l/=c),Math.abs(c)>1e-4){if(i-=c*e,s-=c*r,l-=c*o,0===(c=Math.sqrt(i*i+s*s+l*l)))return null;i/=c,s/=c,l/=c}if(0===(c=Math.sqrt(n*n+a*a+h*h))?(n=r*l-o*s,a=o*i-l*e,h=e*s-r*i):(n/=c,a/=c,h/=c),c=e*n+r*a+o*h,Math.abs(c)>1e-4){if(n-=c*e,a-=c*r,h-=c*o,0===(c=Math.sqrt(n*n+a*a+h*h)))return null;n/=c,a/=c,h/=c}if(c=i*n+s*a+l*h,Math.abs(c)>1e-4){if(n-=c*i,a-=c*s,h-=c*l,0===(c=Math.sqrt(n*n+a*a+h*h)))return null;n/=c,a/=c,h/=c}if(T[0][0]=e,T[0][1]=i,T[0][2]=n,T[1][0]=r,T[1][1]=s,T[1][2]=a,T[2][0]=o,T[2][1]=l,T[2][2]=h,0===(u=this.nifti_mat33_determ(T)))return null;for(E=-666,y=b=w=M=1,v=2,x=3,d=1;d<=3;d+=1)for(p=1;p<=3;p+=1)if(d!==p)for(f=1;f<=3;f+=1)if(d!==f&&p!==f)for(A[0][0]=A[0][1]=A[0][2]=A[1][0]=A[1][1]=A[1][2]=A[2][0]=A[2][1]=A[2][2]=0,m=-1;m<=1;m+=2)for(_=-1;_<=1;_+=2)for(g=-1;g<=1;g+=2)A[0][d-1]=m,A[1][p-1]=_,A[2][f-1]=g,this.nifti_mat33_determ(A)*u>0&&(c=(S=this.nifti_mat33_mul(A,T))[0][0]+S[1][1]+S[2][2])>E&&(E=c,y=d,v=p,x=f,b=m,w=_,M=g);switch(P=C=L=R=I=D=0,y*b){case 1:P="X",R="+";break;case-1:P="X",R="-";break;case 2:P="Y",R="+";break;case-2:P="Y",R="-";break;case 3:P="Z",R="+";break;case-3:P="Z",R="-"}switch(v*w){case 1:C="X",I="+";break;case-1:C="X",I="-";break;case 2:C="Y",I="+";break;case-2:C="Y",I="-";break;case 3:C="Z",I="+";break;case-3:C="Z",I="-"}switch(x*M){case 1:L="X",D="+";break;case-1:L="X",D="-";break;case 2:L="Y",D="+";break;case-2:L="Y",D="-";break;case 3:L="Z",D="+";break;case-3:L="Z",D="-"}return P+C+L+R+I+D},n.NIFTI1.prototype.nifti_mat33_mul=function(t,e){var i,n,r=[[0,0,0],[0,0,0],[0,0,0]];for(i=0;i<3;i+=1)for(n=0;n<3;n+=1)r[i][n]=t[i][0]*e[0][n]+t[i][1]*e[1][n]+t[i][2]*e[2][n];return r},n.NIFTI1.prototype.nifti_mat33_determ=function(t){var e,i,n,r,s,a,o,l,h;return e=t[0][0],i=t[0][1],n=t[0][2],r=t[1][0],s=t[1][1],a=t[1][2],o=t[2][0],l=t[2][1],e*s*(h=t[2][2])-e*l*a-r*i*h+r*l*n+o*i*a-o*s*n},n.NIFTI1.prototype.getExtensionLocation=function(){return n.NIFTI1.MAGIC_COOKIE+4},n.NIFTI1.prototype.getExtensionSize=function(t){return n.Utils.getIntAt(t,this.getExtensionLocation(),this.littleEndian)},n.NIFTI1.prototype.getExtensionCode=function(t){return n.Utils.getIntAt(t,this.getExtensionLocation()+4,this.littleEndian)},t.exports&&(t.exports=n.NIFTI1)},3704:(t,e,i)=>{"use strict";var n=n||{};n.Utils=n.Utils||i(7786),n.NIFTI1=n.NIFTI1||i(8668),n.NIFTI2=n.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},n.NIFTI2.MAGIC_COOKIE=540,n.NIFTI2.MAGIC_NUMBER_LOCATION=4,n.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],n.NIFTI2.prototype.readHeader=function(t){var e,i,r,s,a=new DataView(t),o=n.Utils.getIntAt(a,0,this.littleEndian);if(o!==n.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=n.Utils.getIntAt(a,0,this.littleEndian)),o!==n.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=n.Utils.getShortAt(a,12,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(a,14,this.littleEndian),e=0;e<8;e+=1)s=16+8*e,this.dims[e]=n.Utils.getLongAt(a,s,this.littleEndian);for(this.intent_p1=n.Utils.getDoubleAt(a,80,this.littleEndian),this.intent_p2=n.Utils.getDoubleAt(a,88,this.littleEndian),this.intent_p3=n.Utils.getDoubleAt(a,96,this.littleEndian),e=0;e<8;e+=1)s=104+8*e,this.pixDims[e]=n.Utils.getDoubleAt(a,s,this.littleEndian);for(this.vox_offset=n.Utils.getLongAt(a,168,this.littleEndian),this.scl_slope=n.Utils.getDoubleAt(a,176,this.littleEndian),this.scl_inter=n.Utils.getDoubleAt(a,184,this.littleEndian),this.cal_max=n.Utils.getDoubleAt(a,192,this.littleEndian),this.cal_min=n.Utils.getDoubleAt(a,200,this.littleEndian),this.slice_duration=n.Utils.getDoubleAt(a,208,this.littleEndian),this.toffset=n.Utils.getDoubleAt(a,216,this.littleEndian),this.slice_start=n.Utils.getLongAt(a,224,this.littleEndian),this.slice_end=n.Utils.getLongAt(a,232,this.littleEndian),this.description=n.Utils.getStringAt(a,240,320),this.aux_file=n.Utils.getStringAt(a,320,344),this.qform_code=n.Utils.getIntAt(a,344,this.littleEndian),this.sform_code=n.Utils.getIntAt(a,348,this.littleEndian),this.quatern_b=n.Utils.getDoubleAt(a,352,this.littleEndian),this.quatern_c=n.Utils.getDoubleAt(a,360,this.littleEndian),this.quatern_d=n.Utils.getDoubleAt(a,368,this.littleEndian),this.qoffset_x=n.Utils.getDoubleAt(a,376,this.littleEndian),this.qoffset_y=n.Utils.getDoubleAt(a,384,this.littleEndian),this.qoffset_z=n.Utils.getDoubleAt(a,392,this.littleEndian),i=0;i<3;i+=1)for(r=0;r<4;r+=1)s=400+8*(4*i+r),this.affine[i][r]=n.Utils.getDoubleAt(a,s,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=n.Utils.getIntAt(a,496,this.littleEndian),this.xyzt_units=n.Utils.getIntAt(a,500,this.littleEndian),this.intent_code=n.Utils.getIntAt(a,504,this.littleEndian),this.intent_name=n.Utils.getStringAt(a,508,524),this.dim_info=n.Utils.getByteAt(a,524),a.byteLength>n.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(a,540),this.extensionFlag[1]=n.Utils.getByteAt(a,541),this.extensionFlag[2]=n.Utils.getByteAt(a,542),this.extensionFlag[3]=n.Utils.getByteAt(a,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},n.NIFTI2.prototype.toFormattedString=function(){var t=n.Utils.formatNumber,e="";return e+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",e+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",e+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",e+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",e+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+"\n",e+="Image Offset = "+this.vox_offset+"\n",e+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+"\n",e+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+"\n",e+="Slice Duration = "+this.slice_duration+"\n",e+="Time Axis Shift = "+this.toffset+"\n",e+="Slice Start = "+this.slice_start+"\n",e+="Slice End = "+this.slice_end+"\n",e+='Description: "'+this.description+'"\n',e+='Auxiliary File: "'+this.aux_file+'"\n',e+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",e+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",e+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+"\n",e+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",e+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+"\n",e+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+"\n",e+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+"\n",e+="Slice Code = "+this.slice_code+"\n",e+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",e+="Intent Code = "+this.intent_code+"\n",(e+='Intent Name: "'+this.intent_name+'"\n')+"Dim Info = "+this.dim_info+"\n"},n.NIFTI2.prototype.getExtensionLocation=function(){return n.NIFTI2.MAGIC_COOKIE+4},n.NIFTI2.prototype.getExtensionSize=n.NIFTI1.prototype.getExtensionSize,n.NIFTI2.prototype.getExtensionCode=n.NIFTI1.prototype.getExtensionCode,n.NIFTI2.prototype.getDatatypeCodeString=n.NIFTI1.prototype.getDatatypeCodeString,n.NIFTI2.prototype.getTransformCodeString=n.NIFTI1.prototype.getTransformCodeString,n.NIFTI2.prototype.getUnitsCodeString=n.NIFTI1.prototype.getUnitsCodeString,n.NIFTI2.prototype.getQformMat=n.NIFTI1.prototype.getQformMat,n.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,n.NIFTI2.prototype.convertNiftiSFormToNEMA=n.NIFTI1.prototype.convertNiftiSFormToNEMA,n.NIFTI2.prototype.nifti_mat33_mul=n.NIFTI1.prototype.nifti_mat33_mul,n.NIFTI2.prototype.nifti_mat33_determ=n.NIFTI1.prototype.nifti_mat33_determ,t.exports&&(t.exports=n.NIFTI2)},7786:t=>{"use strict";var e=e||{};e.Utils=e.Utils||{},e.Utils.crcTable=null,e.Utils.GUNZIP_MAGIC_COOKIE1=31,e.Utils.GUNZIP_MAGIC_COOKIE2=139,e.Utils.getStringAt=function(t,e,i){var n,r,s="";for(n=e;n<i;n+=1)0!==(r=t.getUint8(n))&&(s+=String.fromCharCode(r));return s},e.Utils.getByteAt=function(t,e){return t.getInt8(e)},e.Utils.getShortAt=function(t,e,i){return t.getInt16(e,i)},e.Utils.getIntAt=function(t,e,i){return t.getInt32(e,i)},e.Utils.getFloatAt=function(t,e,i){return t.getFloat32(e,i)},e.Utils.getDoubleAt=function(t,e,i){return t.getFloat64(e,i)},e.Utils.getLongAt=function(t,i,n){var r,s=[],a=0;for(r=0;r<8;r+=1)s[r]=e.Utils.getByteAt(t,i+r,n);for(r=s.length-1;r>=0;r--)a=256*a+s[r];return a},e.Utils.toArrayBuffer=function(t){var e,i,n;for(e=new ArrayBuffer(t.length),i=new Uint8Array(e),n=0;n<t.length;n+=1)i[n]=t[n];return e},e.Utils.isString=function(t){return"string"==typeof t||t instanceof String},e.Utils.formatNumber=function(t,i){var n=0;return n=e.Utils.isString(t)?Number(t):t,n=i?n.toPrecision(5):n.toPrecision(7),parseFloat(n)},e.Utils.makeCRCTable=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e},e.Utils.crc32=function(t){for(var i=e.Utils.crcTable||(e.Utils.crcTable=e.Utils.makeCRCTable()),n=-1,r=0;r<t.byteLength;r++)n=n>>>8^i[255&(n^t.getUint8(r))];return(-1^n)>>>0},t.exports&&(t.exports=e.Utils)},757:(t,e,i)=>{"use strict";var n=i(8583),r=/[ \f\t\v]*\r?\n/,s=/^NRRD\d{4}$/,a=/^([^:]*)(:[ =])(.*)$/,o=/^LIST(?: (\d+))?$/;function l(t,e,i,r){var s,a,o=(a=t)in u?u[a]:a;switch(t){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":s=o+": "+e;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":n("number"==typeof e||e instanceof Number,"Field "+t+" should at least contain a number!"),s=o+": "+e;break;case"min":case"max":case"oldMin":case"oldMax":n("number"==typeof e||e instanceof Number,"Field "+t+" should contain a number!"),s=o+": "+e;break;case"spaceOrigin":n(e.length===r,"Field "+t+" should be a list with length equal to the space dimension!"),e.forEach((function(e){n("number"==typeof e||e instanceof Number,"Field "+t+" should be a list of numbers!")})),s=o+": ("+e.join(",")+")";break;case"labels":case"units":case"spaceUnits":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach((function(e){n("string"==typeof e||e instanceof String,"Field "+t+" should be a list of numbers!")})),s=o+": "+e.map(_).join(" ");break;case"sizes":case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach((function(e){n("number"==typeof e||e instanceof Number,"Field "+t+" should be a list of numbers!")})),s=o+": "+e.join(" ");break;case"spaceDirections":n(void 0!==e.length&&e.length===i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach((function(e){n(null===e||void 0!==e.length&&e.length===r,"The elements of field "+t+" should be lists with length equal to the space dimension!"),null!==e&&e.forEach((function(e){n("number"==typeof e||e instanceof Number,"The elements of field "+t+" should be lists of numbers!")}))})),s=o+": "+e.map((function(t){return null===t?"none":"("+t.join(",")+")"})).join(" ");break;case"measurementFrame":n(void 0!==e.length&&e.length===r,"Field "+t+" should be a list with length equal to the space dimension!"),e.forEach((function(e){n(null===e||void 0!==e.length&&e.length===r,"The elements of field "+t+" should be lists with length equal to the space dimension!"),null!==e&&e.forEach((function(e){n("number"==typeof e||e instanceof Number,"The elements of field "+t+" should be lists of numbers!")}))})),s=o+": "+e.map((function(t){return null===t?"none":"("+t.join(",")+")"})).join(" ");break;case"type":case"encoding":case"endian":n("string"==typeof e||e instanceof String,"Field "+t+" should contain a string!"),s=o+": "+e;break;case"dataFile":e.length||e.files&&"subdim"in e||(s=o+": "+function(t){if("string"==typeof t||t instanceof String)return t;if("format"in t&&"min"in t&&"max"in t&&"step"in t)return"subdim"in t?t.format+" "+t.min+" "+t.max+" "+t.step+" "+t.subdim:t.format+" "+t.min+" "+t.max+" "+t.step;throw new Error("Unrecognized data file format!")}(e));break;case"centers":case"kinds":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),s=o+": "+e.map(T).join(" ");break;default:console.warn("Unrecognized NRRD field: "+t+", skipping.")}return s}function h(t,e){switch(t){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":e=d(e);break;case"min":case"max":case"oldMin":case"oldMax":e=p(e);break;case"spaceOrigin":e=f(e);break;case"labels":case"units":case"spaceUnits":e=y(e,m);break;case"sizes":e=y(e,d);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":e=y(e,p);break;case"spaceDirections":case"measurementFrame":e=y(e,f);break;case"type":e=v(e);break;case"encoding":e=x(e);break;case"endian":e=b(e);break;case"dataFile":i=e,e=(n=w.exec(i))?5==n.length&&n[4]?{format:i.substring(0,n.index),min:d(n[1]),max:d(n[2]),step:d(n[3]),subdim:d(n[4])}:{format:i.substring(0,n.index),min:d(n[1]),max:d(n[2]),step:d(n[3])}:i;break;case"centers":e=y(e,M);break;case"kinds":e=y(e,E);break;case"space":e=function(t){switch(t.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+t),t}}(e);break;default:console.warn("Unrecognized NRRD field: "+t)}var i,n;return e}t.exports.serialize=function(t){var e,i,n,r,s,a,o,h,c,u,d=1,p={},f=[];for(r in t)p[r]=t[r];if(void 0===p.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===p.dimension&&(p.dimension=p.sizes.length),p.data instanceof Int8Array?s="int8":p.data instanceof Uint8Array?s="uint8":p.data instanceof Int16Array?s="int16":p.data instanceof Uint16Array?s="uint16":p.data instanceof Int32Array?s="int32":p.data instanceof Uint32Array?s="uint32":p.data instanceof Float32Array?s="float":p.data instanceof Float64Array&&(s="double"),void 0===p.type&&void 0!==s)p.type=s;else{if(void 0===p.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof p.type||p.type instanceof String)&&(p.type=v(p.type))}void 0===p.encoding?p.encoding="raw":("string"==typeof p.encoding||p.encoding instanceof String)&&(p.encoding=x(p.encoding)),p.data&&"block"!=p.type&&"int8"!=p.type&&"uint8"!=p.type&&"ascii"!=p.encoding?p.endian=L:"block"==p.type||"int8"==p.type||"uint8"==p.type||"ascii"==p.encoding?p.endian=void 0:("string"==typeof p.endian||p.endian instanceof String)&&(p.endian=b(p.endian));var m=void 0;if(void 0!==p.spaceDimension)m=p.spaceDimension;else if(void 0!==p.space)switch(p.space){case"right-anterior-superior":case"RAS":case"left-anterior-superior":case"LAS":case"left-posterior-superior":case"LPS":case"scanner-xyz":case"3D-right-handed":case"3D-left-handed":m=3;break;case"right-anterior-superior-time":case"RAST":case"left-anterior-superior-time":case"LAST":case"left-posterior-superior-time":case"LPST":case"scanner-xyz-time":case"3D-right-handed-time":case"3D-left-handed-time":m=4;break;default:console.warn("Unrecognized space: "+p.space)}for(D(p),e=0;e<p.sizes.length;e++){if(p.sizes[e]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");d*=p.sizes[e]}if(p.data){if(p.data.length<d)throw new Error("Missing data to serialize!")}else if(p.buffer){if("raw"==p.encoding&&(a="block"==p.type&&void 0!==p.blockSize?p.blockSize:I(p.type),p.buffer.byteLength<d*a))throw new Error("Missing data to serialize!")}else if(!p.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(p.data)switch(p.encoding){case"raw":o=p.type==s&&p.endian==L?p.data.buffer.slice(p.data.byteOffset,p.data.byteOffset+p.data.byteLength):p.endian==L?(o=O(p.data,p.type)).buffer.slice(o.byteOffset,o.byteOffset+o.byteLength):function(t,e,i){var n,r,s,a=I(e),o=new ArrayBuffer(t.length*a);switch(i){case"big":r=!1;break;case"little":r=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+i)}switch(s=new DataView(o),e){case"int8":for(n=0;n<t.length;n++)s.setInt8(n,t[n],r);return o;case"uint8":for(n=0;n<t.length;n++)s.setUint8(n,t[n],r);return o;case"int16":for(n=0;n<t.length;n++)s.setInt16(2*n,t[n],r);return o;case"uint16":for(n=0;n<t.length;n++)s.setUint16(2*n,t[n],r);return o;case"int32":for(n=0;n<t.length;n++)s.setInt32(4*n,t[n],r);return o;case"uint32":for(n=0;n<t.length;n++)s.setUint32(4*n,t[n],r);return o;case"float":for(n=0;n<t.length;n++)s.setFloat32(4*n,t[n],r);return o;case"double":for(n=0;n<t.length;n++)s.setFloat64(8*n,t[n],r);return o;default:return void console.warn("Cannot serialize NRRD type: "+e+".")}}(p.data,p.type,p.endian);break;case"ascii":o=p.type==s?N(p.data):N(O(p.data,p.type));break;default:throw new Error("Unsupported NRRD encoding: "+p.encoding)}else p.buffer&&(o=p.buffer);f.push("NRRD0005"),f.push("# Generated by nrrd-js");var _=["dimension","spaceDimension","space"];for(e=0;e<_.length;e++)void 0!==p[r=_[e]]&&void 0!==(c=l(r,p[r],p.dimension,m))&&f.push(c);for(r in p)void 0!==p[r]&&(_.indexOf(r)>=0||void 0!==(c=l(r,p[r],p.dimension,m))&&f.push(c));if(p.keys)for(r in p.keys){if(r.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");f.push(r+":="+p[r].replace("\\","\\\\").replace("\n","\\n"))}if(p.dataFile&&p.dataFile.length?(f.push("data file: LIST"),Array.prototype.push.apply(f,p.dataFile)):p.dataFile&&p.dataFile.files&&"subdim"in p.dataFile&&(f.push("data file: LIST "+p.dataFile.subdim),Array.prototype.push.apply(f,p.dataFile.files)),o&&!("dataFile"in p)){for(f.push(""),f.push(""),u=f.join("\n"),i=new ArrayBuffer(u.length+o.byteLength),n=new Uint8Array(i),e=0;e<u.length;e++)n[e]=u.charCodeAt(e);h=new Uint8Array(o),n.set(h,u.length)}else for(f.push(""),u=f.join("\n"),i=new ArrayBuffer(u.length),n=new Uint8Array(i),e=0;e<u.length;e++)n[e]=u.charCodeAt(e);return i},t.exports.parse=function(t){var e,i,n,l,u,f,m,_={data:void 0,buffer:void 0,keys:{},version:void 0},g=new Uint8Array(t);for(g.buffer!==t&&(t=g.buffer),e=2;e<g.length;)if(10==g[e]){if(10==g[e-1]||13==g[e-1]&&10==g[e-2]){n=e+1;break}e++}else 13==g[e]?e++:e+=2;if(void 0===n?i=String.fromCharCode.apply(null,g):(i=String.fromCharCode.apply(null,g.subarray(0,n)),_.buffer=t.slice(n)),l=(l=i.split(r)).filter((function(t){return t.length>0&&"#"!=t[0]})),!s.test(l[0]))throw new Error("File is not an NRRD file!");for(_.version=parseInt(l[0].substring(4,8),10),_.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),e=1;e<l.length;e++)if(u=a.exec(l[e]))if(": "==u[2])u[1]=(m=(m=u[1]).toLowerCase())in c?c[m]:m,"dataFile"==u[1]&&(f=o.exec(u[3]))?(2==f.length&&f[1]?_[u[1]]={files:l.slice(e+1),subdim:d(f[1])}:_[u[1]]=l.slice(e+1),l.length=e):_[u[1]]=h(u[1],u[3]);else{if(":="!=u[2])throw new Error("Logic error in NRRD parser.");_.keys[u[1]]=u[3].split("\\\\").map((function(t){return t.replace("\\n","\n")})).join("\\")}else console.warn("Unrecognized line in NRRD header: "+l[e]);if(D(_),"dataFile"in _)console.warn("No support for external data yet!");else switch(_.encoding){case"raw":_.data=function(t,e,i,n){var r,s,a,o=1;for(r=0;r<i.length;r++){if(i[r]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");o*=i[r]}if("block"==e)return t.slice(0,o*n.blockSize);if("int8"==e||"uint8"==e||n.endian==L)switch(e){case"int8":return l(1),new Int8Array(t.slice(0,o));case"uint8":return l(1),new Uint8Array(t.slice(0,o));case"int16":return l(2),new Int16Array(t.slice(0,2*o));case"uint16":return l(2),new Uint16Array(t.slice(0,2*o));case"int32":return l(4),new Int32Array(t.slice(0,4*o));case"uint32":return l(4),new Uint32Array(t.slice(0,4*o));case"float":return l(4),new Float32Array(t.slice(0,4*o));case"double":return l(8),new Float64Array(t.slice(0,8*o));default:return void console.warn("Unsupported NRRD type: "+e+", returning raw buffer.")}else{switch(n.endian){case"big":case"little":break;default:return void console.warn("Unsupported endianness in NRRD file: "+n.endian)}switch(a=new DataView(t),e){case"int8":for(s=new Int8Array(o),r=0;r<o;r++)s[r]=a.getInt8(r);return s;case"uint8":for(s=new Uint8Array(o),r=0;r<o;r++)s[r]=a.getUint8(r);return s;case"int16":for(s=new Int16Array(o),r=0;r<o;r++)s[r]=a.getInt16(2*r);return s;case"uint16":for(s=new Uint16Array(o),r=0;r<o;r++)s[r]=a.getUint16(2*r);return s;case"int32":for(s=new Int32Array(o),r=0;r<o;r++)s[r]=a.getInt32(4*r);return s;case"uint32":for(s=new Uint32Array(o),r=0;r<o;r++)s[r]=a.getUint32(4*r);return s;case"float":for(s=new Float32Array(o),r=0;r<o;r++)s[r]=a.getFloat32(4*r);return s;case"double":for(s=new Float64Array(o),r=0;r<o;r++)s[r]=a.getFloat64(8*r);return s;default:return void console.warn("Unsupported NRRD type: "+e+", returning raw buffer.")}}function l(e){if(t.byteLength<o*e)throw new Error("NRRD file does not contain enough data!")}}(_.buffer,_.type,_.sizes,{endian:_.endian,blockSize:_.blockSize});break;case"ascii":_.data=function(t,e,i){var n,r,s,a=1;for(n=0;n<i.length;n++){if(i[n]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");a*=i[n]}if(r=new Uint8Array(t),(s=String.fromCharCode.apply(null,r).split(R)).length<a)throw new Error("Not enough data in NRRD file!");switch(s.length>a&&(""===s[0]&&(s=s.slice(1)),s=s.slice(0,a)),e){case"int8":return new Int8Array(s.map(d));case"uint8":return new Uint8Array(s.map(d));case"int16":return new Int16Array(s.map(d));case"uint16":return new Uint16Array(s.map(d));case"int32":return new Int32Array(s.map(d));case"uint32":return new Uint32Array(s.map(d));case"float":return new Float32Array(s.map(p));case"double":return new Float64Array(s.map(p));default:return void console.warn("Unsupported NRRD type: "+e+".")}}(_.buffer,_.type,_.sizes);break;default:console.warn("Unsupported NRRD encoding: "+_.encoding)}return _};var c={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},u=function(){var t,e={};for(t in c)e[c[t]]=t;return e}();function d(t){var e=parseInt(t,10);if(Number.isNaN(e))throw new Error("Malformed NRRD integer: "+t);return e}function p(t){if((t=t.toLowerCase()).indexOf("nan")>=0)return NaN;if(t.indexOf("-inf")>=0)return-1/0;if(t.indexOf("inf")>=0)return 1/0;var e=parseFloat(t);if(Number.isNaN(e))throw new Error("Malformed NRRD float: "+t);return e}function f(t){if("none"==t)return null;if(t.length<2||"("!==t[0]||")"!==t[t.length-1])throw new Error("Malformed NRRD vector: "+t);return t.slice(1,-1).split(",").map(p)}function m(t){if(length<2||'"'!=t[0]||'"'!=t[t.length-1])throw new Error("Invalid NRRD quoted string: "+t);return t.slice(1,-1).replace('\\"','"')}function _(t){return'"'+t.replace('"','\\"')+'"'}var g=/[ \t]+/;function y(t,e){return t.split(g).map(e)}function v(t){switch(t.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+t),t}}function x(t){switch(t.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+t),t}}function b(t){switch(t.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+t),t}}var w=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/;function M(t){switch(t.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+t),t}}var S={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null};function E(t){var e=t.toLowerCase();return e in S?S[e]:(console.warn("Unrecognized NRRD kind: "+t),t)}function T(t){return null===t?"???":t}var A,P,C,L=(A=new ArrayBuffer(4),P=new Uint32Array(A),C=new Uint8Array(A),P[0]=16909060,1==C[0]&&2==C[1]&&3==C[2]&&4==C[3]?"big":4==C[0]&&3==C[1]&&2==C[2]&&1==C[3]?"little":void console.warn("Unrecognized system endianness!")),R=/[ \t\n\r\v\f]+/;function I(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float":return 4;case"int64":case"uint64":case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+t)}}function D(t){if(void 0===t.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===t.type)throw new Error("Type missing from NRRD file!");if(void 0===t.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===t.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=t.type&&"int8"!=t.type&&"uint8"!=t.type&&"ascii"!=t.encoding&&void 0===t.endian)throw new Error("Endianness missing from NRRD file!");if("block"==t.type&&void 0===t.blockSize)throw new Error("Missing block size in NRRD file!");if(0===t.dimension)throw new Error("Zero-dimensional NRRD file?");if(t.dimension!=t.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(t.spacings&&t.dimension!=t.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(t.thicknesses&&t.dimension!=t.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(t.axisMins&&t.dimension!=t.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(t.axisMaxs&&t.dimension!=t.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(t.centers&&t.dimension!=t.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(t.labels&&t.dimension!=t.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(t.units&&t.dimension!=t.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(t.kinds&&t.dimension!=t.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==t.data&&0!==t.data.length||void 0!==t.buffer&&0!==t.buffer.byteLength||void 0!==t.dataFile))throw new Error("NRRD file has neither inline or external data!")}function O(t,e){switch(e){case"int8":return new Int8Array(t);case"uint8":return new Uint8Array(t);case"int16":return new Int16Array(t);case"uint16":return new Uint16Array(t);case"int32":return new Int32Array(t);case"uint32":return new Uint32Array(t);case"float":return new Float32Array(t);case"double":return new Float64Array(t);default:throw new Error("Cannot cast to NRRD type: "+e)}}function N(t){var e,i,n,r,s=new Array(t.length);for(e=0;e<t.length;e++)s[e]=""+t[e];for(i=s.join(" "),n=new ArrayBuffer(i.length),r=new Uint8Array(n),e=0;e<r.length;e++)r[e]=i.charCodeAt(e);return n}},9591:(t,e,i)=>{"use strict";var n={};(0,i(6247).assign)(n,i(4555),i(8843),i(1619)),t.exports=n},4555:(t,e,i)=>{"use strict";var n=i(405),r=i(6247),s=i(9373),a=i(8898),o=i(2292),l=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==i)throw new Error(a[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var c;if(c="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(i=n.deflateSetDictionary(this.strm,c)))throw new Error(a[i]);this._dict_set=!0}}function c(t,e){var i=new h(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}h.prototype.push=function(t,e){var i,a,o=this.strm,h=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=s.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(h),o.next_out=0,o.avail_out=h),1!==(i=n.deflate(o,a))&&0!==i)return this.onEnd(i),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==i);return 4===a?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==a||(this.onEnd(0),o.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=h,e.deflate=c,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,c(t,e)}},8843:(t,e,i)=>{"use strict";var n=i(7948),r=i(6247),s=i(9373),a=i(1619),o=i(8898),l=i(2292),h=i(2401),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==a.Z_OK)throw new Error(o[i]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function d(t,e){var i=new u(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}u.prototype.push=function(t,e){var i,o,l,h,u,d,p=this.strm,f=this.options.chunkSize,m=this.options.dictionary,_=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?p.input=s.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?p.input=new Uint8Array(t):p.input=t,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(i=n.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(d="string"==typeof m?s.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,i=n.inflateSetDictionary(this.strm,d)),i===a.Z_BUF_ERROR&&!0===_&&(i=a.Z_OK,_=!1),i!==a.Z_STREAM_END&&i!==a.Z_OK)return this.onEnd(i),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&i!==a.Z_STREAM_END&&(0!==p.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(p.output,p.next_out),h=p.next_out-l,u=s.buf2string(p.output,l),p.next_out=h,p.avail_out=f-h,h&&r.arraySet(p.output,p.output,l,h,0),this.onData(u)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(_=!0)}while((p.avail_in>0||0===p.avail_out)&&i!==a.Z_STREAM_END);return i===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=u,e.inflate=d,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.ungzip=d},6247:(t,e)=>{"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var s=0;s<n;s++)t[r+s]=e[i+s]},flattenChunks:function(t){var e,i,n,r,s,a;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(a=new Uint8Array(n),r=0,e=0,i=t.length;e<i;e++)s=t[e],a.set(s,r),r+=s.length;return a}},r={arraySet:function(t,e,i,n,r){for(var s=0;s<n;s++)t[r+s]=e[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(i)},9373:(t,e,i)=>{"use strict";var n=i(6247),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var a=new n.Buf8(256),o=0;o<256;o++)a[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",a=0;a<e;a++)i+=String.fromCharCode(t[a]);return i}a[254]=a[254]=1,e.string2buf=function(t){var e,i,r,s,a,o=t.length,l=0;for(s=0;s<o;s++)55296==(64512&(i=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(r=t.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),a=0,s=0;a<l;s++)55296==(64512&(i=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(r=t.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),i<128?e[a++]=i:i<2048?(e[a++]=192|i>>>6,e[a++]=128|63&i):i<65536?(e[a++]=224|i>>>12,e[a++]=128|i>>>6&63,e[a++]=128|63&i):(e[a++]=240|i>>>18,e[a++]=128|i>>>12&63,e[a++]=128|i>>>6&63,e[a++]=128|63&i);return e},e.buf2binstring=function(t){return l(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},e.buf2string=function(t,e){var i,n,r,s,o=e||t.length,h=new Array(2*o);for(n=0,i=0;i<o;)if((r=t[i++])<128)h[n++]=r;else if((s=a[r])>4)h[n++]=65533,i+=s-1;else{for(r&=2===s?31:3===s?15:7;s>1&&i<o;)r=r<<6|63&t[i++],s--;s>1?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return l(h,n)},e.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+a[t[i]]>e?i:e}},6069:t=>{"use strict";t.exports=function(t,e,i,n){for(var r=65535&t|0,s=t>>>16&65535|0,a=0;0!==i;){i-=a=i>2e3?2e3:i;do{s=s+(r=r+e[n++]|0)|0}while(--a);r%=65521,s%=65521}return r|s<<16|0}},1619:t=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},2869:t=>{"use strict";var e=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,i,n,r){var s=e,a=r+n;t^=-1;for(var o=r;o<a;o++)t=t>>>8^s[255&(t^i[o])];return-1^t}},405:(t,e,i)=>{"use strict";var n,r=i(6247),s=i(342),a=i(6069),o=i(2869),l=i(8898),h=-2,c=258,u=262,d=103,p=113,f=666;function m(t,e){return t.msg=l[e],e}function _(t){return(t<<1)-(t>4?9:0)}function g(t){for(var e=t.length;--e>=0;)t[e]=0}function y(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function v(t,e){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,y(t.strm)}function x(t,e){t.pending_buf[t.pending++]=e}function b(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function w(t,e){var i,n,r=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-u?t.strstart-(t.w_size-u):0,h=t.window,d=t.w_mask,p=t.prev,f=t.strstart+c,m=h[s+a-1],_=h[s+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+a]===_&&h[i+a-1]===m&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do{}while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<f);if(n=c-(f-s),s=f-c,n>a){if(t.match_start=e,a=n,n>=o)break;m=h[s+a-1],_=h[s+a]}}}while((e=p[e&d])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function M(t){var e,i,n,s,l,h,c,d,p,f,m=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-u)){r.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,e=i=t.hash_size;do{n=t.head[--e],t.head[e]=n>=m?n-m:0}while(--i);e=i=m;do{n=t.prev[--e],t.prev[e]=n>=m?n-m:0}while(--i);s+=m}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,d=t.strstart+t.lookahead,p=s,f=void 0,(f=h.avail_in)>p&&(f=p),i=0===f?0:(h.avail_in-=f,r.arraySet(c,h.input,h.next_in,f,d),1===h.state.wrap?h.adler=a(h.adler,c,f,d):2===h.state.wrap&&(h.adler=o(h.adler,c,f,d)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=3)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<u&&0!==t.strm.avail_in)}function S(t,e){for(var i,n;;){if(t.lookahead<u){if(M(t),t.lookahead<u&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-u&&(t.match_length=w(t,i)),t.match_length>=3)if(n=s._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function E(t,e){for(var i,n,r;;){if(t.lookahead<u){if(M(t),t.lookahead<u&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-u&&(t.match_length=w(t,i),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(v(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=s._tr_tally(t,0,t.window[t.strstart-1]))&&v(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function T(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function P(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:p,t.adler=2===e.wrap?0:1,e.last_flush=0,s._tr_init(e),0):m(t,h)}function C(t){var e,i=P(t);return 0===i&&((e=t.state).window_size=2*e.w_size,g(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),i}function L(t,e,i,n,s,a){if(!t)return h;var o=1;if(-1===e&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),s<1||s>9||8!==i||n<8||n>15||e<0||e>9||a<0||a>4)return m(t,h);8===n&&(n=9);var l=new A;return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=i,C(t)}n=[new T(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(M(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,v(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-u&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(v(t,!1),t.strm.avail_out),1)})),new T(4,4,8,4,S),new T(4,5,16,8,S),new T(4,6,32,32,S),new T(4,4,16,16,E),new T(8,16,32,32,E),new T(8,16,128,128,E),new T(8,32,128,256,E),new T(32,128,258,1024,E),new T(32,258,258,4096,E)],e.deflateInit=function(t,e){return L(t,e,8,15,8,0)},e.deflateInit2=L,e.deflateReset=C,e.deflateResetKeep=P,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?h:(t.state.gzhead=e,0):h},e.deflate=function(t,e){var i,r,a,l;if(!t||!t.state||e>5||e<0)return t?m(t,h):h;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===f&&4!==e)return m(t,0===t.avail_out?-5:h);if(r.strm=t,i=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,x(r,31),x(r,139),x(r,8),r.gzhead?(x(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),x(r,255&r.gzhead.time),x(r,r.gzhead.time>>8&255),x(r,r.gzhead.time>>16&255),x(r,r.gzhead.time>>24&255),x(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),x(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(x(r,255&r.gzhead.extra.length),x(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(x(r,0),x(r,0),x(r,0),x(r,0),x(r,0),x(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),x(r,3),r.status=p);else{var u=8+(r.w_bits-8<<4)<<8;u|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(u|=32),u+=31-u%31,r.status=p,b(r,u),0!==r.strstart&&(b(r,t.adler>>>16),b(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),y(t),a=r.pending,r.pending!==r.pending_buf_size));)x(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),y(t),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,x(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),y(t),a=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,x(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===l&&(r.status=d)}else r.status=d;if(r.status===d&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&y(t),r.pending+2<=r.pending_buf_size&&(x(r,255&t.adler),x(r,t.adler>>8&255),t.adler=0,r.status=p)):r.status=p),0!==r.pending){if(y(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&_(e)<=_(i)&&4!==e)return m(t,-5);if(r.status===f&&0!==t.avail_in)return m(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&r.status!==f){var w=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(M(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var i,n,r,a,o=t.window;;){if(t.lookahead<=c){if(M(t),t.lookahead<=c&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=o[r=t.strstart-1])===o[++r]&&n===o[++r]&&n===o[++r]){a=t.strstart+c;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<a);t.match_length=c-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=s._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(r,e):n[r.level].func(r,e);if(3!==w&&4!==w||(r.status=f),1===w||3===w)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===w&&(1===e?s._tr_align(r):5!==e&&(s._tr_stored_block(r,0,0,!1),3===e&&(g(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),y(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(x(r,255&t.adler),x(r,t.adler>>8&255),x(r,t.adler>>16&255),x(r,t.adler>>24&255),x(r,255&t.total_in),x(r,t.total_in>>8&255),x(r,t.total_in>>16&255),x(r,t.total_in>>24&255)):(b(r,t.adler>>>16),b(r,65535&t.adler)),y(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},e.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&e!==d&&e!==p&&e!==f?m(t,h):(t.state=null,e===p?m(t,-3):0):h},e.deflateSetDictionary=function(t,e){var i,n,s,o,l,c,u,d,p=e.length;if(!t||!t.state)return h;if(2===(o=(i=t.state).wrap)||1===o&&42!==i.status||i.lookahead)return h;for(1===o&&(t.adler=a(t.adler,e,p,0)),i.wrap=0,p>=i.w_size&&(0===o&&(g(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new r.Buf8(i.w_size),r.arraySet(d,e,p-i.w_size,i.w_size,0),e=d,p=i.w_size),l=t.avail_in,c=t.next_in,u=t.input,t.avail_in=p,t.next_in=0,t.input=e,M(i);i.lookahead>=3;){n=i.strstart,s=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+3-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--s);i.strstart=n,i.lookahead=2,M(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=u,t.avail_in=l,i.wrap=o,0},e.deflateInfo="pako deflate (from Nodeca project)"},2401:t=>{"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},4264:t=>{"use strict";t.exports=function(t,e){var i,n,r,s,a,o,l,h,c,u,d,p,f,m,_,g,y,v,x,b,w,M,S,E,T;i=t.state,n=t.next_in,E=t.input,r=n+(t.avail_in-5),s=t.next_out,T=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,p=i.hold,f=i.bits,m=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;t:do{f<15&&(p+=E[n++]<<f,f+=8,p+=E[n++]<<f,f+=8),v=m[p&g];e:for(;;){if(p>>>=x=v>>>24,f-=x,0==(x=v>>>16&255))T[s++]=65535&v;else{if(!(16&x)){if(0==(64&x)){v=m[(65535&v)+(p&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}b=65535&v,(x&=15)&&(f<x&&(p+=E[n++]<<f,f+=8),b+=p&(1<<x)-1,p>>>=x,f-=x),f<15&&(p+=E[n++]<<f,f+=8,p+=E[n++]<<f,f+=8),v=_[p&y];i:for(;;){if(p>>>=x=v>>>24,f-=x,!(16&(x=v>>>16&255))){if(0==(64&x)){v=_[(65535&v)+(p&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&v,f<(x&=15)&&(p+=E[n++]<<f,(f+=8)<x&&(p+=E[n++]<<f,f+=8)),(w+=p&(1<<x)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=x,f-=x,w>(x=s-a)){if((x=w-x)>c&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(M=0,S=d,0===u){if(M+=h-x,x<b){b-=x;do{T[s++]=d[M++]}while(--x);M=s-w,S=T}}else if(u<x){if(M+=h+u-x,(x-=u)<b){b-=x;do{T[s++]=d[M++]}while(--x);if(M=0,u<b){b-=x=u;do{T[s++]=d[M++]}while(--x);M=s-w,S=T}}}else if(M+=u-x,x<b){b-=x;do{T[s++]=d[M++]}while(--x);M=s-w,S=T}for(;b>2;)T[s++]=S[M++],T[s++]=S[M++],T[s++]=S[M++],b-=3;b&&(T[s++]=S[M++],b>1&&(T[s++]=S[M++]))}else{M=s-w;do{T[s++]=T[M++],T[s++]=T[M++],T[s++]=T[M++],b-=3}while(b>2);b&&(T[s++]=T[M++],b>1&&(T[s++]=T[M++]))}break}}break}}while(n<r&&s<o);n-=b=f>>3,p&=(1<<(f-=b<<3))-1,t.next_in=n,t.next_out=s,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=s<o?o-s+257:257-(s-o),i.hold=p,i.bits=f}},7948:(t,e,i)=>{"use strict";var n=i(6247),r=i(6069),s=i(2869),a=i(4264),o=i(9241),l=-2,h=12,c=30;function u(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function d(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function p(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(852),e.distcode=e.distdyn=new n.Buf32(592),e.sane=1,e.back=-1,0):l}function f(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,p(t)):l}function m(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?l:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,f(t))):l}function _(t,e){var i,n;return t?(n=new d,t.state=n,n.window=null,0!==(i=m(t,e))&&(t.state=null),i):l}var g,y,v=!0;function x(t){if(v){var e;for(g=new n.Buf32(512),y=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(1,t.lens,0,288,g,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(2,t.lens,0,32,y,0,t.work,{bits:5}),v=!1}t.lencode=g,t.lenbits=9,t.distcode=y,t.distbits=5}function b(t,e,i,r){var s,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),r>=a.wsize?(n.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>r&&(s=r),n.arraySet(a.window,e,i-r,s,a.wnext),(r-=s)?(n.arraySet(a.window,e,i-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}e.inflateReset=f,e.inflateReset2=m,e.inflateResetKeep=p,e.inflateInit=function(t){return _(t,15)},e.inflateInit2=_,e.inflate=function(t,e){var i,d,p,f,m,_,g,y,v,w,M,S,E,T,A,P,C,L,R,I,D,O,N,F,k=0,z=new n.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return l;(i=t.state).mode===h&&(i.mode=13),m=t.next_out,p=t.output,g=t.avail_out,f=t.next_in,d=t.input,_=t.avail_in,y=i.hold,v=i.bits,w=_,M=g,O=0;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;v<16;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(2&i.wrap&&35615===y){i.check=0,z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0),y=0,v=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",i.mode=c;break}if(8!=(15&y)){t.msg="unknown compression method",i.mode=c;break}if(v-=4,D=8+(15&(y>>>=4)),0===i.wbits)i.wbits=D;else if(D>i.wbits){t.msg="invalid window size",i.mode=c;break}i.dmax=1<<D,t.adler=i.check=1,i.mode=512&y?10:h,y=0,v=0;break;case 2:for(;v<16;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(i.flags=y,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=c;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=c;break}i.head&&(i.head.text=y>>8&1),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0)),y=0,v=0,i.mode=3;case 3:for(;v<32;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}i.head&&(i.head.time=y),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,z[2]=y>>>16&255,z[3]=y>>>24&255,i.check=s(i.check,z,4,0)),y=0,v=0,i.mode=4;case 4:for(;v<16;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0)),y=0,v=0,i.mode=5;case 5:if(1024&i.flags){for(;v<16;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}i.length=y,i.head&&(i.head.extra_len=y),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=s(i.check,z,2,0)),y=0,v=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((S=i.length)>_&&(S=_),S&&(i.head&&(D=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,d,f,S,D)),512&i.flags&&(i.check=s(i.check,d,S,f)),_-=S,f+=S,i.length-=S),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===_)break t;S=0;do{D=d[f+S++],i.head&&D&&i.length<65536&&(i.head.name+=String.fromCharCode(D))}while(D&&S<_);if(512&i.flags&&(i.check=s(i.check,d,S,f)),_-=S,f+=S,D)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===_)break t;S=0;do{D=d[f+S++],i.head&&D&&i.length<65536&&(i.head.comment+=String.fromCharCode(D))}while(D&&S<_);if(512&i.flags&&(i.check=s(i.check,d,S,f)),_-=S,f+=S,D)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;v<16;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(y!==(65535&i.check)){t.msg="header crc mismatch",i.mode=c;break}y=0,v=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=h;break;case 10:for(;v<32;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}t.adler=i.check=u(y),y=0,v=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=m,t.avail_out=g,t.next_in=f,t.avail_in=_,i.hold=y,i.bits=v,2;t.adler=i.check=1,i.mode=h;case h:if(5===e||6===e)break t;case 13:if(i.last){y>>>=7&v,v-=7&v,i.mode=27;break}for(;v<3;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}switch(i.last=1&y,v-=1,3&(y>>>=1)){case 0:i.mode=14;break;case 1:if(x(i),i.mode=20,6===e){y>>>=2,v-=2;break t}break;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=c}y>>>=2,v-=2;break;case 14:for(y>>>=7&v,v-=7&v;v<32;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",i.mode=c;break}if(i.length=65535&y,y=0,v=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(S=i.length){if(S>_&&(S=_),S>g&&(S=g),0===S)break t;n.arraySet(p,d,f,S,m),_-=S,f+=S,g-=S,m+=S,i.length-=S;break}i.mode=h;break;case 17:for(;v<14;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(i.nlen=257+(31&y),y>>>=5,v-=5,i.ndist=1+(31&y),y>>>=5,v-=5,i.ncode=4+(15&y),y>>>=4,v-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=c;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;v<3;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}i.lens[U[i.have++]]=7&y,y>>>=3,v-=3}for(;i.have<19;)i.lens[U[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,N={bits:i.lenbits},O=o(0,i.lens,0,19,i.lencode,0,i.work,N),i.lenbits=N.bits,O){t.msg="invalid code lengths set",i.mode=c;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;P=(k=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,C=65535&k,!((A=k>>>24)<=v);){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(C<16)y>>>=A,v-=A,i.lens[i.have++]=C;else{if(16===C){for(F=A+2;v<F;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(y>>>=A,v-=A,0===i.have){t.msg="invalid bit length repeat",i.mode=c;break}D=i.lens[i.have-1],S=3+(3&y),y>>>=2,v-=2}else if(17===C){for(F=A+3;v<F;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}v-=A,D=0,S=3+(7&(y>>>=A)),y>>>=3,v-=3}else{for(F=A+7;v<F;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}v-=A,D=0,S=11+(127&(y>>>=A)),y>>>=7,v-=7}if(i.have+S>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=c;break}for(;S--;)i.lens[i.have++]=D}}if(i.mode===c)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=c;break}if(i.lenbits=9,N={bits:i.lenbits},O=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,N),i.lenbits=N.bits,O){t.msg="invalid literal/lengths set",i.mode=c;break}if(i.distbits=6,i.distcode=i.distdyn,N={bits:i.distbits},O=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,N),i.distbits=N.bits,O){t.msg="invalid distances set",i.mode=c;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(_>=6&&g>=258){t.next_out=m,t.avail_out=g,t.next_in=f,t.avail_in=_,i.hold=y,i.bits=v,a(t,M),m=t.next_out,p=t.output,g=t.avail_out,f=t.next_in,d=t.input,_=t.avail_in,y=i.hold,v=i.bits,i.mode===h&&(i.back=-1);break}for(i.back=0;P=(k=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,C=65535&k,!((A=k>>>24)<=v);){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(P&&0==(240&P)){for(L=A,R=P,I=C;P=(k=i.lencode[I+((y&(1<<L+R)-1)>>L)])>>>16&255,C=65535&k,!(L+(A=k>>>24)<=v);){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}y>>>=L,v-=L,i.back+=L}if(y>>>=A,v-=A,i.back+=A,i.length=C,0===P){i.mode=26;break}if(32&P){i.back=-1,i.mode=h;break}if(64&P){t.msg="invalid literal/length code",i.mode=c;break}i.extra=15&P,i.mode=22;case 22:if(i.extra){for(F=i.extra;v<F;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,v-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;P=(k=i.distcode[y&(1<<i.distbits)-1])>>>16&255,C=65535&k,!((A=k>>>24)<=v);){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(0==(240&P)){for(L=A,R=P,I=C;P=(k=i.distcode[I+((y&(1<<L+R)-1)>>L)])>>>16&255,C=65535&k,!(L+(A=k>>>24)<=v);){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}y>>>=L,v-=L,i.back+=L}if(y>>>=A,v-=A,i.back+=A,64&P){t.msg="invalid distance code",i.mode=c;break}i.offset=C,i.extra=15&P,i.mode=24;case 24:if(i.extra){for(F=i.extra;v<F;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,v-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=c;break}i.mode=25;case 25:if(0===g)break t;if(S=M-g,i.offset>S){if((S=i.offset-S)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=c;break}S>i.wnext?(S-=i.wnext,E=i.wsize-S):E=i.wnext-S,S>i.length&&(S=i.length),T=i.window}else T=p,E=m-i.offset,S=i.length;S>g&&(S=g),g-=S,i.length-=S;do{p[m++]=T[E++]}while(--S);0===i.length&&(i.mode=21);break;case 26:if(0===g)break t;p[m++]=i.length,g--,i.mode=21;break;case 27:if(i.wrap){for(;v<32;){if(0===_)break t;_--,y|=d[f++]<<v,v+=8}if(M-=g,t.total_out+=M,i.total+=M,M&&(t.adler=i.check=i.flags?s(i.check,p,M,m-M):r(i.check,p,M,m-M)),M=g,(i.flags?y:u(y))!==i.check){t.msg="incorrect data check",i.mode=c;break}y=0,v=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;v<32;){if(0===_)break t;_--,y+=d[f++]<<v,v+=8}if(y!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=c;break}y=0,v=0}i.mode=29;case 29:O=1;break t;case c:O=-3;break t;case 31:return-4;default:return l}return t.next_out=m,t.avail_out=g,t.next_in=f,t.avail_in=_,i.hold=y,i.bits=v,(i.wsize||M!==t.avail_out&&i.mode<c&&(i.mode<27||4!==e))&&b(t,t.output,t.next_out,M-t.avail_out)?(i.mode=31,-4):(w-=t.avail_in,M-=t.avail_out,t.total_in+=w,t.total_out+=M,i.total+=M,i.wrap&&M&&(t.adler=i.check=i.flags?s(i.check,p,M,t.next_out-M):r(i.check,p,M,t.next_out-M)),t.data_type=i.bits+(i.last?64:0)+(i.mode===h?128:0)+(20===i.mode||15===i.mode?256:0),(0===w&&0===M||4===e)&&0===O&&(O=-5),O)},e.inflateEnd=function(t){if(!t||!t.state)return l;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?l:(i.head=e,e.done=!1,0):l},e.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?l:11===i.mode&&r(1,e,n,0)!==i.check?-3:b(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,0):l},e.inflateInfo="pako inflate (from Nodeca project)"},9241:(t,e,i)=>{"use strict";var n=i(6247),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,l,h,c,u,d){var p,f,m,_,g,y,v,x,b,w=d.bits,M=0,S=0,E=0,T=0,A=0,P=0,C=0,L=0,R=0,I=0,D=null,O=0,N=new n.Buf16(16),F=new n.Buf16(16),k=null,z=0;for(M=0;M<=15;M++)N[M]=0;for(S=0;S<l;S++)N[e[i+S]]++;for(A=w,T=15;T>=1&&0===N[T];T--);if(A>T&&(A=T),0===T)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(E=1;E<T&&0===N[E];E++);for(A<E&&(A=E),L=1,M=1;M<=15;M++)if(L<<=1,(L-=N[M])<0)return-1;if(L>0&&(0===t||1!==T))return-1;for(F[1]=0,M=1;M<15;M++)F[M+1]=F[M]+N[M];for(S=0;S<l;S++)0!==e[i+S]&&(u[F[e[i+S]]++]=S);if(0===t?(D=k=u,y=19):1===t?(D=r,O-=257,k=s,z-=257,y=256):(D=a,k=o,y=-1),I=0,S=0,M=E,g=c,P=A,C=0,m=-1,_=(R=1<<A)-1,1===t&&R>852||2===t&&R>592)return 1;for(;;){v=M-C,u[S]<y?(x=0,b=u[S]):u[S]>y?(x=k[z+u[S]],b=D[O+u[S]]):(x=96,b=0),p=1<<M-C,E=f=1<<P;do{h[g+(I>>C)+(f-=p)]=v<<24|x<<16|b|0}while(0!==f);for(p=1<<M-1;I&p;)p>>=1;if(0!==p?(I&=p-1,I+=p):I=0,S++,0==--N[M]){if(M===T)break;M=e[i+u[S]]}if(M>A&&(I&_)!==m){for(0===C&&(C=A),g+=E,L=1<<(P=M-C);P+C<T&&!((L-=N[P+C])<=0);)P++,L<<=1;if(R+=1<<P,1===t&&R>852||2===t&&R>592)return 1;h[m=I&_]=A<<24|P<<16|g-c|0}}return 0!==I&&(h[g+I]=M-C<<24|64<<16|0),d.bits=A,0}},8898:t=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},342:(t,e,i)=>{"use strict";var n=i(6247);function r(t){for(var e=t.length;--e>=0;)t[e]=0}var s=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=new Array(576);r(h);var c=new Array(60);r(c);var u=new Array(512);r(u);var d=new Array(256);r(d);var p=new Array(29);r(p);var f,m,_,g=new Array(30);function y(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function v(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function x(t){return t<256?u[t]:u[256+(t>>>7)]}function b(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function w(t,e,i){t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function M(t,e,i){w(t,i[2*e],i[2*e+1])}function S(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function E(t,e,i){var n,r,s=new Array(16),a=0;for(n=1;n<=15;n++)s[n]=a=a+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=S(s[o]++,o))}}function T(t){var e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function A(t){t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function P(t,e,i,n){var r=2*e,s=2*i;return t[r]<t[s]||t[r]===t[s]&&n[e]<=n[i]}function C(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&P(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!P(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function L(t,e,i){var n,r,o,l,h=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===n?M(t,r,e):(M(t,(o=d[r])+256+1,e),0!==(l=s[o])&&w(t,r-=p[o],l),M(t,o=x(--n),i),0!==(l=a[o])&&w(t,n-=g[o],l))}while(h<t.last_lit);M(t,256,e)}function R(t,e){var i,n,r,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<l;i++)0!==s[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)s[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=a[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)C(t,s,i);r=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],C(t,s,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,s[2*r]=s[2*i]+s[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,s[2*i+1]=s[2*n+1]=r,t.heap[1]=r++,C(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,s,a,o,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,u=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,f=e.stat_desc.max_length,m=0;for(s=0;s<=15;s++)t.bl_count[s]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)(s=l[2*l[2*(n=t.heap[i])+1]+1]+1)>f&&(s=f,m++),l[2*n+1]=s,n>h||(t.bl_count[s]++,a=0,n>=p&&(a=d[n-p]),o=l[2*n],t.opt_len+=o*(s+a),u&&(t.static_len+=o*(c[2*n+1]+a)));if(0!==m){do{for(s=f-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[f]--,m-=2}while(m>0);for(s=f;0!==s;s--)for(n=t.bl_count[s];0!==n;)(r=t.heap[--i])>h||(l[2*r+1]!==s&&(t.opt_len+=(s-l[2*r+1])*l[2*r],l[2*r+1]=s),n--)}}(t,e),E(s,h,t.bl_count)}function I(t,e,i){var n,r,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=a,a=e[2*(n+1)+1],++o<l&&r===a||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=r,0===a?(l=138,h=3):r===a?(l=6,h=3):(l=7,h=4))}function D(t,e,i){var n,r,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),n=0;n<=i;n++)if(r=a,a=e[2*(n+1)+1],!(++o<l&&r===a)){if(o<h)do{M(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==s&&(M(t,r,t.bl_tree),o--),M(t,16,t.bl_tree),w(t,o-3,2)):o<=10?(M(t,17,t.bl_tree),w(t,o-3,3)):(M(t,18,t.bl_tree),w(t,o-11,7));o=0,s=r,0===a?(l=138,h=3):r===a?(l=6,h=3):(l=7,h=4)}}r(g);var O=!1;function N(t,e,i,r){w(t,0+(r?1:0),3),function(t,e,i,r){A(t),b(t,i),b(t,~i),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}e._tr_init=function(t){O||(function(){var t,e,i,n,r,l=new Array(16);for(i=0,n=0;n<28;n++)for(p[n]=i,t=0;t<1<<s[n];t++)d[i++]=n;for(d[i-1]=n,r=0,n=0;n<16;n++)for(g[n]=r,t=0;t<1<<a[n];t++)u[r++]=n;for(r>>=7;n<30;n++)for(g[n]=r<<7,t=0;t<1<<a[n]-7;t++)u[256+r++]=n;for(e=0;e<=15;e++)l[e]=0;for(t=0;t<=143;)h[2*t+1]=8,t++,l[8]++;for(;t<=255;)h[2*t+1]=9,t++,l[9]++;for(;t<=279;)h[2*t+1]=7,t++,l[7]++;for(;t<=287;)h[2*t+1]=8,t++,l[8]++;for(E(h,287,l),t=0;t<30;t++)c[2*t+1]=5,c[2*t]=S(t,5);f=new y(h,s,257,286,15),m=new y(c,a,0,30,15),_=new y(new Array(0),o,0,19,7)}(),O=!0),t.l_desc=new v(t.dyn_ltree,f),t.d_desc=new v(t.dyn_dtree,m),t.bl_desc=new v(t.bl_tree,_),t.bi_buf=0,t.bi_valid=0,T(t)},e._tr_stored_block=N,e._tr_flush_block=function(t,e,i,n){var r,s,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),R(t,t.l_desc),R(t,t.d_desc),a=function(t){var e;for(I(t,t.dyn_ltree,t.l_desc.max_code),I(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=r&&(r=s)):r=s=i+5,i+4<=r&&-1!==e?N(t,e,i,n):4===t.strategy||s===r?(w(t,2+(n?1:0),3),L(t,h,c)):(w(t,4+(n?1:0),3),function(t,e,i,n){var r;for(w(t,e-257,5),w(t,i-1,5),w(t,n-4,4),r=0;r<n;r++)w(t,t.bl_tree[2*l[r]+1],3);D(t,t.dyn_ltree,e-1),D(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),L(t,t.dyn_ltree,t.dyn_dtree)),T(t),n&&A(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(d[i]+256+1)]++,t.dyn_dtree[2*x(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){w(t,2,3),M(t,256,h),function(t){16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},2292:t=>{"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},8270:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(e,i);r&&!("get"in r?!e.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,r)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),r(i(4381),e),r(i(4236),e),r(i(6505),e),r(i(416),e),r(i(1193),e),r(i(2587),e),r(i(6315),e),r(i(5451),e),r(i(3974),e),r(i(6322),e),r(i(8112),e);const s=i(4147).i8,a=i(4012).i8;console.log(`ami ${s} (three ${a})`)},2450:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.COLORS=void 0,(i=e.COLORS||(e.COLORS={})).blue="#00B0FF",i.yellow="#FFEB3B",i.red="#F50057",i.green="#76FF03",i.white="#FFF",i.lightRed="#F77",e.default=class{static cielab2XYZ(t,e,i){let n=(t+16)/116,r=e/500+n,s=n-i/200;return n=Math.pow(n,3)>.008856?Math.pow(n,3):(n-16/116)/7.787,r=Math.pow(r,3)>.008856?Math.pow(r,3):(r-16/116)/7.787,s=Math.pow(s,3)>.008856?Math.pow(s,3):(s-16/116)/7.787,[95.047*r,100*n,108.883*s]}static xyz2RGB(t,e,i){let n=3.2406*(t/=100)+-1.5372*(e/=100)+-.4986*(i/=100),r=-.9689*t+1.8758*e+.0415*i,s=.0557*t+-.204*e+1.057*i;return n>.0031308?n=1.055*Math.pow(n,1/2.4)-.055:n*=12.92,r>.0031308?r=1.055*Math.pow(r,1/2.4)-.055:r*=12.92,s>.0031308?s=1.055*Math.pow(s,1/2.4)-.055:s*=12.92,n*=255,r*=255,s*=255,[n,r,s]}static cielab2RGB(t=50,e=0,i=0){if(!(t>=0&&t<=100))return null;const[n,r,s]=this.cielab2XYZ(t,e,i);return this.xyz2RGB(n,r,s)}}},361:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.widgetsBase=void 0;const r=n(i(7140)),s=i(2450),a=n(i(1798)),o=i(5232);class l extends o.Object3D{constructor(t,e,i){if(super(),this._widgetType="Base",this._params=i,!0===i.hideMesh&&(this.visible=!1),null===document.getElementById("ami-widgets")){const t=document.createElement("style");t.id="ami-widgets",t.innerHTML=r.default.code,document.head.appendChild(t)}this._enabled=!0,this._selected=!1,this._hovered=!0,this._active=!0,this._colors={default:s.COLORS.blue,active:s.COLORS.yellow,hover:s.COLORS.red,select:s.COLORS.green,text:s.COLORS.white,error:s.COLORS.lightRed},this._color=this._colors.default,this._dragged=!1,this._displayed=!0,this._targetMesh=t,this._controls=e,this._camera=e.object,this._container=e.domElement,this._worldPosition=new o.Vector3,i.worldPosition?this._worldPosition.copy(i.worldPosition):null!==this._targetMesh&&this._worldPosition.copy(this._targetMesh.position)}initOffsets(){const t=this._container.getBoundingClientRect(),e=document.body,i=document.documentElement,n=scrollY||i.scrollTop||e.scrollTop,r=scrollX||i.scrollLeft||e.scrollLeft,s=i.clientTop||e.clientTop||0,a=i.clientLeft||e.clientLeft||0;this._offsets={top:Math.round(t.top+n-s),left:Math.round(t.left+r-a)}}getMouseOffsets(t,e){return{x:(t.clientX-this._offsets.left)/e.offsetWidth*2-1,y:-(t.clientY-this._offsets.top)/e.offsetHeight*2+1,screenX:t.clientX-this._offsets.left,screenY:t.clientY-this._offsets.top}}getArea(t){let e=0,i=t.length-1;for(let n=0;n<t.length;n++)e+=(t[i].x+t[n].x)*(t[i].y-t[n].y),i=n;return Math.abs(e/2)}getRegionByXY(t,e){let i=null;return t.some(((t,n)=>{if(e.x>=t.x0&&e.x<=t.x1&&e.y>=t.y0&&e.y<=t.y1)return i=n,!0})),i}getPointInRegion(t,e){return t?new o.Vector2((e.x-t.x0-(t.axisX||0))*t.deltaX,(e.y-t.y0-(t.axisY||0))*t.deltaY):null}getUsPoint(t,e){return this.getPointInRegion(t[this.getRegionByXY(t,e)],e)}getUsDistance(t,e){const i=this._params.ultrasoundRegions||[];if(i.length<1)return null;const n=this.getRegionByXY(i,t),r=this.getRegionByXY(i,e);return null===n||null===r||n!==r||"cm"!==i[n].unitsX||"cm"!==i[n].unitsY?null:this.getPointInRegion(i[n],t).distanceTo(this.getPointInRegion(i[n],e))}getDistanceData(t,e,i){let n=null,r=null;if(i)n=t.distanceTo(e)*i;else if(this._params.ultrasoundRegions&&this._params.lps2IJK){const i=this.getUsDistance(a.default.worldToData(this._params.lps2IJK,t),a.default.worldToData(this._params.lps2IJK,e));null!==i?(n=10*i,r="mm"):(n=t.distanceTo(e),r=this._params.pixelSpacing?"mm":"units")}else n=t.distanceTo(e);return{distance:n,units:r}}getLineData(t,e){const i=e.clone().sub(t),n=e.clone().add(t).multiplyScalar(.5),r=i.length(),s=i.angleTo(new o.Vector3(1,0,0));return{line:i,length:r,transformX:n.x-r/2,transformY:n.y-this._container.offsetHeight,transformAngle:t.y<e.y?s:-s,center:n}}getRectData(t,e){const i=e.clone().sub(t),n=i.clone().projectOnVector(new o.Vector3(0,1,0)),r=t.clone().min(e);return{width:i.clone().projectOnVector(new o.Vector3(1,0,0)).length(),height:n.length(),transformX:r.x,transformY:r.y-this._container.offsetHeight,paddingVector:n.clone().normalize()}}adjustLabelTransform(t,e,i){let n=Math.round(e.x-(i?0:t.offsetWidth/2)),r=Math.round(e.y-(i?0:t.offsetHeight/2))-this._container.offsetHeight;return n<0?n=n>-t.offsetWidth?0:n+t.offsetWidth:n>this._container.offsetWidth-t.offsetWidth&&(n=n<this._container.offsetWidth?this._container.offsetWidth-t.offsetWidth:n-t.offsetWidth),r<-this._container.offsetHeight?r=r>-this._container.offsetHeight-t.offsetHeight?-this._container.offsetHeight:r+t.offsetHeight:r>-t.offsetHeight&&(r=r<0?-t.offsetHeight:r-t.offsetHeight),new o.Vector2(n,r)}worldToScreen(t){const e=t.clone();return e.project(this._camera),e.x=Math.round((e.x+1)*this._container.offsetWidth/2),e.y=Math.round((1-e.y)*this._container.offsetHeight/2),e.z=0,e}update(){console.log("update() should be overloaded!")}updateColor(){this._active?this._color=this._colors.active:this._hovered?this._color=this._colors.hover:this._selected?this._color=this._colors.select:this._color=this._colors.default}setDefaultColor(t){this._colors.default=t,this._handles&&this._handles.forEach((e=>e._colors.default=t)),this.update()}show(){this.showDOM(),this.showMesh(),this.update(),this._displayed=!0}hide(){this.hideDOM(),this.hideMesh(),this._displayed=!1}hideDOM(){console.log("hideDOM() should be overloaded!")}showDOM(){console.log("showDOM() should be overloaded!")}hideMesh(){this.visible=!1}showMesh(){!0!==this._params.hideMesh&&(this.visible=!0)}free(){this._camera=null,this._container=null,this._controls=null,this._params=null,this._targetMesh=null}get widgetType(){return this._widgetType}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._worldPosition.copy(t),this.update()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.update()}get selected(){return this._selected}set selected(t){this._selected=t,this.update()}get hovered(){return this._hovered}set hovered(t){this._hovered=t,this.update()}get dragged(){return this._dragged}set dragged(t){this._dragged=t,this.update()}get displayed(){return this._displayed}set displayed(t){this._displayed=t,this.update()}get active(){return this._active}set active(t){this._active=t,this.update()}get color(){return this._color}set color(t){this._color=t,this.update()}}e.widgetsBase=l},1119:(t,e,i)=>{"use strict";var n=i(4698),r=i(1835),s=i(7585),a=i(4617),o=9007199254740991;t.exports=function(t,e,i){var l,h;if(!n(t))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+t+"`.");if(!r(e))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+e+"`.");if(arguments.length>2){if(!n(h=i))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+h+"`.");if(0===h.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else h=" ";if(e>o)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(l=(e-t.length)/h.length)<=0?t:(l=s(l),a(h,l)+t)}},4617:(t,e,i)=>{"use strict";var n=i(4698),r=i(1835);t.exports=function(t,e){var i,s;if(!n(t))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+t+"`.");if(!r(e))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+e+"`.");if(0===t.length||0===e)return"";if(t.length*e>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(i="",s=e;1==(1&s)&&(i+=t),0!=(s>>>=1);)t+=t;return i}},1753:(t,e,i)=>{"use strict";var n=i(4698),r=i(1835),s=i(7585),a=i(4617),o=9007199254740991;t.exports=function(t,e,i){var l,h;if(!n(t))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+t+"`.");if(!r(e))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+e+"`.");if(arguments.length>2){if(!n(h=i))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+h+"`.");if(0===h.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else h=" ";if(e>o)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(l=(e-t.length)/h.length)<=0?t:(l=s(l),t+a(h,l))}},5647:(t,e,i)=>{"use strict";var n=i(6953);t.exports=function(t){return n(t)&&t%1==0}},1835:(t,e,i)=>{"use strict";var n=i(5647);t.exports=function(t){return n(t)&&t>=0}},6953:t=>{"use strict";t.exports=function(t){return("number"==typeof t||"[object Number]"===Object.prototype.toString.call(t))&&t.valueOf()==t.valueOf()}},4698:t=>{"use strict";t.exports=function(t){return"string"==typeof t}},4381:(t,e,i)=>{"use strict";i.r(e),i.d(e,{OrthographicCamera:()=>a});var n=i(9501),r=i(2798),s=i(9477);class a extends s.iKG{constructor(t,e,i,n,r,a){super(t,e,i,n,r,a),this._front=null,this._back=null,this._directions=[new s.Pa4(1,0,0),new s.Pa4(0,1,0),new s.Pa4(0,0,1)],this._directionsLabel=["A","P","L","R","I","S"],this._orientation="default",this._convention="radio",this._stackOrientation=0,this._right=null,this._up=null,this._direction=null,this._controls=null,this._box=null,this._canvas={width:null,height:null},this._fromFront=!0,this._angle=0}init(t,e,i,a,o,l){if(console.warn("cameras.orthographic.init(...) is deprecated.\n        Use .cosines, .controls, .box and .canvas instead."),!(r.Z.vector3(t)&&r.Z.vector3(e)&&r.Z.vector3(i)&&r.Z.box(o)&&a))return console.log("Invalid input provided."),!1;this._right=t,this._up=this._adjustTopDirection(t,e),this._direction=(new s.Pa4).crossVectors(this._right,this._up),this._controls=a,this._box=o,this._canvas=l;let h={position:this._box.center,direction:this._direction},c=this._orderIntersections(n.Z.rayBox(h,this._box),this._direction);this._front=c[0],this._back=c[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()}update(){if("default"===this._orientation)switch(this._getMaxIndex(this._directions[2])){case 0:this._orientation="sagittal";break;case 1:this._orientation="coronal";break;case 2:this._orientation="axial";break;default:this._orientation="free"}if("free"===this._orientation)this._right=this._directions[0],this._up=this._directions[1],this._direction=this._directions[2];else{let t=this.leftDirection(),e=this._directions[t],i=this.posteriorDirection(),n=this._directions[i],r=this.superiorDirection(),s=this._directions[r];if("radio"===this._convention)switch(this._orientation){case"axial":n.y>0&&n.negate(),s.z<0&&s.negate(),this._right=e,this._up=n,this._direction=s;break;case"coronal":s.z<0&&s.negate(),n.y<0&&n.negate(),this._right=e,this._up=s,this._direction=n;break;case"sagittal":s.z<0&&s.negate(),e.x>0&&e.negate(),this._right=n,this._up=s,this._direction=e;break;default:console.warn(`"${this._orientation}" orientation is not valid.\n                  (choices: axial, coronal, sagittal)`)}else if("neuro"===this._convention)switch(this._orientation){case"axial":n.y>0&&n.negate(),s.z>0&&s.negate(),this._right=e,this._up=n,this._direction=s;break;case"coronal":s.z<0&&s.negate(),n.y>0&&n.negate(),this._right=e,this._up=s,this._direction=n;break;case"sagittal":s.z<0&&s.negate(),e.x>0&&e.negate(),this._right=n,this._up=s,this._direction=e;break;default:console.warn(`"${this._orientation}" orientation is not valid.\n                  (choices: axial, coronal, sagittal)`)}else console.warn(`${this._convention} is not valid (choices: radio, neuro)`)}let t={position:this._box.center,direction:this._direction},e=this._orderIntersections(n.Z.rayBox(t,this._box),this._direction);this._front=e[0],this._back=e[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()}leftDirection(){return this._findMaxIndex(this._directions,0)}posteriorDirection(){return this._findMaxIndex(this._directions,1)}superiorDirection(){return this._findMaxIndex(this._directions,2)}invertRows(){this.up.multiplyScalar(-1),this.invertColumns(),this._updateDirections()}invertColumns(){this.center();let t=this._oppositePosition(this.position);this._updatePositionAndTarget(t,this.position.clone()),this._updateMatrices(),this._fromFront=!this._fromFront,this._angle%=360,this._angle=360-this._angle,this._updateDirections()}center(){this._fromFront?this._updatePositionAndTarget(this._front,this._back):this._updatePositionAndTarget(this._back,this._front),this._updateMatrices(),this._updateDirections()}rotate(t=null){this.center();let e=90;null===t?(e*=-1,this._angle+=90):(e=360-(t-this._angle),this._angle=t),this._angle%=360;let i=(new s.yGw).makeRotationAxis(this._direction,e*Math.PI/180);this.up.applyMatrix4(i),this._updateMatrices(),this._updateDirections()}fitBox(t=0,e=1.5){let i=1;switch(t){case 0:i=e*this._computeZoom(this._canvas.width,this._right);break;case 1:i=e*this._computeZoom(this._canvas.height,this._up);break;case 2:i=e*Math.min(this._computeZoom(this._canvas.width,this._right),this._computeZoom(this._canvas.height,this._up))}if(!i)return!1;this.zoom=i,this.center()}_adjustTopDirection(t,e){const i=this._getMaxIndex(e);return(2===i&&e.getComponent(i)<0||1===i&&e.getComponent(i)>0||0===i&&e.getComponent(i)>0)&&e.negate(),e}_getMaxIndex(t){let e=Math.abs(t.x),i=0;return Math.abs(t.y)>e&&(e=Math.abs(t.y),i=1),Math.abs(t.z)>e&&(i=2),i}_findMaxIndex(t,e){let i=this._getMaxIndices(t);for(let t=0;t<i.length;t++)if(i[t]===e)return t}_getMaxIndices(t){let e=[];return e.push(this._getMaxIndex(t[0])),e.push(this._getMaxIndex(t[1])),e.push(this._getMaxIndex(t[2])),e}_orderIntersections(t,e){return t[0].dot(e)<t[1].dot(e)?t:[t[1],t[0]]}_updateCanvas(){this.left=-this._canvas.width/2,this.right=this._canvas.width/2,this.top=this._canvas.height/2,this.bottom=-this._canvas.height/2,this._updateMatrices(),this.controls.handleResize()}_oppositePosition(t){let e=t.clone();e.sub(this._box.center);let i=(new s.yGw).makeRotationAxis(this.up,Math.PI);return e.applyMatrix4(i),e.add(this._box.center),e}_computeZoom(t,e){if(!(t&&t>0))return console.log("Invalid dimension provided."),console.log(t),!1;let i={position:this._box.center.clone(),direction:e},r=n.Z.rayBox(i,this._box);return r.length<2?(console.log("Can not adjust the camera ( < 2 intersections)."),console.log(i),console.log(this._box),!1):t/r[0].distanceTo(r[1])}_updatePositionAndTarget(t,e){this.position.set(t.x,t.y,t.z),this.lookAt(e.x,e.y,e.z),this._controls.target.set(e.x,e.y,e.z)}_updateMatrices(){this._controls.update(),this.updateProjectionMatrix(),this.updateMatrixWorld()}_updateLabels(){this._directionsLabel=[this._vector2Label(this._up),this._vector2Label(this._up.clone().negate()),this._vector2Label(this._right),this._vector2Label(this._right.clone().negate()),this._vector2Label(this._direction),this._vector2Label(this._direction.clone().negate())]}_vector2Label(t){const e=this._getMaxIndex(t),i=t.clone().divideScalar(Math.abs(t.getComponent(e))),n=.2;let r="";for(let t=0;t<3;t++)0===t&&(i.getComponent(t)+n>=1?r+="L":i.getComponent(t)-n<=-1&&(r+="R")),1===t&&(i.getComponent(t)+n>=1?r+="P":i.getComponent(t)-n<=-1&&(r+="A")),2===t&&(i.getComponent(t)+n>=1?r+="S":i.getComponent(t)-n<=-1&&(r+="I"));return r}_updateDirections(){this._up=this.up.clone();let t=new s.Pa4(0,0,-1).applyMatrix4(this.matrixWorld);this._direction=t.sub(this.position).normalize(),this._right=(new s.Pa4).crossVectors(this._direction,this.up),this._updateLabels()}set controls(t){this._controls=t}get controls(){return this._controls}set box(t){this._box=t}get box(){return this._box}set canvas(t){this._canvas=t,this._updateCanvas()}get canvas(){return this._canvas}set angle(t){this.rotate(t)}get angle(){return this._angle}set directions(t){this._directions=t}get directions(){return this._directions}set convention(t){this._convention=t}get convention(){return this._convention}set orientation(t){this._orientation=t}get orientation(){return this._orientation}set directionsLabel(t){this._directionsLabel=t}get directionsLabel(){return this._directionsLabel}set stackOrientation(t){if(this._stackOrientation=t,0===this._stackOrientation)this._orientation="default";else{const t=this._getMaxIndex(this._directions[(this._stackOrientation+2)%3]);0===t?this._orientation="sagittal":1===t?this._orientation="coronal":2===t&&(this._orientation="axial")}}get stackOrientation(){if("default"===this._orientation)this._stackOrientation=0;else{let t=this._getMaxIndex(this._direction);t===this._getMaxIndex(this._directions[2])?this._stackOrientation=0:t===this._getMaxIndex(this._directions[0])?this._stackOrientation=1:t===this._getMaxIndex(this._directions[1])&&(this._stackOrientation=2)}return this._stackOrientation}}},4236:(t,e,i)=>{"use strict";i.r(e),i.d(e,{OrbitControl:()=>a,TrackballControl:()=>r,TrackballOrthoControl:()=>s});var n=i(9477);class r extends n.pBf{constructor(t,e){super();let i=this,r=-1;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noCustom=!1,this.forceState=-1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new n.Pa4;let s=new n.Pa4,a=r,o=r,l=new n.Pa4,h=new n.FM8,c=new n.FM8,u=new n.Pa4,d=0,p=new n.FM8,f=new n.FM8,m=0,_=0,g=new n.FM8,y=new n.FM8,v=new n.FM8,x=new n.FM8;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();let b={type:"change"},w={type:"start"},M={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=innerWidth,this.screen.height=innerHeight;else{let t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+scrollX-e.clientLeft,this.screen.top=t.top+scrollY-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};let S=function(){let t=new n.FM8;return function(e,n){return t.set((e-i.screen.left)/i.screen.width,(n-i.screen.top)/i.screen.height),t}}(),E=function(){let t=new n.FM8;return function(e,n){return t.set((e-.5*i.screen.width-i.screen.left)/(.5*i.screen.width),(i.screen.height+2*(i.screen.top-n))/i.screen.width),t}}();function T(t){!1!==i.enabled&&(removeEventListener("keydown",T),o=a,a===r&&(t.keyCode!==i.keys[0]||i.noRotate?t.keyCode!==i.keys[1]||i.noZoom?t.keyCode!==i.keys[2]||i.noPan||(a=2):a=1:a=0))}function A(t){!1!==i.enabled&&(a=o,addEventListener("keydown",T,!1))}function P(t){!1!==i.enabled&&(t.preventDefault(),t.stopPropagation(),a===r&&(a=t.button),0!==a||i.noRotate?1!==a||i.noZoom?2!==a||i.noPan?99!==a||i.noCustom||(v.copy(S(t.pageX,t.pageY)),x.copy(g)):(g.copy(S(t.pageX,t.pageY)),y.copy(g)):(p.copy(S(t.pageX,t.pageY)),f.copy(p)):(c.copy(E(t.pageX,t.pageY)),h.copy(c)),document.addEventListener("mousemove",C,!1),document.addEventListener("mouseup",L,!1),i.dispatchEvent(w))}function C(t){!1!==i.enabled&&(t.preventDefault(),t.stopPropagation(),0!==a||i.noRotate?1!==a||i.noZoom?2!==a||i.noPan?99!==a||i.noCustom||x.copy(S(t.pageX,t.pageY)):y.copy(S(t.pageX,t.pageY)):f.copy(S(t.pageX,t.pageY)):(h.copy(c),c.copy(E(t.pageX,t.pageY))))}function L(t){!1!==i.enabled&&(t.preventDefault(),t.stopPropagation(),-1===i.forceState&&(a=r),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",L),i.dispatchEvent(M))}function R(t){if(!1!==i.enabled&&!0!==i.noZoom){switch(t.preventDefault(),t.stopPropagation(),t.deltaMode){case 2:p.y-=.025*t.deltaY;break;case 1:p.y-=.01*t.deltaY;break;default:p.y-=25e-5*t.deltaY}i.dispatchEvent(w),i.dispatchEvent(M)}}function I(t){if(!1!==i.enabled){if(-1===i.forceState)switch(t.touches.length){case 1:a=3,c.copy(E(t.touches[0].pageX,t.touches[0].pageY)),h.copy(c);break;case 2:a=4;var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;_=m=Math.sqrt(e*e+n*n);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;g.copy(S(s,o)),y.copy(g);break;default:a=r}else switch(a){case 0:a=3,c.copy(E(t.touches[0].pageX,t.touches[0].pageY)),h.copy(c);break;case 1:case 4:t.touches.length>=2?(a=4,e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,_=m=Math.sqrt(e*e+n*n)):(a=1,p.copy(S(t.touches[0].pageX,t.touches[0].pageY)),f.copy(p));break;case 2:case 5:t.touches.length>=2?(a=5,s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2,g.copy(S(s,o)),y.copy(g)):(a=2,g.copy(S(t.touches[0].pageX,t.touches[0].pageY)),y.copy(g));break;case 99:a=99,s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2,v.copy(S(s,o)),x.copy(v);break;default:a=r}i.dispatchEvent(w)}}function D(t){if(!1!==i.enabled)if(t.preventDefault(),t.stopPropagation(),-1===i.forceState)switch(t.touches.length){case 1:h.copy(c),c.copy(E(t.touches[0].pageX,t.touches[0].pageY));break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY;_=Math.sqrt(e*e+n*n);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;y.copy(S(s,o));break;default:a=r}else switch(a){case 0:h.copy(c),c.copy(E(t.touches[0].pageX,t.touches[0].pageY));break;case 1:f.copy(S(t.touches[0].pageX,t.touches[0].pageY));break;case 2:y.copy(S(t.touches[0].pageX,t.touches[0].pageY));break;case 4:e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,_=Math.sqrt(e*e+n*n);break;case 5:s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2,y.copy(S(s,o));break;case 99:s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2,x.copy(S(s,o));break;default:a=r}}function O(t){if(!1!==i.enabled){if(-1===i.forceState){switch(t.touches.length){case 1:h.copy(c),c.copy(E(t.touches[0].pageX,t.touches[0].pageY));break;case 2:m=_=0;var e=(t.touches[0].pageX+t.touches[1].pageX)/2,n=(t.touches[0].pageY+t.touches[1].pageY)/2;y.copy(S(e,n)),g.copy(y)}a=r}else switch(a){case 0:h.copy(c),c.copy(E(t.touches[0].pageX,t.touches[0].pageY));break;case 1:case 2:break;case 4:m=_=0,a=1;break;case 5:t.touches.length>=2&&(e=(t.touches[0].pageX+t.touches[1].pageX)/2,n=(t.touches[0].pageY+t.touches[1].pageY)/2,y.copy(S(e,n)),g.copy(y)),a=2;break;case 99:e=(t.touches[0].pageX+t.touches[1].pageX)/2,n=(t.touches[0].pageY+t.touches[1].pageY)/2,x.copy(S(e,n)),v.copy(x);break;default:a=r}i.dispatchEvent(M)}}function N(t){t.preventDefault()}this.rotateCamera=function(){let t,e=new n.Pa4,r=new n._fP,s=new n.Pa4,a=new n.Pa4,o=new n.Pa4,p=new n.Pa4;return function(){p.set(c.x-h.x,c.y-h.y,0),t=p.length(),t?(l.copy(i.object.position).sub(i.target),s.copy(l).normalize(),a.copy(i.object.up).normalize(),o.crossVectors(a,s).normalize(),a.setLength(c.y-h.y),o.setLength(c.x-h.x),p.copy(a.add(o)),e.crossVectors(p,l).normalize(),t*=i.rotateSpeed,r.setFromAxisAngle(e,t),l.applyQuaternion(r),i.object.up.applyQuaternion(r),u.copy(e),d=t):!i.staticMoving&&d&&(d*=Math.sqrt(1-i.dynamicDampingFactor),l.copy(i.object.position).sub(i.target),r.setFromAxisAngle(u,d),l.applyQuaternion(r),i.object.up.applyQuaternion(r)),h.copy(c)}}(),this.zoomCamera=function(){let t;4===a?(t=m/_,m=_,l.multiplyScalar(t)):(t=1+(f.y-p.y)*i.zoomSpeed,1!==t&&t>0&&(l.multiplyScalar(t),i.staticMoving?p.copy(f):p.y+=(f.y-p.y)*this.dynamicDampingFactor))},this.panCamera=function(){let t=new n.FM8,e=new n.Pa4,r=new n.Pa4;return function(){t.copy(y).sub(g),t.lengthSq()&&(t.multiplyScalar(l.length()*i.panSpeed),r.copy(l).cross(i.object.up).setLength(t.x),r.add(e.copy(i.object.up).setLength(t.y)),i.object.position.add(r),i.target.add(r),i.staticMoving?g.copy(y):g.add(t.subVectors(y,g).multiplyScalar(i.dynamicDampingFactor)))}}(),this.checkDistances=function(){i.noZoom&&i.noPan||(l.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.addVectors(i.target,l.setLength(i.maxDistance)),l.lengthSq()<i.minDistance*i.minDistance&&i.object.position.addVectors(i.target,l.setLength(i.minDistance)))},this.update=function(){l.subVectors(i.object.position,i.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.noCustom||i.custom(v,x),i.object.position.addVectors(i.target,l),i.checkDistances(),i.object.lookAt(i.target),s.distanceToSquared(i.object.position)>1e-6&&(i.dispatchEvent(b),s.copy(i.object.position))},this.reset=function(){a=r,o=r,i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.up.copy(i.up0),l.subVectors(i.object.position,i.target),i.object.lookAt(i.target),i.dispatchEvent(b),s.copy(i.object.position)},this.setState=function(t){i.forceState=t,o=t,a=t},this.custom=function(t,e){},this.dispose=function(){this.domElement.removeEventListener("contextmenu",N,!1),this.domElement.removeEventListener("mousedown",P,!1),this.domElement.removeEventListener("wheel",R,!1),this.domElement.removeEventListener("touchstart",I,!1),this.domElement.removeEventListener("touchend",O,!1),this.domElement.removeEventListener("touchmove",D,!1),removeEventListener("keydown",T,!1),removeEventListener("keyup",A,!1)},this.domElement.addEventListener("contextmenu",N,!1),this.domElement.addEventListener("mousedown",P,!1),this.domElement.addEventListener("wheel",R,!1),this.domElement.addEventListener("touchstart",I,!1),this.domElement.addEventListener("touchend",O,!1),this.domElement.addEventListener("touchmove",D,!1),addEventListener("keydown",T,!1),addEventListener("keyup",A,!1),this.handleResize(),this.update()}}class s extends n.pBf{constructor(t,e,i={NONE:-1,ROTATE:1,ZOOM:2,PAN:0,SCROLL:4,TOUCH_ROTATE:4,TOUCH_ZOOM_PAN:5}){super();let r=this,s=i;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.zoomSpeed=1.2,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new n.Pa4;let a=!0,o=s.NONE,l=s.NONE,h=new n.Pa4,c=new n.FM8,u=new n.FM8,d=0,p=0,f=new n.FM8,m=new n.FM8;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;let _={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=innerWidth,this.screen.height=innerHeight;else{let t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+scrollX-e.clientLeft,this.screen.top=t.top+scrollY-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};let v=function(){let t=new n.FM8;return function(e,i){return t.set((e-r.screen.left)/r.screen.width,(i-r.screen.top)/r.screen.height),t}}();function x(t){!1!==r.enabled&&(removeEventListener("keydown",x),l=o,o===s.NONE&&(t.keyCode!==r.keys[s.ROTATE]||r.noRotate?t.keyCode!==r.keys[s.ZOOM]||r.noZoom?t.keyCode!==r.keys[s.PAN]||r.noPan||(o=s.PAN):o=s.ZOOM:o=s.ROTATE))}function b(t){!1!==r.enabled&&(o=l,addEventListener("keydown",x,!1))}function w(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o===s.NONE&&(o=t.button),(o!==s.ROTATE||r.noRotate)&&(o!==s.ZOOM||r.noZoom?o!==s.PAN||r.noPan||(f.copy(v(t.pageX,t.pageY)),m.copy(f)):(c.copy(v(t.pageX,t.pageY)),u.copy(c))),document.addEventListener("mousemove",M,!1),document.addEventListener("mouseup",S,!1),r.dispatchEvent(g))}function M(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),(o!==s.ROTATE||r.noRotate)&&(o!==s.ZOOM||r.noZoom?o!==s.PAN||r.noPan||m.copy(v(t.pageX,t.pageY)):u.copy(v(t.pageX,t.pageY))))}function S(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),o=s.NONE,document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",S),r.dispatchEvent(y))}function E(t){!1!==r.enabled&&(t.preventDefault(),t.stopPropagation(),r.dispatchEvent({type:"OnScroll",delta:.01*t.deltaX+.01*t.deltaY}),r.dispatchEvent(g),r.dispatchEvent(y))}function T(t){if(!1!==r.enabled){switch(t.touches.length){case 1:o=s.TOUCH_ROTATE;break;case 2:o=s.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=d=Math.sqrt(e*e+i*i);var n=(t.touches[0].pageX+t.touches[1].pageX)/2,a=(t.touches[0].pageY+t.touches[1].pageY)/2;f.copy(v(n,a)),m.copy(f);break;default:o=s.NONE}r.dispatchEvent(g)}}function A(t){if(!1!==r.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;p=Math.sqrt(e*e+i*i);var n=(t.touches[0].pageX+t.touches[1].pageX)/2,a=(t.touches[0].pageY+t.touches[1].pageY)/2;m.copy(v(n,a));break;default:o=s.NONE}}function P(t){if(!1!==r.enabled){switch(t.touches.length){case 1:break;case 2:d=p=0;var e=(t.touches[0].pageX+t.touches[1].pageX)/2,i=(t.touches[0].pageY+t.touches[1].pageY)/2;m.copy(v(e,i)),f.copy(m)}o=s.NONE,r.dispatchEvent(y)}}function C(t){t.preventDefault()}this.zoomCamera=function(){if(o===s.TOUCH_ZOOM_PAN){var t=p/d;d=p,r.object.zoom*=t,a=!0}else t=1+(u.y-c.y)*r.zoomSpeed,Math.abs(t-1)>1e-6&&t>0&&(r.object.zoom/=t,r.staticMoving?c.copy(u):c.y+=(u.y-c.y)*this.dynamicDampingFactor,a=!0)},this.panCamera=function(){let t=new n.FM8,e=new n.Pa4,i=new n.Pa4;return function(){if(t.copy(m).sub(f),t.lengthSq()){let n=(r.object.right-r.object.left)/r.object.zoom,s=(r.object.top-r.object.bottom)/r.object.zoom;t.x*=n,t.y*=s,i.copy(h).cross(r.object.up).setLength(t.x),i.add(e.copy(r.object.up).setLength(t.y)),r.object.position.add(i),r.target.add(i),r.staticMoving?f.copy(m):f.add(t.subVectors(m,f).multiplyScalar(r.dynamicDampingFactor)),a=!0}}}(),this.update=function(){h.subVectors(r.object.position,r.target),r.noZoom||(r.zoomCamera(),a&&r.object.updateProjectionMatrix()),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,h),r.object.lookAt(r.target),a&&(r.dispatchEvent(_),a=!1)},this.reset=function(){o=s.NONE,l=s.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),h.subVectors(r.object.position,r.target),r.object.left=r.left0,r.object.right=r.right0,r.object.top=r.top0,r.object.bottom=r.bottom0,r.object.lookAt(r.target),r.dispatchEvent(_),a=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",C,!1),this.domElement.removeEventListener("mousedown",w,!1),this.domElement.removeEventListener("wheel",E,!1),this.domElement.removeEventListener("touchstart",T,!1),this.domElement.removeEventListener("touchend",P,!1),this.domElement.removeEventListener("touchmove",A,!1),removeEventListener("keydown",x,!1),removeEventListener("keyup",b,!1)},this.domElement.addEventListener("contextmenu",C,!1),this.domElement.addEventListener("mousedown",w,!1),this.domElement.addEventListener("wheel",E,!1),this.domElement.addEventListener("touchstart",T,!1),this.domElement.addEventListener("touchend",P,!1),this.domElement.addEventListener("touchmove",A,!1),addEventListener("keydown",x,!1),addEventListener("keyup",b,!1),this.handleResize(),this.update()}}class a extends n.pBf{get center(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}get noZoom(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom}set noZoom(t){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}get noRotate(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate}set noRotate(t){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}get noPan(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan}set noPan(t){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}get noKeys(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys}set noKeys(t){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}get staticMoving(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping}set staticMoving(t){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}get dynamicDampingFactor(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor}set dynamicDampingFactor(t){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}constructor(t,e){var i,r,s,a,o;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.preventDefault=!0,this.target=new n.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n.RsA.LEFT,MIDDLE:n.RsA.MIDDLE,RIGHT:n.RsA.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(h),l.update(),p=d.NONE},this.handleResize=function(){},this.update=(i=new n.Pa4,r=(new n._fP).setFromUnitVectors(t.up,new n.Pa4(0,1,0)),s=r.clone().inverse(),a=new n.Pa4,o=new n._fP,function(){var t=l.object.position;return i.copy(t).sub(l.target),i.applyQuaternion(r),m.setFromVector3(i),l.autoRotate&&p===d.NONE&&L(2*Math.PI/60/60*l.autoRotateSpeed),m.theta+=_.theta,m.phi+=_.phi,m.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,m.theta)),m.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=g,m.radius=Math.max(l.minDistance,Math.min(l.maxDistance,m.radius)),l.target.add(y),i.setFromSpherical(m),i.applyQuaternion(s),t.copy(l.target).add(i),l.object.lookAt(l.target),!0===l.enableDamping?(_.theta*=1-l.dampingFactor,_.phi*=1-l.dampingFactor,y.multiplyScalar(1-l.dampingFactor)):(_.set(0,0,0),y.set(0,0,0)),g=1,!!(v||a.distanceToSquared(l.object.position)>f||8*(1-o.dot(l.object.quaternion))>f)&&(l.dispatchEvent(h),a.copy(l.object.position),o.copy(l.object.quaternion),v=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",X,!1),l.domElement.removeEventListener("mousedown",U,!1),l.domElement.removeEventListener("wheel",G,!1),l.domElement.removeEventListener("touchstart",W,!1),l.domElement.removeEventListener("touchend",q,!1),l.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",H,!1),removeEventListener("keydown",V,!1)};var l=this,h={type:"change"},c={type:"start"},u={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},p=d.NONE,f=1e-6,m=new n.$V,_=new n.$V,g=1,y=new n.Pa4,v=!1,x=new n.FM8,b=new n.FM8,w=new n.FM8,M=new n.FM8,S=new n.FM8,E=new n.FM8,T=new n.FM8,A=new n.FM8,P=new n.FM8;function C(){return Math.pow(.95,l.zoomSpeed)}function L(t){_.theta-=t}function R(t){_.phi-=t}var I,D=(I=new n.Pa4,function(t,e){I.setFromMatrixColumn(e,0),I.multiplyScalar(-t),y.add(I)}),O=function(){var t=new n.Pa4;return function(e,i){!0===l.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(l.object.up,t)),t.multiplyScalar(e),y.add(t)}}(),N=function(){var t=new n.Pa4;return function(e,i){var n=l.domElement===document?l.domElement.body:l.domElement;if(l.object.isPerspectiveCamera){var r=l.object.position;t.copy(r).sub(l.target);var s=t.length();s*=Math.tan(l.object.fov/2*Math.PI/180),D(2*e*s/n.clientHeight,l.object.matrix),O(2*i*s/n.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(D(e*(l.object.right-l.object.left)/l.object.zoom/n.clientWidth,l.object.matrix),O(i*(l.object.top-l.object.bottom)/l.object.zoom/n.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function F(t){l.object.isPerspectiveCamera?g/=t:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*t)),l.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function k(t){l.object.isPerspectiveCamera?g*=t:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/t)),l.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function z(t){M.set(t.clientX,t.clientY)}function U(t){if(!1!==l.enabled){switch(!0===l.preventDefault&&t.preventDefault(),t.button){case l.mouseButtons.LEFT:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enablePan)return;z(t),p=d.PAN}else{if(!1===l.enableRotate)return;!function(t){x.set(t.clientX,t.clientY)}(t),p=d.ROTATE}break;case l.mouseButtons.MIDDLE:if(!1===l.enableZoom)return;!function(t){T.set(t.clientX,t.clientY)}(t),p=d.DOLLY;break;case l.mouseButtons.RIGHT:if(!1===l.enablePan)return;z(t),p=d.PAN}p!==d.NONE&&(document.addEventListener("mousemove",B,!1),document.addEventListener("mouseup",H,!1),l.dispatchEvent(c))}}function B(t){if(!1!==l.enabled)switch(!0===l.preventDefault&&t.preventDefault(),p){case d.ROTATE:if(!1===l.enableRotate)return;!function(t){b.set(t.clientX,t.clientY),w.subVectors(b,x).multiplyScalar(l.rotateSpeed);var e=l.domElement===document?l.domElement.body:l.domElement;L(2*Math.PI*w.x/e.clientHeight),R(2*Math.PI*w.y/e.clientHeight),x.copy(b),l.update()}(t);break;case d.DOLLY:if(!1===l.enableZoom)return;!function(t){A.set(t.clientX,t.clientY),P.subVectors(A,T),P.y>0?F(C()):P.y<0&&k(C()),T.copy(A),l.update()}(t);break;case d.PAN:if(!1===l.enablePan)return;!function(t){S.set(t.clientX,t.clientY),E.subVectors(S,M).multiplyScalar(l.panSpeed),N(E.x,E.y),M.copy(S),l.update()}(t)}}function H(t){!1!==l.enabled&&(document.removeEventListener("mousemove",B,!1),document.removeEventListener("mouseup",H,!1),l.dispatchEvent(u),p=d.NONE)}function G(t){!1===l.enabled||!1===l.enableZoom||p!==d.NONE&&p!==d.ROTATE||(!0===l.preventDefault&&(t.preventDefault(),t.stopPropagation()),l.dispatchEvent(c),function(t){t.deltaY<0?k(C()):t.deltaY>0&&F(C()),l.update()}(t),l.dispatchEvent(u))}function V(t){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(t){switch(t.keyCode){case l.keys.UP:N(0,l.keyPanSpeed),l.update();break;case l.keys.BOTTOM:N(0,-l.keyPanSpeed),l.update();break;case l.keys.LEFT:N(l.keyPanSpeed,0),l.update();break;case l.keys.RIGHT:N(-l.keyPanSpeed,0),l.update()}}(t)}function W(t){if(!1!==l.enabled){switch(!0===l.preventDefault&&t.preventDefault(),t.touches.length){case 1:if(!1===l.enableRotate)return;!function(t){x.set(t.touches[0].pageX,t.touches[0].pageY)}(t),p=d.TOUCH_ROTATE;break;case 2:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(t){if(l.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);T.set(0,n)}if(l.enablePan){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);M.set(r,s)}}(t),p=d.TOUCH_DOLLY_PAN;break;default:p=d.NONE}p!==d.NONE&&l.dispatchEvent(c)}}function j(t){if(!1!==l.enabled)switch(!0===l.preventDefault&&(t.preventDefault(),t.stopPropagation()),t.touches.length){case 1:if(!1===l.enableRotate)return;if(p!==d.TOUCH_ROTATE)return;!function(t){b.set(t.touches[0].pageX,t.touches[0].pageY),w.subVectors(b,x).multiplyScalar(l.rotateSpeed);var e=l.domElement===document?l.domElement.body:l.domElement;L(2*Math.PI*w.x/e.clientHeight),R(2*Math.PI*w.y/e.clientHeight),x.copy(b),l.update()}(t);break;case 2:if(!1===l.enableZoom&&!1===l.enablePan)return;if(p!==d.TOUCH_DOLLY_PAN)return;!function(t){if(l.enableZoom){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);A.set(0,n),P.set(0,Math.pow(A.y/T.y,l.zoomSpeed)),F(P.y),T.copy(A)}if(l.enablePan){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),s=.5*(t.touches[0].pageY+t.touches[1].pageY);S.set(r,s),E.subVectors(S,M).multiplyScalar(l.panSpeed),N(E.x,E.y),M.copy(S)}l.update()}(t);break;default:p=d.NONE}}function q(t){!1!==l.enabled&&(l.dispatchEvent(u),p=d.NONE)}function X(t){!1!==l.enabled&&!0===l.preventDefault&&t.preventDefault()}l.domElement.addEventListener("contextmenu",X,!1),l.domElement.addEventListener("mousedown",U,!1),l.domElement.addEventListener("wheel",G,!1),l.domElement.addEventListener("touchstart",W,!1),l.domElement.addEventListener("touchend",q,!1),l.domElement.addEventListener("touchmove",j,!1),addEventListener("keydown",V,!1),this.update()}}},9501:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var n=i(1798),r=i(2798),s=i(1245),a=i(7802);class o{static aabbPlane(t,e){let i=[];if(!this.validateAabb(t)||!this.validatePlane(e))return console.log("Invalid aabb or plane provided."),!1;let r=new s.y;r.getInverse(t.toAABB);let o=e.direction.clone().applyMatrix4(t.toAABB),l=new a.P(0,0,0).applyMatrix4(t.toAABB),h=this.posdir(e.position.clone().applyMatrix4(t.toAABB),new a.P(o.x-l.x,o.y-l.y,o.z-l.z).normalize()),c=n.default.bbox(t.center,t.halfDimensions),u=new a.P(new a.P(1,0,0),new a.P(0,1,0),new a.P(0,0,1)),d=this.posdir(new a.P(t.center.x-t.halfDimensions.x,t.center.y-t.halfDimensions.y,t.center.z-t.halfDimensions.z),u.x);this.rayPlaneInBBox(d,h,c,i),d.direction=u.y,this.rayPlaneInBBox(d,h,c,i),d.direction=u.z,this.rayPlaneInBBox(d,h,c,i);let p=this.posdir(new a.P(t.center.x+t.halfDimensions.x,t.center.y+t.halfDimensions.y,t.center.z+t.halfDimensions.z),u.x);this.rayPlaneInBBox(p,h,c,i),p.direction=u.y,this.rayPlaneInBBox(p,h,c,i),p.direction=u.z,this.rayPlaneInBBox(p,h,c,i);let f=this.posdir(new a.P(t.center.x+t.halfDimensions.x,t.center.y-t.halfDimensions.y,t.center.z-t.halfDimensions.z),u.y);this.rayPlaneInBBox(f,h,c,i),f.direction=u.z,this.rayPlaneInBBox(f,h,c,i);let m=this.posdir(new a.P(t.center.x-t.halfDimensions.x,t.center.y+t.halfDimensions.y,t.center.z-t.halfDimensions.z),u.x);this.rayPlaneInBBox(m,h,c,i),m.direction=u.z,this.rayPlaneInBBox(m,h,c,i);let _=this.posdir(new a.P(t.center.x-t.halfDimensions.x,t.center.y-t.halfDimensions.y,t.center.z+t.halfDimensions.z),u.x);return this.rayPlaneInBBox(_,h,c,i),_.direction=u.y,this.rayPlaneInBBox(_,h,c,i),i.map((function(t){return t.applyMatrix4(r)})),i}static rayPlane(t,e){if(0!==t.direction.dot(e.direction)){let i=(e.direction.x*(e.position.x-t.position.x)+e.direction.y*(e.position.y-t.position.y)+e.direction.z*(e.position.z-t.position.z))/(e.direction.x*t.direction.x+e.direction.y*t.direction.y+e.direction.z*t.direction.z);return new a.P(t.position.x+i*t.direction.x,t.position.y+i*t.direction.y,t.position.z+i*t.direction.z)}return null}static rayBox(t,e){let i=[],r=n.default.bbox(e.center,e.halfDimensions),s=this.posdir(new a.P(r.min.x,e.center.y,e.center.z),new a.P(-1,0,0));return this.rayPlaneInBBox(t,s,r,i),s=this.posdir(new a.P(r.max.x,e.center.y,e.center.z),new a.P(1,0,0)),this.rayPlaneInBBox(t,s,r,i),s=this.posdir(new a.P(e.center.x,r.min.y,e.center.z),new a.P(0,-1,0)),this.rayPlaneInBBox(t,s,r,i),s=this.posdir(new a.P(e.center.x,r.max.y,e.center.z),new a.P(0,1,0)),this.rayPlaneInBBox(t,s,r,i),s=this.posdir(new a.P(e.center.x,e.center.y,r.min.z),new a.P(0,0,-1)),this.rayPlaneInBBox(t,s,r,i),s=this.posdir(new a.P(e.center.x,e.center.y,r.max.z),new a.P(0,0,1)),this.rayPlaneInBBox(t,s,r,i),i}static rayPlaneInBBox(t,e,i,n){let r=this.rayPlane(t,e);r&&this.inBBox(r,i)&&(n.find(this.findIntersection(r))||n.push(r))}static findIntersection(t){return function(e,i,n){return t.x===e.x&&t.y===e.y&&t.z===e.z}}static inBBox(t,e){let i=1e-4;return!!(t&&t.x>=e.min.x-i&&t.y>=e.min.y-i&&t.z>=e.min.z-i&&t.x<=e.max.x+i&&t.y<=e.max.y+i&&t.z<=e.max.z+i)}static posdir(t,e){return{position:t,direction:e}}static validatePlane(t){return null===t?(console.log("Invalid plane."),console.log(t),!1):r.Z.vector3(t.position)?!!r.Z.vector3(t.direction)||(console.log("Invalid plane.direction."),console.log(t.direction),!1):(console.log("Invalid plane.position."),console.log(t.position),!1)}static validateAabb(t){return null===t?(console.log("Invalid aabb."),console.log(t),!1):r.Z.matrix4(t.toAABB)?r.Z.vector3(t.center)?!!(r.Z.vector3(t.halfDimensions)&&t.halfDimensions.x>=0&&t.halfDimensions.y>=0&&t.halfDimensions.z>=0)||(console.log("Invalid aabb.halfDimensions."),console.log(t.halfDimensions),!1):(console.log("Invalid aabb.center."),console.log(t.center),!1):(console.log("Invalid aabb.toAABB: "),console.log(t.toAABB),!1)}}},6505:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ColorsCore:()=>n.default,IntersectionsCore:()=>r.Z,UtilsCore:()=>a.default,ValidatorsCore:()=>s.Z});var n=i(2450),r=i(9501),s=i(2798),a=i(1798)},1798:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>W});var n=i(2798),r=i(7802);class s{constructor(t=new r.P(1/0,1/0,1/0),e=new r.P(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=o.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)o.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(o)}else null===i.boundingBox&&i.computeBoundingBox(),l.copy(i.boundingBox),l.applyMatrix4(t.matrixWorld),this.union(l);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,o),o.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(m),_.subVectors(this.max,m),h.subVectors(t.a,m),c.subVectors(t.b,m),u.subVectors(t.c,m),d.subVectors(c,h),p.subVectors(u,c),f.subVectors(h,u);let e=[0,-d.z,d.y,0,-p.z,p.y,0,-f.z,f.y,d.z,0,-d.x,p.z,0,-p.x,f.z,0,-f.x,-d.y,d.x,0,-p.y,p.x,0,-f.y,f.x,0];return!!v(e,h,c,u,_)&&(e=[1,0,0,0,1,0,0,0,1],!!v(e,h,c,u,_)&&(g.crossVectors(d,p),e=[g.x,g.y,g.z],v(e,h,c,u,_)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return o.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(o).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(a)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}s.prototype.isBox3=!0;const a=[new r.P,new r.P,new r.P,new r.P,new r.P,new r.P,new r.P,new r.P],o=new r.P,l=new s,h=new r.P,c=new r.P,u=new r.P,d=new r.P,p=new r.P,f=new r.P,m=new r.P,_=new r.P,g=new r.P,y=new r.P;function v(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){y.fromArray(t,s);const a=r.x*Math.abs(y.x)+r.y*Math.abs(y.y)+r.z*Math.abs(y.z),o=e.dot(y),l=i.dot(y),h=n.dot(y);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const x=new r.P,b=new r.P,w=new r.P,M=new r.P,S=new r.P,E=new r.P,T=new r.P;class A{constructor(t=new r.P,e=new r.P(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,x)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=x.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(x.copy(this.direction).multiplyScalar(e).add(this.origin),x.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){b.copy(t).add(e).multiplyScalar(.5),w.copy(e).sub(t).normalize(),M.copy(this.origin).sub(b);const r=.5*t.distanceTo(e),s=-this.direction.dot(w),a=M.dot(this.direction),o=-M.dot(w),l=M.lengthSq(),h=Math.abs(1-s*s);let c,u,d,p;if(h>0)if(c=s*o-a,u=s*a-o,p=r*h,c>=0)if(u>=-p)if(u<=p){const t=1/h;c*=t,u*=t,d=c*(c+s*u+2*a)+u*(s*c+u+2*o)+l}else u=r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u=-r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u<=-p?(c=Math.max(0,-(-s*r+a)),u=c>0?-r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l):u<=p?(c=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(c=Math.max(0,-(s*r+a)),u=c>0?r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l);else u=s>0?-r:r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(w).multiplyScalar(u).add(b),d}intersectSphere(t,e){x.subVectors(t.center,this.origin);const i=x.dot(this.direction),n=x.dot(x)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,x)}intersectTriangle(t,e,i,n,r){S.subVectors(e,t),E.subVectors(i,t),T.crossVectors(S,E);let s,a=this.direction.dot(T);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}M.subVectors(this.origin,t);const o=s*this.direction.dot(E.crossVectors(M,E));if(o<0)return null;const l=s*this.direction.dot(S.cross(M));if(l<0)return null;if(o+l>a)return null;const h=-s*M.dot(T);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class P{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class C{constructor(t,e,i=0,n=1/0){this.ray=new A(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new P,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return R(t,this,i,e),i.sort(L),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)R(t[n],this,i,e);return i.sort(L),i}}function L(t,e){return t.distance-e.distance}function R(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)R(n[t],e,i,!0)}}const I=new r.P,D=new r.P,O=new r.P,N=new r.P,F=new r.P,k=new r.P,z=new r.P,U=new r.P,B=new r.P,H=new r.P;class G{constructor(t=new r.P,e=new r.P,i=new r.P){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),I.subVectors(t,e),n.cross(I);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){I.subVectors(n,e),D.subVectors(i,e),O.subVectors(t,e);const s=I.dot(I),a=I.dot(D),o=I.dot(O),l=D.dot(D),h=D.dot(O),c=s*l-a*a;if(0===c)return r.set(-2,-1,-1);const u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,N),N.x>=0&&N.y>=0&&N.x+N.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,N),o.set(0,0),o.addScaledVector(r,N.x),o.addScaledVector(s,N.y),o.addScaledVector(a,N.z),o}static isFrontFacing(t,e,i,n){return I.subVectors(i,e),D.subVectors(t,e),I.cross(D).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return I.subVectors(this.c,this.b),D.subVectors(this.a,this.b),.5*I.cross(D).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return G.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return G.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return G.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return G.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return G.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;F.subVectors(n,i),k.subVectors(r,i),U.subVectors(t,i);const o=F.dot(U),l=k.dot(U);if(o<=0&&l<=0)return e.copy(i);B.subVectors(t,n);const h=F.dot(B),c=k.dot(B);if(h>=0&&c<=h)return e.copy(n);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return s=o/(o-h),e.copy(i).addScaledVector(F,s);H.subVectors(t,r);const d=F.dot(H),p=k.dot(H);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(k,a);const m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return z.subVectors(r,n),a=(c-h)/(c-h+(d-p)),e.copy(n).addScaledVector(z,a);const _=1/(m+f+u);return s=f*_,a=u*_,e.copy(i).addScaledVector(F,s).addScaledVector(k,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}var V=i(1245);class W{static bbox(t,e){return n.Z.vector3(t)&&n.Z.vector3(e)?e.x>=0&&e.y>=0&&e.z>=0?{min:t.clone().sub(e),max:t.clone().add(e)}:(console.log("halfDimensions must be >= 0."),console.log(e),!1):(console.log("Invalid center or plane halfDimensions."),!1)}static minMax(t=[]){let e=[65535,-32768],i=t.length;for(let n=0;n<i;n++){let i=t[n];e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],i)}return e}static isElement(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}}static isString(t){return"string"==typeof t||t instanceof String}static parseUrl(t){const e=new URL(t,"http://fix.me"),i={filename:e.searchParams.get("filename"),extension:"",pathname:e.pathname,query:e.search};i.filename||(i.filename=i.pathname.split("/").pop());const n=i.filename.split(".");return i.extension=n.length>1?n.pop():"dicom",(!isNaN(i.extension)||-1!==["asp","aspx","go","gs","hs","jsp","js","php","pl","py","rb","htm","html"].indexOf(i.extension)||i.query&&i.query.includes("contentType=application%2Fdicom"))&&(i.extension="dicom"),i}static ijk2LPS(t,e,i,n,r,s=new V.y){const a=new V.y;return a.set(t.x*n.y,e.x*n.x,i.x*n.z,r.x,t.y*n.y,e.y*n.x,i.y*n.z,r.y,t.z*n.y,e.z*n.x,i.z*n.z,r.z,0,0,0,1),a.premultiply(s),a}static aabb2LPS(t,e,i,n){const r=new V.y;return r.set(t.x,e.x,i.x,n.x,t.y,e.y,i.y,n.y,t.z,e.z,i.z,n.z,0,0,0,1),r}static worldToData(t,e){let i=(new r.P).copy(e).applyMatrix4(t);return i.addScalar(.5).floor(),i}static value(t,e){console.warn("value is deprecated, please use getPixelData instead"),this.getPixelData(t,e)}static getPixelData(t,e){return e.z>=0&&e.z<t._frame.length?t._frame[e.z].getPixelData(e.x,e.y):null}static setPixelData(t,e,i){if(!(e.z>=0&&e.z<t._frame.length))return null;t._frame[e.z].setPixelData(e.x,e.y,i)}static rescaleSlopeIntercept(t,e,i){return t*e+i}static centerOfMass(t){let e=new r.P(0,0,0);for(let i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y,e.z+=t[i].z;return e.divideScalar(t.length),e}static orderIntersections(t,e){let i=this.centerOfMass(t),n=new r.P(t[0].x-i.x,t[0].y-i.y,t[0].z-i.z).normalize(),s=new r.P(0,0,0).crossVectors(n,e).normalize(),a=[];for(let e=0;e<t.length;e++){let o=new r.P(t[e].x,t[e].y,t[e].z);o.direction=new r.P(t[e].x-i.x,t[e].y-i.y,t[e].z-i.z).normalize();let l=n.dot(o.direction),h=s.dot(o.direction);o.xy={x:l,y:h};let c=Math.atan2(h,l)*(180/Math.PI);o.angle=c,a.push(o)}a.sort((function(t,e){return t.angle-e.angle}));let o=[a[0]];for(let t=1;t<a.length;t++)Math.abs(a[t-1].angle-a[t].angle)>1e-4&&o.push(a[t]);return o}static getRoI(t,e,i){t.geometry.computeBoundingBox();const n=(new s).setFromObject(t),r=n.min.clone().project(e),a=n.max.clone().project(e),o=e.controls.domElement.offsetWidth,l=e.controls.domElement.offsetHeight,h=new C,c=[];r.x=Math.round((r.x+1)*o/2),r.y=Math.round((1-r.y)*l/2),a.x=Math.round((a.x+1)*o/2),a.y=Math.round((1-a.y)*l/2),[r.x,a.x]=[Math.min(r.x,a.x),Math.max(r.x,a.x)],[r.y,a.y]=[Math.min(r.y,a.y),Math.max(r.y,a.y)];let u=[],d=null;for(let n=r.x;n<=a.x;n++)for(let s=r.y;s<=a.y;s++)h.setFromCamera({x:n/o*2-1,y:-s/l*2+1},e),u=h.intersectObject(t),0!==u.length&&(d=W.getPixelData(i,W.worldToData(i.lps2IJK,u[0].point)),null!==d&&1===i.numberOfChannels&&c.push(W.rescaleSlopeIntercept(d,i.rescaleSlope,i.rescaleIntercept)));if(0===c.length)return null;const p=c.reduce(((t,e)=>t+e))/c.length;return{min:c.reduce(((t,e)=>t<e?t:e)),max:c.reduce(((t,e)=>t>e?t:e)),mean:p,sd:Math.sqrt(c.reduce(((t,e)=>t+Math.pow(e-p,2)),0)/c.length)}}static getGeometryArea(t){if(t.faces.length<1)return 0;let e=0,i=t.vertices;return t.faces.forEach((function(t){e+=new G(i[t.a],i[t.b],i[t.c]).getArea()})),e}static stringToNumber(t){let e=Number(t);if(e!=e){const i=(t.match(/\./g)||[]).length;if(1===(t.match(/\,/g)||[]).length&&i<2){const n=0===i?".":"",r=t.replace(/,/g,n);e=Number(r)}e!=e&&(console.error(`String could not be converted to number (${t}). Setting value to "1.0".`),e=1)}return e}}},2798:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{static matrix4(t){return!(null==t||!t.hasOwnProperty("elements")||16!==t.elements.length||"function"!=typeof t.identity||"function"!=typeof t.copy||"function"!=typeof t.determinant)}static vector3(t){return!(!(null!=t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z"))||t.hasOwnProperty("w"))}static box(t){return!!(null!=t&&t.hasOwnProperty("center")&&this.vector3(t.center)&&t.hasOwnProperty("halfDimensions")&&this.vector3(t.halfDimensions)&&t.halfDimensions.x>=0&&t.halfDimensions.y>=0&&t.halfDimensions.z>=0)}static ray(t){return!!(null!=t&&t.hasOwnProperty("position")&&this.vector3(t.position)&&t.hasOwnProperty("direction")&&this.vector3(t.direction))}}},416:(t,e,i)=>{"use strict";i.r(e),i.d(e,{SliceGeometry:()=>n.b,VoxelGeometry:()=>s});var n=i(332),r=i(9477);class s extends r.DvJ{constructor(t){super(1,1,1),this._location=t,this.applyMatrix((new r.yGw).makeTranslation(this._location.x,this._location.y,this._location.z)),this.verticesNeedUpdate=!0}resetVertices(){this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5)}set location(t){this._location=t,this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5),this.applyMatrix((new r.yGw).makeTranslation(this._location.x,this._location.y,this._location.z)),this.verticesNeedUpdate=!0}get location(){return this._location}}},332:(t,e,i)=>{"use strict";i.d(e,{b:()=>a});var n=i(9477),r=i(9501),s=i(1798);class a extends n.HW6{constructor(t,e,i,a,o=new n.yGw){let l={halfDimensions:t,center:e,toAABB:o},h={position:i,direction:a},c=r.Z.aabbPlane(l,h);if(c.length<3)throw console.log("WARNING: Less than 3 intersections between AABB and Plane."),console.log("AABB"),console.log(l),console.log("Plane"),console.log(h),console.log("exiting..."),new Error("geometries.slice has less than 3 intersections, can not create a valid geometry.");let u=s.default.orderIntersections(c,a),d=new n.bnF;d.moveTo(u[0].xy.x,u[0].xy.y);const p=new Float32Array(3*u.length);p.set(u[0].toArray(),0);for(let t=1;t<u.length;t++)p.set(u[t].toArray(),3*t),d.lineTo(u[t].xy.x,u[t].xy.y);d.lineTo(u[0].xy.x,u[0].xy.y),super(d),this.type="SliceBufferGeometry",this.setAttribute("position",new n.a$l(p,3)),this.vertices=u}}},1193:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BorderHelper:()=>r,BoundingBoxHelper:()=>s,ContourHelper:()=>h,LocalizerHelper:()=>p,LutHelper:()=>m,ProgressBarEventBasedHelper:()=>v,ProgressBarHelper:()=>y.Z,SegmentationLutHelper:()=>g,SliceHelper:()=>E,StackHelper:()=>T,VolumeRenderingHelper:()=>L});var n=i(9477);class r extends n.Tme{constructor(t){super(),this._helpersSlice=t,this._visible=!0,this._color=16711680,this._material=null,this._geometry=null,this._mesh=null,this._create()}set helpersSlice(t){this._helpersSlice=t,this._update()}get helpersSlice(){return this._helpersSlice}set visible(t){this._visible=t,this._mesh&&(this._mesh.visible=this._visible)}get visible(){return this._visible}set color(t){this._color=t,this._material&&this._material.color.set(this._color)}get color(){return this._color}_create(){if(this._material||(this._material=new n.nls({color:this._color,linewidth:1})),!this._helpersSlice.geometry.vertices)return;this._geometry=new n.u9r;const t=this._helpersSlice.geometry.vertices.length,e=new Float32Array(3*(t+1));e.set(this._helpersSlice.geometry.attributes.position.array,0),e.set(this._helpersSlice.geometry.vertices[0].toArray(),3*t),this._geometry.setAttribute("position",new n.a$l(e,3)),this._mesh=new n.x12(this._geometry,this._material),"IJK"===this._helpersSlice.aabbSpace&&this._mesh.applyMatrix4(this._helpersSlice.stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}_update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh=null),this._create()}dispose(){this._mesh.material.dispose(),this._mesh.material=null,this._geometry.dispose(),this._geometry=null,this._material.dispose(),this._material=null}}class s extends n.Tme{constructor(t){super(),this._stack=t,this._visible=!0,this._color=16777215,this._material=null,this._geometry=null,this._mesh=null,this._meshStack=null,this._create()}set visible(t){this._visible=t,this._mesh&&(this._mesh.visible=this._visible)}get visible(){return this._visible}set color(t){this._color=t,this._material&&this._material.color.set(this._color)}get color(){return this._color}_create(){const t=this._stack.dimensionsIJK,e=this._stack.halfDimensionsIJK,i=new n.Pa4(-.5,-.5,-.5),r=new n.DvJ(t.x,t.y,t.z);r.applyMatrix4((new n.yGw).makeTranslation(e.x+i.x,e.y+i.y,e.z+i.z)),this._geometry=r,this._material=new n.vBJ({wireframe:!0});const s=new n.Kj0(this._geometry,null);s.applyMatrix4(this._stack.ijk2LPS),s.visible=this._visible,this._meshStack=s,this._mesh=new n.fQA(this._meshStack,this._color),this._material=this._mesh.material,this.add(this._mesh)}_update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._create()}dispose(){this._mesh.material.dispose(),this._mesh.material=null,this._geometry.dispose(),this._geometry=null,this._material.dispose(),this._material=null}}var a=i(8525),o=i(185),l=i(8024);class h extends n.Tme{constructor(t,e,i){super(),this._stack=t,this._textureToFilter=i,this._contourWidth=1,this._contourOpacity=1,this._canvasWidth=0,this._canvasHeight=0,this._shadersFragment=l.Z,this._shadersVertex=o.Z,this._uniforms=a.Z.uniforms(),this._material=null,this._geometry=e,this._create()}_create(){this._prepareMaterial(),this._mesh=new n.Kj0(this._geometry,this._material),this._mesh.applyMatrix4(this._stack._ijk2LPS),this.add(this._mesh)}_prepareMaterial(){if(!this._material){this._uniforms.uWidth.value=this._contourWidth,this._uniforms.uOpacity.value=this._contourOpacity,this._uniforms.uCanvasWidth.value=this._canvasWidth,this._uniforms.uCanvasHeight.value=this._canvasHeight;let t=new l.Z(this._uniforms),e=new o.Z;this._material=new n.jyz({side:n.ehD,uniforms:this._uniforms,vertexShader:e.compute(),fragmentShader:t.compute(),transparent:!0})}}update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()}dispose(){null!==this._textureToFilter&&(this._textureToFilter.dispose(),this._textureToFilter=null),this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null}get geometry(){return this._geometry}set geometry(t){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null,this._geometry.dispose(),this._geometry=null),this._geometry=t,this._create()}get textureToFilter(){return this._textureToFilter}set textureToFilter(t){this._textureToFilter=t,this._uniforms.uTextureFilled.value=t,this._material.needsUpdate=!0}get contourOpacity(){return this._contourOpacity}set contourOpacity(t){this._contourOpacity=t,this._uniforms.uOpacity.value=this._contourOpacity}get contourWidth(){return this._contourWidth}set contourWidth(t){this._contourWidth=t,this._uniforms.uWidth.value=this._contourWidth}get canvasWidth(){return this._canvasWidth}set canvasWidth(t){this._canvasWidth=t,this._uniforms.uCanvasWidth.value=this._canvasWidth}get canvasHeight(){return this._canvasHeight}set canvasHeight(t){this._canvasHeight=t,this._uniforms.uCanvasHeight.value=this._canvasHeight}}var c=i(5191),u=i(4338),d=i(9928);class p extends n.Tme{constructor(t,e,i){super(),this._stack=t,this._referencePlane=i,this._plane1=null,this._color1=null,this._plane2=null,this._color2=null,this._plane3=null,this._color3=null,this._canvasWidth=0,this._canvasHeight=0,this._shadersFragment=d.Z,this._shadersVertex=u.Z,this._uniforms=c.Z.uniforms(),this._material=null,this._geometry=e,this._create()}_create(){this._prepareMaterial(),this._mesh=new n.Kj0(this._geometry,this._material),this._mesh.applyMatrix(this._stack._ijk2LPS),this.add(this._mesh)}_prepareMaterial(){if(!this._material){this._uniforms.uSlice.value=this._referencePlane,this._plane1&&(this._uniforms.uPlane1.value=this._plane1,this._uniforms.uPlaneColor1.value=this._color1),this._plane2&&(this._uniforms.uPlane2.value=this._plane2,this._uniforms.uPlaneColor2.value=this._color2),this._plane3&&(this._uniforms.uPlane3.value=this._plane3,this._uniforms.uPlaneColor3.value=this._color3),this._uniforms.uCanvasWidth.value=this._canvasWidth,this._uniforms.uCanvasHeight.value=this._canvasHeight;let t=new d.Z(this._uniforms),e=new u.Z;this._material=new n.jyz({side:n.ehD,uniforms:this._uniforms,vertexShader:e.compute(),fragmentShader:t.compute()}),this._material.transparent=!0}}update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()}dispose(){this._referencePlane=null,this._plane1=null,this._color1=null,this._plane2=null,this._color2=null,this._plane3=null,this._color3=null,this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null}get geometry(){return this._geometry}set geometry(t){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null,this._geometry.dispose(),this._geometry=null),this._geometry=t,this._create()}get referencePlane(){return this._referencePlane}set referencePlane(t){this._referencePlane=t,this._uniforms.uSlice.value=this._referencePlane}get plane1(){return this._plane1}set plane1(t){this._plane1=t,this._uniforms.uPlane1.value=this._plane1}get color1(){return this._color1}set color1(t){this._color1=t,this._uniforms.uPlaneColor1.value=this._color1}get plane2(){return this._plane2}set plane2(t){this._plane2=t,this._uniforms.uPlane2.value=this._plane2}get color2(){return this._color2}set color2(t){this._color2=t,this._uniforms.uPlaneColor2.value=this._color2}get plane3(){return this._plane3}set plane3(t){this._plane3=t,this._uniforms.uPlane3.value=this._plane3}get color3(){return this._color3}set color3(t){this._color3=t,this._uniforms.uPlaneColor3.value=this._color3}get canvasWidth(){return this._canvasWidth}set canvasWidth(t){this._canvasWidth=t,this._uniforms.uCanvasWidth.value=this._canvasWidth}get canvasHeight(){return this._canvasHeight}set canvasHeight(t){this._canvasHeight=t,this._uniforms.uCanvasHeight.value=this._canvasHeight}}var f=i(1798);class m extends n.Tme{constructor(t,e="default",i="linear",n=[[0,0,0,0],[1,1,1,1]],r=[[0,0],[1,1]],s=!1){super(),f.default.isString(t)?this._dom=document.getElementById(t):this._dom=t,this._discrete=s,this._color=n,this._lut=e,this._luts={[e]:n},this._opacity=r,this._lutO=i,this._lutsO={[i]:r},this.initCanvas(),this.paintCanvas()}initCanvas(){this._canvasContainer=this.initCanvasContainer(this._dom),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)}initCanvasContainer(t){let e=t;return e.style.border="1px solid #F9F9F9",e}createCanvas(){let t=document.createElement("canvas");return t.height=1,t.width=256,t.style.width="256px",t.style.height="16px",t}paintCanvas(){let t=this._canvas.getContext("2d");if(t.clearRect(0,0,this._canvas.width,this._canvas.height),t.globalCompositeOperation="source-over",this._discrete){t.lineWidth=2*this._canvas.height;for(let e=0;e<this._color.length;e++){let i=this._color[e][0],n=1;e<this._color.length-1&&(n=this._color[e+1][0]);let r=0;e>0&&(r=this._color[e-1][0]);let s=r+(i-r)/2,a=i+(n-i)/2,o=this._color[e],l=this._opacity[e]?this._opacity[e][1]:1;t.beginPath(),t.strokeStyle=`rgba( ${Math.round(255*o[1])}, ${Math.round(255*o[2])}, ${Math.round(255*o[3])}, ${l})`,t.moveTo(s*this._canvas.width,0),t.lineTo(a*this._canvas.width,0),t.stroke(),t.closePath()}}else{let e=t.createLinearGradient(0,0,this._canvas.width,0);for(let t=0;t<this._color.length;t++)e.addColorStop(this._color[t][0],`rgba( ${Math.round(255*this._color[t][1])}, ${Math.round(255*this._color[t][2])}, ${Math.round(255*this._color[t][3])}, 1)`);t.fillStyle=e,t.fillRect(0,0,this._canvas.width,this._canvas.height),t.globalCompositeOperation="destination-in";let i=t.createLinearGradient(0,0,this._canvas.width,0);for(let t=0;t<this._opacity.length;t++)i.addColorStop(this._opacity[t][0],"rgba(255, 255, 255, "+this._opacity[t][1]+")");t.fillStyle=i,t.fillRect(0,0,this._canvas.width,this._canvas.height)}}get texture(){let t=new n.xEZ(this._canvas);return t.mapping=n.xfE,t.wrapS=t.wrapT=n.uWy,t.magFilter=t.minFilter=n.TyD,t.premultiplyAlpha=!0,t.needsUpdate=!0,t}set lut(t){this._color=this._luts[t],this._lut=t,this.paintCanvas()}get lut(){return this._lut}set luts(t){this._luts=t}get luts(){return this._luts}set lutO(t){this._opacity=this._lutsO[t],this._lutO=t,this.paintCanvas()}get lutO(){return this._lutO}set lutsO(t){this._lutsO=t}get lutsO(){return this._lutsO}set discrete(t){this._discrete=t,this.paintCanvas()}get discrete(){return this._discrete}lutsAvailable(t="color"){let e=[],i=this._luts;"color"!==t&&(i=this._lutsO);for(let t in i)e.push(t);return e}static presetLuts(){return{default:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[.27,.18,.18,.18],[.41,1,1,1],[.7,1,0,0],[1,1,1,1]],muscle_bone:[[0,0,0,0],[.00392156862745098,.00784313725490196,0,0],[.00784313725490196,.0196078431372549,0,0],[.011764705882352941,.03137254901960784,0,0],[.01568627450980392,.0392156862745098,0,.00392156862745098],[.0196078431372549,.050980392156862744,.00392156862745098,.00392156862745098],[.023529411764705882,.06274509803921569,.00392156862745098,.00392156862745098],[.027450980392156862,.07058823529411765,.00392156862745098,.00784313725490196],[.03137254901960784,.08235294117647059,.00392156862745098,.00784313725490196],[.03529411764705882,.09411764705882353,.00784313725490196,.00784313725490196],[.0392156862745098,.10196078431372549,.00784313725490196,.00784313725490196],[.043137254901960784,.11372549019607843,.00784313725490196,.011764705882352941],[.047058823529411764,.12549019607843137,.00784313725490196,.011764705882352941],[.050980392156862744,.13333333333333333,.011764705882352941,.011764705882352941],[.054901960784313725,.1450980392156863,.011764705882352941,.01568627450980392],[.058823529411764705,.1568627450980392,.011764705882352941,.01568627450980392],[.06274509803921569,.16470588235294117,.011764705882352941,.01568627450980392],[.06666666666666667,.17647058823529413,.011764705882352941,.0196078431372549],[.07058823529411765,.18823529411764706,.01568627450980392,.0196078431372549],[.07450980392156863,.2,.01568627450980392,.0196078431372549],[.0784313725490196,.20784313725490197,.01568627450980392,.0196078431372549],[.08235294117647059,.2196078431372549,.01568627450980392,.023529411764705882],[.08627450980392157,.23137254901960785,.0196078431372549,.023529411764705882],[.09019607843137255,.23921568627450981,.0196078431372549,.023529411764705882],[.09411764705882353,.25098039215686274,.0196078431372549,.027450980392156862],[.09803921568627451,.2627450980392157,.0196078431372549,.027450980392156862],[.10196078431372549,.27058823529411763,.023529411764705882,.027450980392156862],[.10588235294117647,.2823529411764706,.023529411764705882,.027450980392156862],[.10980392156862745,.29411764705882354,.023529411764705882,.03137254901960784],[.11372549019607843,.30196078431372547,.023529411764705882,.03137254901960784],[.11764705882352941,.3137254901960784,.023529411764705882,.03137254901960784],[.12156862745098039,.3254901960784314,.027450980392156862,.03529411764705882],[.12549019607843137,.3333333333333333,.027450980392156862,.03529411764705882],[.12941176470588237,.34509803921568627,.027450980392156862,.03529411764705882],[.13333333333333333,.3568627450980392,.027450980392156862,.0392156862745098],[.13725490196078433,.36470588235294116,.03137254901960784,.0392156862745098],[.1411764705882353,.3764705882352941,.03137254901960784,.0392156862745098],[.1450980392156863,.38823529411764707,.03137254901960784,.0392156862745098],[.14901960784313725,.4,.03137254901960784,.043137254901960784],[.15294117647058825,.40784313725490196,.03529411764705882,.043137254901960784],[.1568627450980392,.4196078431372549,.03529411764705882,.043137254901960784],[.1607843137254902,.43137254901960786,.03529411764705882,.047058823529411764],[.16470588235294117,.4392156862745098,.03529411764705882,.047058823529411764],[.16862745098039217,.45098039215686275,.03529411764705882,.047058823529411764],[.17254901960784313,.4627450980392157,.0392156862745098,.047058823529411764],[.17647058823529413,.47058823529411764,.0392156862745098,.050980392156862744],[.1803921568627451,.4823529411764706,.0392156862745098,.050980392156862744],[.1843137254901961,.49411764705882355,.0392156862745098,.050980392156862744],[.18823529411764706,.5019607843137255,.043137254901960784,.054901960784313725],[.19215686274509805,.5137254901960784,.043137254901960784,.054901960784313725],[.19607843137254902,.5254901960784314,.043137254901960784,.054901960784313725],[.2,.5333333333333333,.043137254901960784,.058823529411764705],[.20392156862745098,.5450980392156862,.047058823529411764,.058823529411764705],[.20784313725490197,.5568627450980392,.047058823529411764,.058823529411764705],[.21176470588235294,.5647058823529412,.047058823529411764,.058823529411764705],[.21568627450980393,.5764705882352941,.047058823529411764,.06274509803921569],[.2196078431372549,.5882352941176471,.047058823529411764,.06274509803921569],[.2235294117647059,.6,.050980392156862744,.06274509803921569],[.22745098039215686,.6078431372549019,.050980392156862744,.06666666666666667],[.23137254901960785,.6196078431372549,.050980392156862744,.06666666666666667],[.23529411764705882,.6313725490196078,.050980392156862744,.06666666666666667],[.23921568627450981,.6392156862745098,.054901960784313725,.06666666666666667],[.24313725490196078,.6509803921568628,.054901960784313725,.07058823529411765],[.24705882352941178,.6627450980392157,.054901960784313725,.07058823529411765],[.25098039215686274,.6705882352941176,.054901960784313725,.07058823529411765],[.2549019607843137,.6823529411764706,.058823529411764705,.07450980392156863],[.25882352941176473,.6941176470588235,.058823529411764705,.07450980392156863],[.2627450980392157,.7019607843137254,.058823529411764705,.07450980392156863],[.26666666666666666,.7137254901960784,.058823529411764705,.0784313725490196],[.27058823529411763,.7254901960784313,.058823529411764705,.0784313725490196],[.27450980392156865,.7333333333333333,.06274509803921569,.0784313725490196],[.2784313725490196,.7450980392156863,.06274509803921569,.0784313725490196],[.2823529411764706,.7568627450980392,.06274509803921569,.08235294117647059],[.28627450980392155,.7647058823529411,.06274509803921569,.08235294117647059],[.2901960784313726,.7764705882352941,.06666666666666667,.08235294117647059],[.29411764705882354,.788235294117647,.06666666666666667,.08627450980392157],[.2980392156862745,.8,.06666666666666667,.08627450980392157],[.30196078431372547,.807843137254902,.06666666666666667,.08627450980392157],[.3058823529411765,.8196078431372549,.07058823529411765,.08627450980392157],[.30980392156862746,.8313725490196079,.07058823529411765,.09019607843137255],[.3137254901960784,.8392156862745098,.07058823529411765,.09019607843137255],[.3176470588235294,.8509803921568627,.07058823529411765,.09019607843137255],[.3215686274509804,.8627450980392157,.07058823529411765,.09411764705882353],[.3254901960784314,.8705882352941177,.07450980392156863,.09411764705882353],[.32941176470588235,.8823529411764706,.07450980392156863,.09411764705882353],[.3333333333333333,.8941176470588236,.07450980392156863,.09803921568627451],[.33725490196078434,.9019607843137255,.07450980392156863,.09803921568627451],[.3411764705882353,.9137254901960784,.0784313725490196,.09803921568627451],[.34509803921568627,.9254901960784314,.0784313725490196,.09803921568627451],[.34901960784313724,.9333333333333333,.0784313725490196,.10196078431372549],[.35294117647058826,.9450980392156862,.0784313725490196,.10196078431372549],[.3568627450980392,.9568627450980393,.08235294117647059,.10196078431372549],[.3607843137254902,.9647058823529412,.08235294117647059,.10588235294117647],[.36470588235294116,.9764705882352941,.08235294117647059,.10588235294117647],[.3686274509803922,.9882352941176471,.08235294117647059,.10588235294117647],[.37254901960784315,1,.08235294117647059,.10588235294117647],[.3764705882352941,1,.09411764705882353,.10588235294117647],[.3803921568627451,1,.10588235294117647,.10588235294117647],[.3843137254901961,1,.11764705882352941,.10196078431372549],[.38823529411764707,1,.12941176470588237,.10196078431372549],[.39215686274509803,1,.1411764705882353,.10196078431372549],[.396078431372549,1,.15294117647058825,.09803921568627451],[.4,1,.16470588235294117,.09803921568627451],[.403921568627451,1,.17647058823529413,.09803921568627451],[.40784313725490196,1,.18823529411764706,.09411764705882353],[.4117647058823529,1,.2,.09411764705882353],[.41568627450980394,1,.21176470588235294,.09411764705882353],[.4196078431372549,1,.2235294117647059,.09019607843137255],[.4235294117647059,1,.23529411764705882,.09019607843137255],[.42745098039215684,1,.24705882352941178,.08627450980392157],[.43137254901960786,1,.25882352941176473,.08627450980392157],[.43529411764705883,1,.27058823529411763,.08627450980392157],[.4392156862745098,1,.2823529411764706,.08235294117647059],[.44313725490196076,1,.29411764705882354,.08235294117647059],[.4470588235294118,1,.3058823529411765,.08235294117647059],[.45098039215686275,1,.3176470588235294,.0784313725490196],[.4549019607843137,1,.32941176470588235,.0784313725490196],[.4588235294117647,1,.3411764705882353,.0784313725490196],[.4627450980392157,1,.35294117647058826,.07450980392156863],[.4666666666666667,1,.36470588235294116,.07450980392156863],[.47058823529411764,1,.3764705882352941,.07450980392156863],[.4745098039215686,1,.38823529411764707,.07058823529411765],[.47843137254901963,1,.4,.07058823529411765],[.4823529411764706,1,.4117647058823529,.07058823529411765],[.48627450980392156,1,.4235294117647059,.06666666666666667],[.49019607843137253,1,.43529411764705883,.06666666666666667],[.49411764705882355,1,.4470588235294118,.06274509803921569],[.4980392156862745,1,.4588235294117647,.06274509803921569],[.5019607843137255,1,.47058823529411764,.06274509803921569],[.5058823529411764,1,.4823529411764706,.058823529411764705],[.5098039215686274,1,.49411764705882355,.058823529411764705],[.5137254901960784,1,.5058823529411764,.058823529411764705],[.5176470588235295,1,.5137254901960784,.054901960784313725],[.5215686274509804,1,.5254901960784314,.054901960784313725],[.5254901960784314,1,.5372549019607843,.054901960784313725],[.5294117647058824,1,.5490196078431373,.050980392156862744],[.5333333333333333,1,.5607843137254902,.050980392156862744],[.5372549019607843,1,.5725490196078431,.050980392156862744],[.5411764705882353,1,.5843137254901961,.047058823529411764],[.5450980392156862,1,.596078431372549,.047058823529411764],[.5490196078431373,1,.6078431372549019,.043137254901960784],[.5529411764705883,1,.6196078431372549,.043137254901960784],[.5568627450980392,1,.6313725490196078,.043137254901960784],[.5607843137254902,1,.6431372549019608,.0392156862745098],[.5647058823529412,1,.6549019607843137,.0392156862745098],[.5686274509803921,1,.6666666666666666,.0392156862745098],[.5725490196078431,1,.6784313725490196,.03529411764705882],[.5764705882352941,1,.6901960784313725,.03529411764705882],[.5803921568627451,1,.6941176470588235,.0392156862745098],[.5843137254901961,1,.7019607843137254,.0392156862745098],[.5882352941176471,1,.7058823529411765,.043137254901960784],[.592156862745098,1,.7098039215686275,.043137254901960784],[.596078431372549,1,.7137254901960784,.047058823529411764],[.6,1,.7176470588235294,.047058823529411764],[.6039215686274509,1,.7254901960784313,.050980392156862744],[.6078431372549019,1,.7294117647058823,.050980392156862744],[.611764705882353,1,.7333333333333333,.054901960784313725],[.615686274509804,1,.7372549019607844,.058823529411764705],[.6196078431372549,1,.7411764705882353,.058823529411764705],[.6235294117647059,1,.7490196078431373,.06274509803921569],[.6274509803921569,1,.7529411764705882,.06274509803921569],[.6313725490196078,1,.7568627450980392,.06666666666666667],[.6352941176470588,1,.7607843137254902,.06666666666666667],[.6392156862745098,1,.7647058823529411,.07058823529411765],[.6431372549019608,1,.7725490196078432,.07058823529411765],[.6470588235294118,1,.7764705882352941,.07450980392156863],[.6509803921568628,1,.7803921568627451,.07450980392156863],[.6549019607843137,1,.7843137254901961,.0784313725490196],[.6588235294117647,1,.788235294117647,.08235294117647059],[.6627450980392157,1,.796078431372549,.08235294117647059],[.6666666666666666,1,.8,.08627450980392157],[.6705882352941176,1,.803921568627451,.08627450980392157],[.6745098039215687,1,.807843137254902,.09019607843137255],[.6784313725490196,1,.8117647058823529,.09019607843137255],[.6823529411764706,1,.8196078431372549,.09411764705882353],[.6862745098039216,1,.8235294117647058,.09411764705882353],[.6901960784313725,1,.8274509803921568,.09803921568627451],[.6941176470588235,1,.8313725490196079,.10196078431372549],[.6980392156862745,1,.8352941176470589,.10196078431372549],[.7019607843137254,1,.8431372549019608,.10588235294117647],[.7058823529411765,1,.8470588235294118,.10588235294117647],[.7098039215686275,1,.8509803921568627,.10980392156862745],[.7137254901960784,1,.8549019607843137,.10980392156862745],[.7176470588235294,1,.8627450980392157,.11372549019607843],[.7215686274509804,1,.8666666666666667,.11372549019607843],[.7254901960784313,1,.8705882352941177,.11764705882352941],[.7294117647058823,1,.8745098039215686,.12156862745098039],[.7333333333333333,1,.8784313725490196,.12156862745098039],[.7372549019607844,1,.8862745098039215,.12549019607843137],[.7411764705882353,1,.8901960784313725,.12549019607843137],[.7450980392156863,1,.8941176470588236,.12941176470588237],[.7490196078431373,1,.8980392156862745,.12941176470588237],[.7529411764705882,1,.9019607843137255,.13333333333333333],[.7568627450980392,1,.9098039215686274,.13333333333333333],[.7607843137254902,1,.9137254901960784,.13725490196078433],[.7647058823529411,1,.9176470588235294,.1411764705882353],[.7686274509803922,1,.9215686274509803,.1411764705882353],[.7725490196078432,1,.9254901960784314,.1450980392156863],[.7764705882352941,1,.9333333333333333,.1450980392156863],[.7803921568627451,1,.9372549019607843,.14901960784313725],[.7843137254901961,1,.9411764705882353,.14901960784313725],[.788235294117647,1,.9450980392156862,.15294117647058825],[.792156862745098,1,.9450980392156862,.16862745098039217],[.796078431372549,1,.9490196078431372,.1843137254901961],[.8,1,.9490196078431372,.2],[.803921568627451,1,.9490196078431372,.21568627450980393],[.807843137254902,1,.9490196078431372,.22745098039215686],[.8117647058823529,1,.9529411764705882,.24313725490196078],[.8156862745098039,1,.9529411764705882,.25882352941176473],[.8196078431372549,1,.9529411764705882,.27450980392156865],[.8235294117647058,1,.9529411764705882,.2901960784313726],[.8274509803921568,1,.9568627450980393,.3058823529411765],[.8313725490196079,1,.9568627450980393,.3215686274509804],[.8352941176470589,1,.9568627450980393,.33725490196078434],[.8392156862745098,1,.9568627450980393,.35294117647058826],[.8431372549019608,1,.9607843137254902,.3686274509803922],[.8470588235294118,1,.9607843137254902,.3843137254901961],[.8509803921568627,1,.9607843137254902,.4],[.8549019607843137,1,.9607843137254902,.4117647058823529],[.8588235294117647,1,.9647058823529412,.42745098039215684],[.8627450980392157,1,.9647058823529412,.44313725490196076],[.8666666666666667,1,.9647058823529412,.4588235294117647],[.8705882352941177,1,.9647058823529412,.4745098039215686],[.8745098039215686,1,.9686274509803922,.49019607843137253],[.8784313725490196,1,.9686274509803922,.5058823529411764],[.8823529411764706,1,.9686274509803922,.5215686274509804],[.8862745098039215,1,.9686274509803922,.5372549019607843],[.8901960784313725,1,.9725490196078431,.5529411764705883],[.8941176470588236,1,.9725490196078431,.5686274509803921],[.8980392156862745,1,.9725490196078431,.5843137254901961],[.9019607843137255,1,.9725490196078431,.6],[.9058823529411765,1,.9725490196078431,.611764705882353],[.9098039215686274,1,.9764705882352941,.6274509803921569],[.9137254901960784,1,.9764705882352941,.6431372549019608],[.9176470588235294,1,.9764705882352941,.6588235294117647],[.9215686274509803,1,.9764705882352941,.6745098039215687],[.9254901960784314,1,.9803921568627451,.6901960784313725],[.9294117647058824,1,.9803921568627451,.7058823529411765],[.9333333333333333,1,.9803921568627451,.7215686274509804],[.9372549019607843,1,.9803921568627451,.7372549019607844],[.9411764705882353,1,.984313725490196,.7529411764705882],[.9450980392156862,1,.984313725490196,.7686274509803922],[.9490196078431372,1,.984313725490196,.7843137254901961],[.9529411764705882,1,.984313725490196,.8],[.9568627450980393,1,.9882352941176471,.8117647058823529],[.9607843137254902,1,.9882352941176471,.8274509803921568],[.9647058823529412,1,.9882352941176471,.8431372549019608],[.9686274509803922,1,.9882352941176471,.8588235294117647],[.9725490196078431,1,.9921568627450981,.8745098039215686],[.9764705882352941,1,.9921568627450981,.8901960784313725],[.9803921568627451,1,.9921568627450981,.9058823529411765],[.984313725490196,1,.9921568627450981,.9215686274509803],[.9882352941176471,1,.996078431372549,.9372549019607843],[.9921568627450981,1,.996078431372549,.9529411764705882],[.996078431372549,1,.996078431372549,.9686274509803922],[1,1,.996078431372549,.984313725490196]]}}static presetLutsO(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]],random:[[0,0],[.38,0],[.55,1],[.72,1],[1,.05]],linear_full:[[0,0],[.00392156862745098,.00392156862745098],[.00784313725490196,.00784313725490196],[.011764705882352941,.011764705882352941],[.01568627450980392,.01568627450980392],[.0196078431372549,.0196078431372549],[.023529411764705882,.023529411764705882],[.027450980392156862,.027450980392156862],[.03137254901960784,.03137254901960784],[.03529411764705882,.03529411764705882],[.0392156862745098,.0392156862745098],[.043137254901960784,.043137254901960784],[.047058823529411764,.047058823529411764],[.050980392156862744,.050980392156862744],[.054901960784313725,.054901960784313725],[.058823529411764705,.058823529411764705],[.06274509803921569,.06274509803921569],[.06666666666666667,.06666666666666667],[.07058823529411765,.07058823529411765],[.07450980392156863,.07450980392156863],[.0784313725490196,.0784313725490196],[.08235294117647059,.08235294117647059],[.08627450980392157,.08627450980392157],[.09019607843137255,.09019607843137255],[.09411764705882353,.09411764705882353],[.09803921568627451,.09803921568627451],[.10196078431372549,.10196078431372549],[.10588235294117647,.10588235294117647],[.10980392156862745,.10980392156862745],[.11372549019607843,.11372549019607843],[.11764705882352941,.11764705882352941],[.12156862745098039,.12156862745098039],[.12549019607843137,.12549019607843137],[.12941176470588237,.12941176470588237],[.13333333333333333,.13333333333333333],[.13725490196078433,.13725490196078433],[.1411764705882353,.1411764705882353],[.1450980392156863,.1450980392156863],[.14901960784313725,.14901960784313725],[.15294117647058825,.15294117647058825],[.1568627450980392,.1568627450980392],[.1607843137254902,.1607843137254902],[.16470588235294117,.16470588235294117],[.16862745098039217,.16862745098039217],[.17254901960784313,.17254901960784313],[.17647058823529413,.17647058823529413],[.1803921568627451,.1803921568627451],[.1843137254901961,.1843137254901961],[.18823529411764706,.18823529411764706],[.19215686274509805,.19215686274509805],[.19607843137254902,.19607843137254902],[.2,.2],[.20392156862745098,.20392156862745098],[.20784313725490197,.20784313725490197],[.21176470588235294,.21176470588235294],[.21568627450980393,.21568627450980393],[.2196078431372549,.2196078431372549],[.2235294117647059,.2235294117647059],[.22745098039215686,.22745098039215686],[.23137254901960785,.23137254901960785],[.23529411764705882,.23529411764705882],[.23921568627450981,.23921568627450981],[.24313725490196078,.24313725490196078],[.24705882352941178,.24705882352941178],[.25098039215686274,.25098039215686274],[.2549019607843137,.2549019607843137],[.25882352941176473,.25882352941176473],[.2627450980392157,.2627450980392157],[.26666666666666666,.26666666666666666],[.27058823529411763,.27058823529411763],[.27450980392156865,.27450980392156865],[.2784313725490196,.2784313725490196],[.2823529411764706,.2823529411764706],[.28627450980392155,.28627450980392155],[.2901960784313726,.2901960784313726],[.29411764705882354,.29411764705882354],[.2980392156862745,.2980392156862745],[.30196078431372547,.30196078431372547],[.3058823529411765,.3058823529411765],[.30980392156862746,.30980392156862746],[.3137254901960784,.3137254901960784],[.3176470588235294,.3176470588235294],[.3215686274509804,.3215686274509804],[.3254901960784314,.3254901960784314],[.32941176470588235,.32941176470588235],[.3333333333333333,.3333333333333333],[.33725490196078434,.33725490196078434],[.3411764705882353,.3411764705882353],[.34509803921568627,.34509803921568627],[.34901960784313724,.34901960784313724],[.35294117647058826,.35294117647058826],[.3568627450980392,.3568627450980392],[.3607843137254902,.3607843137254902],[.36470588235294116,.36470588235294116],[.3686274509803922,.3686274509803922],[.37254901960784315,.37254901960784315],[.3764705882352941,.3764705882352941],[.3803921568627451,.3803921568627451],[.3843137254901961,.3843137254901961],[.38823529411764707,.38823529411764707],[.39215686274509803,.39215686274509803],[.396078431372549,.396078431372549],[.4,.4],[.403921568627451,.403921568627451],[.40784313725490196,.40784313725490196],[.4117647058823529,.4117647058823529],[.41568627450980394,.41568627450980394],[.4196078431372549,.4196078431372549],[.4235294117647059,.4235294117647059],[.42745098039215684,.42745098039215684],[.43137254901960786,.43137254901960786],[.43529411764705883,.43529411764705883],[.4392156862745098,.4392156862745098],[.44313725490196076,.44313725490196076],[.4470588235294118,.4470588235294118],[.45098039215686275,.45098039215686275],[.4549019607843137,.4549019607843137],[.4588235294117647,.4588235294117647],[.4627450980392157,.4627450980392157],[.4666666666666667,.4666666666666667],[.47058823529411764,.47058823529411764],[.4745098039215686,.4745098039215686],[.47843137254901963,.47843137254901963],[.4823529411764706,.4823529411764706],[.48627450980392156,.48627450980392156],[.49019607843137253,.49019607843137253],[.49411764705882355,.49411764705882355],[.4980392156862745,.4980392156862745],[.5019607843137255,.5019607843137255],[.5058823529411764,.5058823529411764],[.5098039215686274,.5098039215686274],[.5137254901960784,.5137254901960784],[.5176470588235295,.5176470588235295],[.5215686274509804,.5215686274509804],[.5254901960784314,.5254901960784314],[.5294117647058824,.5294117647058824],[.5333333333333333,.5333333333333333],[.5372549019607843,.5372549019607843],[.5411764705882353,.5411764705882353],[.5450980392156862,.5450980392156862],[.5490196078431373,.5490196078431373],[.5529411764705883,.5529411764705883],[.5568627450980392,.5568627450980392],[.5607843137254902,.5607843137254902],[.5647058823529412,.5647058823529412],[.5686274509803921,.5686274509803921],[.5725490196078431,.5725490196078431],[.5764705882352941,.5764705882352941],[.5803921568627451,.5803921568627451],[.5843137254901961,.5843137254901961],[.5882352941176471,.5882352941176471],[.592156862745098,.592156862745098],[.596078431372549,.596078431372549],[.6,.6],[.6039215686274509,.6039215686274509],[.6078431372549019,.6078431372549019],[.611764705882353,.611764705882353],[.615686274509804,.615686274509804],[.6196078431372549,.6196078431372549],[.6235294117647059,.6235294117647059],[.6274509803921569,.6274509803921569],[.6313725490196078,.6313725490196078],[.6352941176470588,.6352941176470588],[.6392156862745098,.6392156862745098],[.6431372549019608,.6431372549019608],[.6470588235294118,.6470588235294118],[.6509803921568628,.6509803921568628],[.6549019607843137,.6549019607843137],[.6588235294117647,.6588235294117647],[.6627450980392157,.6627450980392157],[.6666666666666666,.6666666666666666],[.6705882352941176,.6705882352941176],[.6745098039215687,.6745098039215687],[.6784313725490196,.6784313725490196],[.6823529411764706,.6823529411764706],[.6862745098039216,.6862745098039216],[.6901960784313725,.6901960784313725],[.6941176470588235,.6941176470588235],[.6980392156862745,.6980392156862745],[.7019607843137254,.7019607843137254],[.7058823529411765,.7058823529411765],[.7098039215686275,.7098039215686275],[.7137254901960784,.7137254901960784],[.7176470588235294,.7176470588235294],[.7215686274509804,.7215686274509804],[.7254901960784313,.7254901960784313],[.7294117647058823,.7294117647058823],[.7333333333333333,.7333333333333333],[.7372549019607844,.7372549019607844],[.7411764705882353,.7411764705882353],[.7450980392156863,.7450980392156863],[.7490196078431373,.7490196078431373],[.7529411764705882,.7529411764705882],[.7568627450980392,.7568627450980392],[.7607843137254902,.7607843137254902],[.7647058823529411,.7647058823529411],[.7686274509803922,.7686274509803922],[.7725490196078432,.7725490196078432],[.7764705882352941,.7764705882352941],[.7803921568627451,.7803921568627451],[.7843137254901961,.7843137254901961],[.788235294117647,.788235294117647],[.792156862745098,.792156862745098],[.796078431372549,.796078431372549],[.8,.8],[.803921568627451,.803921568627451],[.807843137254902,.807843137254902],[.8117647058823529,.8117647058823529],[.8156862745098039,.8156862745098039],[.8196078431372549,.8196078431372549],[.8235294117647058,.8235294117647058],[.8274509803921568,.8274509803921568],[.8313725490196079,.8313725490196079],[.8352941176470589,.8352941176470589],[.8392156862745098,.8392156862745098],[.8431372549019608,.8431372549019608],[.8470588235294118,.8470588235294118],[.8509803921568627,.8509803921568627],[.8549019607843137,.8549019607843137],[.8588235294117647,.8588235294117647],[.8627450980392157,.8627450980392157],[.8666666666666667,.8666666666666667],[.8705882352941177,.8705882352941177],[.8745098039215686,.8745098039215686],[.8784313725490196,.8784313725490196],[.8823529411764706,.8823529411764706],[.8862745098039215,.8862745098039215],[.8901960784313725,.8901960784313725],[.8941176470588236,.8941176470588236],[.8980392156862745,.8980392156862745],[.9019607843137255,.9019607843137255],[.9058823529411765,.9058823529411765],[.9098039215686274,.9098039215686274],[.9137254901960784,.9137254901960784],[.9176470588235294,.9176470588235294],[.9215686274509803,.9215686274509803],[.9254901960784314,.9254901960784314],[.9294117647058824,.9294117647058824],[.9333333333333333,.9333333333333333],[.9372549019607843,.9372549019607843],[.9411764705882353,.9411764705882353],[.9450980392156862,.9450980392156862],[.9490196078431372,.9490196078431372],[.9529411764705882,.9529411764705882],[.9568627450980393,.9568627450980393],[.9607843137254902,.9607843137254902],[.9647058823529412,.9647058823529412],[.9686274509803922,.9686274509803922],[.9725490196078431,.9725490196078431],[.9764705882352941,.9764705882352941],[.9803921568627451,.9803921568627451],[.984313725490196,.984313725490196],[.9882352941176471,.9882352941176471],[.9921568627450981,.9921568627450981],[.996078431372549,.996078431372549],[1,1]]}}}let _={0:{color:[0,0,0],opacity:0,label:"background"},1:{color:[255,0,0],opacity:1,label:"white matter"}};class g{constructor(t,e=_){f.default.isString(t)?this._dom=document.getElementById(t):this._dom=t,this._segmentation=e,this.initCanvas(),this.paintCanvas()}initCanvas(){this._canvasContainer=this.initCanvasContainer(this._dom),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)}initCanvasContainer(t){let e=t;return e.style.width="256 px",e.style.height="128 px",e.style.border="1px solid #F9F9F9",e}createCanvas(){let t=document.createElement("canvas");return t.height=128,t.width=256,t}paintCanvas(){let t=this._canvas.getContext("2d");t.clearRect(0,0,this._canvas.width,this._canvas.height),t.globalCompositeOperation="source-over",t.lineWidth=1;for(let e in this._segmentation){let i=e%this._canvas.width,n=Math.floor(e/this._canvas.width),r=void 0!==this._segmentation[e].opacity?this._segmentation[e].opacity:1,s=this._segmentation[e].color;t.fillStyle=`rgba( ${Math.round(s[0])}, ${Math.round(s[1])}, ${Math.round(s[2])}, ${r})`,t.fillRect(i,n,1,1)}}get texture(){let t=new n.xEZ(this._canvas);return t.mapping=n.xfE,t.wrapS=t.wrapT=n.uWy,t.magFilter=t.minFilter=n.TyD,t.premultiplyAlpha=!0,t.needsUpdate=!0,t}set segmentation(t){this._segmentation=t,this.paintCanvas()}get segmentation(){return this._segmentation}}var y=i(7878);class v{constructor(t,e){t&&this._isFunction(t.emit)?(f.default.isString(e)?this._dom=document.getElementById(e):this._dom=e,f.default.isElement(this._dom)?(this._emitter=t,this.initContainerDom(),this.initEventListenner(),this.loaded=0,this.totalFile=0):console.error("please give the id of container dom or directly a dom instance")):console.error("please give the this._emitter instance")}_isFunction(t){return"[object Function]"===Object.prototype.toString.call(t)}initEventListenner(){const t=this;this._emitter.on("load-start",(function(e){const i=e.files.length;t.totalFile=i,t._domTotalFile.innerHTML=i})),this._emitter.on("fetch-start",(function(e){const i=document.createElement("li"),n=document.createElement("div");n.innerHTML="file: "+e.file,n.style.color="#ffffff",i.append(n),i.className="fetch-file",i.id="file-"+e.file,i.style.marginBottom="7px",i.style.border="1px solid #ffffff;",i.style.width="60%";const r=document.createElement("div");r.id="file-fetch-"+e.file,r.style.width="0%",i.append(r),t._domProcessList.append(i)})),this._emitter.on("fetch-progress",(function(t){const e="file-fetch-"+t.file,i=document.getElementById(e);i.style.width=t.loaded/t.total*100+"%",i.style.border="1px solid red"})),this._emitter.on("fetch-success",(function(t){const e=document.getElementById("file-"+t.file),i=document.createElement("div");i.id="file-result-"+t.file,i.innerHTML="fetch-success",i.style.color="#ffffff",e.append(i)})),this._emitter.on("fetch-error",(function(t){})),this._emitter.on("fetch-abort",(function(t){})),this._emitter.on("fetch-end",(function(t){})),this._emitter.on("fetch-timeout",(function(t){})),this._emitter.on("parse-start",(function(t){const e=document.getElementById("file-"+t.file),i=document.createElement("div");i.id="file-parse-"+t.file,i.style.width="0%",e.append(i)})),this._emitter.on("parsing",(function(t){const e="file-parse-"+t.file,i=document.getElementById(e);i.style.width=t.parsed/t.total*100+"%",i.style.border="1px solid yellow"})),this._emitter.on("parse-success",(function(e){t.loaded+=1,t._domCurrentFile.innerHTML=t.loaded,t._domCurrentProgress.style.width=t.loaded/t.totalFile*100+"%";const i=document.getElementById("file-"+e.file),n=document.createElement("div");n.id="file-result-"+e.file,n.innerHTML="parse-success",n.style.color="#ffffff",i.append(n)}))}initContainerDom(){const t=document.createElement("div");t.innerHTML='\n      <div id="ami-progress-bar-container" style="background-color: rgb(33, 33, 33); color: #ffffff;">\n      <div>\n      <label for="progress-bar" id="progress-label" style="width: 60%; border: 1px solid #ffffff; text-align: center;">\n      <span id="current-file-index">0</span>\n      <span id="total-file">0</span>\n      </label>\n      <div id="progress-bar" style="width: 60%; border: 1px solid #ffffff; text-align: center;">\n      <div id="current-progress" style="border: 1px solid red; width: 0%;"></div>\n      </div>\n      </div>\n      <ul id="process-list" style="list-style-type: none; padding: 0; overflow-y: auto;">\n      </ul>\n      </div>',this._dom.append(t),this._domCurrentFile=document.getElementById("current-file-index"),this._domTotalFile=document.getElementById("total-file"),this._domProcessList=document.getElementById("process-list"),this._domCurrentProgress=document.getElementById("current-progress")}}var x=i(332),b=i(3415),w=i(4140),M=i(9612);class S extends n.Tme{_createMaterial(t){let e=new this._shadersFragment(this._uniforms),i=new this._shadersVertex,r={uniforms:this._uniforms,vertexShader:i.compute(),fragmentShader:e.compute()},s=Object.assign(t,r);this._material=new n.jyz(s),this._material.needsUpdate=!0}_updateMaterial(){let t=new this._shadersFragment(this._uniforms),e=new this._shadersVertex;this._material.vertexShader=e.compute(),this._material.fragmentShader=t.compute(),this._material.needsUpdate=!0}_prepareTexture(){this._textures=[];for(let t=0;t<this._stack._rawData.length;t++){let e=new n.IEO(this._stack.rawData[t],this._stack.textureSize,this._stack.textureSize,this._stack.textureType,n.ywz,n.xfE,n.uWy,n.uWy,n.TyD,n.TyD);e.needsUpdate=!0,e.flipY=!0,this._textures.push(e)}}}class E extends S{constructor(t,e=0,i=new n.Pa4(0,0,0),r=new n.Pa4(0,0,1),s="IJK"){super(),this._stack=t,this._invert=this._stack.invert,this._lut="none",this._lutTexture=null,this._intensityAuto=!0,this._interpolation=1,this._index=e,this._windowWidth=null,this._windowCenter=null,this._opacity=1,this._rescaleSlope=null,this._rescaleIntercept=null,this._spacing=1,this._thickness=0,this._thicknessMethod=0,this._lowerThreshold=null,this._upperThreshold=null,this._canvasWidth=0,this._canvasHeight=0,this._borderColor=null,this._planePosition=i,this._planeDirection=r,this._aaBBspace=s,this._material=null,this._textures=[],this._shadersFragment=M.Z,this._shadersVertex=w.Z,this._uniforms=b.Z.uniforms(),this._geometry=null,this._mesh=null,this._visible=!0,this._init(),this._create()}get stack(){return this._stack}set stack(t){this._stack=t}get spacing(){return this._spacing}set spacing(t){this._spacing=t,this._uniforms.uSpacing.value=this._spacing}get thickness(){return this._thickness}set thickness(t){this._thickness=t,this._uniforms.uThickness.value=this._thickness}get thicknessMethod(){return this._thicknessMethod}set thicknessMethod(t){this._thicknessMethod=t,this._uniforms.uThicknessMethod.value=this._thicknessMethod}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=t,this.updateIntensitySettingsUniforms()}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t,this.updateIntensitySettingsUniforms()}get opacity(){return this._opacity}set opacity(t){this._opacity=t,this.updateIntensitySettingsUniforms()}get upperThreshold(){return this._upperThreshold}set upperThreshold(t){this._upperThreshold=t,this.updateIntensitySettingsUniforms()}get lowerThreshold(){return this._lowerThreshold}set lowerThreshold(t){this._lowerThreshold=t,this.updateIntensitySettingsUniforms()}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(t){this._rescaleSlope=t,this.updateIntensitySettingsUniforms()}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(t){this._rescaleIntercept=t,this.updateIntensitySettingsUniforms()}get invert(){return this._invert}set invert(t){this._invert=t,this.updateIntensitySettingsUniforms()}get lut(){return this._lut}set lut(t){this._lut=t}get lutTexture(){return this._lutTexture}set lutTexture(t){this._lutTexture=t,this.updateIntensitySettingsUniforms()}get intensityAuto(){return this._intensityAuto}set intensityAuto(t){this._intensityAuto=t,this.updateIntensitySettings(),this.updateIntensitySettingsUniforms()}get interpolation(){return this._interpolation}set interpolation(t){this._interpolation=t,this.updateIntensitySettingsUniforms(),this._updateMaterial()}get index(){return this._index}set index(t){this._index=t,this._update()}set planePosition(t){this._planePosition=t,this._update()}get planePosition(){return this._planePosition}set planeDirection(t){this._planeDirection=t,this._update()}get planeDirection(){return this._planeDirection}set halfDimensions(t){this._halfDimensions=t}get halfDimensions(){return this._halfDimensions}set center(t){this._center=t}get center(){return this._center}set aabbSpace(t){this._aaBBspace=t,this._init()}get aabbSpace(){return this._aaBBspace}set mesh(t){this._mesh=t}get mesh(){return this._mesh}set geometry(t){this._geometry=t}get geometry(){return this._geometry}set canvasWidth(t){this._canvasWidth=t,this._uniforms.uCanvasWidth.value=this._canvasWidth}get canvasWidth(){return this._canvasWidth}set canvasHeight(t){this._canvasHeight=t,this._uniforms.uCanvasHeight.value=this._canvasHeight}get canvasHeight(){return this._canvasHeight}set borderColor(t){this._borderColor=t,this._uniforms.uBorderColor.value=new n.Ilk(t)}get borderColor(){return this._borderColor}_init(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aaBBspace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center=new n.Pa4(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new n.yGw;else{let t=this._stack.AABBox();this._halfDimensions=t.clone().multiplyScalar(.5),this._center=this._stack.centerAABBox(),this._toAABB=this._stack.lps2AABB}}_create(){if(this._stack&&this._stack.prepared&&this._stack.packed){try{const t=(0,x.b)();this._geometry=new t(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB)}catch(t){return console.log(t),void console.log("invalid slice geometry - exiting...")}this._geometry.vertices&&(this._material||(this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uSpacing.value=this._spacing,this._uniforms.uThickness.value=this._thickness,this._uniforms.uThicknessMethod.value=this._thicknessMethod,this._prepareTexture(),this._uniforms.uTextureContainer.value=this._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._createMaterial({side:n.ehD})),this.updateIntensitySettings(),this.updateIntensitySettingsUniforms(),this._mesh=new n.Kj0(this._geometry,this._material),"IJK"===this._aaBBspace&&this._mesh.applyMatrix4(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh))}}updateIntensitySettings(){this._intensityAuto?(this.updateIntensitySetting("windowCenter"),this.updateIntensitySetting("windowWidth"),this.updateIntensitySetting("rescaleSlope"),this.updateIntensitySetting("rescaleIntercept")):(null===this._windowCenter&&(this._windowCenter=this._stack.windowCenter),null===this._windowWidth&&(this._windowWidth=this._stack.windowWidth),null===this._rescaleSlope&&(this._rescaleSlope=this._stack.rescaleSlope),null===this._rescaleIntercept&&(this._rescaleIntercept=this._stack.rescaleIntercept)),null===this._upperThreshold&&(this._upperThreshold=this._stack._minMax[1]),null===this._lowerThreshold&&(this._lowerThreshold=this._stack._minMax[0])}updateIntensitySettingsUniforms(){let t=0;this._stack._minMax[0]<0&&(t-=this._stack._minMax[0]),this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[t+this._windowCenter,this._windowWidth],this._uniforms.uOpacity.value=this._opacity,this._uniforms.uLowerUpperThreshold.value=[t+this._lowerThreshold,t+this._upperThreshold],this._uniforms.uInvert.value=!0===this._invert?1:0,this._uniforms.uInterpolation.value=this._interpolation,"none"===this._lut?this._uniforms.uLut.value=0:(this._uniforms.uLut.value=1,this._uniforms.uTextureLUT.value=this._lutTexture)}updateIntensitySetting(t){this._stack.frame[this._index]&&this._stack.frame[this._index][t]?this["_"+t]=this._stack.frame[this._index][t]:this["_"+t]=this._stack[t]}_update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()}dispose(){for(let t=0;t<this._textures.length;t++)this._textures[t].dispose(),this._textures[t]=null;this._textures=null,this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null}cartesianEquation(){if(!this._geometry||!this._geometry.vertices||this._geometry.vertices.length<3)return new n.Ltg;let t=this._geometry.vertices,e=this._stack.ijk2LPS,i=new n.Pa4(t[0].x,t[0].y,t[0].z).applyMatrix4(e),r=new n.Pa4(t[1].x,t[1].y,t[1].z).applyMatrix4(e),s=new n.Pa4(t[2].x,t[2].y,t[2].z).applyMatrix4(e),a=new n.Pa4,o=new n.Pa4,l=a.subVectors(s,r).cross(o.subVectors(i,r)).normalize();return new n.Ltg(l.x,l.y,l.z,-l.dot(i))}}class T extends n.Tme{constructor(t){super(),this._stack=t,this._bBox=null,this._slice=null,this._border=null,this._dummy=null,this._orientation=0,this._index=0,this._uniforms=null,this._autoWindowLevel=!1,this._outOfBounds=!1,this._orientationMaxIndex=0,this._orientationSpacing=0,this._canvasWidth=0,this._canvasHeight=0,this._borderColor=null,this._create()}get stack(){return this._stack}set stack(t){this._stack=t}get bbox(){return this._bBox}get slice(){return this._slice}get border(){return this._border}get index(){return this._index}set index(t){this._index=t,this._slice.index=t;let e=this._stack.halfDimensionsIJK;this._slice.planePosition=this._prepareSlicePosition(e,this._index),this._border.helpersSlice=this._slice,this._isIndexOutOfBounds()}set orientation(t){this._orientation=t,this._computeOrientationMaxIndex(),this._computeOrientationSpacing(),this._slice.spacing=Math.abs(this._orientationSpacing),this._slice.thickness=this._slice.spacing,this._slice.planeDirection=this._prepareDirection(this._orientation),this._border.helpersSlice=this._slice}get orientation(){return this._orientation}set outOfBounds(t){this._outOfBounds=t}get outOfBounds(){return this._outOfBounds}set orientationMaxIndex(t){this._orientationMaxIndex=t}get orientationMaxIndex(){return this._orientationMaxIndex}set orientationSpacing(t){this._orientationSpacing=t}get orientationSpacing(){return this._orientationSpacing}set canvasWidth(t){this._canvasWidth=t,this._slice.canvasWidth=this._canvasWidth}get canvasWidth(){return this._canvasWidth}set canvasHeight(t){this._canvasHeight=t,this._slice.canvasHeight=this._canvasHeight}get canvasHeight(){return this._canvasHeight}set borderColor(t){this._borderColor=t,this._border.color=t,this._slice.borderColor=this._borderColor}get borderColor(){return this._borderColor}_create(){this._stack?(this._prepareStack(),this._prepareBBox(),this._prepareSlice(),this._prepareBorder()):console.log("no stack to be prepared...")}_computeOrientationSpacing(){let t=this._stack._spacing;switch(this._orientation){case 0:this._orientationSpacing=t.z;break;case 1:this._orientationSpacing=t.x;break;case 2:this._orientationSpacing=t.y;break;default:this._orientationSpacing=0}}_computeOrientationMaxIndex(){let t=this._stack.dimensionsIJK;switch(this._orientationMaxIndex=0,this._orientation){case 0:this._orientationMaxIndex=t.z-1;break;case 1:this._orientationMaxIndex=t.x-1;break;case 2:this._orientationMaxIndex=t.y-1}}_isIndexOutOfBounds(){this._computeOrientationMaxIndex(),this._index>=this._orientationMaxIndex||this._index<0?this._outOfBounds=!0:this._outOfBounds=!1}_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}_prepareBBox(){const t=s();this._bBox=new t(this._stack),this.add(this._bBox)}_prepareBorder(){const t=r();this._border=new t(this._slice),this.add(this._border)}_prepareSlice(){let t=this._stack.halfDimensionsIJK;this._index=this._prepareSliceIndex(t);let e=this._prepareSlicePosition(t,this._index),i=this._prepareDirection(this._orientation);const n=E();this._slice=new n(this._stack,this._index,e,i),this.add(this._slice)}_prepareSliceIndex(t){let e=0;switch(this._orientation){case 0:e=Math.floor(t.z);break;case 1:e=Math.floor(t.x);break;case 2:e=Math.floor(t.y)}return e}_prepareSlicePosition(t,e){let i=new n.Pa4(0,0,0);switch(this._orientation){case 0:i=new n.Pa4(Math.floor(t.x),Math.floor(t.y),e);break;case 1:i=new n.Pa4(e,Math.floor(t.y),Math.floor(t.z));break;case 2:i=new n.Pa4(Math.floor(t.x),e,Math.floor(t.z))}return i}_prepareDirection(t){let e=new n.Pa4(0,0,1);switch(t){case 0:e=new n.Pa4(0,0,1);break;case 1:e=new n.Pa4(1,0,0);break;case 2:e=new n.Pa4(0,1,0)}return e}dispose(){this.remove(this._slice),this._slice.dispose(),this._slice=null,this._bBox.dispose(),this._bBox=null,this._border.dispose(),this._border=null}}var A=i(6574),P=i(4079),C=i(5680);class L extends S{constructor(t){super(),this._stack=t,this._textures=[],this._shadersFragment=C.Z,this._shadersVertex=P.Z,this._uniforms=A.Z.uniforms(),this._material=null,this._geometry=null,this._mesh=null,this._algorithm=0,this._alphaCorrection=.5,this._interpolation=1,this._shading=1,this._shininess=10,this._steps=256,this._offset=0,this._windowCenter=0,this._windowWidth=1,this._create()}_create(){this._prepareStack(),this._prepareTexture(),this._prepareMaterial(),this._prepareGeometry(),this._mesh=new n.Kj0(this._geometry,this._material),this.add(this._mesh)}_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack(),this._offset=Math.min(0,this._stack._minMax[0]),this._windowCenter=this._stack.windowCenter,this._windowWidth=.8*this._stack.windowWidth}_prepareMaterial(){this._uniforms=A.Z.uniforms(),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._textures,this._stack.textureUnits>8&&(this._uniforms.uTextureContainer.length=14),this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[this._windowCenter-this._offset,this._windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uAlphaCorrection.value=this._alphaCorrection,this._uniforms.uInterpolation.value=this._interpolation,this._uniforms.uShading.value=this._shading,this._uniforms.uShininess.value=this._shininess,this._uniforms.uSteps.value=this._steps,this._uniforms.uAlgorithm.value=this._algorithm,this._createMaterial({side:n._Li,transparent:!0})}_prepareGeometry(){let t=this._stack.worldBoundingBox(),e=this._stack.worldCenter();this._geometry=new n.DvJ(t[1]-t[0],t[3]-t[2],t[5]-t[4]),this._geometry.applyMatrix4((new n.yGw).makeTranslation(e.x,e.y,e.z))}get uniforms(){return this._uniforms}set uniforms(t){this._uniforms=t}set mesh(t){this._mesh=t}get mesh(){return this._mesh}get stack(){return this._stack}set stack(t){this._stack=t}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t,this._uniforms.uWindowCenterWidth.value[0]=this._windowCenter-this._offset}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=Math.max(1,t),this._uniforms.uWindowCenterWidth.value[1]=this._windowWidth}get steps(){return this._steps}set steps(t){this._steps=t,this._uniforms.uSteps.value=this._steps}get alphaCorrection(){return this._alphaCorrection}set alphaCorrection(t){this._alphaCorrection=t,this._uniforms.uAlphaCorrection.value=this._alphaCorrection}get interpolation(){return this._interpolation}set interpolation(t){this._interpolation=t,this._uniforms.uInterpolation.value=this._interpolation,this._updateMaterial()}get shading(){return this._shading}set shading(t){this._shading=t,this._uniforms.uShading.value=this._shading}get shininess(){return this._shininess}set shininess(t){this._shininess=t,this._uniforms.uShininess.value=this._shininess}get algorithm(){return this._algorithm}set algorithm(t){this._algorithm=t,this._uniforms.uAlgorithm.value=this._algorithm}dispose(){for(let t=0;t<this._textures.length;t++)this._textures[t].dispose(),this._textures[t]=null;this._textures=null,this._shadersFragment=null,this._shadersVertex=null,this._uniforms.uTextureContainer=null,this._uniforms.uTextureLUT=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null}}},7878:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{constructor(t){this._container=t,this._modes={load:{name:"load",color:"#FFF56F"},parse:{name:"parse",color:"#2196F3"}},this.requestAnimationFrameID=null,this._mode=null,this._value=null,this._total=null,this._totalFiles=null,this.init()}free(){let t=this._container.getElementsByClassName("progress container");t.length>0&&t[0].parentNode.removeChild(t[0]),t=null,cancelAnimationFrame(this.requestAnimationFrameID)}init(){let t=this._domContainer();for(let e in this._modes)if(this._modes.hasOwnProperty(e)){let i=this._domBar(this._modes[e]);t.appendChild(i),i=null}this._container.appendChild(t),t=null,this.updateUI()}update(t,e,i,n=""){this._mode=i,this._value=t,0===e?(this._total=t,this._value=Math.random()*t):this._total=e}updateUI(){if(this.requestAnimationFrameID=requestAnimationFrame((()=>{this.updateUI()})),!(this._modes.hasOwnProperty(this._mode)&&this._modes[this._mode].hasOwnProperty("name")&&this._modes[this._mode].hasOwnProperty("color")))return!1;const t=Math.round(this._value/this._total*100),e=this._modes[this._mode].color;let i=this._container.getElementsByClassName("progress "+this._modes[this._mode].name);i.length>0&&(i[0].style.borderColor=e,i[0].style.width=t+"%"),i=null}_domContainer(){let t=document.createElement("div");return t.classList.add("progress"),t.classList.add("container"),t.style.width="100%",t.style.height="8px",t.style.position="absolute",t.style.backgroundColor="rgba(158, 158, 158, 0.5)",t.style.top="0",t.style.zIndex="1",t}_domBar(t){if(!t.hasOwnProperty("name")||!t.hasOwnProperty("color"))return console.log("Invalid mode provided."),console.log(t),!1;let e=document.createElement("div");return e.classList.add(t.name),e.classList.add("progress"),e.style.border="2px solid "+t.color,e.style.width="0%",e}set totalFiles(t){this._totalFiles=t}get totalFiles(){return this._totalFiles}}},2587:(t,e,i)=>{"use strict";i.r(e),i.d(e,{VolumeLoader:()=>v});var n=i(7878),r=i(7187),s=i.n(r);class a extends(s()){constructor(t=null,e=n.Z){super(),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._data=[],this._container=t,this._progressBar=null,this._container&&e&&(this._progressBar=new e(this._container))}free(){this._data=[],this._container=null,this._progressBar&&(this._progressBar.free(),this._progressBar=null)}fetch(t,e){return new Promise(((i,n)=>{const r=new XMLHttpRequest;r.open("GET",t),r.crossOrigin=!0,r.responseType="arraybuffer",r.onloadstart=e=>{this.emit("fetch-start",{file:t,time:new Date})},r.onload=e=>{if(200===r.status||0===r.status){this._loaded=e.loaded,this._totalLoaded=e.total,this._progressBar&&this._progressBar.update(this._loaded,this._totalLoaded,"load",t);let n=r.response,s={url:t,buffer:n};this.emit("fetch-success",{file:t,time:new Date,totalLoaded:e.total}),i(s)}else n(r.statusText)},r.onerror=()=>{this.emit("fetch-error",{file:t,time:new Date}),n(r.statusText)},r.onabort=e=>{this.emit("fetch-abort",{file:t,time:new Date}),n(r.statusText||"Aborted")},r.ontimeout=()=>{this.emit("fetch-timeout",{file:t,time:new Date}),n(r.statusText)},r.onprogress=e=>{this._loaded=e.loaded,this._totalLoaded=e.total,this.emit("fetch-progress",{file:t,total:e.total,loaded:e.loaded,time:new Date}),this._progressBar&&this._progressBar.update(this._loaded,this._totalLoaded,"load",t)},r.onloadend=e=>{this.emit("fetch-end",{file:t,time:new Date})},e instanceof Map&&e.set(t,r),r.send()}))}parse(t){return new Promise(((e,i)=>{e(t)}))}loadSequenceGroup(t,e){const i=[];return t.forEach((t=>{i.push(this.fetch(t,e))})),Promise.all(i).then((t=>this.parse(t))).then((t=>(this._data.push(t),t))).catch((function(t){"Aborted"!==t&&(console.log("oops... something went wrong..."),console.log(t))}))}loadSequence(t,e){return this.fetch(t,e).then((t=>this.parse(t))).then((t=>(this._data.push(t),t))).catch((function(t){"Aborted"!==t&&(console.log("oops... something went wrong..."),console.log(t))}))}load(t,e){Array.isArray(t)||(t=[t]),this._progressBar&&(this._progressBar.totalFiles=t.length,this._progressBar.requests=e),this.emit("load-start",{files:t,time:new Date});const i=[];return t.forEach((t=>{Array.isArray(t)?i.push(this.loadSequenceGroup(t,e)):i.push(this.loadSequence(t,e))})),Promise.all(i)}set data(t){this._data=t}get data(){return this._data}}var o=i(1798),l=i(7415),h=i(4011),c=i(1382),u=i(2793),d=i(7368),p=i(7802);class f extends d.Z{constructor(t,e){super(),this._id=e,this._url=t.url,this._header={},this._buffer=null;try{(new TextDecoder).decode(t.mhdBuffer).split("\n").forEach((t=>{let e=t.split("=");2===e.length&&(this._header[e[0].trim()]=e[1].trim())})),this._header.DimSize=this._header.DimSize.split(" "),this._header.ElementSpacing=this._header.ElementSpacing.split(" "),this._header.TransformMatrix=this._header.TransformMatrix.split(" "),this._header.Offset=this._header.Offset.split(" "),this._buffer=t.rawBuffer}catch(t){console.log("ooops... :(")}}rightHanded(){let t=this._header.AnatomicalOrientation;return this._rightHanded="RAS"===t||"RPI"===t||"LPS"===t||"LAI"===t,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return parseInt(this._header.DimSize[2],10)}sopInstanceUID(t=0){return t}rows(t=0){return parseInt(this._header.DimSize[1],10)}columns(t=0){return parseInt(this._header.DimSize[0],10)}pixelType(t=0){let e=0;return"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(e=1),e}bitsAllocated(t=0){let e=1;return"MET_UCHAR"===this._header.ElementType||"MET_CHAR"===this._header.ElementType?e=8:"MET_USHORT"===this._header.ElementType||"MET_SHORT"===this._header.ElementType?e=16:"MET_UINT"!==this._header.ElementType&&"MET_INT"!==this._header.ElementType&&"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(e=32),e}pixelSpacing(t=0){return[parseFloat(this._header.ElementSpacing[1],10),parseFloat(this._header.ElementSpacing[0],10),parseFloat(this._header.ElementSpacing[2],10)]}imageOrientation(t=0){let e=this._header.AnatomicalOrientation.match(/L/)?-1:1,i=this._header.AnatomicalOrientation.match(/P/)?-1:1,n=new p.P(parseFloat(this._header.TransformMatrix[0])*e,parseFloat(this._header.TransformMatrix[1])*i,parseFloat(this._header.TransformMatrix[2]));n.normalize();let r=new p.P(parseFloat(this._header.TransformMatrix[3])*e,parseFloat(this._header.TransformMatrix[4])*i,parseFloat(this._header.TransformMatrix[5]));return r.normalize(),[n.x,n.y,n.z,r.x,r.y,r.z]}imagePosition(t=0){return[parseFloat(this._header.Offset[0]),parseFloat(this._header.Offset[1]),parseFloat(this._header.Offset[2])]}extractPixelData(t=0){return this._decompressUncompressed(t)}_decompressUncompressed(t=0){let e=this._buffer,i=this.numberOfChannels(),n=this.rows(t)*this.columns(t)*i;this.rightHanded()||(t=this.numberOfFrames()-1-t);let r=t*n;return"MET_CHAR"===this._header.ElementType?new Int8Array(e,r,n):"MET_UCHAR"===this._header.ElementType?new Uint8Array(e,r,n):"MET_SHORT"===this._header.ElementType?(r*=2,new Int16Array(e,r,n)):"MET_USHORT"===this._header.ElementType?(r*=2,new Uint16Array(e,r,n)):"MET_INT"===this._header.ElementType?(r*=4,new Int32Array(e,r,n)):"MET_UINT"===this._header.ElementType?(r*=4,new Uint32Array(e,r,n)):"MET_FLOAT"===this._header.ElementType?(r*=4,new Float32Array(e,r,n)):void 0}}var m=i(9813),_=i(9286),g=i(4656);const y=i(9591);class v extends a{parse(t){return this.emit("parse-start",{file:t.url,time:new Date}),this._progressBar&&this._progressBar.update(0,100,"parse",t.url),new Promise(((e,i)=>{setTimeout((()=>{e(new Promise(((e,i)=>{let n=t;if(Array.isArray(n)||(n=[n]),n.forEach((t=>{this._preprocess(t)})),1===n.length)n=n[0];else{let t=n.filter(this._filterByExtension.bind(null,"MHD")),e=n.filter(this._filterByExtension.bind(null,"RAW"));2===n.length&&1===t.length&&1===e.length&&(n.url=t[0].url,n.extension=t[0].extension,n.mhdBuffer=t[0].buffer,n.rawBuffer=e[0].buffer)}let r=this._parser(n.extension);r||(this.emit("parse-error",{file:t.url,time:new Date,error:n.filename+"can not be parsed."}),i(n.filename+" can not be parsed."));let s=null;try{s=new r(n,0)}catch(e){console.warn(e),this.emit("parse-error",{file:t.url,time:new Date,error:e}),i(e)}let a=new l.Z;a.rawHeader=s.rawHeader(),a.seriesInstanceUID=s.seriesInstanceUID(),a.transferSyntaxUID=s.transferSyntaxUID(),a.seriesDate=s.seriesDate(),a.seriesDescription=s.seriesDescription(),a.studyDate=s.studyDate(),a.studyDescription=s.studyDescription(),a.numberOfFrames=s.numberOfFrames(),a.numberOfFrames||(a.numberOfFrames=1),a.numberOfChannels=s.numberOfChannels(),a.modality=s.modality(),"SEG"===a.modality&&(a.segmentationType=s.segmentationType(),a.segmentationSegments=s.segmentationSegments()),a.patientID=s.patientID(),a.patientName=s.patientName(),a.patientAge=s.patientAge(),a.patientBirthdate=s.patientBirthdate(),a.patientSex=s.patientSex();let o=new h.Z;o.numberOfChannels=s.numberOfChannels(),o.pixelRepresentation=s.pixelRepresentation(),o.pixelType=s.pixelType(),o.invert=s.invert(),o.spacingBetweenSlices=s.spacingBetweenSlices(),o.modality=a.modality,"SEG"===o.modality&&(o.segmentationType=a.segmentationType,o.segmentationSegments=a.segmentationSegments),a.stack.push(o),setTimeout(this.parseFrameClosure(a,o,t.url,0,s,e,i),0)})))}),10)}))}parseFrameClosure(t,e,i,n,r,s,a){return()=>{this.parseFrame(t,e,i,n,r,s,a)}}parseFrame(t,e,i,n,r,s,a){let o=new c.Z;o.sopInstanceUID=r.sopInstanceUID(n),o.url=i,o.index=n,o.invert=e.invert,o.frameTime=r.frameTime(n),o.ultrasoundRegions=r.ultrasoundRegions(n),o.rows=r.rows(n),o.columns=r.columns(n),o.numberOfChannels=e.numberOfChannels,o.pixelPaddingValue=r.pixelPaddingValue(n),o.pixelRepresentation=e.pixelRepresentation,o.pixelType=e.pixelType,o.pixelData=r.extractPixelData(n),o.pixelSpacing=r.pixelSpacing(n),o.spacingBetweenSlices=r.spacingBetweenSlices(n),o.sliceThickness=r.sliceThickness(n),o.imageOrientation=r.imageOrientation(n),o.rightHanded=r.rightHanded(),e.rightHanded=o.rightHanded,null===o.imageOrientation&&(o.imageOrientation=[1,0,0,0,1,0]),o.imagePosition=r.imagePosition(n),o.dimensionIndexValues=r.dimensionIndexValues(n),o.bitsAllocated=r.bitsAllocated(n),o.instanceNumber=r.instanceNumber(n),o.windowCenter=r.windowCenter(n),o.windowWidth=r.windowWidth(n),o.rescaleSlope=r.rescaleSlope(n),o.rescaleIntercept=r.rescaleIntercept(n),o.minMax=r.minMaxPixelData(o.pixelData),"SEG"===t.modality&&(o.referencedSegmentNumber=r.referencedSegmentNumber(n)),e.frame.push(o),this._parsed=n+1,this._totalParsed=t.numberOfFrames,this._progressBar&&this._progressBar.update(this._parsed,this._totalParsed,"parse",i),this.emit("parsing",{file:i,total:this._totalParsed,parsed:this._parsed,time:new Date}),this._parsed===this._totalParsed?(this.emit("parse-success",{file:i,total:this._totalParsed,parsed:this._parsed,time:new Date}),s(t)):setTimeout(this.parseFrameClosure(t,e,i,this._parsed,r,s,a),0)}_parser(t){let e=null;switch(t.toUpperCase()){case"NII":case"NII_":e=m.Z;break;case"DCM":case"DIC":case"DICOM":case"IMA":case"":e=u.Z;break;case"MHD":e=f;break;case"NRRD":e=_.Z;break;case"MGH":case"MGZ":e=g.Z;break;default:return console.warn("unsupported extension: "+t),!1}return e}_preprocess(t){const e=o.default.parseUrl(t.url);if(t.filename=e.filename,t.extension=e.extension,t.pathname=e.pathname,t.query=e.query,"gz"===t.extension?(t.gzcompressed=!0,t.extension=t.filename.split(".gz").shift().split(".").pop()):"mgz"===t.extension?(t.gzcompressed=!0,t.extension="mgh"):"zraw"===t.extension?(t.gzcompressed=!0,t.extension="raw"):t.gzcompressed=!1,t.gzcompressed){let e=y.inflate(t.buffer);t.buffer=e.buffer}}_filterByExtension(t,e){return e.extension.toUpperCase()===t.toUpperCase()}}},7290:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{constructor(){this._id=-1}mergeModels(t,e){if(!this._validateModelArray(t)||!this._validateModelArray(e))return console.log("invalid inputs provided."),!1;for(let i=0,n=e.length;i<n;i++)for(let n=0,r=t.length;n<r&&!t[n].merge(e[i]);n++)n===t.length-1&&t.push(e[i]);return!0}merge(t){return!!this.validate(t)&&this._id===t._id}validate(t){return!(!t||null===t||"function"!=typeof t.merge)}_validateModelArray(t){if(null===t||Array!==t.constructor)return console.log("invalid model array provided."),!1;for(let e=0;e<t.length;e++)if(!t[e]||null===t[e]||"function"!=typeof t[e].validate||!t[e].validate(t[e]))return!1;return!0}}},1382:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var n=i(7290),r=i(7802);class s extends n.Z{constructor(){super(),this._sopInstanceUID=null,this._url=null,this._stackID=-1,this._invert=!1,this._frameTime=null,this._ultrasoundRegions=[],this._rows=0,this._columns=0,this._dimensionIndexValues=[],this._imagePosition=null,this._imageOrientation=null,this._rightHanded=!0,this._sliceThickness=1,this._spacingBetweenSlices=null,this._pixelPaddingValue=null,this._pixelRepresentation=0,this._pixelType=0,this._pixelSpacing=null,this._pixelAspectRatio=null,this._pixelData=null,this._instanceNumber=null,this._windowCenter=null,this._windowWidth=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._bitsAllocated=8,this._numberOfChannels=1,this._minMax=null,this._dist=null,this._index=-1,this._referencedSegmentNumber=-1}validate(t){return!!(super.validate(t)&&"function"==typeof t.cosines&&"function"==typeof t.spacingXY&&t.hasOwnProperty("_sopInstanceUID")&&t.hasOwnProperty("_dimensionIndexValues")&&t.hasOwnProperty("_imageOrientation")&&t.hasOwnProperty("_imagePosition"))}merge(t){return!!this.validate(t)&&!!(this._compareArrays(this._dimensionIndexValues,t.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,t.imageOrientation)&&this._compareArrays(this._imagePosition,t.imagePosition)&&this._instanceNumber===t.instanceNumber&&this._sopInstanceUID===t.sopInstanceUID)}cosines(){let t=[new r.P(1,0,0),new r.P(0,1,0),new r.P(0,0,1)];if(this._imageOrientation&&6===this._imageOrientation.length){let e=new r.P(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),i=new r.P(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]);e.length()>0&&i.length()>0&&(t[0]=e,t[1]=i,t[2]=new r.P(0,0,0).crossVectors(t[0],t[1]).normalize())}else console.log("No valid image orientation for frame"),console.log(this),console.log("Returning default orientation.");return this._rightHanded||t[2].negate(),t}spacingXY(){let t=[1,1];return this.pixelSpacing?(t[0]=this.pixelSpacing[0],t[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(t[0]=1,t[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),t}getPixelData(t,e){return t>=0&&t<this._columns&&e>=0&&e<this._rows?this.pixelData[t+this._columns*e]:null}setPixelData(t,e,i){this.pixelData[t+this._columns*e]=i}getImageDataUrl(){const t=document.createElement("canvas");t.width=this._columns,t.height=this._rows;const e=t.getContext("2d"),i=e.createImageData(t.width,t.height);return i.data.set(this._frameToCanvas()),e.putImageData(i,0,0),t.toDataURL()}_frameToCanvas(){const t=this._columns*this._rows,e={invert:this._invert,min:this._minMax[0],padding:this._pixelPaddingValue};let i=new Uint8Array(4*t);if(null!==e.padding){e.min=this._minMax[1];for(let t=0,i=this._pixelData.length;t<i;t++)this._pixelData[t]!==e.padding&&(e.min=Math.min(e.min,this._pixelData[t]))}if(this._windowWidth&&null!==this._windowCenter){const t=this._rescaleIntercept||0,i=this._rescaleSlope||1;e.min=Math.max((this._windowCenter-this._windowWidth/2-t)/i,e.min),e.max=Math.min((this._windowCenter+this._windowWidth/2-t)/i,this._minMax[1])}else e.max=this._minMax[1];if(e.range=e.max-e.min||255,1===this._numberOfChannels)for(let n=0;n<t;n++){const t=this._pixelTo8Bit(this._pixelData[n],e);i[4*n]=t,i[4*n+1]=t,i[4*n+2]=t,i[4*n+3]=255}else if(3===this._numberOfChannels)for(let n=0;n<t;n++)i[4*n]=this._pixelTo8Bit(this._pixelData[3*n],e),i[4*n+1]=this._pixelTo8Bit(this._pixelData[3*n+1],e),i[4*n+2]=this._pixelTo8Bit(this._pixelData[3*n+2],e),i[4*n+3]=255;return i}_pixelTo8Bit(t,e){let i=t<=e.min||t===e.padding?0:255;return t>e.min&&t<e.max&&(i=Math.round(255*(t-e.min)/e.range)),Number.isNaN(i)?0:e.invert?255-i:i}_compareArrays(t,e){return t===e||!(!t||!e||t.join()!==e.join())}get frameTime(){return this._frameTime}set frameTime(t){this._frameTime=t}get ultrasoundRegions(){return this._ultrasoundRegions}set ultrasoundRegions(t){this._ultrasoundRegions=t}get rows(){return this._rows}set rows(t){this._rows=t}get columns(){return this._columns}set columns(t){this._columns=t}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(t){this._spacingBetweenSlices=t}get sliceThickness(){return this._sliceThickness}set sliceThickness(t){this._sliceThickness=t}get imagePosition(){return this._imagePosition}set imagePosition(t){this._imagePosition=t}get imageOrientation(){return this._imageOrientation}set imageOrientation(t){this._imageOrientation=t}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=t}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(t){this._rescaleSlope=t}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(t){this._rescaleIntercept=t}get bitsAllocated(){return this._bitsAllocated}set bitsAllocated(t){this._bitsAllocated=t}get dist(){return this._dist}set dist(t){this._dist=t}get pixelSpacing(){return this._pixelSpacing}set pixelSpacing(t){this._pixelSpacing=t}get pixelAspectRatio(){return this._pixelAspectRatio}set pixelAspectRatio(t){this._pixelAspectRatio=t}get minMax(){return this._minMax}set minMax(t){this._minMax=t}get dimensionIndexValues(){return this._dimensionIndexValues}set dimensionIndexValues(t){this._dimensionIndexValues=t}get instanceNumber(){return this._instanceNumber}set instanceNumber(t){this._instanceNumber=t}get pixelData(){return this._pixelData}set pixelData(t){this._pixelData=t}set sopInstanceUID(t){this._sopInstanceUID=t}get sopInstanceUID(){return this._sopInstanceUID}get pixelPaddingValue(){return this._pixelPaddingValue}set pixelPaddingValue(t){this._pixelPaddingValue=t}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(t){this._pixelRepresentation=t}get pixelType(){return this._pixelType}set pixelType(t){this._pixelType=t}get url(){return this._url}set url(t){this._url=t}get referencedSegmentNumber(){return this._referencedSegmentNumber}set referencedSegmentNumber(t){this._referencedSegmentNumber=t}get rightHanded(){return this._rightHanded}set rightHanded(t){this._rightHanded=t}get index(){return this._index}set index(t){this._index=t}get invert(){return this._invert}set invert(t){this._invert=t}get numberOfChannels(){return this._numberOfChannels}set numberOfChannels(t){this._numberOfChannels=t}}},6315:(t,e,i)=>{"use strict";i.r(e),i.d(e,{FrameModel:()=>n.Z,SeriesModel:()=>s.Z,StackModel:()=>r.Z,VoxelModel:()=>a.Z});var n=i(1382),r=i(4011),s=i(7415),a=i(7620)},7415:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var n=i(7290);class r extends n.Z{constructor(){super(),this._concatenationUID=-1,this._seriesInstanceUID=-1,this._transferSyntaxUID="",this._seriesNumber=-1,this._seriesDescription="",this._seriesDate="",this._studyDescription="",this._studyDate="",this._accessionNumber=-1,this._modality="Modality not set",this._dimensionIndexSequence=[],this._numberOfFrames=0,this._numberOfChannels=1,this._rawHeader=null,this._patientID="",this._patientName="",this._patientAge="",this._patientBirthdate="",this._patientSex="",this._segmentationType=null,this._segmentationSegments=[],this._stack=[]}validate(t){return!!(super.validate(t)&&"function"==typeof t.mergeSeries&&t.hasOwnProperty("_seriesInstanceUID")&&t.hasOwnProperty("_numberOfFrames")&&t.hasOwnProperty("_numberOfChannels")&&t.hasOwnProperty("_stack")&&void 0!==t._stack&&Array===t._stack.constructor)}merge(t){return!!this.validate(t)&&this._seriesInstanceUID===t.seriesInstanceUID&&(t.stack[0]&&(0===this._stack[0]._numberOfFrames&&this._stack[0].computeNumberOfFrames(),this._stack[0].computeCosines(),0===t.stack[0]._numberOfFrames&&t.stack[0].computeNumberOfFrames(),t.stack[0].computeCosines()),this.mergeModels(this._stack,t.stack))}mergeSeries(t){let e=[this];return this.mergeModels(e,t),e}set seriesInstanceUID(t){this._seriesInstanceUID=t}get seriesInstanceUID(){return this._seriesInstanceUID}set transferSyntaxUID(t){this._transferSyntaxUID=t}get transferSyntaxUID(){return this._transferSyntaxUID}get transferSyntaxUIDLabel(){switch(this._transferSyntaxUID){case"1.2.840.10008.1.2.4.90":return"JPEG 2000 Lossless";case"1.2.840.10008.1.2.4.91":return"JPEG 2000 Lossy";case"1.2.840.10008.1.2.4.57":return"JPEG Lossless, Nonhierarchical (Processes 14)";case"1.2.840.10008.1.2.4.70":return"JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])";case"1.2.840.10008.1.2.4.50":return"JPEG Baseline lossy process 1 (8 bit)";case"1.2.840.10008.1.2.4.51":return"JPEG Baseline lossy process 2 & 4 (12 bit)";case"1.2.840.10008.1.2":return"Implicit VR Little Endian";case"1.2.840.10008.1.2.1":return"Explicit VR Little Endian";case"1.2.840.10008.1.2.2":return"Explicit VR Big Endian";default:return`Unknown transfersyntax: ${this._transferSyntaxUID}`}}set studyDate(t){this._studyDate=t}get studyDate(){return this._studyDate}set studyDescription(t){this._studyDescription=t}get studyDescription(){return this._studyDescription}set seriesDate(t){this._seriesDate=t}get seriesDate(){return this._seriesDate}set seriesDescription(t){this._seriesDescription=t}get seriesDescription(){return this._seriesDescription}set rawHeader(t){this._rawHeader=t}get rawHeader(){return this._rawHeader}set patientID(t){this._patientID=t}get patientID(){return this._patientID}set patientName(t){this._patientName=t}get patientName(){return this._patientName}set patientAge(t){this._patientAge=t}get patientAge(){return this._patientAge}set patientBirthdate(t){this._patientBirthdate=t}get patientBirthdate(){return this._patientBirthdate}set patientSex(t){this._patientSex=t}get patientSex(){return this._patientSex}set numberOfFrames(t){this._numberOfFrames=t}get numberOfFrames(){return this._numberOfFrames}set numberOfChannels(t){this._numberOfChannels=t}get numberOfChannels(){return this._numberOfChannels}set stack(t){this._stack=t}get stack(){return this._stack}set modality(t){this._modality=t}get modality(){return this._modality}set segmentationType(t){this._segmentationType=t}get segmentationType(){return this._segmentationType}set segmentationSegments(t){this._segmentationSegments=t}get segmentationSegments(){return this._segmentationSegments}}},4011:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var n=i(1245),r=i(7802);const s=1023;var a=i(2450),o=i(1798),l=i(7290);const h=i(9254);class c extends l.Z{constructor(){super(),this._uid=null,this._stackID=-1,this._frame=[],this._numberOfFrames=0,this._rows=0,this._columns=0,this._numberOfChannels=1,this._bitsAllocated=8,this._pixelType=0,this._pixelRepresentation=0,this._textureSize=4096,this._textureUnits=7,this._rawData=[],this._windowCenter=0,this._windowWidth=0,this._rescaleSlope=1,this._rescaleIntercept=0,this._minMax=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this._regMatrix=new n.y,this._ijk2LPS=null,this._lps2IJK=null,this._aabb2LPS=null,this._lps2AABB=null,this._dimensionsIJK=null,this._halfDimensionsIJK=null,this._spacing=new r.P(1,1,1),this._spacingBetweenSlices=0,this._sliceThickness=0,this._origin=null,this._rightHanded=!0,this._xCosine=new r.P(1,0,0),this._yCosine=new r.P(0,1,0),this._zCosine=new r.P(0,0,1),this._prepared=!1,this._packed=!1,this._packedPerPixel=1,this._modality="Modality not set",this._segmentationType=null,this._segmentationSegments=[],this._segmentationDefaultColor=[63,174,128],this._frameSegment=[],this._segmentationLUT=[],this._segmentationLUTO=[],this._invert=!1}prepareSegmentation(){this._frameSegment=this._frame;let t=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);let e=-1;for(let i=0;i<this._frame.length;i++){if(t[e]&&t[e]._dist==this._frame[i]._dist)for(let n=0;n<t[e]._rows*t[e]._columns;n++)t[e]._pixelData[n]+=this._frame[i].pixelData[n]*this._frame[i]._referencedSegmentNumber;else{t.push(this._frame[i]),e++;for(let n=0;n<t[e]._rows*t[e]._columns;n++)t[e]._pixelData[n]*=this._frame[i]._referencedSegmentNumber}t[e].minMax=o.default.minMax(t[e]._pixelData)}let i={},n=0;for(let t=0;t<this._segmentationSegments.length;t++){n=Math.max(n,parseInt(this._segmentationSegments[t].segmentNumber,10));let e=this._segmentationSegments[t].recommendedDisplayCIELab;i[this._segmentationSegments[t].segmentNumber]=null===e?this._segmentationDefaultColor:a.default.cielab2RGB(...e)}for(let t=0;t<=n;t++){let e=t/n,r=t?1:0,s=[0,0,0];i.hasOwnProperty(t.toString())&&(s=i[t.toString()]),s[0]/=255,s[1]/=255,s[2]/=255,this._segmentationLUT.push([e,...s]),this._segmentationLUTO.push([e,r])}this._frame=t}prepare(){"SEG"===this._modality&&this.prepareSegmentation(),this.computeNumberOfFrames(),this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK=new r.P(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new r.P(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this._numberOfFrames>1&&this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin=this._arrayToVector3(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB();const t=Math.floor(this._frame.length/2),e=this._frame[t];this._rescaleSlope=e.rescaleSlope||1,this._rescaleIntercept=e.rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=o.default.rescaleSlopeIntercept(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=o.default.rescaleSlopeIntercept(this._minMax[1],this._rescaleSlope,this._rescaleIntercept),this._windowWidth=e.windowWidth||this._minMax[1]-this._minMax[0],this._windowCenter=e.windowCenter||this._minMax[0]+this._windowWidth/2,this._bitsAllocated=e.bitsAllocated,this._prepared=!0}packEchos(){let t=[];for(let e=0;e<this._frame.length;e+=4){let i=this._frame[e];for(let t=0;t<this._rows*this._columns;t++){for(let n=1;n<4;n++)i.pixelData[t]+=this._frame[e+n].pixelData[t];i.pixelData[t]/=4}t.push(i)}this._frame=t,this._numberOfFrames=this._frame.length,this._dimensionsIJK=new r.P(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new r.P(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}computeNumberOfFrames(){if(!(this._frame&&this._frame.length>0))return console.warn("_frame doesn't contain anything...."),console.warn(this._frame),!1;this._numberOfFrames=this._frame.length}computeCosines(){if(this._frame&&this._frame[0]){let t=this._frame[0].cosines();this._xCosine=t[0],this._yCosine=t[1],this._zCosine=t[2]}}orderFrames(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):this._frame[0].imagePosition&&console.warn("do not know how to order the frames...")}computeSpacing(){this.xySpacing(),this.zSpacing()}zSpacing(){this._numberOfFrames>1&&(this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame[1].dist!==this._frame[0].dist?(this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist):this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].sliceThickness&&(this._spacing.z=this._frame[0].sliceThickness))),0===this._spacing.z&&(this._spacing.z=1)}xySpacing(){if(this._frame&&this._frame[0]){let t=this._frame[0].spacingXY();this._spacing.x=t[0],this._spacing.y=t[1]}}computeMinMaxIntensities(){for(let t=0;t<this._frame.length;t++){let e=this._frame[t].minMax[0];Number.isNaN(e)||(this._minMax[0]=Math.min(this._minMax[0],e));let i=this._frame[t].minMax[1];Number.isNaN(i)||(this._minMax[1]=Math.max(this._minMax[1],i))}}computeIJK2LPS(){this._ijk2LPS=o.default.ijk2LPS(this._xCosine,this._yCosine,this._zCosine,this._spacing,this._origin,this._regMatrix),this._lps2IJK=new n.y,this._lps2IJK.getInverse(this._ijk2LPS)}computeLPS2AABB(){this._aabb2LPS=o.default.aabb2LPS(this._xCosine,this._yCosine,this._zCosine,this._origin),this._lps2AABB=new n.y,this._lps2AABB.getInverse(this._aabb2LPS)}merge(t){return!!(this._stackID===t.stackID&&1===this._numberOfFrames&&1===t._numberOfFrames&&this._frame[0].columns===t.frame[0].columns&&this._frame[0].rows===t.frame[0].rows&&this._xCosine.equals(t.xCosine)&&this._yCosine.equals(t.yCosine)&&this._zCosine.equals(t.zCosine))&&this.mergeModels(this._frame,t.frame)}pack(){const t=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;(8===this._bitsAllocated&&1===this._numberOfChannels||1===this._bitsAllocated)&&(this._packedPerPixel=4),16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);const e=this._textureSize*this._textureSize;let i=Math.ceil(t/(e*this._packedPerPixel)),n=0,r=this._packedPerPixel*e;r>t&&(r=t),this._textureUnits<i&&(console.warn("Insufficient number of supported textures. Some frames will not be packed."),i=this._textureUnits);for(let s=0;s<i;s++){const i=this._packTo8Bits(this._numberOfChannels,this._frame,this._textureSize,n,r);this._textureType=i.textureType,this._rawData.push(i.data),n+=this._packedPerPixel*e,r+=this._packedPerPixel*e,r>t&&(r=t)}this._packed=!0}_packTo8Bits(t,e,i,n,r){const a={textureType:null,data:null},o=e[0].bitsAllocated,l=e[0].pixelType;let c=0;this._minMax[0]<0&&(c-=this._minMax[0]);let u=0,d=0,p=0;const f=e[0].rows*e[0].columns;if(8===o&&1===t||1===o){let t=new Uint8Array(i*i*4),o=0,l=0;for(let i=n;i<r;i++){d=~~(i/f),p=i%f;let n=e[d].pixelData[p]+c;Number.isNaN(n)||(t[4*o+l]=n),u++,o=Math.floor(u/4),l=u%4}a.textureType=s,a.data=t}else if(16===o&&1===t){let t=new Uint8Array(i*i*4),o=0,l=0;for(let i=n;i<r;i++){d=~~(i/f),p=i%f;let n=e[d].pixelData[p]+c;Number.isNaN(n)||(t[4*o+2*l]=255&n,t[4*o+2*l+1]=n>>>8&255),u++,o=Math.floor(u/2),l=u%2}a.textureType=s,a.data=t}else if(32===o&&1===t&&0===l){let t=new Uint8Array(i*i*4);for(let i=n;i<r;i++){d=~~(i/f),p=i%f;let n=e[d].pixelData[p]+c;Number.isNaN(n)||(t[4*u]=255&n,t[4*u+1]=n>>>8&255,t[4*u+2]=n>>>16&255,t[4*u+3]=n>>>24&255),u++}a.textureType=s,a.data=t}else if(32===o&&1===t&&1===l){let t=new Uint8Array(i*i*4);for(let i=n;i<r;i++){d=~~(i/f),p=i%f;let n=e[d].pixelData[p]+c;if(!Number.isNaN(n)){let e=h(n).match(/.{1,8}/g);t[4*u]=parseInt(e[0],2),t[4*u+1]=parseInt(e[1],2),t[4*u+2]=parseInt(e[2],2),t[4*u+3]=parseInt(e[3],2)}u++}a.textureType=s,a.data=t}else if(8===o&&3===t){let t=new Uint8Array(i*i*3);for(let i=n;i<r;i++)d=~~(i/f),p=i%f,t[3*u]=e[d].pixelData[3*p],t[3*u+1]=e[d].pixelData[3*p+1],t[3*u+2]=e[d].pixelData[3*p+2],u++;a.textureType=1022,a.data=t}return a}worldCenter(){return this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS)}worldBoundingBox(){let t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];const e=this._dimensionsIJK;for(let i=0;i<=e.x;i+=e.x)for(let n=0;n<=e.y;n+=e.y)for(let s=0;s<=e.z;s+=e.z){let e=new r.P(i,n,s).applyMatrix4(this._ijk2LPS);t=[Math.min(t[0],e.x),Math.max(t[1],e.x),Math.min(t[2],e.y),Math.max(t[3],e.y),Math.min(t[4],e.z),Math.max(t[5],e.z)]}return t}AABBox(){let t=(new r.P).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),e=this._dimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB);return new r.P(Math.abs(t.x-e.x),Math.abs(t.y-e.y),Math.abs(t.z-e.z))}centerAABBox(){let t=this.worldCenter();return t.applyMatrix4(this._lps2AABB),t}static indexInDimensions(t,e){return t.x>=0&&t.y>=0&&t.z>=0&&t.x<e.x&&t.y<e.y&&t.z<e.z}_arrayToVector3(t,e){return new r.P(t[e],t[e+1],t[e+2])}_orderFrameOnDimensionIndicesArraySort(t,e){if("dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues)&&"dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues))for(let i=0;i<t.dimensionIndexValues.length;i++){if(parseInt(t.dimensionIndexValues[i],10)>parseInt(e.dimensionIndexValues[i],10))return 1;if(parseInt(t.dimensionIndexValues[i],10)<parseInt(e.dimensionIndexValues[i],10))return-1}else console.warn("One of the frames doesn't have a dimensionIndexValues array."),console.warn(t),console.warn(e);return 0}_computeDistanceArrayMap(t,e){return e.imagePosition&&(e.dist=e.imagePosition[0]*t.x+e.imagePosition[1]*t.y+e.imagePosition[2]*t.z),e}_sortDistanceArraySort(t,e){return t.dist-e.dist}_sortInstanceNumberArraySort(t,e){return t.instanceNumber-e.instanceNumber}_sortSopInstanceUIDArraySort(t,e){return t.sopInstanceUID-e.sopInstanceUID}set numberOfChannels(t){this._numberOfChannels=t}get numberOfChannels(){return this._numberOfChannels}set frame(t){this._frame=t}get frame(){return this._frame}set prepared(t){this._prepared=t}get prepared(){return this._prepared}set packed(t){this._packed=t}get packed(){return this._packed}set packedPerPixel(t){this._packedPerPixel=t}get packedPerPixel(){return this._packedPerPixel}set dimensionsIJK(t){this._dimensionsIJK=t}get dimensionsIJK(){return this._dimensionsIJK}set halfDimensionsIJK(t){this._halfDimensionsIJK=t}get halfDimensionsIJK(){return this._halfDimensionsIJK}set regMatrix(t){this._regMatrix=t}get regMatrix(){return this._regMatrix}set ijk2LPS(t){this._ijk2LPS=t}get ijk2LPS(){return this._ijk2LPS}set lps2IJK(t){this._lps2IJK=t}get lps2IJK(){return this._lps2IJK}set lps2AABB(t){this._lps2AABB=t}get lps2AABB(){return this._lps2AABB}set textureSize(t){this._textureSize=t}get textureSize(){return this._textureSize}set textureUnits(t){this._textureUnits=t}get textureUnits(){return this._textureUnits}set textureType(t){this._textureType=t}get textureType(){return this._textureType}set bitsAllocated(t){this._bitsAllocated=t}get bitsAllocated(){return this._bitsAllocated}set rawData(t){this._rawData=t}get rawData(){return this._rawData}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=t}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(t){this._rescaleSlope=t}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(t){this._rescaleIntercept=t}get xCosine(){return this._xCosine}set xCosine(t){this._xCosine=t}get yCosine(){return this._yCosine}set yCosine(t){this._yCosine=t}get zCosine(){return this._zCosine}set zCosine(t){this._zCosine=t}get minMax(){return this._minMax}set minMax(t){this._minMax=t}get stackID(){return this._stackID}set stackID(t){this._stackID=t}get pixelType(){return this._pixelType}set pixelType(t){this._pixelType=t}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(t){this._pixelRepresentation=t}set invert(t){this._invert=t}get invert(){return this._invert}set modality(t){this._modality=t}get modality(){return this._modality}get rightHanded(){return this._rightHanded}set rightHanded(t){this._rightHanded=t}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(t){this._spacingBetweenSlices=t}set segmentationSegments(t){this._segmentationSegments=t}get segmentationSegments(){return this._segmentationSegments}set segmentationType(t){this._segmentationType=t}get segmentationType(){return this._segmentationType}set segmentationLUT(t){this._segmentationLUT=t}get segmentationLUT(){return this._segmentationLUT}set segmentationLUTO(t){this._segmentationLUTO=t}get segmentationLUTO(){return this._segmentationLUTO}static value(t,e){return console.warn("models.stack.value is deprecated.\n       Please use core.utils.value instead."),o.default.value(t,e)}static valueRescaleSlopeIntercept(t,e,i){return console.warn("models.stack.valueRescaleSlopeIntercept is deprecated.\n       Please use core.utils.rescaleSlopeIntercept instead."),o.default.rescaleSlopeIntercept(t,e,i)}static worldToData(t,e){return console.warn("models.stack.worldToData is deprecated.\n       Please use core.utils.worldToData instead."),o.default.worldToData(t._lps2IJK,e)}}},7620:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{constructor(){this._id=-1,this._worldCoordinates=null,this._dataCoordinates=null,this._screenCoordinates=null,this._value=null}set worldCoordinates(t){this._worldCoordinates=t}get worldCoordinates(){return this._worldCoordinates}set dataCoordinates(t){this._dataCoordinates=t}get dataCoordinates(){return this._dataCoordinates}set screenCoordinates(t){this._screenCoordinates=t}get screenCoordinates(){return this._screenCoordinates}set value(t){this._value=t}get value(){return this._value}set id(t){this._id=t}get id(){return this._id}}},2793:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var n=i(1798),r=i(7368);let s,a=i(4705),o=i(7090),l=i(9099),h=i(1566);class c extends r.Z{constructor(t,e){super(),this._id=e,this._arrayBuffer=t.buffer;let i=new Uint8Array(this._arrayBuffer);this._dataSet=null;try{this._dataSet=a.parseDicom(i)}catch(t){throw console.log(t),new Error("parsers.dicom could not parse the file")}}seriesInstanceUID(){return this._dataSet.string("x0020000e")}studyInstanceUID(){return this._dataSet.string("x0020000d")}modality(){return this._dataSet.string("x00080060")}segmentationType(){return this._dataSet.string("x00620001")}segmentationSegments(){let t=[],e=this._dataSet.elements.x00620002;if(!e)return t;for(let i=0;i<e.items.length;i++){let n=this._recommendedDisplayCIELab(e.items[i]),r=this._segmentationCode(e.items[i]),s=e.items[i].dataSet.uint16("x00620004"),a=e.items[i].dataSet.string("x00620005"),o=e.items[i].dataSet.string("x00620008");t.push({recommendedDisplayCIELab:n,segmentationCodeDesignator:r.segmentationCodeDesignator,segmentationCodeValue:r.segmentationCodeValue,segmentationCodeMeaning:r.segmentationCodeMeaning,segmentNumber:s,segmentLabel:a,segmentAlgorithmType:o})}return t}_segmentationCode(t){let e="unknown",i="unknown",n="unknown",r=t.dataSet.elements.x00082218;return r&&r.items&&r.items.length>0&&(e=r.items[0].dataSet.string("x00080102"),i=r.items[0].dataSet.string("x00080100"),n=r.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:e,segmentationCodeValue:i,segmentationCodeMeaning:n}}_recommendedDisplayCIELab(t){if(!t.dataSet.elements.x0062000d)return null;let e=t.dataSet.elements.x0062000d.dataOffset,i=t.dataSet.elements.x0062000d.length,n=t.dataSet.byteArray.slice(e,e+i),r=new Uint16Array(i/2);for(let t=0;t<i/2;t++)r[t]=(n[2*t+1]<<8)+n[2*t];return[r[0]/65535*100,r[1]/65535*255-128,r[2]/65535*255-128]}rawHeader(){return this._dataSet}sopInstanceUID(t=0){return this._findStringEverywhere("x2005140f","x00080018",t)}transferSyntaxUID(){return this._dataSet.string("x00020010")}studyDate(){return this._dataSet.string("x00080020")}studyDescription(){return this._dataSet.string("x00081030")}seriesDate(){return this._dataSet.string("x00080021")}seriesDescription(){return this._dataSet.string("x0008103e")}patientName(){return this._dataSet.string("x00100010")}patientID(){return this._dataSet.string("x00100020")}patientBirthdate(){return this._dataSet.string("x00100030")}patientSex(){return this._dataSet.string("x00100040")}patientAge(){return this._dataSet.string("x00101010")}photometricInterpretation(){return this._dataSet.string("x00280004")}planarConfiguration(){let t=this._dataSet.uint16("x00280006");return void 0===t&&(t=null),t}samplesPerPixel(){return this._dataSet.uint16("x00280002")}numberOfFrames(){let t=this._dataSet.intString("x00280008");return void 0===t&&(t=null),t}numberOfChannels(){let t=1,e=this.photometricInterpretation();return"RGB"!==e&&"PALETTE COLOR"!==e&&"YBR_FULL"!==e&&"YBR_FULL_422"!==e&&"YBR_PARTIAL_422"!==e&&"YBR_PARTIAL_420"!==e&&"YBR_RCT"!==e||(t=3),t}invert(){return"MONOCHROME1"===this.photometricInterpretation()}imageOrientation(t=0){let e=this._findStringEverywhere("x00209116","x00200037",t);return e&&(e=e.split("\\").map(n.default.stringToNumber)),e}referencedSegmentNumber(t=0){let e=-1,i=this._findInGroupSequence("x52009230","x0062000a",t);return null!==i&&(e=i.uint16("x0062000b")),e}pixelAspectRatio(){let t=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return void 0===t[0]&&(t=null),t}imagePosition(t=0){let e=this._findStringEverywhere("x00209113","x00200032",t);return e&&(e=e.split("\\").map(n.default.stringToNumber)),e}instanceNumber(t=0){let e=null,i=this._dataSet.elements.x52009230;return void 0!==i&&i.items[t].dataSet.elements.x2005140f?e=i.items[t].dataSet.elements.x2005140f.items[0].dataSet.intString("x00200013"):(e=this._dataSet.intString("x00200013"),void 0===e&&(e=null)),e}pixelSpacing(t=0){let e=this._findStringEverywhere("x00289110","x00280030",t);if(null===e&&(e=this._dataSet.string("x00181164"),void 0===e&&(e=null)),e){const t=e.split("\\");2!==t.length?(console.error(`DICOM spacing format is not supported (could not split string on "\\"): ${e}`),e=null):e=t.map(n.default.stringToNumber)}return e}ultrasoundRegions(t=0){const e=this._dataSet.elements.x00186011;if(!e||!e.items)return[];const i=[];return e.items.forEach((t=>{i.push({x0:t.dataSet.uint32("x00186018"),y0:t.dataSet.uint32("x0018601a"),x1:t.dataSet.uint32("x0018601c"),y1:t.dataSet.uint32("x0018601e"),axisX:t.dataSet.int32("x00186020")||null,axisY:t.dataSet.int32("x00186022")||null,unitsX:this._getUnitsName(t.dataSet.uint16("x00186024")),unitsY:this._getUnitsName(t.dataSet.uint16("x00186026")),deltaX:t.dataSet.double("x0018602c"),deltaY:t.dataSet.double("x0018602e")})})),i}frameTime(t=0){let e,i=this._dataSet.uint16("x00280009",1),n=this._dataSet.intString("x00082144");return"number"==typeof i&&(i=i.toString(16),e=this._dataSet.floatString("x0018"+i)),void 0===e&&"number"==typeof n&&(e=1e3/n),void 0===e&&(e=null),e}rows(t=0){let e=this._dataSet.uint16("x00280010");return void 0===e&&(e=null),e}columns(t=0){let e=this._dataSet.uint16("x00280011");return void 0===e&&(e=null),e}pixelType(t=0){return 0}pixelRepresentation(t=0){return this._dataSet.uint16("x00280103")}pixelPaddingValue(t=0){let e=this._dataSet.int16("x00280120");return void 0===e&&(e=null),e}bitsAllocated(t=0){return this._dataSet.uint16("x00280100")}highBit(t=0){return this._dataSet.uint16("x00280102")}rescaleIntercept(t=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",t)}rescaleSlope(t=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",t)}windowCenter(t=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",t)}windowWidth(t=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",t)}sliceThickness(t=0){return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",t)}spacingBetweenSlices(t=0){let e=this._dataSet.floatString("x00180088");return void 0===e&&(e=null),e}dimensionIndexValues(t=0){let e=null,i=this._dataSet.elements.x52009230;if(void 0!==i){let n=i.items[t].dataSet.elements.x00209111;if(null!=n){n=n.items[0].dataSet;let t=n.elements.x00209157;if(null!=t){let i=t.length/4;e=[];for(let t=0;t<i;t++)e.push(n.uint32("x00209157",t))}}}return e}inStackPositionNumber(t=0){let e=null,i=this._dataSet.elements.x52009230;return e=void 0!==i?i.items[t].dataSet.elements.x00209111.items[0].dataSet.uint32("x00209057"):null,e}stackID(t=0){let e=null,i=this._dataSet.elements.x52009230;return e=void 0!==i?i.items[t].dataSet.elements.x00209111.items[0].dataSet.intString("x00209056"):null,e}extractPixelData(t=0){let e=this._decodePixelData(t);return this.numberOfChannels()>1?this._convertColorSpace(e):e}_findInGroupSequence(t,e,i){let n=this._dataSet.elements[t];if(void 0!==n){let t=n.items[i].dataSet.elements[e];if(void 0!==t)return t.items[0].dataSet}return null}_findStringInGroupSequence(t,e,i,n){let r=this._findInGroupSequence(t,e,n);return null!==r?r.string(i):null}_findStringInFrameGroupSequence(t,e,i){return this._findStringInGroupSequence("x52009229",t,e,0)||this._findStringInGroupSequence("x52009230",t,e,i)}_findStringEverywhere(t,e,i){let n=this._findStringInFrameGroupSequence(t,e,i);if(null===n){const t="x00540022";n=this._findStringInSequence(t,e)}return null===n&&(n=this._dataSet.string(e)),void 0===n&&(n=null),n}_findStringInSequence(t,e,i){const n=this._dataSet.elements[t];let r;return n&&(r=n.items[0].dataSet.string(e)),void 0===r&&(r=null),r}_findFloatStringInGroupSequence(t,e,i,n){let r=this._dataSet.floatString(i);return void 0===r&&(r=this._findInGroupSequence(t,e,n),null!==r)?r.floatString(i):r}_findFloatStringInFrameGroupSequence(t,e,i){return this._findFloatStringInGroupSequence("x52009229",t,e,0)||this._findFloatStringInGroupSequence("x52009230",t,e,i)}_decodePixelData(t=0){let e=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===e||"1.2.840.10008.1.2.4.91"===e)return this._decodeJ2K(t);if("1.2.840.10008.1.2.5"===e)return this._decodeRLE(t);if("1.2.840.10008.1.2.4.57"===e||"1.2.840.10008.1.2.4.70"===e)return this._decodeJPEGLossless(t);if("1.2.840.10008.1.2.4.50"===e||"1.2.840.10008.1.2.4.51"===e)return this._decodeJPEGBaseline(t);if("1.2.840.10008.1.2"===e||"1.2.840.10008.1.2.1"===e)return this._decodeUncompressed(t);if("1.2.840.10008.1.2.2"===e){let e=this._decodeUncompressed(t);return this._swapFrame(e)}throw{error:`no decoder for transfer syntax ${e}`}}framesAreFragmented(){return this._dataSet.intString("x00280008")!==this._dataSet.elements.x7fe00010.fragments.length}getEncapsulatedImageFrame(t){return this._dataSet.elements.x7fe00010&&this._dataSet.elements.x7fe00010.basicOffsetTable.length?a.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,t):this.framesAreFragmented()?a.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,t,a.createJPEGBasicOffsetTable(this._dataSet,this._dataSet.elements.x7fe00010)):a.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,t)}_decodeJpx(t=0){const e=new h;if(e.parse(this.getEncapsulatedImageFrame(t)),1!==e.componentsCount)throw new Error("JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected");if(1!==e.tiles.length)throw new Error("JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected");return e.tiles[0].items}_decodeOpenJPEG(t=0){const e=this.getEncapsulatedImageFrame(t),i=this.bitsAllocated(t)<=8?1:2,n=1===this.pixelRepresentation(t),r=s._malloc(e.length);s.writeArrayToMemory(e,r);const a=s._malloc(4),o=s._malloc(4),l=s._malloc(4),h=s._malloc(4),c=s._malloc(4),u=s.ccall("jp2_decode","number",["number","number","number","number","number","number","number"],[r,e.length,a,o,l,h,c]),d=s.getValue(a,"*");if(0!==u)return console.log("[opj_decode] decoding failed!"),s._free(r),s._free(d),s._free(l),s._free(h),s._free(o),void s._free(c);const p=s.getValue(l,"i32")*s.getValue(h,"i32")*s.getValue(c,"i32"),f=new Int32Array(s.HEAP32.buffer,d,p);let m;if(1===i)if(Uint8Array.from)m=Uint8Array.from(f);else{m=new Uint8Array(p);for(let t=0;t<p;t++)m[t]=f[t]}else if(n)if(Int16Array.from)m=Int16Array.from(f);else{m=new Int16Array(p);for(let t=0;t<p;t++)m[t]=f[t]}else if(Uint16Array.from)m=Uint16Array.from(f);else{m=new Uint16Array(p);for(let t=0;t<p;t++)m[t]=f[t]}return s._free(r),s._free(a),s._free(d),s._free(o),s._free(l),s._free(h),s._free(c),m}_decodeJ2K(t=0){return"undefined"==typeof OpenJPEG?this._decodeJpx(t):s||(s=OpenJPEG(),s&&s._jp2_decode)?this._decodeOpenJPEG(t):this._decodeJpx(t)}_decodeRLE(t=0){const e=this.bitsAllocated(t),i=this.planarConfiguration(),n=this.columns(),r=this.rows(),s=this.samplesPerPixel(t);return function(t,e){if(8===t.bitsAllocated)return t.planarConfiguration?function(t,e){const i=e,n=t.rows*t.columns,r=new ArrayBuffer(n*t.samplesPerPixel),s=new DataView(i.buffer,i.byteOffset),a=new Int8Array(i.buffer,i.byteOffset),o=new Int8Array(r);let l=0;const h=s.getInt32(0,!0);for(let t=0;t<h;++t){l=t*n;let e=s.getInt32(4*(t+1),!0),r=s.getInt32(4*(t+2),!0);0===r&&(r=i.length);const c=n*h;for(;e<r;){const t=a[e++];if(t>=0&&t<=127)for(let i=0;i<t+1&&l<c;++i)o[l]=a[e++],l++;else if(t<=-1&&t>=-127){const i=a[e++];for(let e=0;e<1-t&&l<c;++e)o[l]=i,l++}}}return t.pixelData=new Uint8Array(r),t}(t,e):function(t,e){const i=e,n=t.rows*t.columns,r=new ArrayBuffer(n*t.samplesPerPixel),s=new DataView(i.buffer,i.byteOffset),a=new Int8Array(i.buffer,i.byteOffset),o=new Int8Array(r);let l=0;const h=s.getInt32(0,!0);for(let e=0;e<h;++e){l=e;let r=s.getInt32(4*(e+1),!0),c=s.getInt32(4*(e+2),!0);0===c&&(c=i.length);const u=n*h;for(;r<c;){const e=a[r++];if(e>=0&&e<=127)for(let i=0;i<e+1&&l<u;++i)o[l]=a[r++],l+=t.samplesPerPixel;else if(e<=-1&&e>=-127){const i=a[r++];for(let n=0;n<1-e&&l<u;++n)o[l]=i,l+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(r),t}(t,e);if(16===t.bitsAllocated)return function(t,e){const i=e,n=t.rows*t.columns,r=new ArrayBuffer(n*t.samplesPerPixel*2),s=new DataView(i.buffer,i.byteOffset),a=new Int8Array(i.buffer,i.byteOffset),o=new Int8Array(r),l=s.getInt32(0,!0);for(let t=0;t<l;++t){let e=0;const r=0===t?1:0;let l=s.getInt32(4*(t+1),!0),h=s.getInt32(4*(t+2),!0);for(0===h&&(h=i.length);l<h;){const t=a[l++];if(t>=0&&t<=127)for(let i=0;i<t+1&&e<n;++i)o[2*e+r]=a[l++],e++;else if(t<=-1&&t>=-127){const i=a[l++];for(let s=0;s<1-t&&e<n;++s)o[2*e+r]=i,e++}}}return 0===t.pixelRepresentation?t.pixelData=new Uint16Array(r):t.pixelData=new Int16Array(r),t}(t,e);throw new Error("unsupported pixel format for RLE")}({pixelRepresentation:this.pixelRepresentation(t),bitsAllocated:e,planarConfiguration:i,columns:n,rows:r,samplesPerPixel:s},a.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,t)).pixelData}_decodeJPEGLossless(t=0){let e=this.getEncapsulatedImageFrame(t),i=this.pixelRepresentation(t),n=this.bitsAllocated(t)<=8?1:2,r=(new o.lossless.Decoder).decode(e.buffer,e.byteOffset,e.length,n);return 0===i?2===n?new Uint16Array(r.buffer):new Uint8Array(r.buffer):new Int16Array(r.buffer)}_decodeJPEGBaseline(t=0){let e=this.getEncapsulatedImageFrame(t),i=this.rows(t),n=this.columns(t),r=this.bitsAllocated(t),s=new l;return s.parse(e),8===r?s.getData(n,i):16===r?s.getData16(n,i):void 0}_decodeUncompressed(t=0){let e=this.pixelRepresentation(t),i=this.bitsAllocated(t),n=this._dataSet.elements.x7fe00010.dataOffset,r=this.numberOfChannels(),s=this.rows(t)*this.columns(t)*r,a=0,o=this._dataSet.byteArray.buffer;if(0===e&&8===i)return a=n+t*s,new Uint8Array(o,a,s);if(0===e&&16===i)return a=n+t*s*2,new Uint16Array(o,a,s);if(1===e&&16===i)return a=n+t*s*2,new Int16Array(o,a,s);if(0===e&&32===i)return a=n+t*s*4,new Uint32Array(o,a,s);if(0===e&&1===i){let e=new ArrayBuffer(s),i=new Uint8Array(e);a=n+t*s;let r=0,l=t*s,h=t*s+s,c=Math.floor(l/8),u=l-8*c,d=Math.ceil(h/8),p=new Uint8Array(o,n);for(let t=c;t<=d;t++){for(;u<8;){switch(u){case 0:i[r]=1&p[t];break;case 1:i[r]=p[t]>>>1&1;break;case 2:i[r]=p[t]>>>2&1;break;case 3:i[r]=p[t]>>>3&1;break;case 4:i[r]=p[t]>>>4&1;break;case 5:i[r]=p[t]>>>5&1;break;case 6:i[r]=p[t]>>>6&1;break;case 7:i[r]=p[t]>>>7&1}if(u++,r++,r>=s)return i}u=0}}}_interpretAsRGB(t){return-1!==["RGB","YBR_RCT","YBR_ICT","YBR_FULL_422"].indexOf(t)}_convertColorSpace(t){let e=null,i=this.photometricInterpretation(),n=this.planarConfiguration();null===n&&(n=0,console.log("Planar Configuration was not set and was defaulted to  0"));const r=this._interpretAsRGB(i);if(r&&0===n)e=t;else if(r&&1===n){if(t instanceof Int8Array)e=new Int8Array(t.length);else if(t instanceof Uint8Array)e=new Uint8Array(t.length);else if(t instanceof Int16Array)e=new Int16Array(t.length);else{if(!(t instanceof Uint16Array))throw new Error(`unsuported typed array: ${t}`);e=new Uint16Array(t.length)}let i=t.length/3,n=0,r=0,s=i,a=2*i;for(let o=0;o<i;o++)e[n++]=t[r++],e[n++]=t[s++],e[n++]=t[a++]}else{if("YBR_FULL"!==i)throw new Error(`photometric interpolation not supported: ${i}`);{if(t instanceof Int8Array)e=new Int8Array(t.length);else if(t instanceof Uint8Array)e=new Uint8Array(t.length);else if(t instanceof Int16Array)e=new Int16Array(t.length);else{if(!(t instanceof Uint16Array))throw new Error(`unsuported typed array: ${t}`);e=new Uint16Array(t.length)}let i=t.length/3,n=0,r=0;for(let s=0;s<i;s++){let i=t[n++],s=t[n++],a=t[n++];e[r++]=i+1.402*(a-128),e[r++]=i-.34414*(s-128)-.71414*(a-128),e[r++]=i+1.772*(s-128)}}}return e}_swapFrame(t){let e=this.bitsAllocated();if(16===e)for(let e=0;e<t.length;e++)t[e]=this._swap16(t[e]);else if(32===e)for(let e=0;e<t.length;e++)t[e]=this._swap32(t[e]);return t}_getUnitsName(t){const e={0:"none",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm2",9:"cm2/sec",10:"cm3",11:"cm3/sec",12:"degrees"};return e.hasOwnProperty(t)?e[t]:"none"}}},5451:(t,e,i)=>{"use strict";i.r(e),i.d(e,{DicomParser:()=>n.Z,MghParser:()=>r.Z,NiftiParser:()=>s.Z,NrrdParser:()=>a.Z});var n=i(2793),r=i(4656),s=i(9813),a=i(9286)},4656:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});var n=i(7368),r=i(7802);class s extends n.Z{constructor(t,e){if(super(),this._id=e,this._url=t.url,this._buffer=null,this._bufferPos=0,this._dataPos=0,this._pixelData=null,this._version=1,this._width=0,this._height=0,this._depth=0,this._nframes=0,this._type=s.MRI_UCHAR,this._dof=0,this._goodRASFlag=0,this._spacingXYZ=[1,1,1],this._Xras=[-1,0,0],this._Yras=[0,0,-1],this._Zras=[0,1,0],this._Cras=[0,0,0],this._tr=0,this._flipAngle=0,this._te=0,this._ti=0,this._fov=0,this._tags=[],this._origin=[0,0,0],this._imageOrient=[0,0,0,0,0,0],this._buffer=t.buffer,this._version=this._readInt(),this._swapEndian=!1,1==this._version);else{if(16777216!=this._version)throw new Error("MGH/MGZ parser: Unknown Endian.  Version reports: "+this._version);this._swapEndian=!0,this._version=this._swap32(this._version)}this._width=this._readInt(),this._height=this._readInt(),this._depth=this._readInt(),this._nframes=this._readInt(),this._type=this._readInt(),this._dof=this._readInt(),this._goodRASFlag=this._readShort(),this._spacingXYZ=this._readFloat(3),this._Xras=this._readFloat(3),this._Yras=this._readFloat(3),this._Zras=this._readFloat(3),this._Cras=this._readFloat(3),this._bufferPos=284;let i=this._width*this._height*this._depth*this._nframes;switch(this._width,this._height,this._depth,this._type){case s.MRI_UCHAR:this._pixelData=this._readUChar(i);break;case s.MRI_INT:this._pixelData=this._readInt(i);break;case s.MRI_FLOAT:this._pixelData=this._readFloat(i);break;case s.MRI_SHORT:this._pixelData=this._readShort(i);break;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}this._tr=this._readFloat(1),this._flipAngle=this._readFloat(1),this._te=this._readFloat(1),this._ti=this._readFloat(1),this._fov=this._readFloat(1);let n=new TextDecoder,a=this._tagReadStart();for(;null!=a[0];){let t,e=a[0],i=a[1];switch(e){case s.TAG_OLD_MGH_XFORM:case s.TAG_MGH_XFORM:}t=this._readChar(i),t=n.decode(t),this._tags.push({tagType:e,tagValue:t}),a=this._tagReadStart()}const o=(new r.P).fromArray(this._Xras),l=(new r.P).fromArray(this._Yras),h=(new r.P).crossVectors(o,l),c=(new r.P).fromArray(this._Zras);h.angleTo(c)>Math.PI/2&&(this._rightHanded=!1),this._imageOrient=[-this._Xras[0],-this._Xras[1],this._Xras[2],-this._Yras[0],-this._Yras[1],this._Yras[2]];let u=this._width/2,d=this._height/2,p=this._depth/2;for(let t=0;t<3;++t)this._origin[t]=this._Cras[t]-(this._Xras[t]*this._spacingXYZ[0]*u+this._Yras[t]*this._spacingXYZ[1]*d+this._Zras[t]*this._spacingXYZ[2]*p);this._origin=[-this._origin[0],-this._origin[1],this._origin[2]]}seriesInstanceUID(){return this._url}numberOfFrames(){return this._depth}sopInstanceUID(t=0){return t}rows(t=0){return this._width}columns(t=0){return this._height}pixelType(t=0){switch(this._type){case s.MRI_UCHAR:case s.MRI_INT:case s.MRI_SHORT:return 0;case s.MRI_FLOAT:return 1;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}bitsAllocated(t=0){switch(this._type){case s.MRI_UCHAR:return 8;case s.MRI_SHORT:return 16;case s.MRI_INT:case s.MRI_FLOAT:return 32;default:throw Error("MGH/MGZ parser: Unknown _type.  _type reports: "+this._type)}}pixelSpacing(t=0){return this._spacingXYZ}imageOrientation(t=0){return this._imageOrient}imagePosition(t=0){return this._origin}extractPixelData(t=0){let e=this._width*this._height;return this._pixelData.slice(t*e,(t+1)*e)}_readInt(t=1){let e,i=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*t));if(this._bufferPos+=4*t,1==t)e=i.getInt32(0,this._swapEndian);else{e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=i.getInt32(4*n,this._swapEndian)}return e}_readShort(t=1){let e,i=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+2*t));if(this._bufferPos+=2*t,1==t)e=i.getInt16(0,this._swapEndian);else{e=new Int16Array(t);for(let n=0;n<t;n++)e[n]=i.getInt16(2*n,this._swapEndian)}return e}_readLong(t=1){let e=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+8*t));this._bufferPos+=8*t;let i=new Uint16Array(t);for(let n=0;n<t;n++){let t=0,r=0;this._swapendian?t=4:r=4;let s=e.getInt32(8*n+t,this._swapEndian),a=e.getInt32(8*n+r,this._swapEndian);0!=s&&(console.log("Unable to read Int64 with high word: "+s+"low word: "+a),a=void 0),i[n]=a}return 0==t?void 0:1==t?i[0]:i}_readChar(t=1){let e,i=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+t));if(this._bufferPos+=t,1==t)e=i.getInt8(0,this._swapEndian);else{e=new Int8Array(t);for(let n=0;n<t;n++)e[n]=i.getInt8(n,this._swapEndian)}return e}_readUChar(t=1){let e,i=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+t));if(this._bufferPos+=t,1==t)e=i.getUint8(0,this._swapEndian);else{e=new Uint8Array(t);for(let n=0;n<t;n++)e[n]=i.getUint8(n,this._swapEndian)}return e}_readFloat(t=1){let e,i=new DataView(this._buffer.slice(this._bufferPos,this._bufferPos+4*t));if(this._bufferPos+=4*t,1==t)e=i.getFloat32(0,this._swapEndian);else{e=new Float32Array(t);for(let n=0;n<t;n++)e[n]=i.getFloat32(4*n,this._swapEndian)}return e}_tagReadStart(){if(this._bufferPos>=this._buffer.byteLength)return[void 0,void 0];let t,e=this._readInt();switch(e){case s.TAG_OLD_MGH_XFORM:t=this._readInt(),t-=1;break;case s.TAG_OLD_SURF_GEOM:case s.TAG_OLD_USEREALRAS:case s.TAG_OLD_COLORTABLE:t=0;break;default:t=this._readLong()}return null==t&&(e=void 0),[e,t]}}s.MRI_UCHAR=0,s.MRI_INT=1,s.MRI_LONG=2,s.MRI_FLOAT=3,s.MRI_SHORT=4,s.MRI_BITMAP=5,s.MRI_TENSOR=6,s.MRI_FLOAT_COMPLEX=7,s.MRI_DOUBLE_COMPLEX=8,s.MRI_RGB=9,s.TAG_OLD_COLORTABLE=1,s.TAG_OLD_USEREALRAS=2,s.TAG_CMDLINE=3,s.TAG_USEREALRAS=4,s.TAG_COLORTABLE=5,s.TAG_GCAMORPH_GEOM=10,s.TAG_GCAMORPH_TYPE=11,s.TAG_GCAMORPH_LABELS=12,s.TAG_OLD_SURF_GEOM=20,s.TAG_SURF_GEOM=21,s.TAG_OLD_MGH_XFORM=30,s.TAG_MGH_XFORM=31,s.TAG_GROUP_AVG_SURFACE_AREA=32,s.TAG_AUTO_ALIGN=33,s.TAG_SCALAR_DOUBLE=40,s.TAG_PEDIR=41,s.TAG_MRI_FRAME=42,s.TAG_FIELDSTRENGTH=43},9813:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(7368),r=i(4075),s=i.n(r);class a extends n.Z{constructor(t,e){if(super(),this._id=e,this._arrayBuffer=t.buffer,this._url=t.url,this._dataSet=null,this._niftiHeader=null,this._niftiImage=null,this._ordered=!0,this._orderedData=null,this._qfac=1,!s().isNIFTI(this._arrayBuffer))throw new Error("parsers.nifti could not parse the file");this._dataSet=s().readHeader(this._arrayBuffer),this._niftiImage=s().readImage(this._dataSet,this._arrayBuffer)}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.dims[3]}numberOfChannels(){let t=1;return this._dataSet.dims[0]>=5?(t=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?t=3:2304===this._dataSet.datatypeCode&&(t=4),t}sopInstanceUID(t=0){return t}rows(t=0){return this._dataSet.dims[2]}columns(t=0){return this._dataSet.dims[1]}pixelType(t=0){let e=0;return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(e=1),e}bitsAllocated(t=0){return this._dataSet.numBitsPerVoxel}pixelSpacing(t=0){return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}sliceThickness(){return null}imageOrientation(t=0){if(this._dataSet.qform_code>0){let t=0,e=this._dataSet.quatern_b,i=this._dataSet.quatern_c,n=this._dataSet.quatern_d;return t=1-(e*e+i*i+n*n),t<1e-7?(t=1/Math.sqrt(e*e+i*i+n*n),e*=t,i*=t,n*=t,t=0):t=Math.sqrt(t),this._dataSet.pixDims[0]<0&&(this._rightHanded=!1),[-(t*t+e*e-i*i-n*n),-2*(e*i+t*n),2*(e*n-t*i),-2*(e*i-t*n),-(t*t+i*i-e*e-n*n),2*(i*n+t*e)]}return this._dataSet.sform_code>0?[-this._dataSet.affine[0][0],-this._dataSet.affine[0][1],this._dataSet.affine[0][2],-this._dataSet.affine[1][0],-this._dataSet.affine[1][1],this._dataSet.affine[0][2]]:(this._dataSet.qform_code,[1,0,0,0,1,0])}imagePosition(t=0){return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}dimensionIndexValues(t=0){return null}instanceNumber(t=0){return t}windowCenter(t=0){return null}windowWidth(t=0){return null}rescaleSlope(t=0){return this._dataSet.scl_slope}rescaleIntercept(t=0){return this._dataSet.scl_inter}extractPixelData(t=0){return this._decompressUncompressed(t)}_decompressUncompressed(t=0){let e=this.numberOfChannels(),i=this.rows(t)*this.columns(t)*e,n=t*i,r=this._niftiImage;if(this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData)return this._orderedData.slice(n,n+i);if(2===this._dataSet.datatypeCode)return new Uint8Array(r,n,i);if(256===this._dataSet.datatypeCode)return new Int8Array(r,n,i);if(512===this._dataSet.datatypeCode)return n*=2,new Uint16Array(r,n,i);if(4===this._dataSet.datatypeCode)return n*=2,new Int16Array(r,n,i);if(8===this._dataSet.datatypeCode)return n*=4,new Int32Array(r,n,i);if(16===this._dataSet.datatypeCode){n*=4;const t=new Float32Array(r,n,i);for(let e=0;e<t.length;e++)t[e]!==1/0&&t[e]!==-1/0||(t[e]=0);return t}console.warn(`Unknown data type: datatypeCode : ${this._dataSet.datatypeCode}`)}_reorderData(){let t=this.numberOfChannels(),e=this.rows()*this.columns()*t,i=this._niftiImage,n=e*this.numberOfFrames(),r=null;this._orderedData=null,2===this._dataSet.datatypeCode?(r=new Uint8Array(i,0,n),this._orderedData=new Uint8Array(r.length)):256===this._dataSet.datatypeCode?(r=new Int8Array(i,0,n),this._orderedData=new Int8Array(r.length)):512===this._dataSet.datatypeCode?(r=new Uint16Array(i,0,n),this._orderedData=new Uint16Array(r.length)):4===this._dataSet.datatypeCode?(r=new Int16Array(i,0,n),this._orderedData=new Int16Array(r.length)):16===this._dataSet.datatypeCode&&(r=new Float32Array(i,0,n),this._orderedData=new Float32Array(r.length));let s=r.length/3,a=0,o=0,l=s,h=2*s;for(let t=0;t<s;t++)this._orderedData[a++]=r[o++],this._orderedData[a++]=r[l++],this._orderedData[a++]=r[h++];this._ordered=!0}}},9286:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var n=i(7368),r=i(7802);let s=i(9591),a=i(757);class o extends n.Z{constructor(t,e){super(),this._id=e,this._arrayBuffer=t.buffer,this._url=t.url,this._dataSet=null,this._unpackedData=null;try{this._dataSet=a.parse(this._arrayBuffer)}catch(t){console.log("ooops... :(")}}rightHanded(){return this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/)?this._rightHanded=!0:this._rightHanded=!1,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.sizes[2]}numberOfChannels(){return 1}sopInstanceUID(t=0){return t}rows(t=0){return this._dataSet.sizes[1]}columns(t=0){return this._dataSet.sizes[0]}pixelType(t=0){let e=0;return"float"===this._dataSet.type&&(e=1),e}bitsAllocated(t=0){let e=1;return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?e=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?e=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(e=32),e}pixelSpacing(t=0){const e=new r.P(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2]),i=new r.P(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),n=new r.P(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[e.length(),i.length(),n.length()]}imageOrientation(t=0){let e=this._dataSet.space.match(/right/)?-1:1,i=this._dataSet.space.match(/anterior/)?-1:1,n=new r.P(this._dataSet.spaceDirections[0][0]*e,this._dataSet.spaceDirections[0][1]*i,this._dataSet.spaceDirections[0][2]);n.normalize();let s=new r.P(this._dataSet.spaceDirections[1][0]*e,this._dataSet.spaceDirections[1][1]*i,this._dataSet.spaceDirections[1][2]);return s.normalize(),[n.x,n.y,n.z,s.x,s.y,s.z]}imagePosition(t=0){return[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]}extractPixelData(t=0){return this._decompressUncompressed(t)}_decompressUncompressed(t=0){let e=this._dataSet.buffer;const i=this.numberOfChannels(),n=this.rows(t)*this.columns(t)*i;this.rightHanded()||(t=this.numberOfFrames()-1-t);let r=t*n;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){let t=s.inflate(this._dataSet.buffer);this._unpackedData=t.buffer,e=this._unpackedData}else"gzip"===this._dataSet.encoding&&(e=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?new Int8Array(e,r,n):"uint8"===this._dataSet.type?new Uint8Array(e,r,n):"int16"===this._dataSet.type||"short"===this._dataSet.type?(r*=2,new Int16Array(e,r,n)):"uint16"===this._dataSet.type?(r*=2,new Uint16Array(e,r,n)):"int32"===this._dataSet.type?(r*=4,new Int32Array(e,r,n)):"uint32"===this._dataSet.type?(r*=4,new Uint32Array(e,r,n)):"float"===this._dataSet.type?(r*=4,new Float32Array(e,r,n)):void 0}}},7368:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{constructor(){this._rightHanded=!0}pixelRepresentation(){return 0}pixelPaddingValue(t=0){return null}modality(){return"unknown"}segmentationType(){return"unknown"}segmentationSegments(){return[]}referencedSegmentNumber(t){return-1}rightHanded(){return this._rightHanded}spacingBetweenSlices(){return null}numberOfChannels(){return 1}sliceThickness(){return null}dimensionIndexValues(t=0){return null}instanceNumber(t=0){return t}windowCenter(t=0){return null}windowWidth(t=0){return null}rescaleSlope(t=0){return 1}rescaleIntercept(t=0){return 0}ultrasoundRegions(t=0){return[]}frameTime(t=0){return null}_decompressUncompressed(){}_swap16(t){return(255&t)<<8|t>>8&255}_swap32(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}invert(){return!1}transferSyntaxUID(){return"no value provided"}studyDate(){return"no value provided"}studyDescription(){return"no value provided"}seriesDate(){return"no value provided"}seriesDescription(){return"no value provided"}rawHeader(){return"no value provided"}patientID(){return"no value provided"}patientName(){return"no value provided"}patientAge(){return"no value provided"}patientBirthdate(){return"no value provided"}patientSex(){return"no value provided"}minMaxPixelData(t=[]){let e=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],i=t.length;for(let n=0;n<i;n++){let i=t[n];e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],i)}return e}}},3974:(t,e,i)=>{"use strict";i.r(e),i.d(e,{SegmentationPreset:()=>r});const n={0:{color:[0,0,0],opacity:0,label:"Unknown"},1:{color:[70,130,180],opacity:1,label:"Left-Cerebral-Exterior"},2:{color:[245,245,245],opacity:1,label:"Left-Cerebral-White-Matter"},3:{color:[205,62,78],opacity:1,label:"Left-Cerebral-Cortex"},4:{color:[120,18,134],opacity:1,label:"Left-Lateral-Ventricle"},5:{color:[196,58,250],opacity:1,label:"Left-Inf-Lat-Vent"},6:{color:[0,148,0],opacity:1,label:"Left-Cerebellum-Exterior"},7:{color:[220,248,164],opacity:1,label:"Left-Cerebellum-White-Matter"},8:{color:[230,148,34],opacity:1,label:"Left-Cerebellum-Cortex"},9:{color:[0,118,14],opacity:1,label:"Left-Thalamus"},10:{color:[0,118,14],opacity:1,label:"Left-Thalamus-Proper"},11:{color:[122,186,220],opacity:1,label:"Left-Caudate"},12:{color:[236,13,176],opacity:1,label:"Left-Putamen"},13:{color:[12,48,255],opacity:1,label:"Left-Pallidum"},14:{color:[204,182,142],opacity:1,label:"3rd-Ventricle"},15:{color:[42,204,164],opacity:1,label:"4th-Ventricle"},16:{color:[119,159,176],opacity:1,label:"Brain-Stem"},17:{color:[220,216,20],opacity:1,label:"Left-Hippocampus"},18:{color:[103,255,255],opacity:1,label:"Left-Amygdala"},19:{color:[80,196,98],opacity:1,label:"Left-Insula"},20:{color:[60,58,210],opacity:1,label:"Left-Operculum"},21:{color:[60,58,210],opacity:1,label:"Line-1"},22:{color:[60,58,210],opacity:1,label:"Line-2"},23:{color:[60,58,210],opacity:1,label:"Line-3"},24:{color:[60,60,60],opacity:1,label:"CSF"},25:{color:[255,165,0],opacity:1,label:"Left-Lesion"},26:{color:[255,165,0],opacity:1,label:"Left-Accumbens-area"},27:{color:[0,255,127],opacity:1,label:"Left-Substancia-Nigra"},28:{color:[165,42,42],opacity:1,label:"Left-VentralDC"},29:{color:[135,206,235],opacity:1,label:"Left-undetermined"},30:{color:[160,32,240],opacity:1,label:"Left-vessel"},31:{color:[0,200,200],opacity:1,label:"Left-choroid-plexus"},32:{color:[100,50,100],opacity:1,label:"Left-F3orb"},33:{color:[135,50,74],opacity:1,label:"Left-lOg"},34:{color:[122,135,50],opacity:1,label:"Left-aOg"},35:{color:[51,50,135],opacity:1,label:"Left-mOg"},36:{color:[74,155,60],opacity:1,label:"Left-pOg"},37:{color:[120,62,43],opacity:1,label:"Left-Stellate"},38:{color:[74,155,60],opacity:1,label:"Left-Porg"},39:{color:[122,135,50],opacity:1,label:"Left-Aorg"},40:{color:[70,130,180],opacity:1,label:"Right-Cerebral-Exterior"},41:{color:[245,245,245],opacity:1,label:"Right-Cerebral-White-Matter"},42:{color:[205,62,78],opacity:1,label:"Right-Cerebral-Cortex"},43:{color:[120,18,134],opacity:1,label:"Right-Lateral-Ventricle"},44:{color:[196,58,250],opacity:1,label:"Right-Inf-Lat-Vent"},45:{color:[0,148,0],opacity:1,label:"Right-Cerebellum-Exterior"},46:{color:[220,248,164],opacity:1,label:"Right-Cerebellum-White-Matter"},47:{color:[230,148,34],opacity:1,label:"Right-Cerebellum-Cortex"},48:{color:[0,118,14],opacity:1,label:"Right-Thalamus"},49:{color:[0,118,14],opacity:1,label:"Right-Thalamus-Proper"},50:{color:[122,186,220],opacity:1,label:"Right-Caudate"},51:{color:[236,13,176],opacity:1,label:"Right-Putamen"},52:{color:[13,48,255],opacity:1,label:"Right-Pallidum"},53:{color:[220,216,20],opacity:1,label:"Right-Hippocampus"},54:{color:[103,255,255],opacity:1,label:"Right-Amygdala"},55:{color:[80,196,98],opacity:1,label:"Right-Insula"},56:{color:[60,58,210],opacity:1,label:"Right-Operculum"},57:{color:[255,165,0],opacity:1,label:"Right-Lesion"},58:{color:[255,165,0],opacity:1,label:"Right-Accumbens-area"},59:{color:[0,255,127],opacity:1,label:"Right-Substancia-Nigra"},60:{color:[165,42,42],opacity:1,label:"Right-VentralDC"},61:{color:[135,206,235],opacity:1,label:"Right-undetermined"},62:{color:[160,32,240],opacity:1,label:"Right-vessel"},63:{color:[0,200,221],opacity:1,label:"Right-choroid-plexus"},64:{color:[100,50,100],opacity:1,label:"Right-F3orb"},65:{color:[135,50,74],opacity:1,label:"Right-lOg"},66:{color:[122,135,50],opacity:1,label:"Right-aOg"},67:{color:[51,50,135],opacity:1,label:"Right-mOg"},68:{color:[74,155,60],opacity:1,label:"Right-pOg"},69:{color:[120,62,43],opacity:1,label:"Right-Stellate"},70:{color:[74,155,60],opacity:1,label:"Right-Porg"},71:{color:[122,135,50],opacity:1,label:"Right-Aorg"},72:{color:[120,190,150],opacity:1,label:"5th-Ventricle"},73:{color:[122,135,50],opacity:1,label:"Left-Interior"},74:{color:[122,135,50],opacity:1,label:"Right-Interior"},77:{color:[200,70,255],opacity:1,label:"WM-hypointensities"},78:{color:[255,148,10],opacity:1,label:"Left-WM-hypointensities"},79:{color:[255,148,10],opacity:1,label:"Right-WM-hypointensities"},80:{color:[164,108,226],opacity:1,label:"non-WM-hypointensities"},81:{color:[164,108,226],opacity:1,label:"Left-non-WM-hypointensities"},82:{color:[164,108,226],opacity:1,label:"Right-non-WM-hypointensities"},83:{color:[255,218,185],opacity:1,label:"Left-F1"},84:{color:[255,218,185],opacity:1,label:"Right-F1"},85:{color:[234,169,30],opacity:1,label:"Optic-Chiasm"},192:{color:[250,255,50],opacity:1,label:"Corpus_Callosum"},86:{color:[200,120,255],opacity:1,label:"Left_future_WMSA"},87:{color:[200,121,255],opacity:1,label:"Right_future_WMSA"},88:{color:[200,122,255],opacity:1,label:"future_WMSA"},96:{color:[205,10,125],opacity:1,label:"Left-Amygdala-Anterior"},97:{color:[205,10,125],opacity:1,label:"Right-Amygdala-Anterior"},98:{color:[160,32,240],opacity:1,label:"Dura"},100:{color:[124,140,178],opacity:1,label:"Left-wm-intensity-abnormality"},101:{color:[125,140,178],opacity:1,label:"Left-caudate-intensity-abnormality"},102:{color:[126,140,178],opacity:1,label:"Left-putamen-intensity-abnormality"},103:{color:[127,140,178],opacity:1,label:"Left-accumbens-intensity-abnormality"},104:{color:[124,141,178],opacity:1,label:"Left-pallidum-intensity-abnormality"},105:{color:[124,142,178],opacity:1,label:"Left-amygdala-intensity-abnormality"},106:{color:[124,143,178],opacity:1,label:"Left-hippocampus-intensity-abnormality"},107:{color:[124,144,178],opacity:1,label:"Left-thalamus-intensity-abnormality"},108:{color:[124,140,179],opacity:1,label:"Left-VDC-intensity-abnormality"},109:{color:[124,140,178],opacity:1,label:"Right-wm-intensity-abnormality"},110:{color:[125,140,178],opacity:1,label:"Right-caudate-intensity-abnormality"},111:{color:[126,140,178],opacity:1,label:"Right-putamen-intensity-abnormality"},112:{color:[127,140,178],opacity:1,label:"Right-accumbens-intensity-abnormality"},113:{color:[124,141,178],opacity:1,label:"Right-pallidum-intensity-abnormality"},114:{color:[124,142,178],opacity:1,label:"Right-amygdala-intensity-abnormality"},115:{color:[124,143,178],opacity:1,label:"Right-hippocampus-intensity-abnormality"},116:{color:[124,144,178],opacity:1,label:"Right-thalamus-intensity-abnormality"},117:{color:[124,140,179],opacity:1,label:"Right-VDC-intensity-abnormality"},118:{color:[255,20,147],opacity:1,label:"Epidermis"},119:{color:[205,179,139],opacity:1,label:"Conn-Tissue"},120:{color:[238,238,209],opacity:1,label:"SC-Fat-Muscle"},121:{color:[200,200,200],opacity:1,label:"Cranium"},122:{color:[74,255,74],opacity:1,label:"CSF-SA"},123:{color:[238,0,0],opacity:1,label:"Muscle"},124:{color:[0,0,139],opacity:1,label:"Ear"},125:{color:[173,255,47],opacity:1,label:"Adipose"},126:{color:[133,203,229],opacity:1,label:"Spinal-Cord"},127:{color:[26,237,57],opacity:1,label:"Soft-Tissue"},128:{color:[34,139,34],opacity:1,label:"Nerve"},129:{color:[30,144,255],opacity:1,label:"Bone"},130:{color:[147,19,173],opacity:1,label:"Air"},131:{color:[238,59,59],opacity:1,label:"Orbital-Fat"},132:{color:[221,39,200],opacity:1,label:"Tongue"},133:{color:[238,174,238],opacity:1,label:"Nasal-Structures"},134:{color:[255,0,0],opacity:1,label:"Globe"},135:{color:[72,61,139],opacity:1,label:"Teeth"},136:{color:[21,39,132],opacity:1,label:"Left-Caudate-Putamen"},137:{color:[21,39,132],opacity:1,label:"Right-Caudate-Putamen"},138:{color:[65,135,20],opacity:1,label:"Left-Claustrum"},139:{color:[65,135,20],opacity:1,label:"Right-Claustrum"},140:{color:[134,4,160],opacity:1,label:"Cornea"},142:{color:[221,226,68],opacity:1,label:"Diploe"},143:{color:[255,255,254],opacity:1,label:"Vitreous-Humor"},144:{color:[52,209,226],opacity:1,label:"Lens"},145:{color:[239,160,223],opacity:1,label:"Aqueous-Humor"},146:{color:[70,130,180],opacity:1,label:"Outer-Table"},147:{color:[70,130,181],opacity:1,label:"Inner-Table"},148:{color:[139,121,94],opacity:1,label:"Periosteum"},149:{color:[224,224,224],opacity:1,label:"Endosteum"},150:{color:[255,0,0],opacity:1,label:"R-C-S"},151:{color:[205,205,0],opacity:1,label:"Iris"},152:{color:[238,238,209],opacity:1,label:"SC-Adipose-Muscle"},153:{color:[139,121,94],opacity:1,label:"SC-Tissue"},154:{color:[238,59,59],opacity:1,label:"Orbital-Adipose"},155:{color:[238,59,59],opacity:1,label:"Left-IntCapsule-Ant"},156:{color:[238,59,59],opacity:1,label:"Right-IntCapsule-Ant"},157:{color:[62,10,205],opacity:1,label:"Left-IntCapsule-Pos"},158:{color:[62,10,205],opacity:1,label:"Right-IntCapsule-Pos"},159:{color:[0,118,14],opacity:1,label:"Left-Cerebral-WM-unmyelinated"},160:{color:[0,118,14],opacity:1,label:"Right-Cerebral-WM-unmyelinated"},161:{color:[220,216,21],opacity:1,label:"Left-Cerebral-WM-myelinated"},162:{color:[220,216,21],opacity:1,label:"Right-Cerebral-WM-myelinated"},163:{color:[122,186,220],opacity:1,label:"Left-Subcortical-Gray-Matter"},164:{color:[122,186,220],opacity:1,label:"Right-Subcortical-Gray-Matter"},165:{color:[120,120,120],opacity:1,label:"Skull"},166:{color:[14,48,255],opacity:1,label:"Posterior-fossa"},167:{color:[166,42,42],opacity:1,label:"Scalp"},168:{color:[121,18,134],opacity:1,label:"Hematoma"},169:{color:[236,13,127],opacity:1,label:"Left-Basal-Ganglia"},176:{color:[236,13,126],opacity:1,label:"Right-Basal-Ganglia"},170:{color:[119,159,176],opacity:1,label:"brainstem"},171:{color:[119,0,176],opacity:1,label:"DCG"},172:{color:[119,100,176],opacity:1,label:"Vermis"},173:{color:[242,104,76],opacity:1,label:"Midbrain"},174:{color:[206,195,58],opacity:1,label:"Pons"},175:{color:[119,159,176],opacity:1,label:"Medulla"},177:{color:[119,50,176],opacity:1,label:"Vermis-White-Matter"},178:{color:[142,182,0],opacity:1,label:"SCP"},179:{color:[19,100,176],opacity:1,label:"Floculus"},180:{color:[73,61,139],opacity:1,label:"Left-Cortical-Dysplasia"},181:{color:[73,62,139],opacity:1,label:"Right-Cortical-Dysplasia"},182:{color:[10,100,176],opacity:1,label:"CblumNodulus"},193:{color:[0,196,255],opacity:1,label:"Left-hippocampal_fissure"},194:{color:[255,164,164],opacity:1,label:"Left-CADG-head"},195:{color:[196,196,0],opacity:1,label:"Left-subiculum"},196:{color:[0,100,255],opacity:1,label:"Left-fimbria"},197:{color:[128,196,164],opacity:1,label:"Right-hippocampal_fissure"},198:{color:[0,126,75],opacity:1,label:"Right-CADG-head"},199:{color:[128,96,64],opacity:1,label:"Right-subiculum"},200:{color:[0,50,128],opacity:1,label:"Right-fimbria"},201:{color:[255,204,153],opacity:1,label:"alveus"},202:{color:[255,128,128],opacity:1,label:"perforant_pathway"},203:{color:[255,255,0],opacity:1,label:"parasubiculum"},204:{color:[64,0,64],opacity:1,label:"presubiculum"},205:{color:[0,0,255],opacity:1,label:"subiculum"},206:{color:[255,0,0],opacity:1,label:"CA1"},207:{color:[128,128,255],opacity:1,label:"CA2"},208:{color:[0,128,0],opacity:1,label:"CA3"},209:{color:[196,160,128],opacity:1,label:"CA4"},210:{color:[32,200,255],opacity:1,label:"GC-DG"},211:{color:[128,255,128],opacity:1,label:"HATA"},212:{color:[204,153,204],opacity:1,label:"fimbria"},213:{color:[121,17,136],opacity:1,label:"lateral_ventricle"},214:{color:[128,0,0],opacity:1,label:"molecular_layer_HP"},215:{color:[128,32,255],opacity:1,label:"hippocampal_fissure"},216:{color:[255,204,102],opacity:1,label:"entorhinal_cortex"},217:{color:[128,128,128],opacity:1,label:"molecular_layer_subiculum"},218:{color:[104,255,255],opacity:1,label:"Amygdala"},219:{color:[0,226,0],opacity:1,label:"Cerebral_White_Matter"},220:{color:[205,63,78],opacity:1,label:"Cerebral_Cortex"},221:{color:[197,58,250],opacity:1,label:"Inf_Lat_Vent"},222:{color:[33,150,250],opacity:1,label:"Perirhinal"},223:{color:[226,0,0],opacity:1,label:"Cerebral_White_Matter_Edge"},224:{color:[100,100,100],opacity:1,label:"Background"},225:{color:[197,150,250],opacity:1,label:"Ectorhinal"},226:{color:[170,170,255],opacity:1,label:"HP_tail"},250:{color:[255,0,0],opacity:1,label:"Fornix"},251:{color:[0,0,64],opacity:1,label:"CC_Posterior"},252:{color:[0,0,112],opacity:1,label:"CC_Mid_Posterior"},253:{color:[0,0,160],opacity:1,label:"CC_Central"},254:{color:[0,0,208],opacity:1,label:"CC_Mid_Anterior"},255:{color:[0,0,255],opacity:1,label:"CC_Anterior"},256:{color:[0,0,0],opacity:1,label:"Voxel-Unchanged"},257:{color:[60,60,60],opacity:1,label:"CSF-ExtraCerebral"},258:{color:[150,150,200],opacity:1,label:"Head-ExtraCerebral"},259:{color:[120,120,120],opacity:1,label:"SkullApprox"},260:{color:[119,159,176],opacity:1,label:"BoneOrAir"},261:{color:[120,18,134],opacity:1,label:"PossibleFluid"},262:{color:[119,159,176],opacity:1,label:"Sinus"},263:{color:[119,159,176],opacity:1,label:"Left-Eustachian"},264:{color:[119,159,176],opacity:1,label:"Right-Eustachian"},331:{color:[255,0,0],opacity:1,label:"Aorta"},332:{color:[255,80,0],opacity:1,label:"Left-Common-IliacA"},333:{color:[255,160,0],opacity:1,label:"Right-Common-IliacA"},334:{color:[255,255,0],opacity:1,label:"Left-External-IliacA"},335:{color:[0,255,0],opacity:1,label:"Right-External-IliacA"},336:{color:[255,0,160],opacity:1,label:"Left-Internal-IliacA"},337:{color:[255,0,255],opacity:1,label:"Right-Internal-IliacA"},338:{color:[255,50,80],opacity:1,label:"Left-Lateral-SacralA"},339:{color:[80,255,50],opacity:1,label:"Right-Lateral-SacralA"},340:{color:[160,255,50],opacity:1,label:"Left-ObturatorA"},341:{color:[160,200,255],opacity:1,label:"Right-ObturatorA"},342:{color:[0,255,160],opacity:1,label:"Left-Internal-PudendalA"},343:{color:[0,0,255],opacity:1,label:"Right-Internal-PudendalA"},344:{color:[80,50,255],opacity:1,label:"Left-UmbilicalA"},345:{color:[160,0,255],opacity:1,label:"Right-UmbilicalA"},346:{color:[255,210,0],opacity:1,label:"Left-Inf-RectalA"},347:{color:[0,160,255],opacity:1,label:"Right-Inf-RectalA"},348:{color:[255,200,80],opacity:1,label:"Left-Common-IliacV"},349:{color:[255,200,160],opacity:1,label:"Right-Common-IliacV"},350:{color:[255,80,200],opacity:1,label:"Left-External-IliacV"},351:{color:[255,160,200],opacity:1,label:"Right-External-IliacV"},352:{color:[30,255,80],opacity:1,label:"Left-Internal-IliacV"},353:{color:[80,200,255],opacity:1,label:"Right-Internal-IliacV"},354:{color:[80,255,200],opacity:1,label:"Left-ObturatorV"},355:{color:[195,255,200],opacity:1,label:"Right-ObturatorV"},356:{color:[120,200,20],opacity:1,label:"Left-Internal-PudendalV"},357:{color:[170,10,200],opacity:1,label:"Right-Internal-PudendalV"},358:{color:[20,130,180],opacity:1,label:"Pos-Lymph"},359:{color:[20,180,130],opacity:1,label:"Neg-Lymph"},400:{color:[206,62,78],opacity:1,label:"V1"},401:{color:[121,18,134],opacity:1,label:"V2"},402:{color:[199,58,250],opacity:1,label:"BA44"},403:{color:[1,148,0],opacity:1,label:"BA45"},404:{color:[221,248,164],opacity:1,label:"BA4a"},405:{color:[231,148,34],opacity:1,label:"BA4p"},406:{color:[1,118,14],opacity:1,label:"BA6"},407:{color:[120,118,14],opacity:1,label:"BA2"},408:{color:[123,186,221],opacity:1,label:"BA1_old"},409:{color:[238,13,177],opacity:1,label:"BAun2"},410:{color:[123,186,220],opacity:1,label:"BA1"},411:{color:[138,13,206],opacity:1,label:"BA2b"},412:{color:[238,130,176],opacity:1,label:"BA3a"},413:{color:[218,230,76],opacity:1,label:"BA3b"},414:{color:[38,213,176],opacity:1,label:"MT"},415:{color:[1,225,176],opacity:1,label:"AIPS_AIP_l"},416:{color:[1,225,176],opacity:1,label:"AIPS_AIP_r"},417:{color:[200,2,100],opacity:1,label:"AIPS_VIP_l"},418:{color:[200,2,100],opacity:1,label:"AIPS_VIP_r"},419:{color:[5,200,90],opacity:1,label:"IPL_PFcm_l"},420:{color:[5,200,90],opacity:1,label:"IPL_PFcm_r"},421:{color:[100,5,200],opacity:1,label:"IPL_PF_l"},422:{color:[25,255,100],opacity:1,label:"IPL_PFm_l"},423:{color:[25,255,100],opacity:1,label:"IPL_PFm_r"},424:{color:[230,7,100],opacity:1,label:"IPL_PFop_l"},425:{color:[230,7,100],opacity:1,label:"IPL_PFop_r"},426:{color:[100,5,200],opacity:1,label:"IPL_PF_r"},427:{color:[150,10,200],opacity:1,label:"IPL_PFt_l"},428:{color:[150,10,200],opacity:1,label:"IPL_PFt_r"},429:{color:[175,10,176],opacity:1,label:"IPL_PGa_l"},430:{color:[175,10,176],opacity:1,label:"IPL_PGa_r"},431:{color:[10,100,255],opacity:1,label:"IPL_PGp_l"},432:{color:[10,100,255],opacity:1,label:"IPL_PGp_r"},433:{color:[150,45,70],opacity:1,label:"Visual_V3d_l"},434:{color:[150,45,70],opacity:1,label:"Visual_V3d_r"},435:{color:[45,200,15],opacity:1,label:"Visual_V4_l"},436:{color:[45,200,15],opacity:1,label:"Visual_V4_r"},437:{color:[227,45,100],opacity:1,label:"Visual_V5_b"},438:{color:[227,45,100],opacity:1,label:"Visual_VP_l"},439:{color:[227,45,100],opacity:1,label:"Visual_VP_r"},498:{color:[143,188,143],opacity:1,label:"wmsa"},499:{color:[255,248,220],opacity:1,label:"other_wmsa"},500:{color:[17,85,136],opacity:1,label:"right_CA2_3"},501:{color:[119,187,102],opacity:1,label:"right_alveus"},502:{color:[204,68,34],opacity:1,label:"right_CA1"},503:{color:[204,0,255],opacity:1,label:"right_fimbria"},504:{color:[221,187,17],opacity:1,label:"right_presubiculum"},505:{color:[153,221,238],opacity:1,label:"right_hippocampal_fissure"},506:{color:[51,17,17],opacity:1,label:"right_CA4_DG"},507:{color:[0,119,85],opacity:1,label:"right_subiculum"},508:{color:[20,100,200],opacity:1,label:"right_fornix"},550:{color:[17,85,137],opacity:1,label:"left_CA2_3"},551:{color:[119,187,103],opacity:1,label:"left_alveus"},552:{color:[204,68,35],opacity:1,label:"left_CA1"},553:{color:[204,0,254],opacity:1,label:"left_fimbria"},554:{color:[221,187,16],opacity:1,label:"left_presubiculum"},555:{color:[153,221,239],opacity:1,label:"left_hippocampal_fissure"},556:{color:[51,17,18],opacity:1,label:"left_CA4_DG"},557:{color:[0,119,86],opacity:1,label:"left_subiculum"},558:{color:[20,100,201],opacity:1,label:"left_fornix"},600:{color:[254,254,254],opacity:1,label:"Tumor"},601:{color:[70,130,180],opacity:1,label:"Cbm_Left_I_IV"},602:{color:[245,245,245],opacity:1,label:"Cbm_Right_I_IV"},603:{color:[205,62,78],opacity:1,label:"Cbm_Left_V"},604:{color:[120,18,134],opacity:1,label:"Cbm_Right_V"},605:{color:[196,58,250],opacity:1,label:"Cbm_Left_VI"},606:{color:[0,148,0],opacity:1,label:"Cbm_Vermis_VI"},607:{color:[220,248,164],opacity:1,label:"Cbm_Right_VI"},608:{color:[230,148,34],opacity:1,label:"Cbm_Left_CrusI"},609:{color:[0,118,14],opacity:1,label:"Cbm_Vermis_CrusI"},610:{color:[0,118,14],opacity:1,label:"Cbm_Right_CrusI"},611:{color:[122,186,220],opacity:1,label:"Cbm_Left_CrusII"},612:{color:[236,13,176],opacity:1,label:"Cbm_Vermis_CrusII"},613:{color:[12,48,255],opacity:1,label:"Cbm_Right_CrusII"},614:{color:[204,182,142],opacity:1,label:"Cbm_Left_VIIb"},615:{color:[42,204,164],opacity:1,label:"Cbm_Vermis_VIIb"},616:{color:[119,159,176],opacity:1,label:"Cbm_Right_VIIb"},617:{color:[220,216,20],opacity:1,label:"Cbm_Left_VIIIa"},618:{color:[103,255,255],opacity:1,label:"Cbm_Vermis_VIIIa"},619:{color:[80,196,98],opacity:1,label:"Cbm_Right_VIIIa"},620:{color:[60,58,210],opacity:1,label:"Cbm_Left_VIIIb"},621:{color:[60,58,210],opacity:1,label:"Cbm_Vermis_VIIIb"},622:{color:[60,58,210],opacity:1,label:"Cbm_Right_VIIIb"},623:{color:[60,58,210],opacity:1,label:"Cbm_Left_IX"},624:{color:[60,60,60],opacity:1,label:"Cbm_Vermis_IX"},625:{color:[255,165,0],opacity:1,label:"Cbm_Right_IX"},626:{color:[255,165,0],opacity:1,label:"Cbm_Left_X"},627:{color:[0,255,127],opacity:1,label:"Cbm_Vermis_X"},628:{color:[165,42,42],opacity:1,label:"Cbm_Right_X"},640:{color:[204,0,0],opacity:1,label:"Cbm_Right_I_V_med"},641:{color:[255,0,0],opacity:1,label:"Cbm_Right_I_V_mid"},642:{color:[0,0,255],opacity:1,label:"Cbm_Right_VI_med"},643:{color:[30,144,255],opacity:1,label:"Cbm_Right_VI_mid"},644:{color:[100,212,237],opacity:1,label:"Cbm_Right_VI_lat"},645:{color:[218,165,32],opacity:1,label:"Cbm_Right_CrusI_med"},646:{color:[255,215,0],opacity:1,label:"Cbm_Right_CrusI_mid"},647:{color:[255,255,166],opacity:1,label:"Cbm_Right_CrusI_lat"},648:{color:[153,0,204],opacity:1,label:"Cbm_Right_CrusII_med"},649:{color:[153,141,209],opacity:1,label:"Cbm_Right_CrusII_mid"},650:{color:[204,204,255],opacity:1,label:"Cbm_Right_CrusII_lat"},651:{color:[31,212,194],opacity:1,label:"Cbm_Right_7med"},652:{color:[3,255,237],opacity:1,label:"Cbm_Right_7mid"},653:{color:[204,255,255],opacity:1,label:"Cbm_Right_7lat"},654:{color:[86,74,147],opacity:1,label:"Cbm_Right_8med"},655:{color:[114,114,190],opacity:1,label:"Cbm_Right_8mid"},656:{color:[184,178,255],opacity:1,label:"Cbm_Right_8lat"},657:{color:[126,138,37],opacity:1,label:"Cbm_Right_PUNs"},658:{color:[189,197,117],opacity:1,label:"Cbm_Right_TONs"},659:{color:[240,230,140],opacity:1,label:"Cbm_Right_FLOs"},660:{color:[204,0,0],opacity:1,label:"Cbm_Left_I_V_med"},661:{color:[255,0,0],opacity:1,label:"Cbm_Left_I_V_mid"},662:{color:[0,0,255],opacity:1,label:"Cbm_Left_VI_med"},663:{color:[30,144,255],opacity:1,label:"Cbm_Left_VI_mid"},664:{color:[100,212,237],opacity:1,label:"Cbm_Left_VI_lat"},665:{color:[218,165,32],opacity:1,label:"Cbm_Left_CrusI_med"},666:{color:[255,215,0],opacity:1,label:"Cbm_Left_CrusI_mid"},667:{color:[255,255,166],opacity:1,label:"Cbm_Left_CrusI_lat"},668:{color:[153,0,204],opacity:1,label:"Cbm_Left_CrusII_med"},669:{color:[153,141,209],opacity:1,label:"Cbm_Left_CrusII_mid"},670:{color:[204,204,255],opacity:1,label:"Cbm_Left_CrusII_lat"},671:{color:[31,212,194],opacity:1,label:"Cbm_Left_7med"},672:{color:[3,255,237],opacity:1,label:"Cbm_Left_7mid"},673:{color:[204,255,255],opacity:1,label:"Cbm_Left_7lat"},674:{color:[86,74,147],opacity:1,label:"Cbm_Left_8med"},675:{color:[114,114,190],opacity:1,label:"Cbm_Left_8mid"},676:{color:[184,178,255],opacity:1,label:"Cbm_Left_8lat"},677:{color:[126,138,37],opacity:1,label:"Cbm_Left_PUNs"},678:{color:[189,197,117],opacity:1,label:"Cbm_Left_TONs"},679:{color:[240,230,140],opacity:1,label:"Cbm_Left_FLOs"},690:{color:[122,135,50],opacity:1,label:"CbmWM_Gyri_Left"},691:{color:[122,135,50],opacity:1,label:"CbmWM_Gyri_Right"},701:{color:[120,18,134],opacity:1,label:"CSF-FSL-FAST"},702:{color:[205,62,78],opacity:1,label:"GrayMatter-FSL-FAST"},703:{color:[0,225,0],opacity:1,label:"WhiteMatter-FSL-FAST"},999:{color:[255,100,100],opacity:1,label:"SUSPICIOUS"},1e3:{color:[25,5,25],opacity:1,label:"ctx-lh-unknown"},1001:{color:[25,100,40],opacity:1,label:"ctx-lh-bankssts"},1002:{color:[125,100,160],opacity:1,label:"ctx-lh-caudalanteriorcingulate"},1003:{color:[100,25,0],opacity:1,label:"ctx-lh-caudalmiddlefrontal"},1004:{color:[120,70,50],opacity:1,label:"ctx-lh-corpuscallosum"},1005:{color:[220,20,100],opacity:1,label:"ctx-lh-cuneus"},1006:{color:[220,20,10],opacity:1,label:"ctx-lh-entorhinal"},1007:{color:[180,220,140],opacity:1,label:"ctx-lh-fusiform"},1008:{color:[220,60,220],opacity:1,label:"ctx-lh-inferiorparietal"},1009:{color:[180,40,120],opacity:1,label:"ctx-lh-inferiortemporal"},1010:{color:[140,20,140],opacity:1,label:"ctx-lh-isthmuscingulate"},1011:{color:[20,30,140],opacity:1,label:"ctx-lh-lateraloccipital"},1012:{color:[35,75,50],opacity:1,label:"ctx-lh-lateralorbitofrontal"},1013:{color:[225,140,140],opacity:1,label:"ctx-lh-lingual"},1014:{color:[200,35,75],opacity:1,label:"ctx-lh-medialorbitofrontal"},1015:{color:[160,100,50],opacity:1,label:"ctx-lh-middletemporal"},1016:{color:[20,220,60],opacity:1,label:"ctx-lh-parahippocampal"},1017:{color:[60,220,60],opacity:1,label:"ctx-lh-paracentral"},1018:{color:[220,180,140],opacity:1,label:"ctx-lh-parsopercularis"},1019:{color:[20,100,50],opacity:1,label:"ctx-lh-parsorbitalis"},1020:{color:[220,60,20],opacity:1,label:"ctx-lh-parstriangularis"},1021:{color:[120,100,60],opacity:1,label:"ctx-lh-pericalcarine"},1022:{color:[220,20,20],opacity:1,label:"ctx-lh-postcentral"},1023:{color:[220,180,220],opacity:1,label:"ctx-lh-posteriorcingulate"},1024:{color:[60,20,220],opacity:1,label:"ctx-lh-precentral"},1025:{color:[160,140,180],opacity:1,label:"ctx-lh-precuneus"},1026:{color:[80,20,140],opacity:1,label:"ctx-lh-rostralanteriorcingulate"},1027:{color:[75,50,125],opacity:1,label:"ctx-lh-rostralmiddlefrontal"},1028:{color:[20,220,160],opacity:1,label:"ctx-lh-superiorfrontal"},1029:{color:[20,180,140],opacity:1,label:"ctx-lh-superiorparietal"},1030:{color:[140,220,220],opacity:1,label:"ctx-lh-superiortemporal"},1031:{color:[80,160,20],opacity:1,label:"ctx-lh-supramarginal"},1032:{color:[100,0,100],opacity:1,label:"ctx-lh-frontalpole"},1033:{color:[70,70,70],opacity:1,label:"ctx-lh-temporalpole"},1034:{color:[150,150,200],opacity:1,label:"ctx-lh-transversetemporal"},1035:{color:[255,192,32],opacity:1,label:"ctx-lh-insula"},2e3:{color:[25,5,25],opacity:1,label:"ctx-rh-unknown"},2001:{color:[25,100,40],opacity:1,label:"ctx-rh-bankssts"},2002:{color:[125,100,160],opacity:1,label:"ctx-rh-caudalanteriorcingulate"},2003:{color:[100,25,0],opacity:1,label:"ctx-rh-caudalmiddlefrontal"},2004:{color:[120,70,50],opacity:1,label:"ctx-rh-corpuscallosum"},2005:{color:[220,20,100],opacity:1,label:"ctx-rh-cuneus"},2006:{color:[220,20,10],opacity:1,label:"ctx-rh-entorhinal"},2007:{color:[180,220,140],opacity:1,label:"ctx-rh-fusiform"},2008:{color:[220,60,220],opacity:1,label:"ctx-rh-inferiorparietal"},2009:{color:[180,40,120],opacity:1,label:"ctx-rh-inferiortemporal"},2010:{color:[140,20,140],opacity:1,label:"ctx-rh-isthmuscingulate"},2011:{color:[20,30,140],opacity:1,label:"ctx-rh-lateraloccipital"},2012:{color:[35,75,50],opacity:1,label:"ctx-rh-lateralorbitofrontal"},2013:{color:[225,140,140],opacity:1,label:"ctx-rh-lingual"},2014:{color:[200,35,75],opacity:1,label:"ctx-rh-medialorbitofrontal"},2015:{color:[160,100,50],opacity:1,label:"ctx-rh-middletemporal"},2016:{color:[20,220,60],opacity:1,label:"ctx-rh-parahippocampal"},2017:{color:[60,220,60],opacity:1,label:"ctx-rh-paracentral"},2018:{color:[220,180,140],opacity:1,label:"ctx-rh-parsopercularis"},2019:{color:[20,100,50],opacity:1,label:"ctx-rh-parsorbitalis"},2020:{color:[220,60,20],opacity:1,label:"ctx-rh-parstriangularis"},2021:{color:[120,100,60],opacity:1,label:"ctx-rh-pericalcarine"},2022:{color:[220,20,20],opacity:1,label:"ctx-rh-postcentral"},2023:{color:[220,180,220],opacity:1,label:"ctx-rh-posteriorcingulate"},2024:{color:[60,20,220],opacity:1,label:"ctx-rh-precentral"},2025:{color:[160,140,180],opacity:1,label:"ctx-rh-precuneus"},2026:{color:[80,20,140],opacity:1,label:"ctx-rh-rostralanteriorcingulate"},2027:{color:[75,50,125],opacity:1,label:"ctx-rh-rostralmiddlefrontal"},2028:{color:[20,220,160],opacity:1,label:"ctx-rh-superiorfrontal"},2029:{color:[20,180,140],opacity:1,label:"ctx-rh-superiorparietal"},2030:{color:[140,220,220],opacity:1,label:"ctx-rh-superiortemporal"},2031:{color:[80,160,20],opacity:1,label:"ctx-rh-supramarginal"},2032:{color:[100,0,100],opacity:1,label:"ctx-rh-frontalpole"},2033:{color:[70,70,70],opacity:1,label:"ctx-rh-temporalpole"},2034:{color:[150,150,200],opacity:1,label:"ctx-rh-transversetemporal"},2035:{color:[255,192,32],opacity:1,label:"ctx-rh-insula"},3e3:{color:[230,250,230],opacity:1,label:"wm-lh-unknown"},3001:{color:[230,155,215],opacity:1,label:"wm-lh-bankssts"},3002:{color:[130,155,95],opacity:1,label:"wm-lh-caudalanteriorcingulate"},3003:{color:[155,230,255],opacity:1,label:"wm-lh-caudalmiddlefrontal"},3004:{color:[135,185,205],opacity:1,label:"wm-lh-corpuscallosum"},3005:{color:[35,235,155],opacity:1,label:"wm-lh-cuneus"},3006:{color:[35,235,245],opacity:1,label:"wm-lh-entorhinal"},3007:{color:[75,35,115],opacity:1,label:"wm-lh-fusiform"},3008:{color:[35,195,35],opacity:1,label:"wm-lh-inferiorparietal"},3009:{color:[75,215,135],opacity:1,label:"wm-lh-inferiortemporal"},3010:{color:[115,235,115],opacity:1,label:"wm-lh-isthmuscingulate"},3011:{color:[235,225,115],opacity:1,label:"wm-lh-lateraloccipital"},3012:{color:[220,180,205],opacity:1,label:"wm-lh-lateralorbitofrontal"},3013:{color:[30,115,115],opacity:1,label:"wm-lh-lingual"},3014:{color:[55,220,180],opacity:1,label:"wm-lh-medialorbitofrontal"},3015:{color:[95,155,205],opacity:1,label:"wm-lh-middletemporal"},3016:{color:[235,35,195],opacity:1,label:"wm-lh-parahippocampal"},3017:{color:[195,35,195],opacity:1,label:"wm-lh-paracentral"},3018:{color:[35,75,115],opacity:1,label:"wm-lh-parsopercularis"},3019:{color:[235,155,205],opacity:1,label:"wm-lh-parsorbitalis"},3020:{color:[35,195,235],opacity:1,label:"wm-lh-parstriangularis"},3021:{color:[135,155,195],opacity:1,label:"wm-lh-pericalcarine"},3022:{color:[35,235,235],opacity:1,label:"wm-lh-postcentral"},3023:{color:[35,75,35],opacity:1,label:"wm-lh-posteriorcingulate"},3024:{color:[195,235,35],opacity:1,label:"wm-lh-precentral"},3025:{color:[95,115,75],opacity:1,label:"wm-lh-precuneus"},3026:{color:[175,235,115],opacity:1,label:"wm-lh-rostralanteriorcingulate"},3027:{color:[180,205,130],opacity:1,label:"wm-lh-rostralmiddlefrontal"},3028:{color:[235,35,95],opacity:1,label:"wm-lh-superiorfrontal"},3029:{color:[235,75,115],opacity:1,label:"wm-lh-superiorparietal"},3030:{color:[115,35,35],opacity:1,label:"wm-lh-superiortemporal"},3031:{color:[175,95,235],opacity:1,label:"wm-lh-supramarginal"},3032:{color:[155,255,155],opacity:1,label:"wm-lh-frontalpole"},3033:{color:[185,185,185],opacity:1,label:"wm-lh-temporalpole"},3034:{color:[105,105,55],opacity:1,label:"wm-lh-transversetemporal"},3035:{color:[20,220,160],opacity:1,label:"wm-lh-insula"},4e3:{color:[230,250,230],opacity:1,label:"wm-rh-unknown"},4001:{color:[230,155,215],opacity:1,label:"wm-rh-bankssts"},4002:{color:[130,155,95],opacity:1,label:"wm-rh-caudalanteriorcingulate"},4003:{color:[155,230,255],opacity:1,label:"wm-rh-caudalmiddlefrontal"},4004:{color:[135,185,205],opacity:1,label:"wm-rh-corpuscallosum"},4005:{color:[35,235,155],opacity:1,label:"wm-rh-cuneus"},4006:{color:[35,235,245],opacity:1,label:"wm-rh-entorhinal"},4007:{color:[75,35,115],opacity:1,label:"wm-rh-fusiform"},4008:{color:[35,195,35],opacity:1,label:"wm-rh-inferiorparietal"},4009:{color:[75,215,135],opacity:1,label:"wm-rh-inferiortemporal"},4010:{color:[115,235,115],opacity:1,label:"wm-rh-isthmuscingulate"},4011:{color:[235,225,115],opacity:1,label:"wm-rh-lateraloccipital"},4012:{color:[220,180,205],opacity:1,label:"wm-rh-lateralorbitofrontal"},4013:{color:[30,115,115],opacity:1,label:"wm-rh-lingual"},4014:{color:[55,220,180],opacity:1,label:"wm-rh-medialorbitofrontal"},4015:{color:[95,155,205],opacity:1,label:"wm-rh-middletemporal"},4016:{color:[235,35,195],opacity:1,label:"wm-rh-parahippocampal"},4017:{color:[195,35,195],opacity:1,label:"wm-rh-paracentral"},4018:{color:[35,75,115],opacity:1,label:"wm-rh-parsopercularis"},4019:{color:[235,155,205],opacity:1,label:"wm-rh-parsorbitalis"},4020:{color:[35,195,235],opacity:1,label:"wm-rh-parstriangularis"},4021:{color:[135,155,195],opacity:1,label:"wm-rh-pericalcarine"},4022:{color:[35,235,235],opacity:1,label:"wm-rh-postcentral"},4023:{color:[35,75,35],opacity:1,label:"wm-rh-posteriorcingulate"},4024:{color:[195,235,35],opacity:1,label:"wm-rh-precentral"},4025:{color:[95,115,75],opacity:1,label:"wm-rh-precuneus"},4026:{color:[175,235,115],opacity:1,label:"wm-rh-rostralanteriorcingulate"},4027:{color:[180,205,130],opacity:1,label:"wm-rh-rostralmiddlefrontal"},4028:{color:[235,35,95],opacity:1,label:"wm-rh-superiorfrontal"},4029:{color:[235,75,115],opacity:1,label:"wm-rh-superiorparietal"},4030:{color:[115,35,35],opacity:1,label:"wm-rh-superiortemporal"},4031:{color:[175,95,235],opacity:1,label:"wm-rh-supramarginal"},4032:{color:[155,255,155],opacity:1,label:"wm-rh-frontalpole"},4033:{color:[185,185,185],opacity:1,label:"wm-rh-temporalpole"},4034:{color:[105,105,55],opacity:1,label:"wm-rh-transversetemporal"},4035:{color:[20,220,160],opacity:1,label:"wm-rh-insula"},3201:{color:[235,35,95],opacity:1,label:"wm-lh-frontal-lobe"},3203:{color:[35,75,35],opacity:1,label:"wm-lh-cingulate-lobe"},3204:{color:[135,155,195],opacity:1,label:"wm-lh-occiptal-lobe"},3205:{color:[115,35,35],opacity:1,label:"wm-lh-temporal-lobe"},3206:{color:[35,195,35],opacity:1,label:"wm-lh-parietal-lobe"},3207:{color:[20,220,160],opacity:1,label:"wm-lh-insula-lobe"},4201:{color:[235,35,95],opacity:1,label:"wm-rh-frontal-lobe"},4203:{color:[35,75,35],opacity:1,label:"wm-rh-cingulate-lobe"},4204:{color:[135,155,195],opacity:1,label:"wm-rh-occiptal-lobe"},4205:{color:[115,35,35],opacity:1,label:"wm-rh-temporal-lobe"},4206:{color:[35,195,35],opacity:1,label:"wm-rh-parietal-lobe"},4207:{color:[20,220,160],opacity:1,label:"wm-rh-insula-lobe"},1100:{color:[0,0,0],opacity:1,label:"ctx-lh-Unknown"},1101:{color:[50,50,50],opacity:1,label:"ctx-lh-Corpus_callosum"},1102:{color:[180,20,30],opacity:1,label:"ctx-lh-G_and_S_Insula_ONLY_AVERAGE"},1103:{color:[60,25,25],opacity:1,label:"ctx-lh-G_cingulate-Isthmus"},1104:{color:[25,60,60],opacity:1,label:"ctx-lh-G_cingulate-Main_part"},1200:{color:[25,60,61],opacity:1,label:"ctx-lh-G_cingulate-caudal_ACC"},1201:{color:[25,90,60],opacity:1,label:"ctx-lh-G_cingulate-rostral_ACC"},1202:{color:[25,120,60],opacity:1,label:"ctx-lh-G_cingulate-posterior"},1205:{color:[25,150,60],opacity:1,label:"ctx-lh-S_cingulate-caudal_ACC"},1206:{color:[25,180,60],opacity:1,label:"ctx-lh-S_cingulate-rostral_ACC"},1207:{color:[25,210,60],opacity:1,label:"ctx-lh-S_cingulate-posterior"},1210:{color:[25,150,90],opacity:1,label:"ctx-lh-S_pericallosal-caudal"},1211:{color:[25,180,90],opacity:1,label:"ctx-lh-S_pericallosal-rostral"},1212:{color:[25,210,90],opacity:1,label:"ctx-lh-S_pericallosal-posterior"},1105:{color:[180,20,20],opacity:1,label:"ctx-lh-G_cuneus"},1106:{color:[220,20,100],opacity:1,label:"ctx-lh-G_frontal_inf-Opercular_part"},1107:{color:[140,60,60],opacity:1,label:"ctx-lh-G_frontal_inf-Orbital_part"},1108:{color:[180,220,140],opacity:1,label:"ctx-lh-G_frontal_inf-Triangular_part"},1109:{color:[140,100,180],opacity:1,label:"ctx-lh-G_frontal_middle"},1110:{color:[180,20,140],opacity:1,label:"ctx-lh-G_frontal_superior"},1111:{color:[140,20,140],opacity:1,label:"ctx-lh-G_frontomarginal"},1112:{color:[21,10,10],opacity:1,label:"ctx-lh-G_insular_long"},1113:{color:[225,140,140],opacity:1,label:"ctx-lh-G_insular_short"},1114:{color:[23,60,180],opacity:1,label:"ctx-lh-G_and_S_occipital_inferior"},1115:{color:[180,60,180],opacity:1,label:"ctx-lh-G_occipital_middle"},1116:{color:[20,220,60],opacity:1,label:"ctx-lh-G_occipital_superior"},1117:{color:[60,20,140],opacity:1,label:"ctx-lh-G_occipit-temp_lat-Or_fusiform"},1118:{color:[220,180,140],opacity:1,label:"ctx-lh-G_occipit-temp_med-Lingual_part"},1119:{color:[65,100,20],opacity:1,label:"ctx-lh-G_occipit-temp_med-Parahippocampal_part"},1120:{color:[220,60,20],opacity:1,label:"ctx-lh-G_orbital"},1121:{color:[60,100,60],opacity:1,label:"ctx-lh-G_paracentral"},1122:{color:[20,60,220],opacity:1,label:"ctx-lh-G_parietal_inferior-Angular_part"},1123:{color:[100,100,60],opacity:1,label:"ctx-lh-G_parietal_inferior-Supramarginal_part"},1124:{color:[220,180,220],opacity:1,label:"ctx-lh-G_parietal_superior"},1125:{color:[20,180,140],opacity:1,label:"ctx-lh-G_postcentral"},1126:{color:[60,140,180],opacity:1,label:"ctx-lh-G_precentral"},1127:{color:[25,20,140],opacity:1,label:"ctx-lh-G_precuneus"},1128:{color:[20,60,100],opacity:1,label:"ctx-lh-G_rectus"},1129:{color:[60,220,20],opacity:1,label:"ctx-lh-G_subcallosal"},1130:{color:[60,20,220],opacity:1,label:"ctx-lh-G_subcentral"},1131:{color:[220,220,100],opacity:1,label:"ctx-lh-G_temporal_inferior"},1132:{color:[180,60,60],opacity:1,label:"ctx-lh-G_temporal_middle"},1133:{color:[60,60,220],opacity:1,label:"ctx-lh-G_temp_sup-G_temp_transv_and_interm_S"},1134:{color:[220,60,220],opacity:1,label:"ctx-lh-G_temp_sup-Lateral_aspect"},1135:{color:[65,220,60],opacity:1,label:"ctx-lh-G_temp_sup-Planum_polare"},1136:{color:[25,140,20],opacity:1,label:"ctx-lh-G_temp_sup-Planum_tempolare"},1137:{color:[13,0,250],opacity:1,label:"ctx-lh-G_and_S_transverse_frontopolar"},1138:{color:[61,20,220],opacity:1,label:"ctx-lh-Lat_Fissure-ant_sgt-ramus_horizontal"},1139:{color:[61,20,60],opacity:1,label:"ctx-lh-Lat_Fissure-ant_sgt-ramus_vertical"},1140:{color:[61,60,100],opacity:1,label:"ctx-lh-Lat_Fissure-post_sgt"},1141:{color:[25,25,25],opacity:1,label:"ctx-lh-Medial_wall"},1142:{color:[140,20,60],opacity:1,label:"ctx-lh-Pole_occipital"},1143:{color:[220,180,20],opacity:1,label:"ctx-lh-Pole_temporal"},1144:{color:[63,180,180],opacity:1,label:"ctx-lh-S_calcarine"},1145:{color:[221,20,10],opacity:1,label:"ctx-lh-S_central"},1146:{color:[21,220,20],opacity:1,label:"ctx-lh-S_central_insula"},1147:{color:[183,100,20],opacity:1,label:"ctx-lh-S_cingulate-Main_part_and_Intracingulate"},1148:{color:[221,20,100],opacity:1,label:"ctx-lh-S_cingulate-Marginalis_part"},1149:{color:[221,60,140],opacity:1,label:"ctx-lh-S_circular_insula_anterior"},1150:{color:[221,20,220],opacity:1,label:"ctx-lh-S_circular_insula_inferior"},1151:{color:[61,220,220],opacity:1,label:"ctx-lh-S_circular_insula_superior"},1152:{color:[100,200,200],opacity:1,label:"ctx-lh-S_collateral_transverse_ant"},1153:{color:[10,200,200],opacity:1,label:"ctx-lh-S_collateral_transverse_post"},1154:{color:[221,220,20],opacity:1,label:"ctx-lh-S_frontal_inferior"},1155:{color:[141,20,100],opacity:1,label:"ctx-lh-S_frontal_middle"},1156:{color:[61,220,100],opacity:1,label:"ctx-lh-S_frontal_superior"},1157:{color:[21,220,60],opacity:1,label:"ctx-lh-S_frontomarginal"},1158:{color:[141,60,20],opacity:1,label:"ctx-lh-S_intermedius_primus-Jensen"},1159:{color:[143,20,220],opacity:1,label:"ctx-lh-S_intraparietal-and_Parietal_transverse"},1160:{color:[61,20,180],opacity:1,label:"ctx-lh-S_occipital_anterior"},1161:{color:[101,60,220],opacity:1,label:"ctx-lh-S_occipital_middle_and_Lunatus"},1162:{color:[21,20,140],opacity:1,label:"ctx-lh-S_occipital_superior_and_transversalis"},1163:{color:[221,140,20],opacity:1,label:"ctx-lh-S_occipito-temporal_lateral"},1164:{color:[141,100,220],opacity:1,label:"ctx-lh-S_occipito-temporal_medial_and_S_Lingual"},1165:{color:[101,20,20],opacity:1,label:"ctx-lh-S_orbital-H_shapped"},1166:{color:[221,100,20],opacity:1,label:"ctx-lh-S_orbital_lateral"},1167:{color:[181,200,20],opacity:1,label:"ctx-lh-S_orbital_medial-Or_olfactory"},1168:{color:[21,180,140],opacity:1,label:"ctx-lh-S_paracentral"},1169:{color:[101,100,180],opacity:1,label:"ctx-lh-S_parieto_occipital"},1170:{color:[181,220,20],opacity:1,label:"ctx-lh-S_pericallosal"},1171:{color:[21,140,200],opacity:1,label:"ctx-lh-S_postcentral"},1172:{color:[21,20,240],opacity:1,label:"ctx-lh-S_precentral-Inferior-part"},1173:{color:[21,20,200],opacity:1,label:"ctx-lh-S_precentral-Superior-part"},1174:{color:[61,180,60],opacity:1,label:"ctx-lh-S_subcentral_ant"},1175:{color:[61,180,250],opacity:1,label:"ctx-lh-S_subcentral_post"},1176:{color:[21,20,60],opacity:1,label:"ctx-lh-S_suborbital"},1177:{color:[101,60,60],opacity:1,label:"ctx-lh-S_subparietal"},1178:{color:[21,220,220],opacity:1,label:"ctx-lh-S_supracingulate"},1179:{color:[21,180,180],opacity:1,label:"ctx-lh-S_temporal_inferior"},1180:{color:[223,220,60],opacity:1,label:"ctx-lh-S_temporal_superior"},1181:{color:[221,60,60],opacity:1,label:"ctx-lh-S_temporal_transverse"},2100:{color:[0,0,0],opacity:1,label:"ctx-rh-Unknown"},2101:{color:[50,50,50],opacity:1,label:"ctx-rh-Corpus_callosum"},2102:{color:[180,20,30],opacity:1,label:"ctx-rh-G_and_S_Insula_ONLY_AVERAGE"},2103:{color:[60,25,25],opacity:1,label:"ctx-rh-G_cingulate-Isthmus"},2104:{color:[25,60,60],opacity:1,label:"ctx-rh-G_cingulate-Main_part"},2105:{color:[180,20,20],opacity:1,label:"ctx-rh-G_cuneus"},2106:{color:[220,20,100],opacity:1,label:"ctx-rh-G_frontal_inf-Opercular_part"},2107:{color:[140,60,60],opacity:1,label:"ctx-rh-G_frontal_inf-Orbital_part"},2108:{color:[180,220,140],opacity:1,label:"ctx-rh-G_frontal_inf-Triangular_part"},2109:{color:[140,100,180],opacity:1,label:"ctx-rh-G_frontal_middle"},2110:{color:[180,20,140],opacity:1,label:"ctx-rh-G_frontal_superior"},2111:{color:[140,20,140],opacity:1,label:"ctx-rh-G_frontomarginal"},2112:{color:[21,10,10],opacity:1,label:"ctx-rh-G_insular_long"},2113:{color:[225,140,140],opacity:1,label:"ctx-rh-G_insular_short"},2114:{color:[23,60,180],opacity:1,label:"ctx-rh-G_and_S_occipital_inferior"},2115:{color:[180,60,180],opacity:1,label:"ctx-rh-G_occipital_middle"},2116:{color:[20,220,60],opacity:1,label:"ctx-rh-G_occipital_superior"},2117:{color:[60,20,140],opacity:1,label:"ctx-rh-G_occipit-temp_lat-Or_fusiform"},2118:{color:[220,180,140],opacity:1,label:"ctx-rh-G_occipit-temp_med-Lingual_part"},2119:{color:[65,100,20],opacity:1,label:"ctx-rh-G_occipit-temp_med-Parahippocampal_part"},2120:{color:[220,60,20],opacity:1,label:"ctx-rh-G_orbital"},2121:{color:[60,100,60],opacity:1,label:"ctx-rh-G_paracentral"},2122:{color:[20,60,220],opacity:1,label:"ctx-rh-G_parietal_inferior-Angular_part"},2123:{color:[100,100,60],opacity:1,label:"ctx-rh-G_parietal_inferior-Supramarginal_part"},2124:{color:[220,180,220],opacity:1,label:"ctx-rh-G_parietal_superior"},2125:{color:[20,180,140],opacity:1,label:"ctx-rh-G_postcentral"},2126:{color:[60,140,180],opacity:1,label:"ctx-rh-G_precentral"},2127:{color:[25,20,140],opacity:1,label:"ctx-rh-G_precuneus"},2128:{color:[20,60,100],opacity:1,label:"ctx-rh-G_rectus"},2129:{color:[60,220,20],opacity:1,label:"ctx-rh-G_subcallosal"},2130:{color:[60,20,220],opacity:1,label:"ctx-rh-G_subcentral"},2131:{color:[220,220,100],opacity:1,label:"ctx-rh-G_temporal_inferior"},2132:{color:[180,60,60],opacity:1,label:"ctx-rh-G_temporal_middle"},2133:{color:[60,60,220],opacity:1,label:"ctx-rh-G_temp_sup-G_temp_transv_and_interm_S"},2134:{color:[220,60,220],opacity:1,label:"ctx-rh-G_temp_sup-Lateral_aspect"},2135:{color:[65,220,60],opacity:1,label:"ctx-rh-G_temp_sup-Planum_polare"},2136:{color:[25,140,20],opacity:1,label:"ctx-rh-G_temp_sup-Planum_tempolare"},2137:{color:[13,0,250],opacity:1,label:"ctx-rh-G_and_S_transverse_frontopolar"},2138:{color:[61,20,220],opacity:1,label:"ctx-rh-Lat_Fissure-ant_sgt-ramus_horizontal"},2139:{color:[61,20,60],opacity:1,label:"ctx-rh-Lat_Fissure-ant_sgt-ramus_vertical"},2140:{color:[61,60,100],opacity:1,label:"ctx-rh-Lat_Fissure-post_sgt"},2141:{color:[25,25,25],opacity:1,label:"ctx-rh-Medial_wall"},2142:{color:[140,20,60],opacity:1,label:"ctx-rh-Pole_occipital"},2143:{color:[220,180,20],opacity:1,label:"ctx-rh-Pole_temporal"},2144:{color:[63,180,180],opacity:1,label:"ctx-rh-S_calcarine"},2145:{color:[221,20,10],opacity:1,label:"ctx-rh-S_central"},2146:{color:[21,220,20],opacity:1,label:"ctx-rh-S_central_insula"},2147:{color:[183,100,20],opacity:1,label:"ctx-rh-S_cingulate-Main_part_and_Intracingulate"},2148:{color:[221,20,100],opacity:1,label:"ctx-rh-S_cingulate-Marginalis_part"},2149:{color:[221,60,140],opacity:1,label:"ctx-rh-S_circular_insula_anterior"},2150:{color:[221,20,220],opacity:1,label:"ctx-rh-S_circular_insula_inferior"},2151:{color:[61,220,220],opacity:1,label:"ctx-rh-S_circular_insula_superior"},2152:{color:[100,200,200],opacity:1,label:"ctx-rh-S_collateral_transverse_ant"},2153:{color:[10,200,200],opacity:1,label:"ctx-rh-S_collateral_transverse_post"},2154:{color:[221,220,20],opacity:1,label:"ctx-rh-S_frontal_inferior"},2155:{color:[141,20,100],opacity:1,label:"ctx-rh-S_frontal_middle"},2156:{color:[61,220,100],opacity:1,label:"ctx-rh-S_frontal_superior"},2157:{color:[21,220,60],opacity:1,label:"ctx-rh-S_frontomarginal"},2158:{color:[141,60,20],opacity:1,label:"ctx-rh-S_intermedius_primus-Jensen"},2159:{color:[143,20,220],opacity:1,label:"ctx-rh-S_intraparietal-and_Parietal_transverse"},2160:{color:[61,20,180],opacity:1,label:"ctx-rh-S_occipital_anterior"},2161:{color:[101,60,220],opacity:1,label:"ctx-rh-S_occipital_middle_and_Lunatus"},2162:{color:[21,20,140],opacity:1,label:"ctx-rh-S_occipital_superior_and_transversalis"},2163:{color:[221,140,20],opacity:1,label:"ctx-rh-S_occipito-temporal_lateral"},2164:{color:[141,100,220],opacity:1,label:"ctx-rh-S_occipito-temporal_medial_and_S_Lingual"},2165:{color:[101,20,20],opacity:1,label:"ctx-rh-S_orbital-H_shapped"},2166:{color:[221,100,20],opacity:1,label:"ctx-rh-S_orbital_lateral"},2167:{color:[181,200,20],opacity:1,label:"ctx-rh-S_orbital_medial-Or_olfactory"},2168:{color:[21,180,140],opacity:1,label:"ctx-rh-S_paracentral"},2169:{color:[101,100,180],opacity:1,label:"ctx-rh-S_parieto_occipital"},2170:{color:[181,220,20],opacity:1,label:"ctx-rh-S_pericallosal"},2171:{color:[21,140,200],opacity:1,label:"ctx-rh-S_postcentral"},2172:{color:[21,20,240],opacity:1,label:"ctx-rh-S_precentral-Inferior-part"},2173:{color:[21,20,200],opacity:1,label:"ctx-rh-S_precentral-Superior-part"},2174:{color:[61,180,60],opacity:1,label:"ctx-rh-S_subcentral_ant"},2175:{color:[61,180,250],opacity:1,label:"ctx-rh-S_subcentral_post"},2176:{color:[21,20,60],opacity:1,label:"ctx-rh-S_suborbital"},2177:{color:[101,60,60],opacity:1,label:"ctx-rh-S_subparietal"},2178:{color:[21,220,220],opacity:1,label:"ctx-rh-S_supracingulate"},2179:{color:[21,180,180],opacity:1,label:"ctx-rh-S_temporal_inferior"},2180:{color:[223,220,60],opacity:1,label:"ctx-rh-S_temporal_superior"},2181:{color:[221,60,60],opacity:1,label:"ctx-rh-S_temporal_transverse"},2200:{color:[25,60,61],opacity:1,label:"ctx-rh-G_cingulate-caudal_ACC"},2201:{color:[25,90,60],opacity:1,label:"ctx-rh-G_cingulate-rostral_ACC"},2202:{color:[25,120,60],opacity:1,label:"ctx-rh-G_cingulate-posterior"},2205:{color:[25,150,60],opacity:1,label:"ctx-rh-S_cingulate-caudal_ACC"},2206:{color:[25,180,60],opacity:1,label:"ctx-rh-S_cingulate-rostral_ACC"},2207:{color:[25,210,60],opacity:1,label:"ctx-rh-S_cingulate-posterior"},2210:{color:[25,150,90],opacity:1,label:"ctx-rh-S_pericallosal-caudal"},2211:{color:[25,180,90],opacity:1,label:"ctx-rh-S_pericallosal-rostral"},2212:{color:[25,210,90],opacity:1,label:"ctx-rh-S_pericallosal-posterior"},3100:{color:[0,0,0],opacity:1,label:"wm-lh-Unknown"},3101:{color:[50,50,50],opacity:1,label:"wm-lh-Corpus_callosum"},3102:{color:[180,20,30],opacity:1,label:"wm-lh-G_and_S_Insula_ONLY_AVERAGE"},3103:{color:[60,25,25],opacity:1,label:"wm-lh-G_cingulate-Isthmus"},3104:{color:[25,60,60],opacity:1,label:"wm-lh-G_cingulate-Main_part"},3105:{color:[180,20,20],opacity:1,label:"wm-lh-G_cuneus"},3106:{color:[220,20,100],opacity:1,label:"wm-lh-G_frontal_inf-Opercular_part"},3107:{color:[140,60,60],opacity:1,label:"wm-lh-G_frontal_inf-Orbital_part"},3108:{color:[180,220,140],opacity:1,label:"wm-lh-G_frontal_inf-Triangular_part"},3109:{color:[140,100,180],opacity:1,label:"wm-lh-G_frontal_middle"},3110:{color:[180,20,140],opacity:1,label:"wm-lh-G_frontal_superior"},3111:{color:[140,20,140],opacity:1,label:"wm-lh-G_frontomarginal"},3112:{color:[21,10,10],opacity:1,label:"wm-lh-G_insular_long"},3113:{color:[225,140,140],opacity:1,label:"wm-lh-G_insular_short"},3114:{color:[23,60,180],opacity:1,label:"wm-lh-G_and_S_occipital_inferior"},3115:{color:[180,60,180],opacity:1,label:"wm-lh-G_occipital_middle"},3116:{color:[20,220,60],opacity:1,label:"wm-lh-G_occipital_superior"},3117:{color:[60,20,140],opacity:1,label:"wm-lh-G_occipit-temp_lat-Or_fusiform"},3118:{color:[220,180,140],opacity:1,label:"wm-lh-G_occipit-temp_med-Lingual_part"},3119:{color:[65,100,20],opacity:1,label:"wm-lh-G_occipit-temp_med-Parahippocampal_part"},3120:{color:[220,60,20],opacity:1,label:"wm-lh-G_orbital"},3121:{color:[60,100,60],opacity:1,label:"wm-lh-G_paracentral"},3122:{color:[20,60,220],opacity:1,label:"wm-lh-G_parietal_inferior-Angular_part"},3123:{color:[100,100,60],opacity:1,label:"wm-lh-G_parietal_inferior-Supramarginal_part"},3124:{color:[220,180,220],opacity:1,label:"wm-lh-G_parietal_superior"},3125:{color:[20,180,140],opacity:1,label:"wm-lh-G_postcentral"},3126:{color:[60,140,180],opacity:1,label:"wm-lh-G_precentral"},3127:{color:[25,20,140],opacity:1,label:"wm-lh-G_precuneus"},3128:{color:[20,60,100],opacity:1,label:"wm-lh-G_rectus"},3129:{color:[60,220,20],opacity:1,label:"wm-lh-G_subcallosal"},3130:{color:[60,20,220],opacity:1,label:"wm-lh-G_subcentral"},3131:{color:[220,220,100],opacity:1,label:"wm-lh-G_temporal_inferior"},3132:{color:[180,60,60],opacity:1,label:"wm-lh-G_temporal_middle"},3133:{color:[60,60,220],opacity:1,label:"wm-lh-G_temp_sup-G_temp_transv_and_interm_S"},3134:{color:[220,60,220],opacity:1,label:"wm-lh-G_temp_sup-Lateral_aspect"},3135:{color:[65,220,60],opacity:1,label:"wm-lh-G_temp_sup-Planum_polare"},3136:{color:[25,140,20],opacity:1,label:"wm-lh-G_temp_sup-Planum_tempolare"},3137:{color:[13,0,250],opacity:1,label:"wm-lh-G_and_S_transverse_frontopolar"},3138:{color:[61,20,220],opacity:1,label:"wm-lh-Lat_Fissure-ant_sgt-ramus_horizontal"},3139:{color:[61,20,60],opacity:1,label:"wm-lh-Lat_Fissure-ant_sgt-ramus_vertical"},3140:{color:[61,60,100],opacity:1,label:"wm-lh-Lat_Fissure-post_sgt"},3141:{color:[25,25,25],opacity:1,label:"wm-lh-Medial_wall"},3142:{color:[140,20,60],opacity:1,label:"wm-lh-Pole_occipital"},3143:{color:[220,180,20],opacity:1,label:"wm-lh-Pole_temporal"},3144:{color:[63,180,180],opacity:1,label:"wm-lh-S_calcarine"},3145:{color:[221,20,10],opacity:1,label:"wm-lh-S_central"},3146:{color:[21,220,20],opacity:1,label:"wm-lh-S_central_insula"},3147:{color:[183,100,20],opacity:1,label:"wm-lh-S_cingulate-Main_part_and_Intracingulate"},3148:{color:[221,20,100],opacity:1,label:"wm-lh-S_cingulate-Marginalis_part"},3149:{color:[221,60,140],opacity:1,label:"wm-lh-S_circular_insula_anterior"},3150:{color:[221,20,220],opacity:1,label:"wm-lh-S_circular_insula_inferior"},3151:{color:[61,220,220],opacity:1,label:"wm-lh-S_circular_insula_superior"},3152:{color:[100,200,200],opacity:1,label:"wm-lh-S_collateral_transverse_ant"},3153:{color:[10,200,200],opacity:1,label:"wm-lh-S_collateral_transverse_post"},3154:{color:[221,220,20],opacity:1,label:"wm-lh-S_frontal_inferior"},3155:{color:[141,20,100],opacity:1,label:"wm-lh-S_frontal_middle"},3156:{color:[61,220,100],opacity:1,label:"wm-lh-S_frontal_superior"},3157:{color:[21,220,60],opacity:1,label:"wm-lh-S_frontomarginal"},3158:{color:[141,60,20],opacity:1,label:"wm-lh-S_intermedius_primus-Jensen"},3159:{color:[143,20,220],opacity:1,label:"wm-lh-S_intraparietal-and_Parietal_transverse"},3160:{color:[61,20,180],opacity:1,label:"wm-lh-S_occipital_anterior"},3161:{color:[101,60,220],opacity:1,label:"wm-lh-S_occipital_middle_and_Lunatus"},3162:{color:[21,20,140],opacity:1,label:"wm-lh-S_occipital_superior_and_transversalis"},3163:{color:[221,140,20],opacity:1,label:"wm-lh-S_occipito-temporal_lateral"},3164:{color:[141,100,220],opacity:1,label:"wm-lh-S_occipito-temporal_medial_and_S_Lingual"},3165:{color:[101,20,20],opacity:1,label:"wm-lh-S_orbital-H_shapped"},3166:{color:[221,100,20],opacity:1,label:"wm-lh-S_orbital_lateral"},3167:{color:[181,200,20],opacity:1,label:"wm-lh-S_orbital_medial-Or_olfactory"},3168:{color:[21,180,140],opacity:1,label:"wm-lh-S_paracentral"},3169:{color:[101,100,180],opacity:1,label:"wm-lh-S_parieto_occipital"},3170:{color:[181,220,20],opacity:1,label:"wm-lh-S_pericallosal"},3171:{color:[21,140,200],opacity:1,label:"wm-lh-S_postcentral"},3172:{color:[21,20,240],opacity:1,label:"wm-lh-S_precentral-Inferior-part"},3173:{color:[21,20,200],opacity:1,label:"wm-lh-S_precentral-Superior-part"},3174:{color:[61,180,60],opacity:1,label:"wm-lh-S_subcentral_ant"},3175:{color:[61,180,250],opacity:1,label:"wm-lh-S_subcentral_post"},3176:{color:[21,20,60],opacity:1,label:"wm-lh-S_suborbital"},3177:{color:[101,60,60],opacity:1,label:"wm-lh-S_subparietal"},3178:{color:[21,220,220],opacity:1,label:"wm-lh-S_supracingulate"},3179:{color:[21,180,180],opacity:1,label:"wm-lh-S_temporal_inferior"},3180:{color:[223,220,60],opacity:1,label:"wm-lh-S_temporal_superior"},3181:{color:[221,60,60],opacity:1,label:"wm-lh-S_temporal_transverse"},4100:{color:[0,0,0],opacity:1,label:"wm-rh-Unknown"},4101:{color:[50,50,50],opacity:1,label:"wm-rh-Corpus_callosum"},4102:{color:[180,20,30],opacity:1,label:"wm-rh-G_and_S_Insula_ONLY_AVERAGE"},4103:{color:[60,25,25],opacity:1,label:"wm-rh-G_cingulate-Isthmus"},4104:{color:[25,60,60],opacity:1,label:"wm-rh-G_cingulate-Main_part"},4105:{color:[180,20,20],opacity:1,label:"wm-rh-G_cuneus"},4106:{color:[220,20,100],opacity:1,label:"wm-rh-G_frontal_inf-Opercular_part"},4107:{color:[140,60,60],opacity:1,label:"wm-rh-G_frontal_inf-Orbital_part"},4108:{color:[180,220,140],opacity:1,label:"wm-rh-G_frontal_inf-Triangular_part"},4109:{color:[140,100,180],opacity:1,label:"wm-rh-G_frontal_middle"},4110:{color:[180,20,140],opacity:1,label:"wm-rh-G_frontal_superior"},4111:{color:[140,20,140],opacity:1,label:"wm-rh-G_frontomarginal"},4112:{color:[21,10,10],opacity:1,label:"wm-rh-G_insular_long"},4113:{color:[225,140,140],opacity:1,label:"wm-rh-G_insular_short"},4114:{color:[23,60,180],opacity:1,label:"wm-rh-G_and_S_occipital_inferior"},4115:{color:[180,60,180],opacity:1,label:"wm-rh-G_occipital_middle"},4116:{color:[20,220,60],opacity:1,label:"wm-rh-G_occipital_superior"},4117:{color:[60,20,140],opacity:1,label:"wm-rh-G_occipit-temp_lat-Or_fusiform"},4118:{color:[220,180,140],opacity:1,label:"wm-rh-G_occipit-temp_med-Lingual_part"},4119:{color:[65,100,20],opacity:1,label:"wm-rh-G_occipit-temp_med-Parahippocampal_part"},4120:{color:[220,60,20],opacity:1,label:"wm-rh-G_orbital"},4121:{color:[60,100,60],opacity:1,label:"wm-rh-G_paracentral"},4122:{color:[20,60,220],opacity:1,label:"wm-rh-G_parietal_inferior-Angular_part"},4123:{color:[100,100,60],opacity:1,label:"wm-rh-G_parietal_inferior-Supramarginal_part"},4124:{color:[220,180,220],opacity:1,label:"wm-rh-G_parietal_superior"},4125:{color:[20,180,140],opacity:1,label:"wm-rh-G_postcentral"},4126:{color:[60,140,180],opacity:1,label:"wm-rh-G_precentral"},4127:{color:[25,20,140],opacity:1,label:"wm-rh-G_precuneus"},4128:{color:[20,60,100],opacity:1,label:"wm-rh-G_rectus"},4129:{color:[60,220,20],opacity:1,label:"wm-rh-G_subcallosal"},4130:{color:[60,20,220],opacity:1,label:"wm-rh-G_subcentral"},4131:{color:[220,220,100],opacity:1,label:"wm-rh-G_temporal_inferior"},4132:{color:[180,60,60],opacity:1,label:"wm-rh-G_temporal_middle"},4133:{color:[60,60,220],opacity:1,label:"wm-rh-G_temp_sup-G_temp_transv_and_interm_S"},4134:{color:[220,60,220],opacity:1,label:"wm-rh-G_temp_sup-Lateral_aspect"},4135:{color:[65,220,60],opacity:1,label:"wm-rh-G_temp_sup-Planum_polare"},4136:{color:[25,140,20],opacity:1,label:"wm-rh-G_temp_sup-Planum_tempolare"},4137:{color:[13,0,250],opacity:1,label:"wm-rh-G_and_S_transverse_frontopolar"},4138:{color:[61,20,220],opacity:1,label:"wm-rh-Lat_Fissure-ant_sgt-ramus_horizontal"},4139:{color:[61,20,60],opacity:1,label:"wm-rh-Lat_Fissure-ant_sgt-ramus_vertical"},4140:{color:[61,60,100],opacity:1,label:"wm-rh-Lat_Fissure-post_sgt"},4141:{color:[25,25,25],opacity:1,label:"wm-rh-Medial_wall"},4142:{color:[140,20,60],opacity:1,label:"wm-rh-Pole_occipital"},4143:{color:[220,180,20],opacity:1,label:"wm-rh-Pole_temporal"},4144:{color:[63,180,180],opacity:1,label:"wm-rh-S_calcarine"},4145:{color:[221,20,10],opacity:1,label:"wm-rh-S_central"},4146:{color:[21,220,20],opacity:1,label:"wm-rh-S_central_insula"},4147:{color:[183,100,20],opacity:1,label:"wm-rh-S_cingulate-Main_part_and_Intracingulate"},4148:{color:[221,20,100],opacity:1,label:"wm-rh-S_cingulate-Marginalis_part"},4149:{color:[221,60,140],opacity:1,label:"wm-rh-S_circular_insula_anterior"},4150:{color:[221,20,220],opacity:1,label:"wm-rh-S_circular_insula_inferior"},4151:{color:[61,220,220],opacity:1,label:"wm-rh-S_circular_insula_superior"},4152:{color:[100,200,200],opacity:1,label:"wm-rh-S_collateral_transverse_ant"},4153:{color:[10,200,200],opacity:1,label:"wm-rh-S_collateral_transverse_post"},4154:{color:[221,220,20],opacity:1,label:"wm-rh-S_frontal_inferior"},4155:{color:[141,20,100],opacity:1,label:"wm-rh-S_frontal_middle"},4156:{color:[61,220,100],opacity:1,label:"wm-rh-S_frontal_superior"},4157:{color:[21,220,60],opacity:1,label:"wm-rh-S_frontomarginal"},4158:{color:[141,60,20],opacity:1,label:"wm-rh-S_intermedius_primus-Jensen"},4159:{color:[143,20,220],opacity:1,label:"wm-rh-S_intraparietal-and_Parietal_transverse"},4160:{color:[61,20,180],opacity:1,label:"wm-rh-S_occipital_anterior"},4161:{color:[101,60,220],opacity:1,label:"wm-rh-S_occipital_middle_and_Lunatus"},4162:{color:[21,20,140],opacity:1,label:"wm-rh-S_occipital_superior_and_transversalis"},4163:{color:[221,140,20],opacity:1,label:"wm-rh-S_occipito-temporal_lateral"},4164:{color:[141,100,220],opacity:1,label:"wm-rh-S_occipito-temporal_medial_and_S_Lingual"},4165:{color:[101,20,20],opacity:1,label:"wm-rh-S_orbital-H_shapped"},4166:{color:[221,100,20],opacity:1,label:"wm-rh-S_orbital_lateral"},4167:{color:[181,200,20],opacity:1,label:"wm-rh-S_orbital_medial-Or_olfactory"},4168:{color:[21,180,140],opacity:1,label:"wm-rh-S_paracentral"},4169:{color:[101,100,180],opacity:1,label:"wm-rh-S_parieto_occipital"},4170:{color:[181,220,20],opacity:1,label:"wm-rh-S_pericallosal"},4171:{color:[21,140,200],opacity:1,label:"wm-rh-S_postcentral"},4172:{color:[21,20,240],opacity:1,label:"wm-rh-S_precentral-Inferior-part"},4173:{color:[21,20,200],opacity:1,label:"wm-rh-S_precentral-Superior-part"},4174:{color:[61,180,60],opacity:1,label:"wm-rh-S_subcentral_ant"},4175:{color:[61,180,250],opacity:1,label:"wm-rh-S_subcentral_post"},4176:{color:[21,20,60],opacity:1,label:"wm-rh-S_suborbital"},4177:{color:[101,60,60],opacity:1,label:"wm-rh-S_subparietal"},4178:{color:[21,220,220],opacity:1,label:"wm-rh-S_supracingulate"},4179:{color:[21,180,180],opacity:1,label:"wm-rh-S_temporal_inferior"},4180:{color:[223,220,60],opacity:1,label:"wm-rh-S_temporal_superior"},4181:{color:[221,60,60],opacity:1,label:"wm-rh-S_temporal_transverse"},5001:{color:[20,30,40],opacity:1,label:"Left-UnsegmentedWhiteMatter"},5002:{color:[20,30,40],opacity:1,label:"Right-UnsegmentedWhiteMatter"},5100:{color:[204,102,102],opacity:1,label:"fmajor"},5101:{color:[204,102,102],opacity:1,label:"fminor"},5102:{color:[255,255,102],opacity:1,label:"lh.atr"},5103:{color:[153,204,0],opacity:1,label:"lh.cab"},5104:{color:[0,153,153],opacity:1,label:"lh.ccg"},5105:{color:[204,153,255],opacity:1,label:"lh.cst"},5106:{color:[255,153,51],opacity:1,label:"lh.ilf"},5107:{color:[204,204,204],opacity:1,label:"lh.slfp"},5108:{color:[153,255,255],opacity:1,label:"lh.slft"},5109:{color:[102,153,255],opacity:1,label:"lh.unc"},5110:{color:[255,255,102],opacity:1,label:"rh.atr"},5111:{color:[153,204,0],opacity:1,label:"rh.cab"},5112:{color:[0,153,153],opacity:1,label:"rh.ccg"},5113:{color:[204,153,255],opacity:1,label:"rh.cst"},5114:{color:[255,153,51],opacity:1,label:"rh.ilf"},5115:{color:[204,204,204],opacity:1,label:"rh.slfp"},5116:{color:[153,255,255],opacity:1,label:"rh.slft"},5117:{color:[102,153,255],opacity:1,label:"rh.unc"},5200:{color:[204,102,102],opacity:1,label:"CC-ForcepsMajor"},5201:{color:[204,102,102],opacity:1,label:"CC-ForcepsMinor"},5202:{color:[255,255,102],opacity:1,label:"LAntThalRadiation"},5203:{color:[153,204,0],opacity:1,label:"LCingulumAngBundle"},5204:{color:[0,153,153],opacity:1,label:"LCingulumCingGyrus"},5205:{color:[204,153,255],opacity:1,label:"LCorticospinalTract"},5206:{color:[255,153,51],opacity:1,label:"LInfLongFas"},5207:{color:[204,204,204],opacity:1,label:"LSupLongFasParietal"},5208:{color:[153,255,255],opacity:1,label:"LSupLongFasTemporal"},5209:{color:[102,153,255],opacity:1,label:"LUncinateFas"},5210:{color:[255,255,102],opacity:1,label:"RAntThalRadiation"},5211:{color:[153,204,0],opacity:1,label:"RCingulumAngBundle"},5212:{color:[0,153,153],opacity:1,label:"RCingulumCingGyrus"},5213:{color:[204,153,255],opacity:1,label:"RCorticospinalTract"},5214:{color:[255,153,51],opacity:1,label:"RInfLongFas"},5215:{color:[204,204,204],opacity:1,label:"RSupLongFasParietal"},5216:{color:[153,255,255],opacity:1,label:"RSupLongFasTemporal"},5217:{color:[102,153,255],opacity:1,label:"RUncinateFas"},6e3:{color:[0,255,0],opacity:1,label:"CST-orig"},6001:{color:[255,255,0],opacity:1,label:"CST-hammer"},6002:{color:[0,255,255],opacity:1,label:"CST-CVS"},6003:{color:[0,0,255],opacity:1,label:"CST-flirt"},6010:{color:[236,16,231],opacity:1,label:"Left-SLF1"},6020:{color:[237,18,232],opacity:1,label:"Right-SLF1"},6030:{color:[236,13,227],opacity:1,label:"Left-SLF3"},6040:{color:[236,17,228],opacity:1,label:"Right-SLF3"},6050:{color:[1,255,1],opacity:1,label:"Left-CST"},6060:{color:[2,255,1],opacity:1,label:"Right-CST"},6070:{color:[236,14,230],opacity:1,label:"Left-SLF2"},6080:{color:[237,14,230],opacity:1,label:"Right-SLF2"},7001:{color:[72,132,181],opacity:1,label:"Lateral-nucleus"},7002:{color:[243,243,243],opacity:1,label:"Basolateral-nucleus"},7003:{color:[207,63,79],opacity:1,label:"Basal-nucleus"},7004:{color:[121,20,135],opacity:1,label:"Centromedial-nucleus"},7005:{color:[197,60,248],opacity:1,label:"Central-nucleus"},7006:{color:[2,149,2],opacity:1,label:"Medial-nucleus"},7007:{color:[221,249,166],opacity:1,label:"Cortical-nucleus"},7008:{color:[232,146,35],opacity:1,label:"Accessory-Basal-nucleus"},7009:{color:[20,60,120],opacity:1,label:"Corticoamygdaloid-transitio"},7010:{color:[250,250,0],opacity:1,label:"Anterior-amygdaloid-area-AAA"},7011:{color:[122,187,222],opacity:1,label:"Fusion-amygdala-HP-FAH"},7012:{color:[237,12,177],opacity:1,label:"Hippocampal-amygdala-transition-HATA"},7013:{color:[10,49,255],opacity:1,label:"Endopiriform-nucleus"},7014:{color:[205,184,144],opacity:1,label:"Lateral-nucleus-olfactory-tract"},7015:{color:[45,205,165],opacity:1,label:"Paralaminar-nucleus"},7016:{color:[117,160,175],opacity:1,label:"Intercalated-nucleus"},7017:{color:[221,217,21],opacity:1,label:"Prepiriform-cortex"},7018:{color:[20,60,120],opacity:1,label:"Periamygdaloid-cortex"},7019:{color:[141,21,100],opacity:1,label:"Envelope-Amygdala"},7020:{color:[225,140,141],opacity:1,label:"Extranuclear-Amydala"},7100:{color:[42,201,168],opacity:1,label:"Brainstem-inferior-colliculus"},7101:{color:[168,104,162],opacity:1,label:"Brainstem-cochlear-nucleus"},8001:{color:[74,130,181],opacity:1,label:"Thalamus-Anterior"},8002:{color:[242,241,240],opacity:1,label:"Thalamus-Ventral-anterior"},8003:{color:[206,65,78],opacity:1,label:"Thalamus-Lateral-dorsal"},8004:{color:[120,21,133],opacity:1,label:"Thalamus-Lateral-posterior"},8005:{color:[195,61,246],opacity:1,label:"Thalamus-Ventral-lateral"},8006:{color:[3,147,6],opacity:1,label:"Thalamus-Ventral-posterior-medial"},8007:{color:[220,251,163],opacity:1,label:"Thalamus-Ventral-posterior-lateral"},8008:{color:[232,146,33],opacity:1,label:"Thalamus-intralaminar"},8009:{color:[4,114,14],opacity:1,label:"Thalamus-centromedian"},8010:{color:[121,184,220],opacity:1,label:"Thalamus-mediodorsal"},8011:{color:[235,11,175],opacity:1,label:"Thalamus-medial"},8012:{color:[12,46,250],opacity:1,label:"Thalamus-pulvinar"},8013:{color:[203,182,143],opacity:1,label:"Thalamus-lateral-geniculate"},8014:{color:[42,204,167],opacity:1,label:"Thalamus-medial-geniculate"},9e3:{color:[50,100,30],opacity:1,label:"ctx-lh-prefrontal"},9001:{color:[30,100,45],opacity:1,label:"ctx-lh-primary-motor"},9002:{color:[130,100,165],opacity:1,label:"ctx-lh-premotor"},9003:{color:[105,25,5],opacity:1,label:"ctx-lh-temporal"},9004:{color:[125,70,55],opacity:1,label:"ctx-lh-posterior-parietal"},9005:{color:[225,20,105],opacity:1,label:"ctx-lh-prim-sec-somatosensory"},9006:{color:[225,20,15],opacity:1,label:"ctx-lh-occipital"},9500:{color:[50,200,30],opacity:1,label:"ctx-rh-prefrontal"},9501:{color:[30,150,45],opacity:1,label:"ctx-rh-primary-motor"},9502:{color:[130,150,165],opacity:1,label:"ctx-rh-premotor"},9503:{color:[105,75,5],opacity:1,label:"ctx-rh-temporal"},9504:{color:[125,120,55],opacity:1,label:"ctx-rh-posterior-parietal"},9505:{color:[225,70,105],opacity:1,label:"ctx-rh-prim-sec-somatosensory"},9506:{color:[225,70,15],opacity:1,label:"ctx-rh-occipital"},11100:{color:[0,0,0],opacity:1,label:"ctx_lh_Unknown"},11101:{color:[23,220,60],opacity:1,label:"ctx_lh_G_and_S_frontomargin"},11102:{color:[23,60,180],opacity:1,label:"ctx_lh_G_and_S_occipital_inf"},11103:{color:[63,100,60],opacity:1,label:"ctx_lh_G_and_S_paracentral"},11104:{color:[63,20,220],opacity:1,label:"ctx_lh_G_and_S_subcentral"},11105:{color:[13,0,250],opacity:1,label:"ctx_lh_G_and_S_transv_frontopol"},11106:{color:[26,60,0],opacity:1,label:"ctx_lh_G_and_S_cingul-Ant"},11107:{color:[26,60,75],opacity:1,label:"ctx_lh_G_and_S_cingul-Mid-Ant"},11108:{color:[26,60,150],opacity:1,label:"ctx_lh_G_and_S_cingul-Mid-Post"},11109:{color:[25,60,250],opacity:1,label:"ctx_lh_G_cingul-Post-dorsal"},11110:{color:[60,25,25],opacity:1,label:"ctx_lh_G_cingul-Post-ventral"},11111:{color:[180,20,20],opacity:1,label:"ctx_lh_G_cuneus"},11112:{color:[220,20,100],opacity:1,label:"ctx_lh_G_front_inf-Opercular"},11113:{color:[140,60,60],opacity:1,label:"ctx_lh_G_front_inf-Orbital"},11114:{color:[180,220,140],opacity:1,label:"ctx_lh_G_front_inf-Triangul"},11115:{color:[140,100,180],opacity:1,label:"ctx_lh_G_front_middle"},11116:{color:[180,20,140],opacity:1,label:"ctx_lh_G_front_sup"},11117:{color:[23,10,10],opacity:1,label:"ctx_lh_G_Ins_lg_and_S_cent_ins"},11118:{color:[225,140,140],opacity:1,label:"ctx_lh_G_insular_short"},11119:{color:[180,60,180],opacity:1,label:"ctx_lh_G_occipital_middle"},11120:{color:[20,220,60],opacity:1,label:"ctx_lh_G_occipital_sup"},11121:{color:[60,20,140],opacity:1,label:"ctx_lh_G_oc-temp_lat-fusifor"},11122:{color:[220,180,140],opacity:1,label:"ctx_lh_G_oc-temp_med-Lingual"},11123:{color:[65,100,20],opacity:1,label:"ctx_lh_G_oc-temp_med-Parahip"},11124:{color:[220,60,20],opacity:1,label:"ctx_lh_G_orbital"},11125:{color:[20,60,220],opacity:1,label:"ctx_lh_G_pariet_inf-Angular"},11126:{color:[100,100,60],opacity:1,label:"ctx_lh_G_pariet_inf-Supramar"},11127:{color:[220,180,220],opacity:1,label:"ctx_lh_G_parietal_sup"},11128:{color:[20,180,140],opacity:1,label:"ctx_lh_G_postcentral"},11129:{color:[60,140,180],opacity:1,label:"ctx_lh_G_precentral"},11130:{color:[25,20,140],opacity:1,label:"ctx_lh_G_precuneus"},11131:{color:[20,60,100],opacity:1,label:"ctx_lh_G_rectus"},11132:{color:[60,220,20],opacity:1,label:"ctx_lh_G_subcallosal"},11133:{color:[60,60,220],opacity:1,label:"ctx_lh_G_temp_sup-G_T_transv"},11134:{color:[220,60,220],opacity:1,label:"ctx_lh_G_temp_sup-Lateral"},11135:{color:[65,220,60],opacity:1,label:"ctx_lh_G_temp_sup-Plan_polar"},11136:{color:[25,140,20],opacity:1,label:"ctx_lh_G_temp_sup-Plan_tempo"},11137:{color:[220,220,100],opacity:1,label:"ctx_lh_G_temporal_inf"},11138:{color:[180,60,60],opacity:1,label:"ctx_lh_G_temporal_middle"},11139:{color:[61,20,220],opacity:1,label:"ctx_lh_Lat_Fis-ant-Horizont"},11140:{color:[61,20,60],opacity:1,label:"ctx_lh_Lat_Fis-ant-Vertical"},11141:{color:[61,60,100],opacity:1,label:"ctx_lh_Lat_Fis-post"},11142:{color:[25,25,25],opacity:1,label:"ctx_lh_Medial_wall"},11143:{color:[140,20,60],opacity:1,label:"ctx_lh_Pole_occipital"},11144:{color:[220,180,20],opacity:1,label:"ctx_lh_Pole_temporal"},11145:{color:[63,180,180],opacity:1,label:"ctx_lh_S_calcarine"},11146:{color:[221,20,10],opacity:1,label:"ctx_lh_S_central"},11147:{color:[221,20,100],opacity:1,label:"ctx_lh_S_cingul-Marginalis"},11148:{color:[221,60,140],opacity:1,label:"ctx_lh_S_circular_insula_ant"},11149:{color:[221,20,220],opacity:1,label:"ctx_lh_S_circular_insula_inf"},11150:{color:[61,220,220],opacity:1,label:"ctx_lh_S_circular_insula_sup"},11151:{color:[100,200,200],opacity:1,label:"ctx_lh_S_collat_transv_ant"},11152:{color:[10,200,200],opacity:1,label:"ctx_lh_S_collat_transv_post"},11153:{color:[221,220,20],opacity:1,label:"ctx_lh_S_front_inf"},11154:{color:[141,20,100],opacity:1,label:"ctx_lh_S_front_middle"},11155:{color:[61,220,100],opacity:1,label:"ctx_lh_S_front_sup"},11156:{color:[141,60,20],opacity:1,label:"ctx_lh_S_interm_prim-Jensen"},11157:{color:[143,20,220],opacity:1,label:"ctx_lh_S_intrapariet_and_P_trans"},11158:{color:[101,60,220],opacity:1,label:"ctx_lh_S_oc_middle_and_Lunatus"},11159:{color:[21,20,140],opacity:1,label:"ctx_lh_S_oc_sup_and_transversal"},11160:{color:[61,20,180],opacity:1,label:"ctx_lh_S_occipital_ant"},11161:{color:[221,140,20],opacity:1,label:"ctx_lh_S_oc-temp_lat"},11162:{color:[141,100,220],opacity:1,label:"ctx_lh_S_oc-temp_med_and_Lingual"},11163:{color:[221,100,20],opacity:1,label:"ctx_lh_S_orbital_lateral"},11164:{color:[181,200,20],opacity:1,label:"ctx_lh_S_orbital_med-olfact"},11165:{color:[101,20,20],opacity:1,label:"ctx_lh_S_orbital-H_Shaped"},11166:{color:[101,100,180],opacity:1,label:"ctx_lh_S_parieto_occipital"},11167:{color:[181,220,20],opacity:1,label:"ctx_lh_S_pericallosal"},11168:{color:[21,140,200],opacity:1,label:"ctx_lh_S_postcentral"},11169:{color:[21,20,240],opacity:1,label:"ctx_lh_S_precentral-inf-part"},11170:{color:[21,20,200],opacity:1,label:"ctx_lh_S_precentral-sup-part"},11171:{color:[21,20,60],opacity:1,label:"ctx_lh_S_suborbital"},11172:{color:[101,60,60],opacity:1,label:"ctx_lh_S_subparietal"},11173:{color:[21,180,180],opacity:1,label:"ctx_lh_S_temporal_inf"},11174:{color:[223,220,60],opacity:1,label:"ctx_lh_S_temporal_sup"},11175:{color:[221,60,60],opacity:1,label:"ctx_lh_S_temporal_transverse"},12100:{color:[0,0,0],opacity:1,label:"ctx_rh_Unknown"},12101:{color:[23,220,60],opacity:1,label:"ctx_rh_G_and_S_frontomargin"},12102:{color:[23,60,180],opacity:1,label:"ctx_rh_G_and_S_occipital_inf"},12103:{color:[63,100,60],opacity:1,label:"ctx_rh_G_and_S_paracentral"},12104:{color:[63,20,220],opacity:1,label:"ctx_rh_G_and_S_subcentral"},12105:{color:[13,0,250],opacity:1,label:"ctx_rh_G_and_S_transv_frontopol"},12106:{color:[26,60,0],opacity:1,label:"ctx_rh_G_and_S_cingul-Ant"},12107:{color:[26,60,75],opacity:1,label:"ctx_rh_G_and_S_cingul-Mid-Ant"},12108:{color:[26,60,150],opacity:1,label:"ctx_rh_G_and_S_cingul-Mid-Post"},12109:{color:[25,60,250],opacity:1,label:"ctx_rh_G_cingul-Post-dorsal"},12110:{color:[60,25,25],opacity:1,label:"ctx_rh_G_cingul-Post-ventral"},12111:{color:[180,20,20],opacity:1,label:"ctx_rh_G_cuneus"},12112:{color:[220,20,100],opacity:1,label:"ctx_rh_G_front_inf-Opercular"},12113:{color:[140,60,60],opacity:1,label:"ctx_rh_G_front_inf-Orbital"},12114:{color:[180,220,140],opacity:1,label:"ctx_rh_G_front_inf-Triangul"},12115:{color:[140,100,180],opacity:1,label:"ctx_rh_G_front_middle"},12116:{color:[180,20,140],opacity:1,label:"ctx_rh_G_front_sup"},12117:{color:[23,10,10],opacity:1,label:"ctx_rh_G_Ins_lg_and_S_cent_ins"},12118:{color:[225,140,140],opacity:1,label:"ctx_rh_G_insular_short"},12119:{color:[180,60,180],opacity:1,label:"ctx_rh_G_occipital_middle"},12120:{color:[20,220,60],opacity:1,label:"ctx_rh_G_occipital_sup"},12121:{color:[60,20,140],opacity:1,label:"ctx_rh_G_oc-temp_lat-fusifor"},12122:{color:[220,180,140],opacity:1,label:"ctx_rh_G_oc-temp_med-Lingual"},12123:{color:[65,100,20],opacity:1,label:"ctx_rh_G_oc-temp_med-Parahip"},12124:{color:[220,60,20],opacity:1,label:"ctx_rh_G_orbital"},12125:{color:[20,60,220],opacity:1,label:"ctx_rh_G_pariet_inf-Angular"},12126:{color:[100,100,60],opacity:1,label:"ctx_rh_G_pariet_inf-Supramar"},12127:{color:[220,180,220],opacity:1,label:"ctx_rh_G_parietal_sup"},12128:{color:[20,180,140],opacity:1,label:"ctx_rh_G_postcentral"},12129:{color:[60,140,180],opacity:1,label:"ctx_rh_G_precentral"},12130:{color:[25,20,140],opacity:1,label:"ctx_rh_G_precuneus"},12131:{color:[20,60,100],opacity:1,label:"ctx_rh_G_rectus"},12132:{color:[60,220,20],opacity:1,label:"ctx_rh_G_subcallosal"},12133:{color:[60,60,220],opacity:1,label:"ctx_rh_G_temp_sup-G_T_transv"},12134:{color:[220,60,220],opacity:1,label:"ctx_rh_G_temp_sup-Lateral"},12135:{color:[65,220,60],opacity:1,label:"ctx_rh_G_temp_sup-Plan_polar"},12136:{color:[25,140,20],opacity:1,label:"ctx_rh_G_temp_sup-Plan_tempo"},12137:{color:[220,220,100],opacity:1,label:"ctx_rh_G_temporal_inf"},12138:{color:[180,60,60],opacity:1,label:"ctx_rh_G_temporal_middle"},12139:{color:[61,20,220],opacity:1,label:"ctx_rh_Lat_Fis-ant-Horizont"},12140:{color:[61,20,60],opacity:1,label:"ctx_rh_Lat_Fis-ant-Vertical"},12141:{color:[61,60,100],opacity:1,label:"ctx_rh_Lat_Fis-post"},12142:{color:[25,25,25],opacity:1,label:"ctx_rh_Medial_wall"},12143:{color:[140,20,60],opacity:1,label:"ctx_rh_Pole_occipital"},12144:{color:[220,180,20],opacity:1,label:"ctx_rh_Pole_temporal"},12145:{color:[63,180,180],opacity:1,label:"ctx_rh_S_calcarine"},12146:{color:[221,20,10],opacity:1,label:"ctx_rh_S_central"},12147:{color:[221,20,100],opacity:1,label:"ctx_rh_S_cingul-Marginalis"},12148:{color:[221,60,140],opacity:1,label:"ctx_rh_S_circular_insula_ant"},12149:{color:[221,20,220],opacity:1,label:"ctx_rh_S_circular_insula_inf"},12150:{color:[61,220,220],opacity:1,label:"ctx_rh_S_circular_insula_sup"},12151:{color:[100,200,200],opacity:1,label:"ctx_rh_S_collat_transv_ant"},12152:{color:[10,200,200],opacity:1,label:"ctx_rh_S_collat_transv_post"},12153:{color:[221,220,20],opacity:1,label:"ctx_rh_S_front_inf"},12154:{color:[141,20,100],opacity:1,label:"ctx_rh_S_front_middle"},12155:{color:[61,220,100],opacity:1,label:"ctx_rh_S_front_sup"},12156:{color:[141,60,20],opacity:1,label:"ctx_rh_S_interm_prim-Jensen"},12157:{color:[143,20,220],opacity:1,label:"ctx_rh_S_intrapariet_and_P_trans"},12158:{color:[101,60,220],opacity:1,label:"ctx_rh_S_oc_middle_and_Lunatus"},12159:{color:[21,20,140],opacity:1,label:"ctx_rh_S_oc_sup_and_transversal"},12160:{color:[61,20,180],opacity:1,label:"ctx_rh_S_occipital_ant"},12161:{color:[221,140,20],opacity:1,label:"ctx_rh_S_oc-temp_lat"},12162:{color:[141,100,220],opacity:1,label:"ctx_rh_S_oc-temp_med_and_Lingual"},12163:{color:[221,100,20],opacity:1,label:"ctx_rh_S_orbital_lateral"},12164:{color:[181,200,20],opacity:1,label:"ctx_rh_S_orbital_med-olfact"},12165:{color:[101,20,20],opacity:1,label:"ctx_rh_S_orbital-H_Shaped"},12166:{color:[101,100,180],opacity:1,label:"ctx_rh_S_parieto_occipital"},12167:{color:[181,220,20],opacity:1,label:"ctx_rh_S_pericallosal"},12168:{color:[21,140,200],opacity:1,label:"ctx_rh_S_postcentral"},12169:{color:[21,20,240],opacity:1,label:"ctx_rh_S_precentral-inf-part"},12170:{color:[21,20,200],opacity:1,label:"ctx_rh_S_precentral-sup-part"},12171:{color:[21,20,60],opacity:1,label:"ctx_rh_S_suborbital"},12172:{color:[101,60,60],opacity:1,label:"ctx_rh_S_subparietal"},12173:{color:[21,180,180],opacity:1,label:"ctx_rh_S_temporal_inf"},12174:{color:[223,220,60],opacity:1,label:"ctx_rh_S_temporal_sup"},12175:{color:[221,60,60],opacity:1,label:"ctx_rh_S_temporal_transverse"},13100:{color:[0,0,0],opacity:1,label:"wm_lh_Unknown"},13101:{color:[23,220,60],opacity:1,label:"wm_lh_G_and_S_frontomargin"},13102:{color:[23,60,180],opacity:1,label:"wm_lh_G_and_S_occipital_inf"},13103:{color:[63,100,60],opacity:1,label:"wm_lh_G_and_S_paracentral"},13104:{color:[63,20,220],opacity:1,label:"wm_lh_G_and_S_subcentral"},13105:{color:[13,0,250],opacity:1,label:"wm_lh_G_and_S_transv_frontopol"},13106:{color:[26,60,0],opacity:1,label:"wm_lh_G_and_S_cingul-Ant"},13107:{color:[26,60,75],opacity:1,label:"wm_lh_G_and_S_cingul-Mid-Ant"},13108:{color:[26,60,150],opacity:1,label:"wm_lh_G_and_S_cingul-Mid-Post"},13109:{color:[25,60,250],opacity:1,label:"wm_lh_G_cingul-Post-dorsal"},13110:{color:[60,25,25],opacity:1,label:"wm_lh_G_cingul-Post-ventral"},13111:{color:[180,20,20],opacity:1,label:"wm_lh_G_cuneus"},13112:{color:[220,20,100],opacity:1,label:"wm_lh_G_front_inf-Opercular"},13113:{color:[140,60,60],opacity:1,label:"wm_lh_G_front_inf-Orbital"},13114:{color:[180,220,140],opacity:1,label:"wm_lh_G_front_inf-Triangul"},13115:{color:[140,100,180],opacity:1,label:"wm_lh_G_front_middle"},13116:{color:[180,20,140],opacity:1,label:"wm_lh_G_front_sup"},13117:{color:[23,10,10],opacity:1,label:"wm_lh_G_Ins_lg_and_S_cent_ins"},13118:{color:[225,140,140],opacity:1,label:"wm_lh_G_insular_short"},13119:{color:[180,60,180],opacity:1,label:"wm_lh_G_occipital_middle"},13120:{color:[20,220,60],opacity:1,label:"wm_lh_G_occipital_sup"},13121:{color:[60,20,140],opacity:1,label:"wm_lh_G_oc-temp_lat-fusifor"},13122:{color:[220,180,140],opacity:1,label:"wm_lh_G_oc-temp_med-Lingual"},13123:{color:[65,100,20],opacity:1,label:"wm_lh_G_oc-temp_med-Parahip"},13124:{color:[220,60,20],opacity:1,label:"wm_lh_G_orbital"},13125:{color:[20,60,220],opacity:1,label:"wm_lh_G_pariet_inf-Angular"},13126:{color:[100,100,60],opacity:1,label:"wm_lh_G_pariet_inf-Supramar"},13127:{color:[220,180,220],opacity:1,label:"wm_lh_G_parietal_sup"},13128:{color:[20,180,140],opacity:1,label:"wm_lh_G_postcentral"},13129:{color:[60,140,180],opacity:1,label:"wm_lh_G_precentral"},13130:{color:[25,20,140],opacity:1,label:"wm_lh_G_precuneus"},13131:{color:[20,60,100],opacity:1,label:"wm_lh_G_rectus"},13132:{color:[60,220,20],opacity:1,label:"wm_lh_G_subcallosal"},13133:{color:[60,60,220],opacity:1,label:"wm_lh_G_temp_sup-G_T_transv"},13134:{color:[220,60,220],opacity:1,label:"wm_lh_G_temp_sup-Lateral"},13135:{color:[65,220,60],opacity:1,label:"wm_lh_G_temp_sup-Plan_polar"},13136:{color:[25,140,20],opacity:1,label:"wm_lh_G_temp_sup-Plan_tempo"},13137:{color:[220,220,100],opacity:1,label:"wm_lh_G_temporal_inf"},13138:{color:[180,60,60],opacity:1,label:"wm_lh_G_temporal_middle"},13139:{color:[61,20,220],opacity:1,label:"wm_lh_Lat_Fis-ant-Horizont"},13140:{color:[61,20,60],opacity:1,label:"wm_lh_Lat_Fis-ant-Vertical"},13141:{color:[61,60,100],opacity:1,label:"wm_lh_Lat_Fis-post"},13142:{color:[25,25,25],opacity:1,label:"wm_lh_Medial_wall"},13143:{color:[140,20,60],opacity:1,label:"wm_lh_Pole_occipital"},13144:{color:[220,180,20],opacity:1,label:"wm_lh_Pole_temporal"},13145:{color:[63,180,180],opacity:1,label:"wm_lh_S_calcarine"},13146:{color:[221,20,10],opacity:1,label:"wm_lh_S_central"},13147:{color:[221,20,100],opacity:1,label:"wm_lh_S_cingul-Marginalis"},13148:{color:[221,60,140],opacity:1,label:"wm_lh_S_circular_insula_ant"},13149:{color:[221,20,220],opacity:1,label:"wm_lh_S_circular_insula_inf"},13150:{color:[61,220,220],opacity:1,label:"wm_lh_S_circular_insula_sup"},13151:{color:[100,200,200],opacity:1,label:"wm_lh_S_collat_transv_ant"},13152:{color:[10,200,200],opacity:1,label:"wm_lh_S_collat_transv_post"},13153:{color:[221,220,20],opacity:1,label:"wm_lh_S_front_inf"},13154:{color:[141,20,100],opacity:1,label:"wm_lh_S_front_middle"},13155:{color:[61,220,100],opacity:1,label:"wm_lh_S_front_sup"},13156:{color:[141,60,20],opacity:1,label:"wm_lh_S_interm_prim-Jensen"},13157:{color:[143,20,220],opacity:1,label:"wm_lh_S_intrapariet_and_P_trans"},13158:{color:[101,60,220],opacity:1,label:"wm_lh_S_oc_middle_and_Lunatus"},13159:{color:[21,20,140],opacity:1,label:"wm_lh_S_oc_sup_and_transversal"},13160:{color:[61,20,180],opacity:1,label:"wm_lh_S_occipital_ant"},13161:{color:[221,140,20],opacity:1,label:"wm_lh_S_oc-temp_lat"},13162:{color:[141,100,220],opacity:1,label:"wm_lh_S_oc-temp_med_and_Lingual"},13163:{color:[221,100,20],opacity:1,label:"wm_lh_S_orbital_lateral"},13164:{color:[181,200,20],opacity:1,label:"wm_lh_S_orbital_med-olfact"},13165:{color:[101,20,20],opacity:1,label:"wm_lh_S_orbital-H_Shaped"},13166:{color:[101,100,180],opacity:1,label:"wm_lh_S_parieto_occipital"},13167:{color:[181,220,20],opacity:1,label:"wm_lh_S_pericallosal"},13168:{color:[21,140,200],opacity:1,label:"wm_lh_S_postcentral"},13169:{color:[21,20,240],opacity:1,label:"wm_lh_S_precentral-inf-part"},13170:{color:[21,20,200],opacity:1,label:"wm_lh_S_precentral-sup-part"},13171:{color:[21,20,60],opacity:1,label:"wm_lh_S_suborbital"},13172:{color:[101,60,60],opacity:1,label:"wm_lh_S_subparietal"},13173:{color:[21,180,180],opacity:1,label:"wm_lh_S_temporal_inf"},13174:{color:[223,220,60],opacity:1,label:"wm_lh_S_temporal_sup"},13175:{color:[221,60,60],opacity:1,label:"wm_lh_S_temporal_transverse"},14100:{color:[0,0,0],opacity:1,label:"wm_rh_Unknown"},14101:{color:[23,220,60],opacity:1,label:"wm_rh_G_and_S_frontomargin"},14102:{color:[23,60,180],opacity:1,label:"wm_rh_G_and_S_occipital_inf"},14103:{color:[63,100,60],opacity:1,label:"wm_rh_G_and_S_paracentral"},14104:{color:[63,20,220],opacity:1,label:"wm_rh_G_and_S_subcentral"},14105:{color:[13,0,250],opacity:1,label:"wm_rh_G_and_S_transv_frontopol"},14106:{color:[26,60,0],opacity:1,label:"wm_rh_G_and_S_cingul-Ant"},14107:{color:[26,60,75],opacity:1,label:"wm_rh_G_and_S_cingul-Mid-Ant"},14108:{color:[26,60,150],opacity:1,label:"wm_rh_G_and_S_cingul-Mid-Post"},14109:{color:[25,60,250],opacity:1,label:"wm_rh_G_cingul-Post-dorsal"},14110:{color:[60,25,25],opacity:1,label:"wm_rh_G_cingul-Post-ventral"},14111:{color:[180,20,20],opacity:1,label:"wm_rh_G_cuneus"},14112:{color:[220,20,100],opacity:1,label:"wm_rh_G_front_inf-Opercular"},14113:{color:[140,60,60],opacity:1,label:"wm_rh_G_front_inf-Orbital"},14114:{color:[180,220,140],opacity:1,label:"wm_rh_G_front_inf-Triangul"},14115:{color:[140,100,180],opacity:1,label:"wm_rh_G_front_middle"},14116:{color:[180,20,140],opacity:1,label:"wm_rh_G_front_sup"},14117:{color:[23,10,10],opacity:1,label:"wm_rh_G_Ins_lg_and_S_cent_ins"},14118:{color:[225,140,140],opacity:1,label:"wm_rh_G_insular_short"},14119:{color:[180,60,180],opacity:1,label:"wm_rh_G_occipital_middle"},14120:{color:[20,220,60],opacity:1,label:"wm_rh_G_occipital_sup"},14121:{color:[60,20,140],opacity:1,label:"wm_rh_G_oc-temp_lat-fusifor"},14122:{color:[220,180,140],opacity:1,label:"wm_rh_G_oc-temp_med-Lingual"},14123:{color:[65,100,20],opacity:1,label:"wm_rh_G_oc-temp_med-Parahip"},14124:{color:[220,60,20],opacity:1,label:"wm_rh_G_orbital"},14125:{color:[20,60,220],opacity:1,label:"wm_rh_G_pariet_inf-Angular"},14126:{color:[100,100,60],opacity:1,label:"wm_rh_G_pariet_inf-Supramar"},14127:{color:[220,180,220],opacity:1,label:"wm_rh_G_parietal_sup"},14128:{color:[20,180,140],opacity:1,label:"wm_rh_G_postcentral"},14129:{color:[60,140,180],opacity:1,label:"wm_rh_G_precentral"},14130:{color:[25,20,140],opacity:1,label:"wm_rh_G_precuneus"},14131:{color:[20,60,100],opacity:1,label:"wm_rh_G_rectus"},14132:{color:[60,220,20],opacity:1,label:"wm_rh_G_subcallosal"},14133:{color:[60,60,220],opacity:1,label:"wm_rh_G_temp_sup-G_T_transv"},14134:{color:[220,60,220],opacity:1,label:"wm_rh_G_temp_sup-Lateral"},14135:{color:[65,220,60],opacity:1,label:"wm_rh_G_temp_sup-Plan_polar"},14136:{color:[25,140,20],opacity:1,label:"wm_rh_G_temp_sup-Plan_tempo"},14137:{color:[220,220,100],opacity:1,label:"wm_rh_G_temporal_inf"},14138:{color:[180,60,60],opacity:1,label:"wm_rh_G_temporal_middle"},14139:{color:[61,20,220],opacity:1,label:"wm_rh_Lat_Fis-ant-Horizont"},14140:{color:[61,20,60],opacity:1,label:"wm_rh_Lat_Fis-ant-Vertical"},14141:{color:[61,60,100],opacity:1,label:"wm_rh_Lat_Fis-post"},14142:{color:[25,25,25],opacity:1,label:"wm_rh_Medial_wall"},14143:{color:[140,20,60],opacity:1,label:"wm_rh_Pole_occipital"},14144:{color:[220,180,20],opacity:1,label:"wm_rh_Pole_temporal"},14145:{color:[63,180,180],opacity:1,label:"wm_rh_S_calcarine"},14146:{color:[221,20,10],opacity:1,label:"wm_rh_S_central"},14147:{color:[221,20,100],opacity:1,label:"wm_rh_S_cingul-Marginalis"},14148:{color:[221,60,140],opacity:1,label:"wm_rh_S_circular_insula_ant"},14149:{color:[221,20,220],opacity:1,label:"wm_rh_S_circular_insula_inf"},14150:{color:[61,220,220],opacity:1,label:"wm_rh_S_circular_insula_sup"},14151:{color:[100,200,200],opacity:1,label:"wm_rh_S_collat_transv_ant"},14152:{color:[10,200,200],opacity:1,label:"wm_rh_S_collat_transv_post"},14153:{color:[221,220,20],opacity:1,label:"wm_rh_S_front_inf"},14154:{color:[141,20,100],opacity:1,label:"wm_rh_S_front_middle"},14155:{color:[61,220,100],opacity:1,label:"wm_rh_S_front_sup"},14156:{color:[141,60,20],opacity:1,label:"wm_rh_S_interm_prim-Jensen"},14157:{color:[143,20,220],opacity:1,label:"wm_rh_S_intrapariet_and_P_trans"},14158:{color:[101,60,220],opacity:1,label:"wm_rh_S_oc_middle_and_Lunatus"},14159:{color:[21,20,140],opacity:1,label:"wm_rh_S_oc_sup_and_transversal"},14160:{color:[61,20,180],opacity:1,label:"wm_rh_S_occipital_ant"},14161:{color:[221,140,20],opacity:1,label:"wm_rh_S_oc-temp_lat"},14162:{color:[141,100,220],opacity:1,label:"wm_rh_S_oc-temp_med_and_Lingual"},14163:{color:[221,100,20],opacity:1,label:"wm_rh_S_orbital_lateral"},14164:{color:[181,200,20],opacity:1,label:"wm_rh_S_orbital_med-olfact"},14165:{color:[101,20,20],opacity:1,label:"wm_rh_S_orbital-H_Shaped"},14166:{color:[101,100,180],opacity:1,label:"wm_rh_S_parieto_occipital"},14167:{color:[181,220,20],opacity:1,label:"wm_rh_S_pericallosal"},14168:{color:[21,140,200],opacity:1,label:"wm_rh_S_postcentral"},14169:{color:[21,20,240],opacity:1,label:"wm_rh_S_precentral-inf-part"},14170:{color:[21,20,200],opacity:1,label:"wm_rh_S_precentral-sup-part"},14171:{color:[21,20,60],opacity:1,label:"wm_rh_S_suborbital"},14172:{color:[101,60,60],opacity:1,label:"wm_rh_S_subparietal"},14173:{color:[21,180,180],opacity:1,label:"wm_rh_S_temporal_inf"},14174:{color:[223,220,60],opacity:1,label:"wm_rh_S_temporal_sup"},14175:{color:[221,60,60],opacity:1,label:"wm_rh_S_temporal_transverse"}};class r{constructor(t="Freesurfer"){this._presetID=t,this._presets=this.presetSegs()}set preset(t){this._presetID=t}get preset(){return this.fetchPreset(this._presetID)}fetchPreset(t){return this._presets[t]}addPreset(t){this._presets.push(t)}presetsAvailable(t="segmentation"){let e=[],i=this._presets;for(let t in i)e.push(t);return e}presetSegs(){return{Freesurfer:n}}}},3329:(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var n=i(1779);class r extends n.Z{constructor(){super(),this.name="unpack",this._packedData="packedData",this._offset="offset",this._unpackedData="unpackedData",this._base._uniforms={uNumberOfChannels:{value:1},uBitsAllocated:{value:16},uPixelType:{value:0}}}api(t=this._base,e=this._packedData,i=this._offset,n=this._unpackedData){return this._base=t,this.compute(e,i,n)}compute(t,e,i){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i});`}computeDefinition(){let t="";if(1===this._base._uniforms.uNumberOfChannels.value)switch(this._base._uniforms.uBitsAllocated.value){case 1:case 8:t=this.upack8();break;case 16:t=this.upack16();break;case 32:t=this.upack32();break;default:t=this.upackIdentity()}else t=this.upackIdentity();this._definition=`\nvoid ${this._name}(in vec4 packedData, in int offset, out vec4 unpackedData){\n\n${t}\n\n}  \n    `}upack8(){return this._base._functions.uInt8=this.uInt8(),"\nfloat floatedOffset = float(offset);\nfloat floatedOffsetSquared = floatedOffset * floatedOffset;\nuInt8(\n  step( floatedOffsetSquared , 0.0 ) * packedData.r +\n  step( floatedOffsetSquared - 2. * floatedOffset + 1., 0.0 ) * packedData.g +\n  step( floatedOffsetSquared - 2. * 2. *  floatedOffset + 4., 0.0 ) * packedData.b +\n  step( floatedOffsetSquared - 2. * 3. *  floatedOffset + 9., 0.0 ) * packedData.a\n  ,\n  unpackedData.x);\n    "}upack16(){return this._base._functions.uInt16=this.uInt16(),"\nfloat floatedOffset = float(offset);\nuInt16(\n  packedData.r * (1. - floatedOffset) + packedData.b * floatedOffset,\n  packedData.g * (1. - floatedOffset) + packedData.a * floatedOffset,\n  unpackedData.x);\n    "}upack32(){return 0===this._base._uniforms.uPixelType.value?(this._base._functions.uInt32=this.uInt32(),"\nuInt32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      "):(this._base._functions.uFloat32=this.uFloat32(),"\nuFloat32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      ")}upackIdentity(){return"\nunpackedData = packedData;\n      "}uInt8(){return"\nvoid uInt8(in float r, out float value){\n  value = r * 255.;\n}\n    "}uInt16(){return"\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 255. + a * 255. * 256.;\n}\n    "}uInt32(){return"\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 255. + g * 255. * 256. + b * 255. * 256. * 256. + a * 255. * 256. * 256. * 256.;\n  // value = r * 255. + g * 65025. + b * 16581375. + a * 4228250625.;\n}\n    "}uFloat32(){return"\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n    "}}const s=new r;class a extends n.Z{constructor(){super(),this.name="texture3d",this._dataCoordinates="dataCoordinates",this._dataValue="dataValue",this._offset="offset"}api(t=this._base,e=this._dataCoordinates,i=this._dataValue,n=this._offset){return this._base=t,this.compute(e,i,n)}compute(t,e,i){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i});`}computeDefinition(){let t="\n      step( abs( textureIndexF - 0.0 ), 0.0 ) * texture2D(uTextureContainer[0], uv) +\n      step( abs( textureIndexF - 1.0 ), 0.0 ) * texture2D(uTextureContainer[1], uv) +\n      step( abs( textureIndexF - 2.0 ), 0.0 ) * texture2D(uTextureContainer[2], uv) +\n      step( abs( textureIndexF - 3.0 ), 0.0 ) * texture2D(uTextureContainer[3], uv) +\n      step( abs( textureIndexF - 4.0 ), 0.0 ) * texture2D(uTextureContainer[4], uv) +\n      step( abs( textureIndexF - 5.0 ), 0.0 ) * texture2D(uTextureContainer[5], uv) +\n      step( abs( textureIndexF - 6.0 ), 0.0 ) * texture2D(uTextureContainer[6], uv)";14===this._base._uniforms.uTextureContainer.length&&(t+=" +\n      step( abs( textureIndexF - 7.0 ), 0.0 ) * texture2D(uTextureContainer[7], uv) +\n      step( abs( textureIndexF - 8.0 ), 0.0 ) * texture2D(uTextureContainer[8], uv) +\n      step( abs( textureIndexF - 9.0 ), 0.0 ) * texture2D(uTextureContainer[9], uv) +\n      step( abs( textureIndexF - 10.0 ), 0.0 ) * texture2D(uTextureContainer[10], uv) +\n      step( abs( textureIndexF - 11.0 ), 0.0 ) * texture2D(uTextureContainer[11], uv) +\n      step( abs( textureIndexF - 12.0 ), 0.0 ) * texture2D(uTextureContainer[12], uv) +\n      step( abs( textureIndexF - 13.0 ), 0.0 ) * texture2D(uTextureContainer[13], uv)"),this._definition=`\nvoid ${this._name}(in ivec3 dataCoordinates, out vec4 dataValue, out int offset){\n  float textureSizeF = float(uTextureSize);\n  int voxelsPerTexture = uTextureSize*uTextureSize;\n\n  int index = dataCoordinates.x\n            + dataCoordinates.y * uDataDimensions.x\n            + dataCoordinates.z * uDataDimensions.y * uDataDimensions.x;\n  \n  // dividing an integer by an integer will give you an integer result, rounded down\n  // can not get float numbers to work :(\n  int packedIndex = index/uPackedPerPixel;\n  offset = index - uPackedPerPixel*packedIndex;\n\n  // Map data index to right sampler2D texture\n  int textureIndex = packedIndex/voxelsPerTexture;\n  int inTextureIndex = packedIndex - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int rowIndex = inTextureIndex/uTextureSize;\n  float rowIndexF = float(rowIndex);\n  float colIndex = float(inTextureIndex - uTextureSize * rowIndex);\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + colIndex) / textureSizeF;\n  uv.y = 1. - (0.5 + rowIndexF) / textureSizeF;\n\n  float textureIndexF = float(textureIndex);\n  dataValue = vec4(0.) + ${t};\n}\n    `}}const o=new a;class l extends n.Z{constructor(){super(),this.name="interpolationIdentity",this._currentVoxel="currentVoxel",this._dataValue="dataValue"}api(t=this._base,e=this._currentVoxel,i=this._dataValue){return this._base=t,this.compute(e,i)}compute(t,e){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e});`}computeDefinition(){this._definition=`\nvoid ${this._name}(in vec3 currentVoxel, out vec4 dataValue){\n  // lower bound\n  vec3 rcurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rcurrentVoxel.x), int(rcurrentVoxel.y), int(rcurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  ${o.api(this._base,"voxel","tmp","offset")}\n  ${s.api(this._base,"tmp","offset","dataValue")}\n}\n    `}}const h=new l;class c extends n.Z{constructor(){super(),this.name="interpolationTrilinear",this._currentVoxel="currentVoxel",this._dataValue="dataValue",this._gradient="gradient"}api(t=this._base,e=this._currentVoxel,i=this._dataValue,n=this._gradient){return this._base=t,this.compute(e,i,n)}compute(t,e,i){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i});`}computeDefinition(){this._definition=`\nvoid trilinearInterpolation(\n  in vec3 normalizedPosition,\n  out vec4 interpolatedValue,\n  in vec4 v000, in vec4 v100,\n  in vec4 v001, in vec4 v101,\n  in vec4 v010, in vec4 v110,\n  in vec4 v011, in vec4 v111) {\n  // https://en.wikipedia.org/wiki/Trilinear_interpolation\n  vec4 c00 = v000 * ( 1.0 - normalizedPosition.x ) + v100 * normalizedPosition.x;\n  vec4 c01 = v001 * ( 1.0 - normalizedPosition.x ) + v101 * normalizedPosition.x;\n  vec4 c10 = v010 * ( 1.0 - normalizedPosition.x ) + v110 * normalizedPosition.x;\n  vec4 c11 = v011 * ( 1.0 - normalizedPosition.x ) + v111 * normalizedPosition.x;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - normalizedPosition.y) + c10 * normalizedPosition.y;\n  vec4 c1 = c01 * ( 1.0 - normalizedPosition.y) + c11 * normalizedPosition.y;\n\n  // c\n  vec4 c = c0 * ( 1.0 - normalizedPosition.z) + c1 * normalizedPosition.z;\n  interpolatedValue = c;\n}\n\nvoid ${this._name}(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient){\n\n  vec3 lower_bound = floor(currentVoxel);\n  lower_bound = max(vec3(0.), lower_bound);\n  \n  vec3 higher_bound = lower_bound + vec3(1.);\n\n  vec3 normalizedPosition = (currentVoxel - lower_bound);\n  normalizedPosition =  max(vec3(0.), normalizedPosition);\n\n  vec4 interpolatedValue = vec4(0.);\n\n  //\n  // fetch values required for interpolation\n  //\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lower_bound.x, lower_bound.y, lower_bound.z);\n  ${h.api(this._base,"c000","v000")}\n\n  //\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(higher_bound.x, lower_bound.y, lower_bound.z);\n  ${h.api(this._base,"c100","v100")}\n\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lower_bound.x, lower_bound.y, higher_bound.z);\n  ${h.api(this._base,"c001","v001")}\n\n  //\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(higher_bound.x, lower_bound.y, higher_bound.z);\n  ${h.api(this._base,"c101","v101")}\n  \n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lower_bound.x, higher_bound.y, lower_bound.z);\n  ${h.api(this._base,"c010","v010")}\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(higher_bound.x, higher_bound.y, lower_bound.z);\n  ${h.api(this._base,"c110","v110")}\n\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lower_bound.x, higher_bound.y, higher_bound.z);\n  ${h.api(this._base,"c011","v011")}\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(higher_bound.x, higher_bound.y, higher_bound.z);\n  ${h.api(this._base,"c111","v111")}\n\n  // compute interpolation at position\n  trilinearInterpolation(normalizedPosition, interpolatedValue ,v000, v100, v001, v101, v010,v110, v011,v111);\n  dataValue = interpolatedValue;\n\n  // That breaks shading in volume rendering\n  // if (gradient.x == 1.) { // skip gradient calculation for slice helper\n  //  return;\n  // }\n\n  // compute gradient\n  float gradientStep = 0.005;\n\n  // x axis\n  vec3 g100 = vec3(1., 0., 0.);\n  vec3 ng100 = normalizedPosition + g100 * gradientStep;\n  ng100.x = min(1., ng100.x);\n\n  vec4 vg100 = vec4(0.);\n  trilinearInterpolation(ng100, vg100 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  vec3 go100 = -g100;\n  vec3 ngo100 = normalizedPosition + go100 * gradientStep;\n  ngo100.x = max(0., ngo100.x);\n\n  vec4 vgo100 = vec4(0.);\n  trilinearInterpolation(ngo100, vgo100 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  gradient.x = (g100.x * vg100.x + go100.x * vgo100.x);\n\n  // y axis\n  vec3 g010 = vec3(0., 1., 0.);\n  vec3 ng010 = normalizedPosition + g010 * gradientStep;\n  ng010.y = min(1., ng010.y);\n\n  vec4 vg010 = vec4(0.);\n  trilinearInterpolation(ng010, vg010 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  vec3 go010 = -g010;\n  vec3 ngo010 = normalizedPosition + go010 * gradientStep;\n  ngo010.y = max(0., ngo010.y);\n\n  vec4 vgo010 = vec4(0.);\n  trilinearInterpolation(ngo010, vgo010 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  gradient.y = (g010.y * vg010.x + go010.y * vgo010.x);\n\n  // z axis\n  vec3 g001 = vec3(0., 0., 1.);\n  vec3 ng001 = normalizedPosition + g001 * gradientStep;\n  ng001.z = min(1., ng001.z);\n\n  vec4 vg001 = vec4(0.);\n  trilinearInterpolation(ng001, vg001 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  vec3 go001 = -g001;\n  vec3 ngo001 = normalizedPosition + go001 * gradientStep;\n  ngo001.z = max(0., ngo001.z);\n\n  vec4 vgo001 = vec4(0.);\n  trilinearInterpolation(ngo001, vgo001 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  gradient.z = (g001.z * vg001.x + go001.z * vgo001.x);\n\n  // normalize gradient\n  // +0.0001  instead of if?\n  float gradientMagnitude = length(gradient);\n  if (gradientMagnitude > 0.0) {\n    gradient = -(1. / gradientMagnitude) * gradient;\n  }\n}\n    `}}const u=new c,d=function(t,e,i,n){switch(t._uniforms.uInterpolation.value){case 0:default:return h.api(t,e,i);case 1:return u.api(t,e,i,n)}}},1779:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{constructor(){this._name="shadersBase",this._base={_functions:{},_uniforms:{}},this._definition=""}get name(){return this._name}set name(t){this._name=t}}},8024:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{constructor(t){this._uniforms=t,this._functions={},this._main=""}functions(){""===this._main&&this.main();let t="";for(let e in this._functions)t+=this._functions[e]+"\n";return t}uniforms(){let t="";for(let e in this._uniforms){let i=this._uniforms[e];t+=`uniform ${i.typeGLSL} ${e}`,i&&i.length&&(t+=`[${i.length}]`),t+=";\n"}return t}main(){this._main="\n\nfloat luma (vec3 rgb) {\n  return (rgb.r + rgb.g + rgb.b)/3.0;\n}\n\nconst float T = 0.04;\nconst float M = 1.0;\nconst float L = 0.002;\n\nvoid main(void) {\n\n  vec2 texCoord = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n\n  float borderWidth = uWidth; // in px\n  float step_u = borderWidth * 1.0 / uCanvasWidth;\n  float step_v = borderWidth * 1.0 / uCanvasHeight;\n  vec4 centerPixel = texture2D(uTextureFilled, texCoord);\n\n  vec4 rightPixel  = texture2D(uTextureFilled, texCoord + vec2(step_u, 0.0));\n  vec4 bottomPixel = texture2D(uTextureFilled, texCoord + vec2(0.0, step_v));\n\n  // now manually compute the derivatives\n  float _dFdX = length(rightPixel - centerPixel) / step_u;\n  float _dFdY = length(bottomPixel - centerPixel) / step_v;\n\n  // gl_FragColor.r = _dFdX;\n  // gl_FragColor.g = _dFdY;\n  gl_FragColor.r = max(max(centerPixel.r, rightPixel.r), bottomPixel.r);\n  gl_FragColor.g = max(max(centerPixel.g, rightPixel.g), bottomPixel.g);\n  gl_FragColor.b = max(max(centerPixel.b, rightPixel.b), bottomPixel.b);\n  float maxDerivative = max(_dFdX, _dFdY);\n  float clampedDerivative = clamp(maxDerivative, 0., 1.);\n  gl_FragColor.a = uOpacity * clampedDerivative;\n\n  return;\n  // float h = 1./uCanvasHeight;\n  // float w = 1./uCanvasWidth;\n  // vec4 n[9];\n  // n[0] = texture2D(uTextureFilled, vProjectedTextCoords + vec2( -w, -h));\n  // n[1] = texture2D(uTextureFilled, vProjectedTextCoords + vec2(0.0, -h));\n  // n[2] = texture2D(uTextureFilled, vProjectedTextCoords + vec2(  w, -h));\n  // n[3] = texture2D(uTextureFilled, vProjectedTextCoords + vec2( -w, 0.0));\n  // n[4] = texture2D(uTextureFilled, vProjectedTextCoords);\n  // n[5] = texture2D(uTextureFilled, texCoord + vec2(  w, 0.0));\n  // n[6] = texture2D(uTextureFilled, texCoord + vec2( -w, h));\n  // n[7] = texture2D(uTextureFilled, texCoord + vec2(0.0, h));\n  // n[8] = texture2D(uTextureFilled, texCoord + vec2(  w, h));\n  // vec4 sobel_horizEdge = n[2] + (2.0*n[5]) + n[8] - (n[0] + (2.0*n[3]) + n[6]);\n  // vec4 sobel_vertEdge  = n[0] + (2.0*n[1]) + n[2] - (n[6] + (2.0*n[7]) + n[8]);\n  // vec3 sobel = sqrt((sobel_horizEdge.rgb * sobel_horizEdge.rgb) + (sobel_vertEdge.rgb * sobel_vertEdge.rgb));\n  // gl_FragColor = vec4( sobel, max(max(sobel.r, sobel.g), sobel.b) );\n\n  // return;\n}\n   "}compute(){return`\n// uniforms\n${this.uniforms()}\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vProjectedCoords;\n\n// tailored functions\n${this.functions()}\n\n// main loop\n${this._main}\n      `}}},8525:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{static uniforms(){return{uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uWidth:{type:"f",value:1,typeGLSL:"float"},uOpacity:{type:"f",value:1,typeGLSL:"float"},uTextureFilled:{type:"t",value:[],typeGLSL:"sampler2D"}}}}},185:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{compute(){return"\nvarying vec4 vProjectedCoords;\n\n//\n// main\n//\nvoid main() {\n\n  vec4 vPos = modelMatrix * vec4(position, 1.0 );\n  mat4 vProjectionViewMatrix = projectionMatrix * viewMatrix;\n  vProjectedCoords =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}},9612:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var n=i(3329);class r{constructor(t){this._uniforms=t,this._functions={},this._main=""}functions(){""===this._main&&this.main();let t="";for(let e in this._functions)t+=this._functions[e]+"\n";return t}uniforms(){let t="";for(let e in this._uniforms){let i=this._uniforms[e];t+=`uniform ${i.typeGLSL} ${e}`,i&&i.length&&(t+=`[${i.length}]`),t+=";\n"}return t}main(){this._main=`\nvoid main(void) {\n\n  // draw border if slice is cropped\n  // float uBorderDashLength = 10.;\n\n  if( uCanvasWidth > 0. &&\n      ((gl_FragCoord.x > uBorderMargin && (gl_FragCoord.x - uBorderMargin) < uBorderWidth) ||\n       (gl_FragCoord.x < (uCanvasWidth - uBorderMargin) && (gl_FragCoord.x + uBorderMargin) > (uCanvasWidth - uBorderWidth) ))){\n    float valueY = mod(gl_FragCoord.y, 2. * uBorderDashLength);\n    if( valueY < uBorderDashLength && gl_FragCoord.y > uBorderMargin && gl_FragCoord.y < (uCanvasHeight - uBorderMargin) ){\n      gl_FragColor = vec4(uBorderColor, 1.);\n      return;\n    }\n  }\n\n  if( uCanvasHeight > 0. &&\n      ((gl_FragCoord.y > uBorderMargin && (gl_FragCoord.y - uBorderMargin) < uBorderWidth) ||\n       (gl_FragCoord.y < (uCanvasHeight - uBorderMargin) && (gl_FragCoord.y + uBorderMargin) > (uCanvasHeight - uBorderWidth) ))){\n    float valueX = mod(gl_FragCoord.x, 2. * uBorderDashLength);\n    if( valueX < uBorderDashLength && gl_FragCoord.x > uBorderMargin && gl_FragCoord.x < (uCanvasWidth - uBorderMargin) ){\n      gl_FragColor = vec4(uBorderColor, 1.);\n      return;\n    }\n  }\n\n  // get texture coordinates of current pixel\n  vec4 dataValue = vec4(0.);\n  vec3 gradient = vec3(1.); // gradient calculations will be skipped if it is equal to vec3(1.) \n  float steps = floor(uThickness / uSpacing + 0.5);\n\n  if (steps > 1.) {\n    vec3 origin = vPos - uThickness * 0.5 * vNormal;\n    vec4 dataValueAcc = vec4(0.);\n    for (float step = 0.; step < 128.; step++) {\n      if (step >= steps) {\n        break;\n      }\n\n      vec4 dataCoordinates = uWorldToData * vec4(origin + step * uSpacing * vNormal, 1.);\n      vec3 currentVoxel = dataCoordinates.xyz;\n      ${(0,n.Z)(this,"currentVoxel","dataValueAcc","gradient")};\n\n      if (step == 0.) {\n        dataValue.r = dataValueAcc.r;\n        continue;\n      }\n\n      if (uThicknessMethod == 0) {\n        dataValue.r = max(dataValueAcc.r, dataValue.r);\n      }\n      if (uThicknessMethod == 1) {\n        dataValue.r += dataValueAcc.r;\n      }\n      if (uThicknessMethod == 2) {\n        dataValue.r = min(dataValueAcc.r, dataValue.r);\n      }\n    }\n\n    if (uThicknessMethod == 1) {\n      dataValue.r /= steps;\n    }\n  } else {\n    vec4 dataCoordinates = uWorldToData * vec4(vPos, 1.);\n    vec3 currentVoxel = dataCoordinates.xyz;\n    ${(0,n.Z)(this,"currentVoxel","dataValue","gradient")}\n  }\n\n  if(uNumberOfChannels == 1){\n    // rescale/slope\n    float realIntensity = dataValue.r * uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n  \n    // threshold\n    if (realIntensity < uLowerUpperThreshold[0] || realIntensity > uLowerUpperThreshold[1]) {\n      discard;\n    }\n  \n    // normalize\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    float normalizedIntensity =\n      ( realIntensity - windowMin ) / uWindowCenterWidth[1];\n    dataValue.r = dataValue.g = dataValue.b = normalizedIntensity;\n    dataValue.a = 1.;\n\n    // apply LUT\n    if(uLut == 1){\n      // should opacity be grabbed there?\n      dataValue = texture2D( uTextureLUT, vec2( normalizedIntensity , 1.0) );\n    }\n  \n    // apply segmentation\n    if(uLutSegmentation == 1){\n      // should opacity be grabbed there?\n      //\n      float textureWidth = 256.;\n      float textureHeight = 128.;\n      float min = 0.;\n      // start at 0!\n      int adjustedIntensity = int(floor(realIntensity + 0.5));\n  \n      // Get row and column in the texture\n      int colIndex = int(mod(float(adjustedIntensity), textureWidth));\n      int rowIndex = int(floor(float(adjustedIntensity)/textureWidth));\n  \n      float texWidth = 1./textureWidth;\n      float texHeight = 1./textureHeight;\n    \n      // Map row and column to uv\n      vec2 uv = vec2(0,0);\n      uv.x = 0.5 * texWidth + (texWidth * float(colIndex));\n      uv.y = 1. - (0.5 * texHeight + float(rowIndex) * texHeight);\n  \n      dataValue = texture2D( uTextureLUTSegmentation, uv );\n    }\n  }\n\n  if(uInvert == 1){\n    dataValue.xyz = vec3(1.) - dataValue.xyz;\n  }\n\n  dataValue.a = dataValue.a*uOpacity;\n\n  gl_FragColor = dataValue;\n}\n   `}compute(){return`\n// uniforms\n${this.uniforms()}\n\n// varying (should fetch it from vertex directly)\nvarying vec3 vPos;\nvarying vec3 vNormal;\n\n// tailored functions\n${this.functions()}\n\n// main loop\n${this._main}\n      `}}},3415:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var n=i(1245);class r{static uniforms(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new n.y,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uLowerUpperThreshold:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uLutSegmentation:{type:"i",value:0,typeGLSL:"int"},uTextureLUTSegmentation:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"},uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uBorderColor:{type:"v3",value:[1,0,.5],typeGLSL:"vec3"},uBorderWidth:{type:"f",value:2,typeGLSL:"float"},uBorderMargin:{type:"f",value:2,typeGLSL:"float"},uBorderDashLength:{type:"f",value:10,typeGLSL:"float"},uOpacity:{type:"f",value:1,typeGLSL:"float"},uSpacing:{type:"f",value:0,typeGLSL:"float"},uThickness:{type:"f",value:0,typeGLSL:"float"},uThicknessMethod:{type:"i",value:0,typeGLSL:"int"}}}}},4140:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{compute(){return"\nvarying vec3 vPos;\nvarying vec3 vNormal;\n\nvoid main() {\n  vNormal = normal;\n  vPos = (modelMatrix * vec4(position, 1.0 )).xyz;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}},6322:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ContourFragmentShader:()=>r.Z,ContourUniformShader:()=>n.Z,ContourVertexShader:()=>s.Z,DataFragmentShader:()=>o.Z,DataUniformShader:()=>a.Z,DataVertexShader:()=>l.Z,LayerFragmentShader:()=>f,LayerUniformShader:()=>p,LayerVertexShader:()=>m,LocalizerFragmentShader:()=>g.Z,LocalizerUniformShader:()=>_.Z,LocalizerVertexShader:()=>y.Z,VRFragmentShader:()=>c.Z,VRUniformShader:()=>h.Z,VRVertexShader:()=>u.Z});var n=i(8525),r=i(8024),s=i(185),a=i(3415),o=i(9612),l=i(4140),h=i(6574),c=i(5680),u=i(4079);class d{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}d.prototype.isVector2=!0;class p{static uniforms(){return{uTextureBackTest0:{type:"t",value:[],typeGLSL:"sampler2D"},uTextureBackTest1:{type:"t",value:[],typeGLSL:"sampler2D"},uOpacity0:{type:"f",value:1,typeGLSL:"float"},uOpacity1:{type:"f",value:1,typeGLSL:"float"},uType0:{type:"i",value:0,typeGLSL:"int"},uType1:{type:"i",value:1,typeGLSL:"int"},uTrackMouse:{type:"i",value:0,typeGLSL:"int"},uMouse:{type:"v2",value:new d,typeGLSL:"vec2"}}}}class f{constructor(t){this._uniforms=t,this._functions={},this._main=""}functions(){""===this._main&&this.main();let t="";for(let e in this._functions)t+=this._functions[e]+"\n";return t}uniforms(){let t="";for(let e in this._uniforms){let i=this._uniforms[e];t+=`uniform ${i.typeGLSL} ${e}`,i&&i.length&&(t+=`[${i.length}]`),t+=";\n"}return t}main(){this._main="\nvoid main(void) {\n\n  vec2 texc = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n\n  // just silence warning for\n  // vec4 dummy = vPos;\n\n  //The back position is the world space position stored in the texture.\n  vec4 baseColor0 = texture2D(uTextureBackTest0, texc);\n  vec4 baseColor1 = texture2D(uTextureBackTest1, texc);\n\n  if( uTrackMouse == 1 ){\n\n      if( vProjectedCoords.x < uMouse.x ){\n\n        gl_FragColor = baseColor0;\n\n      }\n      else{\n\n        gl_FragColor = mix( baseColor0, baseColor1, uOpacity1 );\n\n      }\n\n  }\n  else{\n\n    if( uType1 == 0 ){\n\n      //merge an image into\n      gl_FragColor = mix( baseColor0, baseColor1, uOpacity1 );\n\n    }\n    else{\n\n      float opacity = baseColor1.a;\n      gl_FragColor = mix( baseColor0, baseColor1, opacity * uOpacity1 );\n\n    }\n\n  }\n\n  return;\n}\n   "}compute(){return`\n// uniforms\n${this.uniforms()}\n\n// varying (should fetch it from vertex directly)\n// varying vec4      vPos;\nvarying vec4      vProjectedCoords;\n\n// tailored functions\n${this.functions()}\n\n// main loop\n${this._main}\n      `}}class m{compute(){return"\n// varying vec4 vPos;\nvarying vec4 vProjectedCoords;\n\n//\n// main\n//\nvoid main() {\n\n  vec4 vPos = modelMatrix * vec4(position, 1.0 );\n  vProjectedCoords =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}var _=i(5191),g=i(9928),y=i(4338)},9928:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const n=class{constructor(t){this._uniforms=t,this._functions={},this._main=""}functions(){""===this._main&&this.main();let t="";for(let e in this._functions)t+=this._functions[e]+"\n";return t}uniforms(){let t="";for(let e in this._uniforms){let i=this._uniforms[e];t+=`uniform ${i.typeGLSL} ${e}`,i&&i.length&&(t+=`[${i.length}]`),t+=";\n"}return t}main(){this._main="\nvoid intersectionProjection(\n  in vec4 plane,\n  in vec4 slice,\n  out vec3 intersectionProjection){\n\n      vec3 intersectionDirection = normalize(cross(plane.xyz, slice.xyz));\n      vec3 intersectionPoint = \n        cross(intersectionDirection,slice.xyz) * plane.w +\n        cross(plane.xyz, intersectionDirection) * slice.w;\n\n      intersectionProjection =\n        intersectionPoint.xyz +\n        (dot(vPos.xyz - intersectionPoint, intersectionDirection)\n          * intersectionDirection);\n\n}\n\nvoid main(void) {\n      vec4 c1 = vec4(0., 0., 0., 0.);\n      vec4 c2 = vec4(0., 0., 0., 0.);\n      vec4 c3 = vec4(0., 0., 0., 0.);\n\n      // localizer #1\n      // must be normalized!\n      if(length(uPlane1.xyz) > 0.5) {\n        vec3 projection1 = vec3(1.);\n        intersectionProjection(\n          uPlane1,\n          uSlice,\n          projection1\n        );\n\n        vec4 projInter1 = (vProjectionViewMatrix * vec4(projection1, 1.));\n        vec3 ndc1 = projInter1.xyz / projInter1.w;\n        vec2 screenSpace1 = (ndc1.xy * .5 + .5) * vec2(uCanvasWidth, uCanvasHeight);\n\n        float d1 = distance(gl_FragCoord.xy, screenSpace1.xy);\n        c1 = vec4(uPlaneColor1, 1. - smoothstep(.5, .7, d1));\n      }\n\n      // localizer #2\n      if(length(uPlane2.xyz) > 0.5) {\n        vec3 projection2 = vec3(1.);\n        intersectionProjection(\n          uPlane2,\n          uSlice,\n          projection2\n        );\n\n        vec4 projInter2 = (vProjectionViewMatrix * vec4(projection2, 1.));\n        vec3 ndc2 = projInter2.xyz / projInter2.w;\n        vec2 screenSpace2 = (ndc2.xy * .5 + .5) * vec2(uCanvasWidth, uCanvasHeight);\n\n        float d2 = distance(gl_FragCoord.xy, screenSpace2.xy);\n        c2 = vec4(uPlaneColor2, 1. - smoothstep(.5, .7, d2));\n      }\n\n      // localizer #3\n      if(length(uPlane3.xyz) > 0.5) {\n        vec3 projection3 = vec3(1.);\n        intersectionProjection(\n          uPlane3,\n          uSlice,\n          projection3\n        );\n\n        vec4 projInter3 = (vProjectionViewMatrix * vec4(projection3, 1.));\n        vec3 ndc3 = projInter3.xyz / projInter3.w;\n        vec2 screenSpace3 = (ndc3.xy * .5 + .5) * vec2(uCanvasWidth, uCanvasHeight);\n\n        float d3 = distance(gl_FragCoord.xy, screenSpace3.xy);\n        c3 = vec4(uPlaneColor3, 1. - smoothstep(.5, .7, d3));\n      }\n\n      // float uBorderDashLength = 10.0;\n      // float uBorderWidth = 2.0;\n      // float valueX = mod(gl_FragCoord.x, 2. * uBorderDashLength);\n      // float valueY = mod(gl_FragCoord.y, 2. * uBorderDashLength);\n      // if( valueX < uBorderDashLength || valueY < uBorderDashLength ){\n        vec3 colorMix = c1.xyz*c1.w + c2.xyz*c2.w + c3.xyz*c3.w;\n        gl_FragColor = vec4(colorMix, max(max(c1.w, c2.w),c3.w)*0.5);\n        return;\n      // }\n      \n      // gl_FragColor = vec4(0., 0., 0., 0.);\n      // return;\n}\n   "}compute(){return`\n// uniforms\n${this.uniforms()}\n\n// varying (should fetch it from vertex directly)\nvarying vec4 vPos;\nvarying mat4 vProjectionViewMatrix;\n\n// tailored functions\n${this.functions()}\n\n// main loop\n${this._main}\n      `}}},5191:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const n=class{static uniforms(){return{uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uSlice:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlane1:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlaneColor1:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uPlane2:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlaneColor2:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uPlane3:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlaneColor3:{type:"v3",value:[1,1,0],typeGLSL:"vec3"}}}}},4338:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const n=class{compute(){return"\nvarying vec4 vPos;\nvarying mat4 vProjectionViewMatrix;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  vProjectionViewMatrix = projectionMatrix * viewMatrix;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}},5680:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var n=i(3329),r=i(1779);class s extends r.Z{constructor(){super(),this.name="intersectBox",this._rayOrigin="rayOrigin",this._rayDirection="rayDirection",this._aabbMin="aabbMin",this._aabbMax="aabbMax",this._tNear="tNear",this._tFar="tFar",this._intersect="intersect"}api(t=this._base,e=this._rayOrigin,i=this._rayDirection,n=this._aabbMin,r=this._aabbMax,s=this._tNear,a=this._tFar,o=this._intersect){return this._base=t,this.compute(e,i,n,r,s,a,o)}compute(t,e,i,n,r,s,a){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i}, ${n}, ${r}, ${s}, ${a});`}computeDefinition(){this._definition=`\nvoid ${this._name}(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect){\n  // compute intersection of ray with all six bbox planes\n  vec3 invRay = vec3(1.) / rayDirection;\n  vec3 tBot = invRay * (boxMin - rayOrigin);\n  vec3 tTop = invRay * (boxMax - rayOrigin);\n  // re-order intersections to find smallest and largest on each axis\n  vec3 tMin = min(tTop, tBot);\n  vec3 tMax = max(tTop, tBot);\n  // find the largest tMin and the smallest tMax\n  float largest_tMin = max(max(tMin.x, tMin.y), max(tMin.x, tMin.z));\n  float smallest_tMax = min(min(tMax.x, tMax.y), min(tMax.x, tMax.z));\n  tNear = largest_tMin;\n  tFar = smallest_tMax;\n  intersect = smallest_tMax > largest_tMin;\n}\n\n    `}}const a=new s;class o{constructor(t){this._uniforms=t,this._functions={},this._main=""}functions(){""===this._main&&this.main();let t="";for(let e in this._functions)t+=this._functions[e]+"\n";return t}uniforms(){let t="";for(let e in this._uniforms){let i=this._uniforms[e];t+=`uniform ${i.typeGLSL} ${e}`,i&&i.length&&(t+=`[${i.length}]`),t+=";\n"}return t}main(){this._main=`\nvoid getIntensity(in vec3 dataCoordinates, out float intensity, out vec3 gradient){\n\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  ${(0,n.Z)(this,"dataCoordinates","dataValue","gradient")}\n\n  intensity = dataValue.r;\n\n  // rescale/slope\n  intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n  // window level\n  float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n  intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}\n\nmat4 inverse(mat4 m) {\n  float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n    a11 * b11 - a12 * b10 + a13 * b09,\n    a02 * b10 - a01 * b11 - a03 * b09,\n    a31 * b05 - a32 * b04 + a33 * b03,\n    a22 * b04 - a21 * b05 - a23 * b03,\n    a12 * b08 - a10 * b11 - a13 * b07,\n    a00 * b11 - a02 * b08 + a03 * b07,\n    a32 * b02 - a30 * b05 - a33 * b01,\n    a20 * b05 - a22 * b02 + a23 * b01,\n    a10 * b10 - a11 * b08 + a13 * b06,\n    a01 * b08 - a00 * b10 - a03 * b06,\n    a30 * b04 - a31 * b02 + a33 * b00,\n    a21 * b02 - a20 * b04 - a23 * b00,\n    a11 * b07 - a10 * b09 - a12 * b06,\n    a00 * b09 - a01 * b07 + a02 * b06,\n    a31 * b01 - a30 * b03 - a32 * b00,\n    a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n/**\n * Adapted from original sources\n * \n * Original code: \n * http://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/\n * https://www.shadertoy.com/view/lt33z7\n * \n * The vec3 returned is the RGB color of the light's contribution.\n *\n * k_a: Ambient color\n * k_d: Diffuse color\n * k_s: Specular color\n * alpha: Shininess coefficient\n * p: position of point being lit\n * eye: the position of the camera\n * lightPos: the position of the light\n * lightIntensity: color/intensity of the light\n *\n * See https://en.wikipedia.org/wiki/Phong_reflection_model#Description\n */\nvec3 phongShading(vec3 k_a, vec3 k_d, vec3 k_s, float shininess, vec3 p, vec3 eye,\n  vec3 lightPos, vec3 lightIntensity, vec3 normal) {\n  vec3 N = normal;\n  vec3 L = lightPos - p;\n  if (length(L) > 0.) {\n    L = L / length(L);\n  }\n  vec3 V = eye - p;\n  if (length(V) > 0.) {\n    V = V / length(V);\n  }\n  vec3 R = reflect(-L, N);\n  if (length(R) > 0.) {\n    R = R / length(R);\n  }\n\n  // https://en.wikipedia.org/wiki/Blinn%E2%80%93Phong_shading_model\n  vec3 h = L + V;\n  vec3 H = h;\n  if (length(h) > 0.) {\n    H = H / length(h);\n  }\n\n  float dotLN = dot(L, N);\n  float dotRV = dot(R, V);\n\n  if (dotLN < 0.) {\n    // Light not visible from this point on the surface\n    return k_a;\n  } \n\n  if (dotRV < 0.) {\n    // Light reflection in opposite direction as viewer, apply only diffuse\n    // component\n    return k_a + lightIntensity * (k_d * dotLN);\n  }\n\n  float specAngle = max(dot(H, normal), 0.0);\n  float specular = pow(dotRV, shininess); //pow(specAngle, shininess); // \n  return k_a + lightIntensity * (k_d * dotLN  + k_s * specular);\n}\n\nfloat PI = 3.14159265358979323846264 * 00000.1; // PI\n\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv) {\n  const highp float a = 12.9898;\n  const highp float b = 78.233;\n  const highp float c = 43758.5453;\n  highp float dt = dot(uv.xy, vec2(a, b)), sn = mod(dt, PI);\n  return fract(sin(sn) * c);\n}\n\nvoid main(void) {\n  const int maxSteps = 1024;\n\n  // the ray\n  vec3 rayOrigin = cameraPosition;\n  vec3 rayDirection = normalize(vPos.xyz - rayOrigin);\n\n  vec3 lightOrigin = uLightPositionInCamera == 1 ? cameraPosition : uLightPosition;\n\n  // the Axe-Aligned B-Box\n  vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n  vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n  // Intersection ray/bbox\n  float tNear, tFar;\n  bool intersect = false;\n  ${a.api(this,"rayOrigin","rayDirection","AABBMin","AABBMax","tNear","tFar","intersect")}\n  if (tNear < 0.0) tNear = 0.0;\n\n  // x / y should be within o-1\n  // should\n  float offset = rand(gl_FragCoord.xy);\n\n  // init the ray marching\n  float tStep = (tFar - tNear) / float(uSteps);\n  float tCurrent = tNear + offset * tStep;\n  vec4 accumulatedColor = vec4(0.0);\n  float accumulatedAlpha = 0.0;\n\n  // MIP volume rendering\n  float maxIntensity = 0.0;\n\n  mat4 dataToWorld = inverse(uWorldToData);\n\n  // rayOrigin -= rayDirection * 0.1; // gold_noise(vPos.xz, vPos.y) / 100.;  \n\n  for(int rayStep = 0; rayStep < maxSteps; rayStep++){\n    vec3 currentPosition = rayOrigin + rayDirection * tCurrent;\n    // some non-linear FUN\n    // some occlusion issue to be fixed\n    vec3 transformedPosition = currentPosition; //transformPoint(currentPosition, uAmplitude, uFrequence);\n    // world to data coordinates\n    // rounding trick\n    // first center of first voxel in data space is CENTERED on (0,0,0)\n    vec4 dataCoordinatesRaw = uWorldToData * vec4(transformedPosition, 1.0);\n    vec3 currentVoxel = vec3(dataCoordinatesRaw.x, dataCoordinatesRaw.y, dataCoordinatesRaw.z);\n    float intensity = 0.0;\n    vec3 gradient = vec3(0., 0., 0.);\n    getIntensity(currentVoxel, intensity, gradient);\n    // map gradient to world space and normalize before using\n    // we avoid to call "normalize" as it may be undefined if vector length == 0.\n    gradient = (vec3(dataToWorld * vec4(gradient, 0.)));\n    if (length(gradient) > 0.0) {\n      gradient = normalize(gradient);\n    }\n\n    vec4 colorSample;\n    float alphaSample;\n    if(uLut == 1){\n      vec4 colorFromLUT = texture2D( uTextureLUT, vec2( intensity, 1.0) );\n      // 256 colors\n      colorSample = colorFromLUT;\n      alphaSample = colorFromLUT.a;\n    }\n    else{\n      alphaSample = intensity;\n      colorSample.r = colorSample.g = colorSample.b = intensity;\n    }\n\n    // ray marching algorithm\n    // shading on\n    // interpolation on\n    if (uAlgorithm == 0 && uShading == 1 && uInterpolation != 0) {\n      //  && alphaSample > .3\n      vec3 ambientComponent = uSampleColorToAmbient == 1 ? colorSample.xyz : uAmbientColor;\n      ambientComponent *= uAmbient;\n      vec3 diffuseComponent = uSampleColorToDiffuse == 1 ? colorSample.xyz : uDiffuseColor;\n      diffuseComponent *= uDiffuse;\n      vec3 specularComponent = uSpecular * uSpecularColor;\n      float shininess = uShininess;\n      vec3 vIntensity = uIntensity;\n\n      colorSample.xyz += phongShading(\n        ambientComponent,\n        diffuseComponent,\n        specularComponent,\n        shininess,\n        currentPosition.xyz,\n        rayOrigin.xyz,\n        lightOrigin.xyz,\n        vIntensity,\n        gradient);\n    }\n\n    alphaSample = 1.0 - pow((1.0- alphaSample),tStep*uAlphaCorrection);\n    alphaSample *= (1.0 - accumulatedAlpha);\n\n    accumulatedColor += alphaSample * colorSample;\n    accumulatedAlpha += alphaSample;\n\n    tCurrent += tStep;\n\n    if (tCurrent > tFar || (uAlgorithm == 0 && accumulatedAlpha >= 1.0)) break;\n\n    if (uAlgorithm == 1 && (intensity >= maxIntensity)) {\n      maxIntensity = intensity;\n      accumulatedColor = colorSample;\n      accumulatedAlpha = 1.;\n    }\n  }\n\n  gl_FragColor = vec4(accumulatedColor.xyz, accumulatedAlpha);\n}\n   `}compute(){return`\n// uniforms\n${this.uniforms()}\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\n\n// tailored functions\n${this.functions()}\n\n// main loop\n${this._main}\n      `}}},6574:(t,e,i)=>{"use strict";i.d(e,{Z:()=>r});var n=i(1245);class r{static uniforms(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new n.y,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"},uWorldBBox:{type:"fv1",value:[0,0,0,0,0,0],typeGLSL:"float",length:6},uSteps:{type:"i",value:256,typeGLSL:"int"},uAlphaCorrection:{type:"f",value:.5,typeGLSL:"float"},uFrequence:{type:"f",value:0,typeGLSL:"float"},uAmplitude:{type:"f",value:0,typeGLSL:"float"},uShading:{type:"i",value:1,typeGLSL:"int"},uAmbient:{type:"f",value:.1,typeGLSL:"float"},uAmbientColor:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uSampleColorToAmbient:{type:"i",value:1,typeGLSL:"int"},uSpecular:{type:"f",value:1,typeGLSL:"float"},uSpecularColor:{type:"v3",value:[1,1,1],typeGLSL:"vec3"},uDiffuse:{type:"f",value:.3,typeGLSL:"float"},uDiffuseColor:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uSampleColorToDiffuse:{type:"i",value:1,typeGLSL:"int"},uShininess:{type:"f",value:5,typeGLSL:"float"},uLightPosition:{type:"v3",value:[0,0,0],typeGLSL:"vec3"},uLightPositionInCamera:{type:"i",value:1,typeGLSL:"int"},uIntensity:{type:"v3",value:[.8,.8,.8],typeGLSL:"vec3"},uAlgorithm:{type:"i",value:0,typeGLSL:"int"}}}}},4079:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});class n{compute(){return"\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}},7140:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});class n{static get code(){return'\n        .widgets-handle {\n            position: absolute;\n            border: 1px solid;\n            border-radius: 50%;\n            width: 10px;\n            height: 10px;\n            margin: -6px; /* border + width / 2 */\n            z-index: 3;\n        }\n        .widgets-line {\n            position: absolute;\n            width: 1px;\n            height: 1px;\n            margin-top: -0.5px; /* height / 2 */\n        }\n        .widgets-dashline {\n            position: absolute;\n            border-top: 1px dashed;\n            margin-top: -0.5px; /* border / 2 */\n        }\n        .widgets-line:before,\n        .widgets-dashline:before { /* for dragging */\n            content: " ";\n            position: absolute;\n            height: 12px;\n            left: 0;\n            right: 0;\n            margin-top: -6px;\n        }\n        .widgets-rectangle {\n            position: absolute;\n            border: 1px solid;\n            margin: -1px; /* border */\n        }\n        .widgets-rectangle-helper {\n            position: absolute;\n            border: 1px dashed;\n            margin: -1px; /* border */\n        }\n        .widgets-ellipse {\n            position: absolute;\n            border: 1px solid;\n            border-radius: 50%;\n            margin: -1px; /* border */\n            z-index: 2;\n        }\n        .widgets-label {\n            position: absolute;\n            border: 1px solid;\n            background-color: rgba(0, 0, 0, 0.7);\n            color: rgb(255, 255, 255);\n            padding: 4px;\n            z-index: 3;\n        }\n        '}}},8112:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AngleWidget:()=>l,AnnotationWidget:()=>h,BiRulerWidget:()=>c,CrossRulerWidget:()=>u,EllipseWidget:()=>p,FreehandWidget:()=>f,HandleWidget:()=>o,PeakVelocityWidget:()=>m,PolygonWidget:()=>g,PressureHalfTimeWidget:()=>_,RectangleWidget:()=>y,RulerWidget:()=>v,VelocityTimeIntegralWidget:()=>x,VoxelProbeWidget:()=>w,WidgetsCss:()=>n.default});var n=i(7140),r=i(361),s=i(9501),a=i(9477);class o extends r.widgetsBase{constructor(t,e,i={}){super(t,e,i),this._widgetType="Handle",!0===i.hideHandleMesh&&(this.visible=!1),this._plane={position:new a.Pa4,direction:new a.Pa4},this._offset=new a.Pa4,this._raycaster=new a.iMs,this._active=!1,this._hovered=!1,this._tracking=!1,this._mouse=new a.FM8,this._initialized=!1,this._material=null,this._geometry=null,this._mesh=null,this._meshHovered=!1,this._dom=null,this._domHovered=!1,this._screenPosition=this.worldToScreen(this._worldPosition),this.create(),this.initOffsets(),this.onResize=this.onResize.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){addEventListener("resize",this.onResize),this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){removeEventListener("resize",this.onResize),this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)}onResize(){this.initOffsets()}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._meshHovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){let t=this._raycaster.intersectObject(this._mesh);this._meshHovered=t.length>0}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){const e=this.getMouseOffsets(t,this._container);if(this._mouse.set(e.x,e.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){let t=this._raycaster.intersectObject(this._targetMesh);t.length>0&&this._offset.copy(t[0].point).sub(this._worldPosition)}else{this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection());let t=s.Z.rayPlane(this._raycaster.ray,this._plane);null!==t&&this._offset.copy(t).sub(this._plane.position)}this.update()}}onMove(t,e){const i=this.getMouseOffsets(t,this._container);if(this._mouse.set(i.x,i.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._active||e)if(this._dragged=!0,null!==this._targetMesh){let t=this._raycaster.intersectObject(this._targetMesh);t.length>0&&this._worldPosition.copy(t[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()));let t=s.Z.rayPlane(this._raycaster.ray,this._plane);null!==t&&this._worldPosition.copy(t.sub(this._offset))}else this.onHover(null);this.update()}onEnd(){!0!==this._tracking&&(!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected),this._initialized=!0,this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new a.xo$(1,16,16),this._material=new a.vBJ({wireframe:!0,wireframeLinewidth:2}),this.updateMeshColor(),this._mesh=new a.Kj0(this._geometry,this._material),this._mesh.position.copy(this._worldPosition),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._dom=document.createElement("div"),this._dom.className="widgets-handle",this._dom.style.transform=`translate3D(\n      ${this._screenPosition.x}px,\n      ${this._screenPosition.y-this._container.offsetHeight}px, 0)`,this.updateDOMColor(),this._container.appendChild(this._dom)}update(){this.updateColor(),this._screenPosition=this.worldToScreen(this._worldPosition),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._mesh&&this._mesh.position.copy(this._worldPosition)}updateDOMPosition(){this._dom&&(this._dom.style.transform=`translate3D(${this._screenPosition.x}px,\n        ${this._screenPosition.y-this._container.offsetHeight}px, 0)`)}updateDOMColor(){this._dom.style.borderColor=this._color}showMesh(){!0!==this._params.hideMesh&&!0!==this._params.hideHandleMesh&&(this.visible=!0)}free(){this.removeEventListeners(),this._container.removeChild(this._dom),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}hideDOM(){this._dom.style.display="none"}showDOM(){this._dom.style.display=""}get screenPosition(){return this._screenPosition}set screenPosition(t){this._screenPosition=t}get active(){return this._active}set active(t){this._active=t,this._controls.enabled=!this._active,this.update()}get tracking(){return this._tracking}set tracking(t){this._tracking=t,this.update()}}class l extends r.widgetsBase{constructor(t,e,i={}){let n;super(t,e,i),this._widgetType="Angle",this._opangle=null,this._moving=!1,this._domHovered=!1,this._defaultAngle=!0,this._material=null,this._geometry=null,this._mesh=null,this._line=null,this._line2=null,this._label=null,this._handles=[];const r=o();for(let s=0;s<3;s++)n=new r(t,e,i),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[2].active=!0,this._handles[2].tracking=!0,this._moveHandle=new r(t,e,i),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handles[0].onStart(t),this._handles[1].onStart(t),this._handles[2].onStart(t),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._domHovered,!this._domHovered||this._handles[1].tracking||this._handles[2].tracking||(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(t,!0),this._moving&&this._handles.slice(0,-1).forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))}))}else this.onHover(null);this._handles[0].onMove(t),this._handles[1].onMove(t),this._handles[2].onMove(t),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||!this._handles[1].tracking&&this._handles[2].tracking&&this._handles[1].screenPosition.distanceTo(this._handles[2].screenPosition)<10||(this._dragged||!this._active||this._handles[2].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._handles[1].active?this._handles[2].onEnd():this._dragged||!this._handles[2].tracking?(this._handles[2].tracking=!1,this._handles[2].onEnd()):this._handles[2].tracking=!1,this._handles[2].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active,this._dragged=this._handles[2].tracking,this._moving=!1,this.update())}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new a.u9r;const t=new Float32Array(12);this._geometry.setAttribute("position",new a.TlE(t,3));let e=0;t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,t[e++]=this._handles[2].worldPosition.x,t[e++]=this._handles[2].worldPosition.y,t[e++]=this._handles[2].worldPosition.z,this._material=new a.nls,this.updateMeshColor(),this._mesh=new a.ejS(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-line",this._container.appendChild(this._line),this._line2=document.createElement("div"),this._line2.className="widgets-line",this._container.appendChild(this._line2),this._label=document.createElement("div"),this._label.className="widgets-label",this._container.appendChild(this._label),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._line2.style.display="none",this._label.style.display="none",this._handles.forEach((t=>t.hideDOM()))}showDOM(){this._line.style.display="",this._line2.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM(),this._handles[2].showDOM()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this._handles[2].update(),this._opangle=180*this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition).angleTo(this._handles[1].worldPosition.clone().sub(this._handles[2].worldPosition))/Math.PI||0,this._opangle=this._defaultAngle?this._opangle:360-this._opangle,this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}updateDOM(){this.updateDOMColor();const t=this.getLineData(this._handles[1].screenPosition,this._handles[0].screenPosition);this._line.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n            rotate(${t.transformAngle}rad)`,this._line.style.width=t.length+"px";const e=this.getLineData(this._handles[1].screenPosition,this._handles[2].screenPosition);this._line2.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)\n            rotate(${e.transformAngle}rad)`,this._line2.style.width=e.length+"px",this._label.innerHTML=`${this._opangle.toFixed(2)}&deg;`;let i=t.line.clone().add(e.line).normalize().negate(),n=i.angleTo(new a.Pa4(1,0,0));n>Math.PI/2&&(n=Math.PI-n);const r=Math.tan(n)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(n)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-n)+15,s=this._handles[1].screenPosition.clone().add(i.multiplyScalar(r)),o=this.adjustLabelTransform(this._label,s);this._label.style.transform=`translate3D(${o.x}px, ${o.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._line2.style.backgroundColor=this._color,this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._line2),this._container.removeChild(this._label),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}toggleDefaultAngle(){this._defaultAngle=!this._defaultAngle}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(t),this._handles[2].worldPosition.copy(t),this._worldPosition.copy(t),this.update()}get angle(){return this._opangle}}class h extends r.widgetsBase{constructor(t,e,i={}){let n;super(t,e,i),this._widgetType="Annotation",this._initialized=!1,this._movinglabel=null,this._labelmoved=!1,this._labelhovered=!1,this._manuallabeldisplay=!1,this._material=null,this._geometry=null,this._meshline=null,this._cone=null,this._line=null,this._dashline=null,this._label=null,this._labeltext=null,this._labelOffset=new a.Pa4,this._mouseLabelOffset=new a.Pa4,this._handles=[];const r=o();for(let s=0;s<2;s++)n=new r(t,e,i),this.add(n),this._handles.push(n);this._handles[1].active=!0,this.create(),this.initOffsets(),this.onResize=this.onResize.bind(this),this.onMove=this.onMove.bind(this),this.onHoverlabel=this.onHoverlabel.bind(this),this.notonHoverlabel=this.notonHoverlabel.bind(this),this.changelabeltext=this.changelabeltext.bind(this),this.addEventListeners()}addEventListeners(){addEventListener("resize",this.onResize),this._label.addEventListener("mouseenter",this.onHoverlabel),this._label.addEventListener("mouseleave",this.notonHoverlabel),this._label.addEventListener("dblclick",this.changelabeltext),this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){removeEventListener("resize",this.onResize),this._label.removeEventListener("mouseenter",this.onHoverlabel),this._label.removeEventListener("mouseleave",this.notonHoverlabel),this._label.removeEventListener("dblclick",this.changelabeltext),this._container.removeEventListener("wheel",this.onMove)}onResize(){this.initOffsets()}onHoverlabel(){this._labelhovered=!0,this._container.style.cursor="pointer"}notonHoverlabel(){this._labelhovered=!1,this._container.style.cursor="default"}onStart(t){if(this._labelhovered){const e=this.getMouseOffsets(t,this._container),i=this._handles[1].screenPosition.clone().sub(this._labelOffset);this._mouseLabelOffset=new a.Pa4(e.screenX-i.x,e.screenY-i.y,0),this._movinglabel=!0,this._labelmoved=!0}this._handles[0].onStart(t),this._handles[1].onStart(t),this._active=this._handles[0].active||this._handles[1].active||this._labelhovered,this.update()}onMove(t){if(this._movinglabel){const e=this.getMouseOffsets(t,this._container);this._labelOffset=new a.Pa4(this._handles[1].screenPosition.x-e.screenX+this._mouseLabelOffset.x,this._handles[1].screenPosition.y-e.screenY+this._mouseLabelOffset.y,0),this._controls.enabled=!1}this._active&&(this._dragged=!0),this._handles[0].onMove(t),this._handles[1].onMove(t),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._labelhovered,this.update()}onEnd(){this._handles[0].onEnd(),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[1].selected=this._selected),this._initialized||(this._labelOffset=this._handles[1].screenPosition.clone().sub(this._handles[0].screenPosition).multiplyScalar(.5),this.setlabeltext(),this._initialized=!0),this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._movinglabel=!1,this.update()}setlabeltext(){for(;!this._labeltext;)this._labeltext=prompt("Please enter the annotation text","");this.displaylabel()}changelabeltext(){this._labeltext=prompt("Please enter a new annotation text",this._label.innerHTML),this.displaylabel()}displaylabel(){this._label.innerHTML="string"==typeof this._labeltext&&this._labeltext.length>0?this._labeltext:"",this._label.style.display="",this._dashline.style.display="",this._label.style.transform=`translate3D(\n        ${this._handles[1].screenPosition.x-this._labelOffset.x-this._label.offsetWidth/2}px,\n        ${this._handles[1].screenPosition.y-this._labelOffset.y-this._label.offsetHeight/2-this._container.offsetHeight}px, 0)`}create(){this.createMesh(),this.createDOM()}createMesh(){this._material=new a.nls,this.updateMeshColor(),this._geometry=new a.u9r;const t=new Float32Array(6);this._geometry.setAttribute("position",new a.TlE(t,3));let e=0;t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,this._meshline=new a.x12(this._geometry,this._material),this._meshline.visible=!0,this.add(this._meshline),this._conegeometry=new a.fHI(0,2,10),this._conegeometry.translate(0,-5,0),this._conegeometry.rotateX(-Math.PI/2),this._cone=new a.Kj0(this._conegeometry,this._material),this._cone.visible=!0,this.add(this._cone)}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-line",this._container.appendChild(this._line),this._dashline=document.createElement("div"),this._dashline.className="widgets-dashline",this._dashline.style.display="none",this._container.appendChild(this._dashline),this._label=document.createElement("div"),this._label.className="widgets-label",this._label.style.display="none",this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0),this._cone&&(this._cone.position.copy(this._handles[1].worldPosition),this._cone.lookAt(this._handles[0].worldPosition))}updateDOM(){this.updateDOMColor();const t=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n        rotate(${t.transformAngle}rad)`,this._line.style.width=t.length+"px";const e=t.line.multiplyScalar(.5),i=this._handles[1].screenPosition.clone().sub(this._labelmoved?this._labelOffset:e),n=this.adjustLabelTransform(this._label,i);this._label.style.transform=`translate3D(${n.x}px, ${n.y}px, 0)`,this._manuallabeldisplay&&this.displaylabel();let r=this.getLineData(this._handles[0].screenPosition,i),s=this.getLineData(t.center,i),a=this.getLineData(this._handles[1].screenPosition,i);r.length>s.length&&(r=s),r.length>a.length&&(r=a),this._dashline.style.transform=`translate3D(${r.transformX}px, ${r.transformY}px, 0)\n        rotate(${r.transformAngle}rad)`,this._dashline.style.width=r.length+"px"}updateDOMColor(){this._line.style.backgroundColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color,this._label.style.borderColor=this._color}hideDOM(){this._line.style.display="none",this._dashline.style.display="none",this._label.style.display="none",this._handles.forEach((t=>t.hideDOM()))}showDOM(){this._line.style.display="",this._dashline.style.display="",this._label.style.display="",this._handles.forEach((t=>t.showDOM()))}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._dashline),this._container.removeChild(this._label),this.remove(this._meshline),this._meshline.geometry.dispose(),this._meshline.geometry=null,this._meshline.material.dispose(),this._meshline.material=null,this._meshline=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this.remove(this._cone),this._cone.geometry.dispose(),this._cone.geometry=null,this._cone.material.dispose(),this._cone.material=null,this._cone=null,this._conegeometry.dispose(),this._conegeometry=null,super.free()}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(t),this._worldPosition.copy(t),this.update()}}class c extends r.widgetsBase{constructor(t,e,i={}){let n;super(t,e,i),this._widgetType="BiRuler",this._calibrationFactor=i.calibrationFactor||null,this._distance=null,this._distance2=null,this._units=this._calibrationFactor||i.pixelSpacing?"mm":"units",this._material=null,this._geometry=null,this._mesh=null,this._line=null,this._label=null,this._line2=null,this._label2=null,this._dashline=null,this._handles=[];const r=o();for(let s=0;s<4;s++)n=new r(t,e,i),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._handles[3].active=!0,this._handles[3].tracking=!0,this.create(),this.onMove=this.onMove.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove)}onStart(t){this._handles.forEach((e=>e.onStart(t))),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._handles[3].active,this.update()}onMove(t){this._active?this._dragged=!0:(this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._handles[3].hovered,this._container.style.cursor=this._hovered?"pointer":"default"),this._handles.forEach((e=>e.onMove(t))),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[2].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[3].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[2].selected=this._selected),this._handles[1].active?this._handles[3].onEnd():this._dragged||!this._handles[3].tracking?(this._handles[3].tracking=!1,this._handles[3].onEnd()):this._handles[3].tracking=!1,this._handles[3].selected=this._selected,this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._handles[3].active,this._dragged=!1,this.update())}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new BufferGeometry;const t=new Float32Array(12);this._geometry.setAttribute("position",new BufferAttribute(t,3));let e=0;t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,t[e++]=this._handles[2].worldPosition.x,t[e++]=this._handles[2].worldPosition.y,t[e++]=this._handles[2].worldPosition.z,t[e++]=this._handles[3].worldPosition.x,t[e++]=this._handles[3].worldPosition.y,t[e++]=this._handles[3].worldPosition.z,this._material=new a.nls,this.updateMeshColor(),this._mesh=new a.ejS(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="widgets-label",this._container.appendChild(this._label),this._line2=document.createElement("div"),this._line2.className="widgets-line",this._container.appendChild(this._line2),this._label2=document.createElement("div"),this._label2.className="widgets-label",this._container.appendChild(this._label2),this._dashline=document.createElement("div"),this._dashline.className="widgets-dashline",this._container.appendChild(this._dashline),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._label.style.display="none",this._line2.style.display="none",this._label2.style.display="none",this._dashline.style.display="none",this._handles.forEach((t=>t.hideDOM()))}showDOM(){this._line.style.display="",this._label.style.display="",this._line2.style.display="",this._label2.style.display="",this._dashline.style.display="",this._handles.forEach((t=>t.showDOM()))}update(){this.updateColor(),this._handles.forEach((t=>t.update())),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}updateDOM(){this.updateDOMColor();const t=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n                rotate(${t.transformAngle}rad)`,this._line.style.width=t.length+"px";const e=this.getLineData(this._handles[2].screenPosition,this._handles[3].screenPosition);this._line2.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)\n                rotate(${e.transformAngle}rad)`,this._line2.style.width=e.length+"px";const i=this._handles[0].worldPosition.clone().add(this._handles[1].worldPosition).multiplyScalar(.5),n=this._handles[2].worldPosition.clone().add(this._handles[3].worldPosition).multiplyScalar(.5),r=this.getLineData(this.worldToScreen(i),this.worldToScreen(n));this._dashline.style.transform=`translate3D(${r.transformX}px, ${r.transformY}px, 0)\n                rotate(${r.transformAngle}rad)`,this._dashline.style.width=r.length+"px";const s=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor),a=this.getDistanceData(this._handles[2].worldPosition,this._handles[3].worldPosition,this._calibrationFactor),o="Calibration is required to display the distance in mm";this._distance=s.distance,this._distance2=a.distance,s.units&&a.units&&s.units===a.units?this._units=s.units:(s.units||(s.units=this._units),a.units||(a.units=this._units)),"units"!==s.units||this._label.hasAttribute("title")?"units"!==s.units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",o),this._label.style.color=this._colors.error),"units"!==a.units||this._label2.hasAttribute("title")?"units"!==a.units&&this._label2.hasAttribute("title")&&(this._label2.removeAttribute("title"),this._label2.style.color=this._colors.text):(this._label2.setAttribute("title",o),this._label2.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${s.units}`,this._label2.innerHTML=`${this._distance2.toFixed(2)} ${a.units}`;let l=Math.abs(t.transformAngle);l>Math.PI/2&&(l=Math.PI-l);const h=Math.tan(l)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(l)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-l)+15,c=t.line.normalize().multiplyScalar(h),u=t.length>2*h?this._handles[1].screenPosition.clone().sub(c):this._handles[1].screenPosition.clone().add(c),d=this.adjustLabelTransform(this._label,u);this._label.style.transform=`translate3D(${d.x}px, ${d.y}px, 0)`;let p=Math.abs(e.transformAngle);p>Math.PI/2&&(p=Math.PI-p);const f=Math.tan(p)<this._label2.offsetHeight/this._label2.offsetWidth?this._label2.offsetWidth/2/Math.cos(p)+15:this._label2.offsetHeight/2/Math.cos(Math.PI/2-p)+15,m=e.line.normalize().multiplyScalar(f),_=e.length>2*f?this._handles[3].screenPosition.clone().sub(m):this._handles[3].screenPosition.clone().add(m),g=this.adjustLabelTransform(this._label2,_);this._label2.style.transform=`translate3D(${g.x}px, ${g.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color,this._line2.style.backgroundColor=this._color,this._label2.style.borderColor=this._color,this._dashline.style.borderTop="1.5px dashed "+this._color}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label),this._container.removeChild(this._line2),this._container.removeChild(this._label2),this._container.removeChild(this._dashline),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}getDistances(){return[this._distance,this._distance2]}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles.forEach((e=>e.worldPosition.copy(t))),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="mm",this.update()}get shotestDistance(){return this._distance<this._distance2?this._distance:this._distance2}get longestDistance(){return this._distance>this._distance2?this._distance:this._distance2}}class u extends r.widgetsBase{constructor(t,e,i={}){let n;super(t,e,i),this._widgetType="CrossRuler",this._calibrationFactor=i.calibrationFactor||null,this._distances=null,this._line01=null,this._normal=null,this._distance=null,this._distance2=null,this._units=this._calibrationFactor||i.pixelSpacing?"mm":"units",this._domHovered=!1,this._moving=!1,this._material=null,this._geometry=null,this._mesh=null,this._line=null,this._line2=null,this._label=null,this._label2=null,this._handles=[];const r=o();for(let s=0;s<4;s++)n=new r(t,e,i),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new r(t,e,i),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.onHover=this.onHover.bind(this),this.onMove=this.onMove.bind(this),this.create(),this.addEventListeners()}addEventListeners(){this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._line2.addEventListener("mouseenter",this.onHover),this._line2.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._line2.removeEventListener("mouseenter",this.onHover),this._line2.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._handles[3].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handles.slice(0,-1).forEach((e=>e.onStart(t))),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._handles[3].active||this._domHovered,this._domHovered&&this._distances&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(t,!0),this._moving&&this._handles.slice(0,-1).forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))}))}else this.onHover(null);this._handles.slice(0,-1).forEach((e=>e.onMove(t))),this._distances&&(this._handles[0].active||this._handles[1].active?this.repositionOrtho():(this._handles[2].active||this._handles[3].active)&&this.recalculateOrtho()),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[2].onEnd(),this._handles[3].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected,this._handles[2].selected=this._selected,this._handles[3].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._handles[3].active,this._dragged=!1,this._moving=!1,this._distances||this.initOrtho(),this.update())}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new BufferGeometry;const t=new Float32Array(12);this._geometry.setAttribute("position",new BufferAttribute(t,3));let e=0;t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,t[e++]=this._handles[2].worldPosition.x,t[e++]=this._handles[2].worldPosition.y,t[e++]=this._handles[2].worldPosition.z,t[e++]=this._handles[3].worldPosition.x,t[e++]=this._handles[3].worldPosition.y,t[e++]=this._handles[3].worldPosition.z,this._material=new a.nls,this.updateMeshColor(),this._mesh=new a.ejS(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-line",this._container.appendChild(this._line),this._line2=document.createElement("div"),this._line2.className="widgets-line",this._container.appendChild(this._line2),this._label=document.createElement("div"),this._label.className="widgets-label",this._container.appendChild(this._label),this._label2=document.createElement("div"),this._label2.className="widgets-label",this._container.appendChild(this._label2),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._line2.style.display="none",this._label.style.display="none",this._label2.style.display="none",this._handles.slice(0,-1).forEach((t=>t.hideDOM()))}showDOM(){this._line.style.display="",this._line2.style.display="",this._label.style.display="",this._label2.style.display="",this._handles.slice(0,-1).forEach((t=>t.showDOM()))}update(){this.updateColor(),this._handles.slice(0,-1).forEach((t=>t.update())),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}updateDOM(){this.updateDOMColor();const t=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n            rotate(${t.transformAngle}rad)`,this._line.style.width=t.length+"px";const e=this.getLineData(this._handles[2].screenPosition,this._handles[3].screenPosition);this._line2.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)\n            rotate(${e.transformAngle}rad)`,this._line2.style.width=e.length+"px";const i=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor),n=this.getDistanceData(this._handles[2].worldPosition,this._handles[3].worldPosition,this._calibrationFactor),r="Calibration is required to display the distance in mm";this._distance=i.distance,this._distance2=n.distance,i.units&&n.units&&i.units===n.units?this._units=i.units:(i.units||(i.units=this._units),n.units||(n.units=this._units)),"units"!==i.units||this._label.hasAttribute("title")?"units"!==i.units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",r),this._label.style.color=this._colors.error),"units"!==n.units||this._label2.hasAttribute("title")?"units"!==n.units&&this._label2.hasAttribute("title")&&(this._label2.removeAttribute("title"),this._label2.style.color=this._colors.text):(this._label2.setAttribute("title",r),this._label2.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${i.units}`,this._label2.innerHTML=`${this._distance2.toFixed(2)} ${n.units}`;let s=Math.abs(t.transformAngle);s>Math.PI/2&&(s=Math.PI-s);const a=Math.tan(s)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(s)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-s)+15,o=t.line.normalize().multiplyScalar(a),l=t.length>4*a?this._handles[1].screenPosition.clone().sub(o):this._handles[1].screenPosition.clone().add(o),h=this.adjustLabelTransform(this._label,l);this._label.style.transform=`translate3D(${h.x}px, ${h.y}px, 0)`;let c=Math.abs(e.transformAngle);c>Math.PI/2&&(c=Math.PI-c);const u=Math.tan(c)<this._label2.offsetHeight/this._label2.offsetWidth?this._label2.offsetWidth/2/Math.cos(c)+15:this._label2.offsetHeight/2/Math.cos(Math.PI/2-c)+15,d=e.line.normalize().multiplyScalar(u),p=e.length>4*u?this._handles[3].screenPosition.clone().sub(d):this._handles[3].screenPosition.clone().add(d),f=this.adjustLabelTransform(this._label2,p);this._label2.style.transform=`translate3D(${f.x}px, ${f.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._line2.style.backgroundColor=this._color,this._label.style.borderColor=this._color,this._label2.style.borderColor=this._color}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._line2),this._container.removeChild(this._label),this._container.removeChild(this._label2),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}initLineAndNormal(){this._line01=this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition),this._normal=this._line01.clone().cross(this._camera._direction).normalize()}initOrtho(){this.initLineAndNormal();const t=this._handles[1].worldPosition.clone().add(this._handles[0].worldPosition).multiplyScalar(.5),e=this._line01.length()/2,i=this._normal.clone().multiplyScalar(.8*e),n=i.length();this._handles[2].worldPosition.copy(t.clone().add(i)),this._handles[3].worldPosition.copy(t.clone().sub(i)),this._distances=[e,e,n,n]}repositionOrtho(){this.initLineAndNormal(),this._distances[0]*=this._line01.length()/(this._distances[0]+this._distances[1]),this._distances[1]=this._line01.length()-this._distances[0];const t=this._handles[0].worldPosition.clone().add(this._line01.clone().normalize().multiplyScalar(this._distances[0]));this._handles[2].worldPosition.copy(t.clone().add(this._normal.clone().multiplyScalar(this._distances[2]))),this._handles[3].worldPosition.copy(t.clone().sub(this._normal.clone().multiplyScalar(this._distances[3])))}recalculateOrtho(){const t=this._handles[2].active?2:3,e=[],i=new a.Pa4;e[2]=this._handles[2].worldPosition.clone().sub(this._handles[0].worldPosition),e[3]=this._handles[3].worldPosition.clone().sub(this._handles[0].worldPosition),new a.zHn(this._handles[0].worldPosition,this._line01.clone().normalize()).closestPointToPoint(this._handles[t].worldPosition,i);const n=i.clone().sub(this._handles[0].worldPosition).length()>this._line01.length();(n||i.equals(this._handles[0].worldPosition))&&(n&&i.copy(this._handles[1].worldPosition),this._handles[t].worldPosition.copy(i.clone().add(e[t].clone().projectOnVector(this._normal)))),e[2].cross(this._line01).angleTo(this._camera._direction)>.01&&this._handles[2].worldPosition.copy(i),e[3].cross(this._line01).angleTo(this._camera._direction)<Math.PI-.01&&this._handles[3].worldPosition.copy(i),e[0]=this._normal.clone().multiplyScalar(this._distances[5-t]),2===t&&e[0].negate(),this._handles[5-t].worldPosition.copy(i.clone().add(e[0])),this._distances[t]=i.distanceTo(this._handles[t].worldPosition),this._distances[0]=i.distanceTo(this._handles[0].worldPosition),this._distances[1]=i.distanceTo(this._handles[1].worldPosition)}getDimensions(){return[this._distance,this._distance2]}getCoordinates(){return[this._handles[0].worldPosition,this._handles[1].worldPosition,this._handles[2].worldPosition,this._handles[3].worldPosition]}initCoordinates(t,e,i,n){const r=new a.Pa4,s=new a.Pa4,o=new a.zHn(t);o.lookAt(e),o.distanceSqToSegment(i,n,r,s),r.distanceTo(s)>.01&&r.distanceTo(t)>e.distanceTo(t)+.01?console.warn("Lines do not intersect"):(this.active=!1,this.hovered=!1,this.setDefaultColor("#198"),this._worldPosition.copy(t),this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(e),this._handles[1].active=!1,this._handles[1].tracking=!1,this._handles[2].worldPosition.copy(i),this._handles[3].worldPosition.copy(n),this._distances=[r.distanceTo(t),r.distanceTo(e),r.distanceTo(i),r.distanceTo(n)],this.initLineAndNormal(),this.update())}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles.slice(0,-1).forEach((e=>e.worldPosition.copy(t))),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="mm",this.update()}}var d=i(1798);class p extends r.widgetsBase{constructor(t,e,i={}){let n;super(t,e,i),this._widgetType="Ellipse",this._stack=i.stack,this._calibrationFactor=i.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||i.stack.frame[i.frameIndex].pixelSpacing?"cm²":"units",this._moving=!1,this._domHovered=!1,this._material=null,this._geometry=null,this._mesh=null,this._rectangle=null,this._ellipse=null,this._label=null,this._handles=[];const r=o();for(let s=0;s<2;s++)n=new r(t,e,i),this.add(n),this._handles.push(n);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new r(t,e,i),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._rectangle.addEventListener("mouseenter",this.onHover),this._rectangle.addEventListener("mouseleave",this.onHover),this._ellipse.addEventListener("mouseenter",this.onHover),this._ellipse.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._rectangle.removeEventListener("mouseenter",this.onHover),this._rectangle.removeEventListener("mouseleave",this.onHover),this._ellipse.removeEventListener("mouseenter",this.onHover),this._ellipse.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handles[0].onStart(t),this._handles[1].onStart(t),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(t,!0),this._moving&&this._handles.slice(0,-1).forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))})),this.updateRoI(!0)}else this.onHover(null);this._handles[0].onMove(t),this._handles[1].onMove(t),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.updateRoI(),this.update())}hideDOM(){this._handles.forEach((t=>t.hideDOM())),this._rectangle.style.display="none",this._ellipse.style.display="none",this._label.style.display="none"}showDOM(){this._handles[0].showDOM(),this._handles[1].showDOM(),this._rectangle.style.display="",this._ellipse.style.display="",this._label.style.display=""}create(){this.createMaterial(),this.createDOM()}createMaterial(){this._material=new a.vBJ,this._material.transparent=!0,this._material.opacity=.2}createDOM(){this._rectangle=document.createElement("div"),this._rectangle.className="widgets-rectangle-helper",this._container.appendChild(this._rectangle),this._ellipse=document.createElement("div"),this._ellipse.className="widgets-ellipse",this._container.appendChild(this._ellipse),this._label=document.createElement("div"),this._label.className="widgets-label";const t=document.createElement("div");let e=document.createElement("div");e.className="mean-sd",t.appendChild(e);let i=document.createElement("div");i.className="max-min",t.appendChild(i);let n=document.createElement("div");n.className="area",t.appendChild(n),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._mesh&&this.remove(this._mesh);const t=this._handles[1].worldPosition.clone().sub(this._handles[0].worldPosition),e=t.clone().projectOnVector(this._camera.up).length(),i=t.clone().projectOnVector(this._camera._right).length();0!==i&&0!==e&&(this._geometry=new a.oa8(new a.bnF(new a.Ny0(0,0,i/2,e/2,0,2*Math.PI,!1).getPoints(50))),this._mesh=new a.Kj0(this._geometry,this._material),this._mesh.position.copy(this._handles[0].worldPosition.clone().add(t.multiplyScalar(.5))),this._mesh.rotation.copy(this._camera.rotation),this._mesh.visible=!0,this.add(this._mesh))}updateRoI(t){if(!this._geometry)return;const e=this._label.querySelector(".mean-sd"),i=this._label.querySelector(".max-min");if(t)return e.innerHTML="",void(i.innerHTML="");const n=d.default.getRoI(this._mesh,this._camera,this._stack);null!==n?(e.innerHTML=`Mean: ${n.mean.toFixed(1)} / SD: ${n.sd.toFixed(1)}`,i.innerHTML=`Max: ${n.max.toFixed()} / Min: ${n.min.toFixed()}`):(e.innerHTML="",i.innerHTML="")}updateDOMColor(){this._rectangle.style.borderColor=this._color,this._ellipse.style.borderColor=this._color,this._label.style.borderColor=this._color}updateDOM(){if(!this._geometry)return;this.updateDOMColor();const t=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=d.default.getGeometryArea(this._geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(t&&t.length>0&&this._stack.lps2IJK){const e=this.getRegionByXY(t,d.default.worldToData(this._stack.lps2IJK,this._handles[0].worldPosition)),i=this.getRegionByXY(t,d.default.worldToData(this._stack.lps2IJK,this._handles[1].worldPosition));null!==e&&null!==i&&e===i&&"cm"===t[e].unitsX&&"cm"===t[e].unitsY?(this._area*=Math.pow(t[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);"units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the area in cm²"),this._label.style.color=this._colors.error),this._label.querySelector(".area").innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`;const e=this.getRectData(this._handles[0].screenPosition,this._handles[1].screenPosition),i=this.adjustLabelTransform(this._label,this._handles[1].screenPosition.clone().add(e.paddingVector.multiplyScalar(15+this._label.offsetHeight/2)));this._rectangle.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)`,this._rectangle.style.width=e.width+"px",this._rectangle.style.height=e.height+"px",this._ellipse.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)`,this._ellipse.style.width=e.width+"px",this._ellipse.style.height=e.height+"px",this._label.style.transform="translate3D("+i.x+"px,"+i.y+"px, 0)"}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._rectangle),this._container.removeChild(this._ellipse),this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._geometry&&(this._geometry.dispose(),this._geometry=null),this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null,super.free()}getMeasurements(){return{area:this._area,units:this._units}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(t),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="cm²",this.update()}}class f extends r.widgetsBase{constructor(t,e,i={}){super(t,e,i),this._widgetType="Freehand",this._stack=i.stack,this._calibrationFactor=i.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||i.stack.frame[i.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._moving=!1,this._domHovered=!1,this._material=null,this._geometry=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];const n=o();let r=new n(t,e,i);this.add(r),this._handles.push(r),this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._moveHandle.hide(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh();let e=!1;this._handles.forEach((t=>e=e||t.hovered)),this._hovered=e||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){let e=!1;this._moveHandle.onMove(t,!0),this._handles.forEach((i=>{i.onStart(t),e=e||i.active})),this._active=e||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){let e=!1;if(this.active)if(this._dragged=!0,this._initialized){const e=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(t,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))}))}else{this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let t=new(o())(this._targetMesh,this._controls,this._params);t.hovered=!0,t.active=!0,t.tracking=!0,this.add(t),this._handles.push(t),this.createLine()}this._handles.forEach((i=>{i.onMove(t),e=e||i.hovered})),this._hovered=e||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.active&&this._handles.length>2&&this.pushPopHandle(),this.update()}onEnd(){if(this._handles.length<3)return;let t=!1;this._handles.slice(0,-1).forEach((e=>{e.onEnd(),t=t||e.active})),this._dragged||!this._handles[this._handles.length-1].tracking?(this._handles[this._handles.length-1].tracking=!1,this._handles[this._handles.length-1].onEnd()):this._handles[this._handles.length-1].tracking=!1,this._lines.length<this._handles.length&&this.createLine(),!this._dragged&&this._initialized||(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach((t=>t.selected=this._selected))),this._active=t||this._handles[this._handles.length-1].active,this._dragged=!1,this._moving=!1,this._initialized=!0,this.update()}create(){this.createMaterial(),this.createDOM()}createMaterial(){this._material=new a.vBJ({side:a.ehD}),this._material.transparent=!0,this._material.opacity=.2}createDOM(){this._label=document.createElement("div"),this._label.className="widgets-label";const t=document.createElement("div");let e=document.createElement("div");e.className="mean-sd",t.appendChild(e);let i=document.createElement("div");i.className="max-min",t.appendChild(i);let n=document.createElement("div");n.className="area",t.appendChild(n),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}createLine(){const t=document.createElement("div");t.className="widgets-line",t.addEventListener("mouseenter",this.onHover),t.addEventListener("mouseleave",this.onHover),this._lines.push(t),this._container.appendChild(t)}hideDOM(){this._handles.forEach((t=>t.hideDOM())),this._lines.forEach((t=>t.style.display="none")),this._label.style.display="none"}showDOM(){this._handles.forEach((t=>t.showDOM())),this._lines.forEach((t=>t.style.display="")),this._label.style.display=""}update(){this.updateColor(),this._handles.forEach((t=>t.update())),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()}updateMesh(){this._mesh&&this.remove(this._mesh);let t=[];this._handles.forEach((e=>t.push(e.worldPosition)));let e=d.default.centerOfMass(t),i=(new a.Pa4).subVectors(t[0],e).normalize(),n=(new a.Pa4).crossVectors((new a.Pa4).subVectors(t[0],e),(new a.Pa4).subVectors(t[1],e)),r=(new a.Pa4).crossVectors(i,n).normalize(),s=[];for(let n=0;n<t.length;n++){let o=new a.Pa4(t[n].x,t[n].y,t[n].z);o.direction=(new a.Pa4).subVectors(t[n],e).normalize();let l=i.dot(o.direction),h=r.dot(o.direction);o.xy={x:l,y:h},o.angle=Math.atan2(h,l)*(180/Math.PI),s.push(o)}this._shapeWarn=!1;const o=console.warn;console.warn=function(...t){return"three.ShapeUtils: Unable to triangulate polygon! in triangulate()"===t[0]&&(this._shapeWarn=!0),o.apply(console,t)}.bind(this);let l=new a.bnF;l.moveTo(s[0].xy.x,s[0].xy.y);for(let t=1;t<s.length;t++)l.lineTo(s[t].xy.x,s[t].xy.y);l.lineTo(s[0].xy.x,s[0].xy.y),this._geometry=new a.oa8(l),console.warn=o,this._geometry.vertices=s,this._geometry.verticesNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this.updateMeshColor(),this._mesh=new a.Kj0(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}isPointOnLine(t,e,i){let n=new a.Pa4;return n.crossVectors(t.clone().sub(i),e.clone().sub(i)),!n.length()}pushPopHandle(){let t=this._handles[this._handles.length-3],e=this._handles[this._handles.length-2],i=this._handles[this._handles.length-1],n=this.isPointOnLine(t.worldPosition,e.worldPosition,i.worldPosition);return(n||t.screenPosition.distanceTo(i.screenPosition)<25)&&(this.remove(e),e.free(),this._handles[this._handles.length-2]=i,this._handles.pop(),this._container.removeChild(this._lines.pop())),n}updateDOMColor(){this._handles.length>=2&&this._lines.forEach((t=>t.style.backgroundColor=this._color)),this._label.style.borderColor=this._color}updateDOMContent(t){const e=this._label.querySelector(".mean-sd"),i=this._label.querySelector(".max-min"),n=this._label.querySelector(".area");if(t)return e.innerHTML="",i.innerHTML="",void(n.innerHTML="");const r=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=d.default.getGeometryArea(this._geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(r&&r.length>0&&this._stack.lps2IJK){let t,e,i=!0;this._handles.forEach((n=>{t=this.getRegionByXY(r,d.default.worldToData(this._stack.lps2IJK,n.worldPosition)),(null===t||"cm"!==r[t].unitsX||void 0!==e&&e!==t)&&(i=!1),e=t})),i?(this._area*=Math.pow(r[t].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let s="units"===this._units?"Calibration is required to display the area in cm². ":"";this._shapeWarn&&(s+="Values may be incorrect due to triangulation error."),""===s||this._label.hasAttribute("title")?""===s&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",s),this._label.style.color=this._colors.error);const a=d.default.getRoI(this._mesh,this._camera,this._stack);null!==a?(e.innerHTML=`Mean: ${a.mean.toFixed(1)} / SD: ${a.sd.toFixed(1)}`,i.innerHTML=`Max: ${a.max.toFixed()} / Min: ${a.min.toFixed()}`):(e.innerHTML="",i.innerHTML=""),n.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`}updateDOMPosition(){if(this._handles.length<2)return;let t=null;this._lines.forEach(((e,i)=>{const n=this.getLineData(this._handles[i].screenPosition,this._handles[i+1===this._handles.length?0:i+1].screenPosition);e.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0)\n                rotate(${n.transformAngle}rad)`,e.style.width=n.length+"px",(null===t||t.y<this._handles[i].screenPosition.y)&&(t=this._handles[i].screenPosition.clone())})),this._initialized&&(t.y+=15+this._label.offsetHeight/2,t=this.adjustLabelTransform(this._label,t),this._label.style.transform=`translate3D(${t.x}px, ${t.y}px, 0)`)}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach((t=>{t.removeEventListener("mouseenter",this.onHover),t.removeEventListener("mouseleave",this.onHover),this._container.removeChild(t)})),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._geometry&&(this._geometry.dispose(),this._geometry=null),this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null,super.free()}getMeasurements(){return{area:this._area,units:this._units}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this._moveHandle.targetMesh=t,this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles.forEach((e=>e._worldPosition.copy(t))),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="cm²",this.update()}}class m extends r.widgetsBase{constructor(t,e,i={}){if(super(t,e,i),this._widgetType="PeakVelocity",this._regions=i.ultrasoundRegions||[],this._regions.length<1)throw new Error("Ultrasound regions should not be empty!");if(this._velocity=null,this._gradient=null,this._container.style.cursor="pointer",this._controls.enabled=!1,this._initialized=!1,this._active=!0,this._domHovered=!1,this._initialRegion=this.getRegionByXY(this._regions,d.default.worldToData(i.lps2IJK,i.worldPosition)),null===this._initialRegion)throw new Error("Invalid initial UltraSound region!");this._line=null,this._label=null;const n=o();this._handle=new n(t,e,i),this.add(this._handle),this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this._hovered=this._handle.hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handle.onStart(t),this._active=this._handle.active||this._domHovered,this._domHovered&&(this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(t,!0);const i=this._moveHandle.worldPosition.clone().sub(e);if(!this.isCorrectRegion(i))return void this._moveHandle.worldPosition.copy(e);this._handle.active||this._handle.worldPosition.add(i),this._dragged=!0}else this.onHover(null);this._handle.onMove(t),this.update()}onEnd(){this._handle.onEnd(),!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handle.selected=this._selected),this._initialized=!0,this._active=!1,this._dragged=!1,this.update()}isCorrectRegion(t){const e=this.getRegionByXY(this._regions,d.default.worldToData(this._params.lps2IJK,this._handle.worldPosition.clone().add(t)));return null!==e&&e===this._initialRegion&&"cm/sec"===this._regions[e].unitsY}create(){this.createDOM()}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-dashline",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="widgets-label";let t=document.createElement("div"),e=document.createElement("div");e.className="peakVelocity",t.appendChild(e);let i=document.createElement("div");i.className="gradient",t.appendChild(i),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handle.update(),this._worldPosition.copy(this._handle.worldPosition),this.updateDOM()}updateDOM(){this.updateDOMColor();const t=d.default.worldToData(this._params.lps2IJK,this._worldPosition),e=this._regions[this.getRegionByXY(this._regions,t)],i=this.getPointInRegion(e,t);this._velocity=Math.abs(i.y/100),this._gradient=4*Math.pow(this._velocity,2),this._label.querySelector(".peakVelocity").innerHTML=`${this._velocity.toFixed(2)} m/s`,this._label.querySelector(".gradient").innerHTML=`${this._gradient.toFixed(2)} mmhg`;const n=this.adjustLabelTransform(this._label,this._handle.screenPosition,!0);this._line.style.transform=`translate3D(${n.x-(t.x-e.x0)*this._camera.zoom}px, ${n.y}px, 0)`,this._line.style.width=(e.x1-e.x0)*this._camera.zoom+"px",this._label.style.transform=`translate3D(${n.x+10}px, ${n.y+10}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color}hideDOM(){this._line.style.display="none",this._label.style.display="none",this._handle.hideDOM()}showDOM(){this._line.style.display="",this._label.style.display="",this._handle.showDOM()}free(){this.removeEventListeners(),this.remove(this._handle),this._handle.free(),this._handle=null,this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._container.removeChild(this._line),this._container.removeChild(this._label),super.free()}getMeasurements(){return{velocity:this._velocity,gradient:this._gradient}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handle.targetMesh=t,this._moveHandle.targetMesh=t,this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handle.worldPosition.copy(t),this._moveHandle.worldPosition.copy(t),this._worldPosition.copy(t),this.update()}get active(){return this._active}set active(t){this._active=t,this._controls.enabled=!this._active,this.update()}}class _ extends r.widgetsBase{constructor(t,e,i={}){if(super(t,e,i),this._widgetType="PressureHalfTime",this._regions=i.ultrasoundRegions||[],this._regions.length<1)throw new Error("Ultrasound regions should not be empty!");if(this._vMax=null,this._gMax=null,this._pht=null,this._mva=null,this._dt=null,this._ds=null,this._domHovered=!1,this._initialRegion=this.getRegionByXY(this._regions,d.default.worldToData(i.lps2IJK,i.worldPosition)),null===this._initialRegion)throw new Error("Invalid initial UltraSound region!");this._material=null,this._geometry=null,this._mesh=null,this._line=null,this._label=null,this._handles=[];const n=o();let r;for(let s=0;s<2;s++)r=new n(t,e,i),this.add(r),this._handles.push(r);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handles[0].onStart(t),this._handles[1].onStart(t),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&(this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(t,!0);const i=this._moveHandle.worldPosition.clone().sub(e);if(!this.isCorrectRegion(i))return void this._moveHandle.worldPosition.copy(e);this._handles[0].active||this._handles[1].active||this._handles.slice(0,-1).forEach((t=>{t.worldPosition.add(i)})),this._dragged=!0}else this.onHover(null);this._handles[0].onMove(t),this._handles[1].onMove(t),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this.update())}isCorrectRegion(t){const e=!(this._handles[0].active||this._handles[1].active);let i=!0;return(this._handles[0].active||e)&&(i=i&&this.checkHandle(0,t)),(this._handles[1].active||e)&&(i=i&&this.checkHandle(1,t)),i}checkHandle(t,e){const i=this.getRegionByXY(this._regions,d.default.worldToData(this._params.lps2IJK,this._handles[t].worldPosition.clone().add(e)));return null!==i&&i===this._initialRegion&&"cm/sec"===this._regions[i].unitsY}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new BufferGeometry;const t=new Float32Array(6);this._geometry.setAttribute("position",new BufferAttribute(t,3));let e=0;t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,this._material=new a.nls,this.updateMeshColor(),this._mesh=new a.x12(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="widgets-label";const t=document.createElement("div");["vmax","gmax","pht","mva","dt","ds"].forEach((e=>{const i=document.createElement("div");i.className=e,t.appendChild(i)})),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._label.style.display="none",this._handles.forEach((t=>t.hideDOM()))}showDOM(){this._line.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateValues(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateValues(){const t=this.getUsPoint(this._regions,d.default.worldToData(this._params.lps2IJK,this._handles[0].worldPosition)),e=this.getUsPoint(this._regions,d.default.worldToData(this._params.lps2IJK,this._handles[1].worldPosition)),i=Math.abs(t.y/100),n=Math.abs(e.y/100),r=Math.abs(t.x),s=Math.abs(e.x),a=this._vMax===i?r:s;this._vMax=Math.max(i,n),this._gMax=4*Math.pow(this._vMax,2);const o=this._vMax/Math.sqrt(2),l=(i-o)/(n-o),h=i/n;this._pht=1===l?Number.POSITIVE_INFINITY:1e3*Math.abs(a-(r-l*s)/(1-l)),this._mva=220/this._pht,this._dt=1===h?Number.POSITIVE_INFINITY:1e3*Math.abs(a-(r-h*s)/(1-h)),this._ds=0===this._dt?Number.POSITIVE_INFINITY:this._vMax/this._dt*1e3}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}updateDOM(){this.updateDOMColor();const t=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n                rotate(${t.transformAngle}rad)`,this._line.style.width=t.length+"px",this._label.querySelector(".vmax").innerHTML=`Vmax: ${this._vMax.toFixed(2)} m/s`,this._label.querySelector(".gmax").innerHTML=`Gmax: ${this._gMax.toFixed(2)} mmhg`,this._label.querySelector(".pht").innerHTML=`PHT: ${this._pht.toFixed(1)} ms`,this._label.querySelector(".mva").innerHTML=`MVA: ${this._mva.toFixed(2)} cm²`,this._label.querySelector(".dt").innerHTML=`DT: ${this._dt.toFixed(1)} ms`,this._label.querySelector(".ds").innerHTML=`DS: ${this._ds.toFixed(2)} m/s²`;let e=Math.abs(t.transformAngle);e>Math.PI/2&&(e=Math.PI-e);const i=Math.tan(e)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(e)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-e)+15,n=t.line.normalize().multiplyScalar(i),r=t.length>2*i?this._handles[1].screenPosition.clone().sub(n):this._handles[1].screenPosition.clone().add(n),s=this.adjustLabelTransform(this._label,r);this._label.style.transform=`translate3D(${s.x}px, ${s.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}getMeasurements(){return{vMax:this._vMax,gMax:this._gMax,pht:this._pht,mva:this._mva,dt:this._dt,ds:this._ds}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(t),this._worldPosition.copy(t),this.update()}}class g extends r.widgetsBase{constructor(t,e,i={}){super(t,e,i),this._widgetType="Polygon",this._stack=i.stack,this._calibrationFactor=i.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||i.stack.frame[i.frameIndex].pixelSpacing?"cm²":"units",this._initialized=!1,this._newHandleRequired=!0,this._moving=!1,this._domHovered=!1,this._material=null,this._geometry=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];const n=o();let r=new n(t,e,i);this.add(r),this._handles.push(r),this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._moveHandle.hide(),this.onDoubleClick=this.onDoubleClick.bind(this),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()}addEventListeners(){this._container.addEventListener("dblclick",this.onDoubleClick),this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("dblclick",this.onDoubleClick),this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh();let e=!1;this._handles.forEach((t=>e=e||t.hovered)),this._hovered=e||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){let e=!1;this._handles.forEach((i=>{i.onStart(t),e=e||i.active})),this._initialized&&(this._moveHandle.onMove(t,!0),this._active=e||this._domHovered,this._domHovered&&this._initialized&&(this._moving=!0,this._controls.enabled=!1),this.update())}onMove(t){let e=!1;if(this.active)if(this._dragged=!0,this._newHandleRequired&&!this._initialized){this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let t=new(o())(this._targetMesh,this._controls,this._params);t.hovered=!0,t.active=!0,t.tracking=!0,this.add(t),this._handles.push(t),this.createLine(),this._newHandleRequired=!1}else{const e=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(t,!0),this._mesh&&this.remove(this._mesh),this.updateDOMContent(!0),this._moving&&this._handles.forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))}))}this._handles.forEach((i=>{i.onMove(t),e=e||i.hovered})),this._hovered=e||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default",this.update()}onEnd(){let t=this._handles.length,e=!1;!this._initialized&&t>1&&this._handles[t-2].screenPosition.distanceTo(this._handles[t-1].screenPosition)<10||(this._handles.forEach((t=>{t.onEnd(),e=e||t.active})),this._initialized?(this._dragged&&(this.updateMesh(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach((t=>t.selected=this._selected))),this._active=e||this._handles[t-1].active,this._dragged=!1,this._moving=!1,this.update()):this._newHandleRequired=!0)}onDoubleClick(){let t=this._handles.length;t<3||this._initialized||t>1&&this._handles[t-2].screenPosition.distanceTo(this._handles[t-1].screenPosition)<10||(this._handles[t-1].tracking=!1,this._handles.forEach((t=>t.onEnd())),this._active=!1,this._dragged=!1,this._moving=!1,this._initialized=!0,this.updateMesh(),this.updateDOMContent(),this.update())}create(){this.createMaterial(),this.createDOM()}createMaterial(){this._material=new a.vBJ({side:a.ehD}),this._material.transparent=!0,this._material.opacity=.2}createDOM(){this.createLine(),this._label=document.createElement("div"),this._label.className="widgets-label";const t=document.createElement("div");let e=document.createElement("div");e.className="mean-sd",t.appendChild(e);let i=document.createElement("div");i.className="max-min",t.appendChild(i);let n=document.createElement("div");n.className="area",t.appendChild(n),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}createLine(){const t=document.createElement("div");t.className="widgets-line",t.addEventListener("mouseenter",this.onHover),t.addEventListener("mouseleave",this.onHover),this._lines.push(t),this._container.appendChild(t)}hideDOM(){this._handles.forEach((t=>t.hideDOM())),this._lines.forEach((t=>t.style.display="none")),this._label.style.display="none"}showDOM(){this._handles.forEach((t=>t.showDOM())),this._lines.forEach((t=>t.style.display="")),this._label.style.display=""}update(){this.updateColor(),this._handles.forEach((t=>t.update())),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()}updateMesh(){this._mesh&&this.remove(this._mesh);let t=[];this._handles.forEach((e=>t.push(e.worldPosition)));let e=d.default.centerOfMass(t),i=(new a.Pa4).subVectors(t[0],e).normalize(),n=(new a.Pa4).crossVectors((new a.Pa4).subVectors(t[0],e),(new a.Pa4).subVectors(t[1],e)),r=(new a.Pa4).crossVectors(i,n).normalize(),s=[];for(let n=0;n<t.length;n++){let o=new a.Pa4(t[n].x,t[n].y,t[n].z);o.direction=(new a.Pa4).subVectors(t[n],e).normalize();let l=i.dot(o.direction),h=r.dot(o.direction);o.xy={x:l,y:h},o.angle=Math.atan2(h,l)*(180/Math.PI),s.push(o)}this._shapeWarn=!1;const o=console.warn;console.warn=function(...t){return"THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"===t[0]&&(this._shapeWarn=!0),o.apply(console,t)}.bind(this);let l=new a.bnF;l.moveTo(s[0].xy.x,s[0].xy.y);for(let t=1;t<s.length;t++)l.lineTo(s[t].xy.x,s[t].xy.y);l.lineTo(s[0].xy.x,s[0].xy.y),this._geometry=new a.oa8(l),console.warn=o,this._geometry.vertices=s,this._geometry.verticesNeedUpdate=!0,this._geometry.elementsNeedUpdate=!0,this.updateMeshColor(),this._mesh=new a.Kj0(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}updateDOMColor(){this._lines.forEach((t=>t.style.backgroundColor=this._color)),this._label.style.borderColor=this._color}updateDOMContent(t){const e=this._label.querySelector(".mean-sd"),i=this._label.querySelector(".max-min"),n=this._label.querySelector(".area");if(t)return e.innerHTML="",i.innerHTML="",void(n.innerHTML="");const r=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=d.default.getGeometryArea(this._geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(r&&r.length>0&&this._stack.lps2IJK){let t,e,i=!0;this._handles.forEach((n=>{t=this.getRegionByXY(r,d.default.worldToData(this._stack.lps2IJK,n.worldPosition)),(null===t||"cm"!==r[t].unitsX||void 0!==e&&e!==t)&&(i=!1),e=t})),i?(this._area*=Math.pow(r[t].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);let s="units"===this._units?"Calibration is required to display the area in cm². ":"";this._shapeWarn&&(s+="Values may be incorrect due to triangulation error."),""===s||this._label.hasAttribute("title")?""===s&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title",s),this._label.style.color=this._colors.error);const a=d.default.getRoI(this._mesh,this._camera,this._stack);null!==a?(e.innerHTML=`Mean: ${a.mean.toFixed(1)} / SD: ${a.sd.toFixed(1)}`,i.innerHTML=`Max: ${a.max.toFixed()} / Min: ${a.min.toFixed()}`):(e.innerHTML="",i.innerHTML=""),n.innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`}updateDOMPosition(){let t=null;this._lines.forEach(((e,i)=>{const n=this.getLineData(this._handles[i].screenPosition,this._handles[i+1===this._handles.length?0:i+1].screenPosition);e.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0)\n                    rotate(${n.transformAngle}rad)`,e.style.width=n.length+"px",(null===t||t.y<this._handles[i].screenPosition.y)&&(t=this._handles[i].screenPosition.clone())})),this._initialized&&(t.y+=15+this._label.offsetHeight/2,t=this.adjustLabelTransform(this._label,t),this._label.style.transform=`translate3D(${t.x}px, ${t.y}px, 0)`)}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach((t=>{t.removeEventListener("mouseenter",this.onHover),t.removeEventListener("mouseleave",this.onHover),this._container.removeChild(t)})),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._geometry&&(this._geometry.dispose(),this._geometry=null),this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null,super.free()}getMeasurements(){return{area:this._area,units:this._units}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this._moveHandle.targetMesh=t,this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles.forEach((e=>e.worldPosition.copy(t))),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="cm²",this.update()}}class y extends r.widgetsBase{constructor(t,e,i={}){super(t,e,i),this._widgetType="Rectangle",this._stack=i.stack,this._calibrationFactor=i.calibrationFactor||null,this._area=null,this._units=this._calibrationFactor||i.stack.frame[i.frameIndex].pixelSpacing?"cm²":"units",this._moving=!1,this._domHovered=!1,this._material=null,this._geometry=null,this._mesh=null,this._rectangle=null,this._label=null,this._handles=[];const n=o();let r;for(let s=0;s<2;s++)r=new n(t,e,i),this.add(r),this._handles.push(r);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._rectangle.addEventListener("mouseenter",this.onHover),this._rectangle.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._rectangle.removeEventListener("mouseenter",this.onHover),this._rectangle.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handles[0].onStart(t),this._handles[1].onStart(t),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(t,!0),this._moving&&this._handles.slice(0,-1).forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))})),this.updateRoI(!0)}else this.onHover(null);this._handles[0].onMove(t),this._handles[1].onMove(t),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.updateRoI(),this.update())}hideDOM(){this._handles.forEach((t=>t.hideDOM())),this._rectangle.style.display="none",this._label.style.display="none"}showDOM(){this._handles[0].showDOM(),this._handles[1].showDOM(),this._rectangle.style.display="",this._label.style.display=""}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new a._12(1,1),this._material=new a.vBJ({side:a.ehD}),this._material.transparent=!0,this._material.opacity=.2,this.updateMeshColor(),this._mesh=new a.Kj0(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._rectangle=document.createElement("div"),this._rectangle.className="widgets-rectangle",this._container.appendChild(this._rectangle),this._label=document.createElement("div"),this._label.className="widgets-label";const t=document.createElement("div");let e=document.createElement("div");e.className="mean-sd",t.appendChild(e);let i=document.createElement("div");i.className="max-min",t.appendChild(i);let n=document.createElement("div");n.className="area",t.appendChild(n),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){if(this._geometry){const t=(new a.Pa4).subVectors(this._handles[1].worldPosition,this._handles[0].worldPosition).projectOnVector(this._camera.up);this._geometry.vertices[0].copy(this._handles[0].worldPosition),this._geometry.vertices[1].copy((new a.Pa4).addVectors(this._handles[0].worldPosition,t)),this._geometry.vertices[2].copy((new a.Pa4).subVectors(this._handles[1].worldPosition,t)),this._geometry.vertices[3].copy(this._handles[1].worldPosition),this._geometry.verticesNeedUpdate=!0,this._geometry.computeBoundingSphere()}}updateRoI(t){const e=this._label.querySelector(".mean-sd"),i=this._label.querySelector(".max-min");if(t)return e.innerHTML="",void(i.innerHTML="");const n=d.default.getRoI(this._mesh,this._camera,this._stack);null!==n?(e.innerHTML=`Mean: ${n.mean.toFixed(1)} / SD: ${n.sd.toFixed(1)}`,i.innerHTML=`Max: ${n.max.toFixed()} / Min: ${n.min.toFixed()}`):(e.innerHTML="",i.innerHTML="")}updateDOMColor(){this._rectangle.style.borderColor=this._color,this._label.style.borderColor=this._color}updateDOM(){this.updateDOMColor();const t=this._stack.frame[this._params.frameIndex].ultrasoundRegions||[];if(this._area=d.default.getGeometryArea(this._geometry),this._calibrationFactor)this._area*=Math.pow(this._calibrationFactor,2);else if(t&&t.length>0&&this._stack.lps2IJK){const e=this.getRegionByXY(t,d.default.worldToData(this._stack.lps2IJK,this._handles[0].worldPosition)),i=this.getRegionByXY(t,d.default.worldToData(this._stack.lps2IJK,this._handles[1].worldPosition));null!==e&&null!==i&&e===i&&"cm"===t[e].unitsX&&"cm"===t[e].unitsY?(this._area*=Math.pow(t[e].deltaX,2),this._units="cm²"):this._stack.frame[this._params.frameIndex].pixelSpacing?(this._area/=100,this._units="cm²"):this._units="units"}else"cm²"===this._units&&(this._area/=100);"units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the area in cm²"),this._label.style.color=this._colors.error),this._label.querySelector(".area").innerHTML=`Area: ${this._area.toFixed(2)} ${this._units}`;const e=this.getRectData(this._handles[0].screenPosition,this._handles[1].screenPosition),i=this.adjustLabelTransform(this._label,this._handles[1].screenPosition.clone().add(e.paddingVector.multiplyScalar(15+this._label.offsetHeight/2)));this._rectangle.style.transform=`translate3D(${e.transformX}px, ${e.transformY}px, 0)`,this._rectangle.style.width=e.width+"px",this._rectangle.style.height=e.height+"px",this._label.style.transform="translate3D("+i.x+"px,"+i.y+"px, 0)"}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._rectangle),this._container.removeChild(this._label),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null,super.free()}getMeasurements(){return{area:this._area,units:this._units}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(t),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="cm²",this.update()}}class v extends r.widgetsBase{constructor(t,e,i={}){super(t,e,i),this._widgetType="Ruler",this._calibrationFactor=i.calibrationFactor||null,this._distance=null,this._units=this._calibrationFactor||i.pixelSpacing?"mm":"units",this._moving=!1,this._domHovered=!1,this._material=null,this._geometry=null,this._mesh=null,this._line=null,this._label=null,this._handles=[];const n=o();let r;for(let s=0;s<2;s++)r=new n(t,e,i),this.add(r),this._handles.push(r);this._handles[1].active=!0,this._handles[1].tracking=!0,this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._handles.push(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._line.addEventListener("mouseenter",this.onHover),this._line.addEventListener("mouseleave",this.onHover),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._line.removeEventListener("mouseenter",this.onHover),this._line.removeEventListener("mouseleave",this.onHover),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh(),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){this._moveHandle.onMove(t,!0),this._handles[0].onStart(t),this._handles[1].onStart(t),this._active=this._handles[0].active||this._handles[1].active||this._domHovered,this._domHovered&&!this._handles[1].tracking&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(t,!0),this._moving&&this._handles.slice(0,-1).forEach((t=>{t.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))}))}else this.onHover(null);this._handles[0].onMove(t),this._handles[1].onMove(t),this.update()}onEnd(){this._handles[0].onEnd(),this._handles[1].tracking&&this._handles[0].screenPosition.distanceTo(this._handles[1].screenPosition)<10||(this._dragged||!this._active||this._handles[1].tracking||(this._selected=!this._selected,this._handles[0].selected=this._selected),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd()):this._handles[1].tracking=!1,this._handles[1].selected=this._selected,this._active=this._handles[0].active||this._handles[1].active,this._dragged=!1,this._moving=!1,this.update())}create(){this.createMesh(),this.createDOM()}createMesh(){this._geometry=new BufferGeometry;const t=new Float32Array(6);this._geometry.setAttribute("position",new BufferAttribute(t,3));let e=0;t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,t[e++]=this._handles[1].worldPosition.x,t[e++]=this._handles[1].worldPosition.y,t[e++]=this._handles[1].worldPosition.z,this._material=new a.nls,this.updateMeshColor(),this._mesh=new a.x12(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}createDOM(){this._line=document.createElement("div"),this._line.className="widgets-line",this._container.appendChild(this._line),this._label=document.createElement("div"),this._label.className="widgets-label",this._container.appendChild(this._label),this.updateDOMColor()}hideDOM(){this._line.style.display="none",this._label.style.display="none",this._handles.forEach((t=>t.hideDOM()))}showDOM(){this._line.style.display="",this._label.style.display="",this._handles[0].showDOM(),this._handles[1].showDOM()}update(){this.updateColor(),this._handles[0].update(),this._handles[1].update();const t=this.getDistanceData(this._handles[0].worldPosition,this._handles[1].worldPosition,this._calibrationFactor);this._distance=t.distance,t.units&&(this._units=t.units),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOM()}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateMeshPosition(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)}updateDOM(){this.updateDOMColor();const t=this.getLineData(this._handles[0].screenPosition,this._handles[1].screenPosition);this._line.style.transform=`translate3D(${t.transformX}px, ${t.transformY}px, 0)\n      rotate(${t.transformAngle}rad)`,this._line.style.width=t.length+"px","units"!==this._units||this._label.hasAttribute("title")?"units"!==this._units&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text):(this._label.setAttribute("title","Calibration is required to display the distance in mm"),this._label.style.color=this._colors.error),this._label.innerHTML=`${this._distance.toFixed(2)} ${this._units}`;let e=Math.abs(t.transformAngle);e>Math.PI/2&&(e=Math.PI-e);const i=Math.tan(e)<this._label.offsetHeight/this._label.offsetWidth?this._label.offsetWidth/2/Math.cos(e)+15:this._label.offsetHeight/2/Math.cos(Math.PI/2-e)+15,n=t.line.normalize().multiplyScalar(i),r=t.length>2*i?this._handles[1].screenPosition.clone().sub(n):this._handles[1].screenPosition.clone().add(n),s=this.adjustLabelTransform(this._label,r);this._label.style.transform=`translate3D(${s.x}px, ${s.y}px, 0)`}updateDOMColor(){this._line.style.backgroundColor=this._color,this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._label),this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}getMeasurements(){return{distance:this._distance,units:this._units}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles[0].worldPosition.copy(t),this._handles[1].worldPosition.copy(t),this._worldPosition.copy(t),this.update()}get calibrationFactor(){return this._calibrationFactor}set calibrationFactor(t){this._calibrationFactor=t,this._units="mm",this.update()}}class x extends r.widgetsBase{constructor(t,e,i={}){if(super(t,e,i),this._widgetType="VelocityTimeIntegral",this._regions=i.ultrasoundRegions||[],this._regions.length<1)throw new Error("Ultrasound regions should not be empty!");if(this._vMax=null,this._vMean=null,this._gMax=null,this._gMean=null,this._envTi=null,this._vti=null,this._extraInfo=null,this._initialized=!1,this._isHandleActive=!0,this._domHovered=!1,this._initialRegion=this.getRegionByXY(this._regions,d.default.worldToData(i.lps2IJK,i.worldPosition)),null===this._initialRegion)throw new Error("Invalid initial UltraSound region!");this._usPoints=[],this._material=null,this._geometry=null,this._mesh=null,this._lines=[],this._label=null,this._handles=[];const n=o();let r=new n(t,e,i);this.add(r),this._handles.push(r),this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._moveHandle.hide(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.create(),this.addEventListeners()}addEventListeners(){this._container.addEventListener("wheel",this.onMove),this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover)}removeEventListeners(){this._container.removeEventListener("wheel",this.onMove),this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover)}onHover(t){t&&this.hoverDom(t),this.hoverMesh();let e=!1;this._handles.forEach((t=>e=e||t.hovered)),this._hovered=e||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverMesh(){}hoverDom(t){this._domHovered="mouseenter"===t.type}onStart(t){let e=!1;this._moveHandle.onMove(t,!0),this._handles.forEach((i=>{i.onStart(t),e=e||i.active})),this._active=e||this._domHovered,this._isHandleActive=e,this._domHovered&&(this._controls.enabled=!1),this.update()}onMove(t){if(this.active){const e=this._moveHandle.worldPosition.clone();this._moveHandle.onMove(t,!0);const i=this._moveHandle.worldPosition.clone().sub(e);if(!this.isCorrectRegion(i))return void this._moveHandle.worldPosition.copy(e);if(this._initialized)this.updateDOMContent(!0),(!this._isHandleActive||this._handles[this._handles.length-2].active||this._handles[this._handles.length-1].active)&&(this._handles.forEach((t=>{t.worldPosition.add(i)})),this._isHandleActive=!1,this._handles[this._handles.length-2].active=!1,this._handles[this._handles.length-1].active=!1,this._controls.enabled=!1);else{this._handles[this._handles.length-1].hovered=!1,this._handles[this._handles.length-1].active=!1,this._handles[this._handles.length-1].tracking=!1;let t=new(o())(this._targetMesh,this._controls,this._params);t.hovered=!0,t.active=!0,t.tracking=!0,this.add(t),this._handles.push(t),this.createLine()}this._dragged=!0}else this.onHover(null);this._handles.forEach((e=>{e.onMove(t)})),this.active&&this._handles.length>2&&this.pushPopHandle(),this.update()}onEnd(){if(this._handles.length<3)return;let t=!1;this._handles.slice(0,-1).forEach((e=>{e.onEnd(),t=t||e.active})),this._dragged||!this._handles[this._handles.length-1].tracking?(this._handles[this._handles.length-1].tracking=!1,this._handles[this._handles.length-1].onEnd()):this._handles[this._handles.length-1].tracking=!1,!this._dragged&&this._initialized||(this.finalize(),this.updateDOMContent()),!this._dragged&&this._active&&(this._selected=!this._selected,this._handles.forEach((t=>t.selected=this._selected))),this._active=t||this._handles[this._handles.length-1].active,this._isHandleActive=t,this._dragged=!1,this._initialized=!0,this.update()}isCorrectRegion(t){let e=!0;return this._handles.forEach(((i,n)=>{!i.active&&this._isHandleActive||(e=e&&this.checkHandle(n,t))})),e}checkHandle(t,e){const i=this.getRegionByXY(this._regions,d.default.worldToData(this._params.lps2IJK,this._handles[t].worldPosition.clone().add(e)));return null!==i&&i===this._initialRegion&&"cm/sec"===this._regions[i].unitsY}create(){this.createMaterial(),this.createDOM()}createMaterial(){this._material=new a.nls}createDOM(){this._label=document.createElement("div"),this._label.className="widgets-label";const t=document.createElement("div");["vmax","vmean","gmax","gmean","envti","vti","info"].forEach((e=>{const i=document.createElement("div");i.className=e,t.appendChild(i)})),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}createLine(){const t=document.createElement("div");t.className="widgets-line",t.addEventListener("mouseenter",this.onHover),t.addEventListener("mouseleave",this.onHover),this._lines.push(t),this._container.appendChild(t)}pushPopHandle(){let t=this._handles[this._handles.length-3],e=this._handles[this._handles.length-2],i=this._handles[this._handles.length-1],n=this.isPointOnLine(t.worldPosition,e.worldPosition,i.worldPosition);return(n||t.screenPosition.distanceTo(i.screenPosition)<25)&&(this.remove(e),e.free(),this._handles[this._handles.length-2]=i,this._handles.pop(),this._container.removeChild(this._lines.pop())),n}isPointOnLine(t,e,i){return!(new a.Pa4).crossVectors(t.clone().sub(i),e.clone().sub(i)).length()}finalize(){this._initialized&&this._handles.splice(-2).forEach((t=>{this.remove(t),t.free()}));const t=d.default.worldToData(this._params.lps2IJK,this._handles[0]._worldPosition),e=d.default.worldToData(this._params.lps2IJK,this._handles[this._handles.length-1]._worldPosition),i=this._regions[this.getRegionByXY(this._regions,t)],n=i.y0+(i.axisY||0),r=o(),s={hideHandleMesh:this._params.hideHandleMesh||!1};for(t.y=n,e.y=n,this._usPoints=[this.getPointInRegion(i,e),this.getPointInRegion(i,t)],s.worldPosition=e.applyMatrix4(this._params.ijk2LPS),this._handles.push(new r(this._targetMesh,this._controls,s)),this.add(this._handles[this._handles.length-1]),s.worldPosition=t.applyMatrix4(this._params.ijk2LPS),this._handles.push(new r(this._targetMesh,this._controls,s)),this.add(this._handles[this._handles.length-1]);this._lines.length<this._handles.length;)this.createLine()}update(){this.updateColor(),this._handles.forEach((t=>t.update())),this.updateMesh(),this.updateDOMColor(),this.updateDOMPosition()}updateValues(){const t=this._regions[this.getRegionByXY(this._regions,d.default.worldToData(this._params.lps2IJK,this._handles[0]._worldPosition))],e={xMin:Number.POSITIVE_INFINITY,xMax:Number.NEGATIVE_INFINITY,yMin:Number.POSITIVE_INFINITY,yMax:Number.NEGATIVE_INFINITY};let i,n,r,s=0;this._vMax=0,this._vMean=0,this._gMean=0,this._usPoints.splice(2),this._handles.slice(0,-2).forEach((a=>{const o=this.getPointInRegion(t,d.default.worldToData(this._params.lps2IJK,a._worldPosition)),l=Math.abs(o.y/100),h=4*Math.pow(l,2);if((null===this._vMax||l>this._vMax)&&(this._vMax=l),e.xMin=Math.min(o.x,e.xMin),e.xMax=Math.max(o.x,e.xMax),e.yMin=Math.min(o.y,e.yMin),e.yMax=Math.max(o.y,e.yMax),r){const t=Math.abs(o.x-r);s+=t,this._vMean+=t*(i+l)/2,this._gMean+=t*(n+h)/2}i=l,n=h,r=o.x,this._usPoints.push(o)})),this._gMax=4*Math.pow(this._vMax,2),this._vMean/=s,this._gMean/=s,this._envTi=1e3*s,this._vti=this.getArea(this._usPoints),this._shapeWarn=e.xMax-e.xMin!==s||e.yMin<0!=e.yMax<0}updateMesh(){this._mesh&&this.remove(this._mesh),this._geometry=new a.u9r;const t=new Float32Array(3*this._handles.length);this._geometry.setAttribute("position",new a.TlE(t,3));let e=0;this._handles.forEach((i=>{t[e++]=i.worldPosition.x,t[e++]=i.worldPosition.y,t[e++]=i.worldPosition.z})),t[e++]=this._handles[0].worldPosition.x,t[e++]=this._handles[0].worldPosition.y,t[e++]=this._handles[0].worldPosition.z,this._geometry.computeVertexNormals(),this.updateMeshColor(),this._mesh=new a.x12(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)}updateMeshColor(){this._material&&this._material.color.set(this._color)}updateDOMColor(){this._handles.length>=2&&this._lines.forEach((t=>t.style.backgroundColor=this._color)),this._label.style.borderColor=this._color}updateDOMContent(t){const e=this._label.querySelector(".vmax"),i=this._label.querySelector(".vmean"),n=this._label.querySelector(".gmax"),r=this._label.querySelector(".gmean"),s=this._label.querySelector(".envti"),a=this._label.querySelector(".vti"),o=this._label.querySelector(".info");if(t)return e.innerHTML="",i.innerHTML="",n.innerHTML="",r.innerHTML="",s.innerHTML="",a.innerHTML="",void(o.innerHTML="");this.updateValues(),this._shapeWarn&&!this._label.hasAttribute("title")?(this._label.setAttribute("title","Values may be incorrect due to invalid curve."),this._label.style.color=this._colors.error):!this._shapeWarn&&this._label.hasAttribute("title")&&(this._label.removeAttribute("title"),this._label.style.color=this._colors.text),e.innerHTML=`Vmax: ${this._vMax.toFixed(2)} m/s`,i.innerHTML=`Vmean: ${this._vMean.toFixed(2)} m/s`,n.innerHTML=`Gmax: ${this._gMax.toFixed(2)} mmhg`,r.innerHTML=`Gmean: ${this._gMean.toFixed(2)} mmhg`,s.innerHTML=`Env.Ti: ${this._envTi.toFixed(1)} ms`,a.innerHTML=`VTI: ${this._vti.toFixed(2)} cm`,o.innerHTML=this._extraInfo}updateDOMPosition(){if(this._handles.length<2)return;let t=null;this._lines.forEach(((e,i)=>{const n=this.getLineData(this._handles[i].screenPosition,this._handles[i+1===this._handles.length?0:i+1].screenPosition);e.style.transform=`translate3D(${n.transformX}px, ${n.transformY}px, 0)\n                    rotate(${n.transformAngle}rad)`,e.style.width=n.length+"px",(null===t||t.y<this._handles[i].screenPosition.y)&&(t=this._handles[i].screenPosition.clone())})),this._initialized&&(t.y+=15+this._label.offsetHeight/2,t=this.adjustLabelTransform(this._label,t),this._label.style.transform=`translate3D(${t.x}px, ${t.y}px, 0)`)}hideDOM(){this._handles.forEach((t=>t.hideDOM())),this._lines.forEach((t=>t.style.display="none")),this._label.style.display="none"}showDOM(){this._handles.forEach((t=>t.showDOM())),this._lines.forEach((t=>t.style.display="")),this._label.style.display=""}free(){this.removeEventListeners(),this._handles.forEach((t=>{this.remove(t),t.free()})),this._handles=[],this._usPoints=[],this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._lines.forEach((t=>{t.removeEventListener("mouseenter",this.onHover),t.removeEventListener("mouseleave",this.onHover),this._container.removeChild(t)})),this._lines=[],this._container.removeChild(this._label),this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._geometry&&(this._geometry.dispose(),this._geometry=null),this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,super.free()}getMeasurements(){return{vMax:this._vMax,vMean:this._vMean,gMax:this._gMax,gMean:this._gMean,envTi:this._envTi,vti:this._vti}}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handles.forEach((e=>e.targetMesh=t)),this._moveHandle.targetMesh=t,this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handles.forEach((e=>e._worldPosition.copy(t))),this._worldPosition.copy(t),this.update()}get extraInfo(){return this._extraInfo}set extraInfo(t){this._extraInfo=t,this._label.querySelector(".info").innerHTML=t}}var b=i(7620);class w extends r.widgetsBase{constructor(t,e,i={}){super(t,e,i),this._widgetType="VoxelProbe",this._stack=i.stack,this._container.style.cursor="pointer",this._controls.enabled=!1,this._initialized=!1,this._active=!0,this._moving=!0,this._domHovered=!1,this._label=null;const n=o();this._handle=new n(t,e,i),this.add(this._handle),this._moveHandle=new n(t,e,i),this.add(this._moveHandle),this._moveHandle.hide(),this.create(),this.onMove=this.onMove.bind(this),this.onHover=this.onHover.bind(this),this.addEventListeners()}addEventListeners(){this._label.addEventListener("mouseenter",this.onHover),this._label.addEventListener("mouseleave",this.onHover),this._container.addEventListener("wheel",this.onMove)}removeEventListeners(){this._label.removeEventListener("mouseenter",this.onHover),this._label.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("wheel",this.onMove)}onStart(t){this._moveHandle.onMove(t,!0),this._handle.onStart(t),this._active=this._handle.active||this._domHovered,this._domHovered&&(this._moving=!0,this._controls.enabled=!1),this.update()}onMove(t){if(this._active){const e=this._moveHandle.worldPosition.clone();this._dragged=!0,this._moveHandle.onMove(t,!0),this._moving&&this._handle.worldPosition.add(this._moveHandle.worldPosition.clone().sub(e))}else this.onHover(null);this._handle.onMove(t),this.update()}onEnd(){this._handle.onEnd(),!this._dragged&&this._active&&this._initialized&&(this._selected=!this._selected,this._handle.selected=this._selected),this._initialized=!0,this._active=this._handle.active,this._dragged=!1,this._moving=!1,this.update()}onHover(t){t&&this.hoverDom(t),this._hovered=this._handle.hovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"}hoverDom(t){this._domHovered="mouseenter"===t.type}create(){this.createVoxel(),this.createDOM()}createVoxel(){this._voxel=new b.Z,this._voxel.id=this.id}createDOM(){this._label=document.createElement("div"),this._label.className="widgets-label";let t=document.createElement("div"),e=document.createElement("div");e.className="lpsPosition",t.appendChild(e);let i=document.createElement("div");i.className="ijkPosition",t.appendChild(i);let n=document.createElement("div");n.className="value",t.appendChild(n),this._label.appendChild(t),this._container.appendChild(this._label),this.updateDOMColor()}update(){this.updateColor(),this._handle.update(),this._worldPosition.copy(this._handle.worldPosition),this.updateVoxel(),this.updateDOM()}updateVoxel(){this._voxel.worldCoordinates=this._worldPosition,this._voxel.dataCoordinates=d.default.worldToData(this._stack.lps2IJK,this._worldPosition);let t=d.default.getPixelData(this._stack,this._voxel.dataCoordinates);this._voxel.value=null===t||this._stack.numberOfChannels>1?"NA":d.default.rescaleSlopeIntercept(t,this._stack.rescaleSlope,this._stack.rescaleIntercept).toFixed()}updateDOM(){const t=this._label.querySelector(".lpsPosition"),e=this._label.querySelector(".ijkPosition"),i=this._label.querySelector(".value");t.innerHTML=`LPS: \n      ${this._voxel.worldCoordinates.x.toFixed(2)} :\n      ${this._voxel.worldCoordinates.y.toFixed(2)} :\n      ${this._voxel.worldCoordinates.z.toFixed(2)}`,e.innerHTML=`IJK: \n      ${this._voxel.dataCoordinates.x} :\n      ${this._voxel.dataCoordinates.y} :\n      ${this._voxel.dataCoordinates.z}`,i.innerHTML=`Value: ${this._voxel.value}`,this.updateDOMColor();const n=this.adjustLabelTransform(this._label,this._handle.screenPosition,!0);this._label.style.transform=`translate3D(${n.x}px, ${n.y}px, 0)`}updateDOMColor(){this._label.style.borderColor=this._color}free(){this.removeEventListeners(),this.remove(this._handle),this._handle.free(),this._handle=null,this.remove(this._moveHandle),this._moveHandle.free(),this._moveHandle=null,this._container.removeChild(this._label),this._stack=null,this._voxel=null,super.free()}hideDOM(){this._label.style.display="none",this._handle.hideDOM()}showDOM(){this._label.style.display="",this._handle.showDOM()}get targetMesh(){return this._targetMesh}set targetMesh(t){this._targetMesh=t,this._handle.targetMesh=t,this._moveHandle.targetMesh=t,this.update()}get worldPosition(){return this._worldPosition}set worldPosition(t){this._handle.worldPosition.copy(t),this._moveHandle.worldPosition.copy(t),this._worldPosition.copy(t),this.update()}get active(){return this._active}set active(t){this._active=t,this._controls.enabled=!this._active,this.update()}}},5232:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i="140",n=100,r=300,s=301,a=302,o=303,l=304,h=306,c=1e3,u=1001,d=1002,p=1003,f=1004,m=1005,_=1006,g=1007,y=1008,v=1009,x=1012,b=1014,w=1015,M=1016,S=1020,E=1023,T=1026,A=1027,P=33776,C=33777,L=33778,R=33779,I=35840,D=35841,O=35842,N=35843,F=37492,k=37496,z=37808,U=37809,B=37810,H=37811,G=37812,V=37813,W=37814,j=37815,q=37816,X=37817,Y=37818,Z=37819,J=37820,K=37821,$=36492,Q=2300,tt=2301,et=2302,it=2400,nt=2401,rt=2402,st=2501,at=3e3,ot=3001,lt="srgb",ht="srgb-linear",ct=7680,ut=35044,dt=35048,pt="300 es",ft=1035;class mt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const _t=[];for(let t=0;t<256;t++)_t[t]=(t<16?"0":"")+t.toString(16);let gt=1234567;const yt=Math.PI/180,vt=180/Math.PI;function xt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_t[255&t]+_t[t>>8&255]+_t[t>>16&255]+_t[t>>24&255]+"-"+_t[255&e]+_t[e>>8&255]+"-"+_t[e>>16&15|64]+_t[e>>24&255]+"-"+_t[63&i|128]+_t[i>>8&255]+"-"+_t[i>>16&255]+_t[i>>24&255]+_t[255&n]+_t[n>>8&255]+_t[n>>16&255]+_t[n>>24&255]).toLowerCase()}function bt(t,e,i){return Math.max(e,Math.min(i,t))}function wt(t,e){return(t%e+e)%e}function Mt(t,e,i){return(1-i)*t+i*e}function St(t){return 0==(t&t-1)&&0!==t}function Et(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var At=Object.freeze({__proto__:null,DEG2RAD:yt,RAD2DEG:vt,generateUUID:xt,clamp:bt,euclideanModulo:wt,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:Mt,damp:function(t,e,i,n){return Mt(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(wt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(gt=t);let e=gt+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*yt},radToDeg:function(t){return t*vt},isPowerOfTwo:St,ceilPowerOfTwo:Et,floorPowerOfTwo:Tt,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),h=s((e+n)/2),c=a((e+n)/2),u=s((e-n)/2),d=a((e-n)/2),p=s((n-e)/2),f=a((n-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*d,o*h);break;case"YZY":t.set(l*d,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*d,o*c,o*h);break;case"XZX":t.set(o*c,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*c,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}},denormalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}});class Pt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Pt.prototype.isVector2=!0;class Ct{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],_=n[6],g=n[1],y=n[4],v=n[7],x=n[2],b=n[5],w=n[8];return r[0]=s*f+a*g+o*x,r[3]=s*m+a*y+o*b,r[6]=s*_+a*v+o*w,r[1]=l*f+h*g+c*x,r[4]=l*m+h*y+c*b,r[7]=l*_+h*v+c*w,r[2]=u*f+d*g+p*x,r[5]=u*m+d*y+p*b,r[8]=u*_+d*v+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-i*r*h+i*a*o+n*r*l-n*s*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,u=a*o-h*r,d=l*r-s*o,p=e*c+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(n*l-h*i)*f,t[2]=(a*i-n*s)*f,t[3]=u*f,t[4]=(h*e-n*o)*f,t[5]=(n*r-a*e)*f,t[6]=d*f,t[7]=(i*o-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],h=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*h,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*h,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Lt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}Ct.prototype.isMatrix3=!0;const Rt={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function It(t,e){return new Rt[t](e)}function Dt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Ot(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Nt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Ft={[lt]:{[ht]:Ot},[ht]:{[lt]:Nt}},kt={legacyMode:!0,get workingColorSpace(){return ht},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(Ft[e]&&void 0!==Ft[e][i]){const n=Ft[e][i];return t.r=n(t.r),t.g=n(t.g),t.b=n(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},zt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ut={r:0,g:0,b:0},Bt={h:0,s:0,l:0},Ht={h:0,s:0,l:0};function Gt(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Vt(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class Wt{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,kt.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n="srgb-linear"){return this.r=t,this.g=e,this.b=i,kt.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n="srgb-linear"){if(t=wt(t,1),e=bt(e,0,1),i=bt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=Gt(r,n,t+1/3),this.g=Gt(r,n,t),this.b=Gt(r,n,t-1/3)}return kt.toWorkingColorSpace(this,n),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,kt.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,kt.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return i(t[4]),this.setHSL(n,r,s,e)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,kt.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,kt.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=zt[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ot(t.r),this.g=Ot(t.g),this.b=Ot(t.b),this}copyLinearToSRGB(t){return this.r=Nt(t.r),this.g=Nt(t.g),this.b=Nt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return kt.fromWorkingColorSpace(Vt(this,Ut),t),bt(255*Ut.r,0,255)<<16^bt(255*Ut.g,0,255)<<8^bt(255*Ut.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){kt.fromWorkingColorSpace(Vt(this,Ut),e);const i=Ut.r,n=Ut.g,r=Ut.b,s=Math.max(i,n,r),a=Math.min(i,n,r);let o,l;const h=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=h<=.5?t/(s+a):t/(2-s-a),s){case i:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-i)/t+2;break;case r:o=(i-n)/t+4}o/=6}return t.h=o,t.s=l,t.l=h,t}getRGB(t,e="srgb-linear"){return kt.fromWorkingColorSpace(Vt(this,Ut),e),t.r=Ut.r,t.g=Ut.g,t.b=Ut.b,t}getStyle(t="srgb"){return kt.fromWorkingColorSpace(Vt(this,Ut),t),t!==lt?`color(${t} ${Ut.r} ${Ut.g} ${Ut.b})`:`rgb(${255*Ut.r|0},${255*Ut.g|0},${255*Ut.b|0})`}offsetHSL(t,e,i){return this.getHSL(Bt),Bt.h+=t,Bt.s+=e,Bt.l+=i,this.setHSL(Bt.h,Bt.s,Bt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Bt),t.getHSL(Ht);const i=Mt(Bt.h,Ht.h,e),n=Mt(Bt.s,Ht.s,e),r=Mt(Bt.l,Ht.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let jt;Wt.NAMES=zt,Wt.prototype.isColor=!0,Wt.prototype.r=1,Wt.prototype.g=1,Wt.prototype.b=1;class qt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===jt&&(jt=Dt("canvas")),jt.width=t.width,jt.height=t.height;const i=jt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=jt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Dt("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*Ot(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ot(e[t]/255)):e[t]=Ot(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Xt{constructor(t=null){this.uuid=xt(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(Yt(n[e].image)):t.push(Yt(n[e]))}else t=Yt(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function Yt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?qt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Xt.prototype.isSource=!0;let Zt=0;class Jt extends mt{constructor(t=Jt.DEFAULT_IMAGE,e=Jt.DEFAULT_MAPPING,i=1001,n=1001,r=1006,s=1008,a=1023,o=1009,l=1,h=3e3){super(),Object.defineProperty(this,"id",{value:Zt++}),this.uuid=xt(),this.name="",this.source=new Xt(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Pt(0,0),this.repeat=new Pt(1,1),this.center=new Pt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ct,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==r)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case c:t.x=t.x-Math.floor(t.x);break;case u:t.x=t.x<0?0:1;break;case d:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case c:t.y=t.y-Math.floor(t.y);break;case u:t.y=t.y<0?0:1;break;case d:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}Jt.DEFAULT_IMAGE=null,Jt.DEFAULT_MAPPING=r,Jt.prototype.isTexture=!0;class Kt{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,a=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],_=o[10];if(Math.abs(h-u)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(h+u)<a&&Math.abs(c+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+_-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,g=(_+1)/2,y=(h+u)/4,v=(c+f)/4,x=(p+m)/4;return t>o&&t>g?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=v/i):o>g?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=y/n,r=x/n):g<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(g),i=v/r,n=x/r),this.set(i,n,r,e),this}let g=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(g)<.001&&(g=1),this.x=(m-p)/g,this.y=(c-f)/g,this.z=(u-h)/g,this.w=Math.acos((l+d+_-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Kt.prototype.isVector4=!0;class $t extends mt{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Kt(0,0,t,e),this.scissorTest=!1,this.viewport=new Kt(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new Jt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:_,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Xt(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}$t.prototype.isWebGLRenderTarget=!0;class Qt extends Jt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=p,this.minFilter=p,this.wrapR=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Qt.prototype.isDataArrayTexture=!0;class te extends $t{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Qt(null,t,e,i),this.texture.isRenderTargetTexture=!0}}te.prototype.isWebGLArrayRenderTarget=!0;class ee extends Jt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=p,this.minFilter=p,this.wrapR=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}ee.prototype.isData3DTexture=!0;class ie extends $t{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new ee(null,t,e,i),this.texture.isRenderTargetTexture=!0}}ie.prototype.isWebGL3DRenderTarget=!0;class ne extends $t{constructor(t,e,i,n={}){super(t,e,n);const r=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}ne.prototype.isWebGLMultipleRenderTargets=!0;class re{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(n/2),c=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>c){const t=2*Math.sqrt(1+i-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-i-c);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(bt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+s*a+n*l-r*o,this._y=n*h+s*o+r*a-i*l,this._z=r*h+s*l+i*o-n*a,this._w=s*h-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}re.prototype.isQuaternion=!0;class se{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(oe.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(oe.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,h=o*i+a*e-r*n,c=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+h*-a-c*-s,this.y=h*o+u*-s+c*-r-l*-a,this.z=c*o+u*-a+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ae.copy(this).projectOnVector(t),this.sub(ae)}reflect(t){return this.sub(ae.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(bt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}se.prototype.isVector3=!0;const ae=new se,oe=new re;class le{constructor(t=new se(1/0,1/0,1/0),e=new se(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=ce.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)ce.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(ce)}else null===i.boundingBox&&i.computeBoundingBox(),ue.copy(i.boundingBox),ue.applyMatrix4(t.matrixWorld),this.union(ue);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ce),ce.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ye),ve.subVectors(this.max,ye),de.subVectors(t.a,ye),pe.subVectors(t.b,ye),fe.subVectors(t.c,ye),me.subVectors(pe,de),_e.subVectors(fe,pe),ge.subVectors(de,fe);let e=[0,-me.z,me.y,0,-_e.z,_e.y,0,-ge.z,ge.y,me.z,0,-me.x,_e.z,0,-_e.x,ge.z,0,-ge.x,-me.y,me.x,0,-_e.y,_e.x,0,-ge.y,ge.x,0];return!!we(e,de,pe,fe,ve)&&(e=[1,0,0,0,1,0,0,0,1],!!we(e,de,pe,fe,ve)&&(xe.crossVectors(me,_e),e=[xe.x,xe.y,xe.z],we(e,de,pe,fe,ve)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ce.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(ce).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(he[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),he[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),he[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),he[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),he[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),he[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),he[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),he[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(he)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}le.prototype.isBox3=!0;const he=[new se,new se,new se,new se,new se,new se,new se,new se],ce=new se,ue=new le,de=new se,pe=new se,fe=new se,me=new se,_e=new se,ge=new se,ye=new se,ve=new se,xe=new se,be=new se;function we(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){be.fromArray(t,s);const a=r.x*Math.abs(be.x)+r.y*Math.abs(be.y)+r.z*Math.abs(be.z),o=e.dot(be),l=i.dot(be),h=n.dot(be);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const Me=new le,Se=new se,Ee=new se,Te=new se;class Ae{constructor(t=new se,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Me.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Te.subVectors(t,this.center);const e=Te.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(Te.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?Ee.set(0,0,1).multiplyScalar(t.radius):Ee.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Se.copy(t.center).add(Ee)),this.expandByPoint(Se.copy(t.center).sub(Ee)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Pe=new se,Ce=new se,Le=new se,Re=new se,Ie=new se,De=new se,Oe=new se;class Ne{constructor(t=new se,e=new se(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Pe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Pe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Pe.copy(this.direction).multiplyScalar(e).add(this.origin),Pe.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Ce.copy(t).add(e).multiplyScalar(.5),Le.copy(e).sub(t).normalize(),Re.copy(this.origin).sub(Ce);const r=.5*t.distanceTo(e),s=-this.direction.dot(Le),a=Re.dot(this.direction),o=-Re.dot(Le),l=Re.lengthSq(),h=Math.abs(1-s*s);let c,u,d,p;if(h>0)if(c=s*o-a,u=s*a-o,p=r*h,c>=0)if(u>=-p)if(u<=p){const t=1/h;c*=t,u*=t,d=c*(c+s*u+2*a)+u*(s*c+u+2*o)+l}else u=r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u=-r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u<=-p?(c=Math.max(0,-(-s*r+a)),u=c>0?-r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l):u<=p?(c=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(c=Math.max(0,-(s*r+a)),u=c>0?r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l);else u=s>0?-r:r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(Le).multiplyScalar(u).add(Ce),d}intersectSphere(t,e){Pe.subVectors(t.center,this.origin);const i=Pe.dot(this.direction),n=Pe.dot(Pe)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Pe)}intersectTriangle(t,e,i,n,r){Ie.subVectors(e,t),De.subVectors(i,t),Oe.crossVectors(Ie,De);let s,a=this.direction.dot(Oe);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Re.subVectors(this.origin,t);const o=s*this.direction.dot(De.crossVectors(Re,De));if(o<0)return null;const l=s*this.direction.dot(Ie.cross(Re));if(l<0)return null;if(o+l>a)return null;const h=-s*Re.dot(Oe);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Fe{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){const _=this.elements;return _[0]=t,_[4]=e,_[8]=i,_[12]=n,_[1]=r,_[5]=s,_[9]=a,_[13]=o,_[2]=l,_[6]=h,_[10]=c,_[14]=u,_[3]=d,_[7]=p,_[11]=f,_[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Fe).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/ke.setFromMatrixColumn(t,0).length(),r=1/ke.setFromMatrixColumn(t,1).length(),s=1/ke.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=n*c+i,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ue,t,Be)}lookAt(t,e,i){const n=this.elements;return Ve.subVectors(t,e),0===Ve.lengthSq()&&(Ve.z=1),Ve.normalize(),He.crossVectors(i,Ve),0===He.lengthSq()&&(1===Math.abs(i.z)?Ve.x+=1e-4:Ve.z+=1e-4,Ve.normalize(),He.crossVectors(i,Ve)),He.normalize(),Ge.crossVectors(Ve,He),n[0]=He.x,n[4]=Ge.x,n[8]=Ve.x,n[1]=He.y,n[5]=Ge.y,n[9]=Ve.y,n[2]=He.z,n[6]=Ge.z,n[10]=Ve.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],_=i[14],g=i[3],y=i[7],v=i[11],x=i[15],b=n[0],w=n[4],M=n[8],S=n[12],E=n[1],T=n[5],A=n[9],P=n[13],C=n[2],L=n[6],R=n[10],I=n[14],D=n[3],O=n[7],N=n[11],F=n[15];return r[0]=s*b+a*E+o*C+l*D,r[4]=s*w+a*T+o*L+l*O,r[8]=s*M+a*A+o*R+l*N,r[12]=s*S+a*P+o*I+l*F,r[1]=h*b+c*E+u*C+d*D,r[5]=h*w+c*T+u*L+d*O,r[9]=h*M+c*A+u*R+d*N,r[13]=h*S+c*P+u*I+d*F,r[2]=p*b+f*E+m*C+_*D,r[6]=p*w+f*T+m*L+_*O,r[10]=p*M+f*A+m*R+_*N,r[14]=p*S+f*P+m*I+_*F,r[3]=g*b+y*E+v*C+x*D,r[7]=g*w+y*T+v*L+x*O,r[11]=g*M+y*A+v*R+x*N,r[15]=g*S+y*P+v*I+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-n*l*c-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+i*s*d+r*a*h-i*l*h)+t[15]*(-n*a*h-e*o*c+e*a*u+n*s*c-i*s*u+i*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],_=t[15],g=c*m*l-f*u*l+f*o*d-a*m*d-c*o*_+a*u*_,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*_-s*u*_,v=h*f*l-p*c*l+p*a*d-s*f*d-h*a*_+s*c*_,x=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,b=e*g+i*y+n*v+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=g*w,t[1]=(f*u*r-c*m*r-f*n*d+i*m*d+c*n*_-i*u*_)*w,t[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*_+i*o*_)*w,t[3]=(c*o*r-a*u*r-c*n*l+i*u*l+a*n*d-i*o*d)*w,t[4]=y*w,t[5]=(h*m*r-p*u*r+p*n*d-e*m*d-h*n*_+e*u*_)*w,t[6]=(p*o*r-s*m*r-p*n*l+e*m*l+s*n*_-e*o*_)*w,t[7]=(s*u*r-h*o*r+h*n*l-e*u*l-s*n*d+e*o*d)*w,t[8]=v*w,t[9]=(p*c*r-h*f*r-p*i*d+e*f*d+h*i*_-e*c*_)*w,t[10]=(s*f*r-p*a*r+p*i*l-e*f*l-s*i*_+e*a*_)*w,t[11]=(h*a*r-s*c*r-h*i*l+e*c*l+s*i*d-e*a*d)*w,t[12]=x*w,t[13]=(h*f*n-p*c*n+p*i*u-e*f*u-h*i*m+e*c*m)*w,t[14]=(p*a*n-s*f*n-p*i*o+e*f*o+s*i*m-e*a*m)*w,t[15]=(s*c*n-h*a*n+h*i*o-e*c*o-s*i*u+e*a*u)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+i,h*o-n*s,0,l*o-n*a,h*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,_=a*c,g=o*l,y=o*h,v=o*c,x=i.x,b=i.y,w=i.z;return n[0]=(1-(f+_))*x,n[1]=(d+v)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-v)*b,n[5]=(1-(u+_))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(m-g)*w,n[10]=(1-(u+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=ke.set(n[0],n[1],n[2]).length();const s=ke.set(n[4],n[5],n[6]).length(),a=ke.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],ze.copy(this);const o=1/r,l=1/s,h=1/a;return ze.elements[0]*=o,ze.elements[1]*=o,ze.elements[2]*=o,ze.elements[4]*=l,ze.elements[5]*=l,ze.elements[6]*=l,ze.elements[8]*=h,ze.elements[9]*=h,ze.elements[10]*=h,e.setFromRotationMatrix(ze),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),h=1/(s-r),c=(e+t)*o,u=(i+n)*l,d=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Fe.prototype.isMatrix4=!0;const ke=new se,ze=new Fe,Ue=new se(0,0,0),Be=new se(1,1,1),He=new se,Ge=new se,Ve=new se,We=new Fe,je=new re;class qe{constructor(t=0,e=0,i=0,n=qe.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(bt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-bt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(bt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-bt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(bt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-bt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return We.makeRotationFromQuaternion(t),this.setFromRotationMatrix(We,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return je.setFromEuler(this),this.setFromQuaternion(je,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}qe.prototype.isEuler=!0,qe.DefaultOrder="XYZ",qe.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Xe{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Ye=0;const Ze=new se,Je=new re,Ke=new Fe,$e=new se,Qe=new se,ti=new se,ei=new re,ii=new se(1,0,0),ni=new se(0,1,0),ri=new se(0,0,1),si={type:"added"},ai={type:"removed"};class oi extends mt{constructor(){super(),Object.defineProperty(this,"id",{value:Ye++}),this.uuid=xt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=oi.DefaultUp.clone();const t=new se,e=new qe,i=new re,n=new se(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Fe},normalMatrix:{value:new Ct}}),this.matrix=new Fe,this.matrixWorld=new Fe,this.matrixAutoUpdate=oi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Xe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Je.setFromAxisAngle(t,e),this.quaternion.multiply(Je),this}rotateOnWorldAxis(t,e){return Je.setFromAxisAngle(t,e),this.quaternion.premultiply(Je),this}rotateX(t){return this.rotateOnAxis(ii,t)}rotateY(t){return this.rotateOnAxis(ni,t)}rotateZ(t){return this.rotateOnAxis(ri,t)}translateOnAxis(t,e){return Ze.copy(t).applyQuaternion(this.quaternion),this.position.add(Ze.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ii,t)}translateY(t){return this.translateOnAxis(ni,t)}translateZ(t){return this.translateOnAxis(ri,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Ke.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?$e.copy(t):$e.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Qe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ke.lookAt(Qe,$e,this.up):Ke.lookAt($e,Qe,this.up),this.quaternion.setFromRotationMatrix(Ke),n&&(Ke.extractRotation(n.matrixWorld),Je.setFromRotationMatrix(Ke),this.quaternion.premultiply(Je.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(si)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ai)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ai)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ke.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ke.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ke),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qe,t,ti),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qe,ei,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),h=s(t.animations),c=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}oi.DefaultUp=new se(0,1,0),oi.DefaultMatrixAutoUpdate=!0,oi.prototype.isObject3D=!0;const li=new se,hi=new se,ci=new se,ui=new se,di=new se,pi=new se,fi=new se,mi=new se,_i=new se,gi=new se;class yi{constructor(t=new se,e=new se,i=new se){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),li.subVectors(t,e),n.cross(li);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){li.subVectors(n,e),hi.subVectors(i,e),ci.subVectors(t,e);const s=li.dot(li),a=li.dot(hi),o=li.dot(ci),l=hi.dot(hi),h=hi.dot(ci),c=s*l-a*a;if(0===c)return r.set(-2,-1,-1);const u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,ui),ui.x>=0&&ui.y>=0&&ui.x+ui.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,ui),o.set(0,0),o.addScaledVector(r,ui.x),o.addScaledVector(s,ui.y),o.addScaledVector(a,ui.z),o}static isFrontFacing(t,e,i,n){return li.subVectors(i,e),hi.subVectors(t,e),li.cross(hi).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return li.subVectors(this.c,this.b),hi.subVectors(this.a,this.b),.5*li.cross(hi).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return yi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return yi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return yi.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return yi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return yi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;di.subVectors(n,i),pi.subVectors(r,i),mi.subVectors(t,i);const o=di.dot(mi),l=pi.dot(mi);if(o<=0&&l<=0)return e.copy(i);_i.subVectors(t,n);const h=di.dot(_i),c=pi.dot(_i);if(h>=0&&c<=h)return e.copy(n);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return s=o/(o-h),e.copy(i).addScaledVector(di,s);gi.subVectors(t,r);const d=di.dot(gi),p=pi.dot(gi);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(pi,a);const m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return fi.subVectors(r,n),a=(c-h)/(c-h+(d-p)),e.copy(n).addScaledVector(fi,a);const _=1/(m+f+u);return s=f*_,a=u*_,e.copy(i).addScaledVector(di,s).addScaledVector(pi,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let vi=0;class xi extends mt{constructor(){super(),Object.defineProperty(this,"id",{value:vi++}),this.uuid=xt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ct,this.stencilZFail=ct,this.stencilZPass=ct,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}xi.prototype.isMaterial=!0,xi.fromType=function(){return null};class bi extends xi{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Wt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}bi.prototype.isMeshBasicMaterial=!0;const wi=new se,Mi=new Pt;class Si{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new Wt),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Pt),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new se),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new Kt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Mi.fromBufferAttribute(this,e),Mi.applyMatrix3(t),this.setXY(e,Mi.x,Mi.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)wi.fromBufferAttribute(this,e),wi.applyMatrix3(t),this.setXYZ(e,wi.x,wi.y,wi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)wi.fromBufferAttribute(this,e),wi.applyMatrix4(t),this.setXYZ(e,wi.x,wi.y,wi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)wi.fromBufferAttribute(this,e),wi.applyNormalMatrix(t),this.setXYZ(e,wi.x,wi.y,wi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)wi.fromBufferAttribute(this,e),wi.transformDirection(t),this.setXYZ(e,wi.x,wi.y,wi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ut&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}Si.prototype.isBufferAttribute=!0;class Ei extends Si{constructor(t,e,i){super(new Int8Array(t),e,i)}}class Ti extends Si{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class Ai extends Si{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}}class Pi extends Si{constructor(t,e,i){super(new Int16Array(t),e,i)}}class Ci extends Si{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Li extends Si{constructor(t,e,i){super(new Int32Array(t),e,i)}}class Ri extends Si{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ii extends Si{constructor(t,e,i){super(new Uint16Array(t),e,i)}}Ii.prototype.isFloat16BufferAttribute=!0;class Di extends Si{constructor(t,e,i){super(new Float32Array(t),e,i)}}class Oi extends Si{constructor(t,e,i){super(new Float64Array(t),e,i)}}let Ni=0;const Fi=new Fe,ki=new oi,zi=new se,Ui=new le,Bi=new le,Hi=new se;class Gi extends mt{constructor(){super(),Object.defineProperty(this,"id",{value:Ni++}),this.uuid=xt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Lt(t)?Ri:Ci)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Ct).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Fi.makeRotationFromQuaternion(t),this.applyMatrix4(Fi),this}rotateX(t){return Fi.makeRotationX(t),this.applyMatrix4(Fi),this}rotateY(t){return Fi.makeRotationY(t),this.applyMatrix4(Fi),this}rotateZ(t){return Fi.makeRotationZ(t),this.applyMatrix4(Fi),this}translate(t,e,i){return Fi.makeTranslation(t,e,i),this.applyMatrix4(Fi),this}scale(t,e,i){return Fi.makeScale(t,e,i),this.applyMatrix4(Fi),this}lookAt(t){return ki.lookAt(t),ki.updateMatrix(),this.applyMatrix4(ki.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zi).negate(),this.translate(zi.x,zi.y,zi.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Di(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new le);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new se(-1/0,-1/0,-1/0),new se(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Ui.setFromBufferAttribute(i),this.morphTargetsRelative?(Hi.addVectors(this.boundingBox.min,Ui.min),this.boundingBox.expandByPoint(Hi),Hi.addVectors(this.boundingBox.max,Ui.max),this.boundingBox.expandByPoint(Hi)):(this.boundingBox.expandByPoint(Ui.min),this.boundingBox.expandByPoint(Ui.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ae);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new se,1/0);if(t){const i=this.boundingSphere.center;if(Ui.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Bi.setFromBufferAttribute(i),this.morphTargetsRelative?(Hi.addVectors(Ui.min,Bi.min),Ui.expandByPoint(Hi),Hi.addVectors(Ui.max,Bi.max),Ui.expandByPoint(Hi)):(Ui.expandByPoint(Bi.min),Ui.expandByPoint(Bi.max))}Ui.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)Hi.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Hi));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Hi.fromBufferAttribute(s,e),a&&(zi.fromBufferAttribute(t,e),Hi.add(zi)),n=Math.max(n,i.distanceToSquared(Hi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Si(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],h=[];for(let t=0;t<a;t++)l[t]=new se,h[t]=new se;const c=new se,u=new se,d=new se,p=new Pt,f=new Pt,m=new Pt,_=new se,g=new se;function y(t,e,i){c.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(c),d.sub(c),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(_.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(_),l[e].add(_),l[i].add(_),h[t].add(g),h[e].add(g),h[i].add(g))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let t=0,e=v.length;t<e;++t){const e=v[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)y(i[t+0],i[t+1],i[t+2])}const x=new se,b=new se,w=new se,M=new se;function S(t){w.fromArray(r,3*t),M.copy(w);const e=l[t];x.copy(e),x.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(M,e);const i=b.dot(h[t])<0?-1:1;o[4*t]=x.x,o[4*t+1]=x.y,o[4*t+2]=x.z,o[4*t+3]=i}for(let t=0,e=v.length;t<e;++t){const e=v[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new Si(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new se,r=new se,s=new se,a=new se,o=new se,l=new se,h=new se,c=new se;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(h),o.add(h),l.add(h),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],a=s.array,o=s.itemSize*e,l=Math.min(a.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Hi.fromBufferAttribute(t,e),Hi.normalize(),t.setXYZ(e,Hi.x,Hi.y,Hi.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new Si(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Gi,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],a=r[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Gi.prototype.isBufferGeometry=!0;const Vi=new Fe,Wi=new Ne,ji=new Ae,qi=new se,Xi=new se,Yi=new se,Zi=new se,Ji=new se,Ki=new se,$i=new se,Qi=new se,tn=new se,en=new Pt,nn=new Pt,rn=new Pt,sn=new se,an=new se;class on extends oi{constructor(t=new Gi,e=new bi){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),ji.copy(i.boundingSphere),ji.applyMatrix4(r),!1===t.ray.intersectsSphere(ji))return;if(Vi.copy(r).invert(),Wi.copy(t.ray).applyMatrix4(Vi),null!==i.boundingBox&&!1===Wi.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,c=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=u.length;i<p;i++){const p=u[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=ln(this,f,t,Wi,a,o,l,h,c,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=ln(this,n,t,Wi,a,o,l,h,c,u,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}else if(void 0!==a)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3)s=ln(this,p,t,Wi,a,o,l,h,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}else for(let i=Math.max(0,d.start),r=Math.min(a.count,d.start+d.count);i<r;i+=3)s=ln(this,n,t,Wi,a,o,l,h,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function ln(t,e,i,n,r,s,a,o,l,h,c,u){qi.fromBufferAttribute(r,h),Xi.fromBufferAttribute(r,c),Yi.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){$i.set(0,0,0),Qi.set(0,0,0),tn.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],i=s[t];0!==e&&(Zi.fromBufferAttribute(i,h),Ji.fromBufferAttribute(i,c),Ki.fromBufferAttribute(i,u),a?($i.addScaledVector(Zi,e),Qi.addScaledVector(Ji,e),tn.addScaledVector(Ki,e)):($i.addScaledVector(Zi.sub(qi),e),Qi.addScaledVector(Ji.sub(Xi),e),tn.addScaledVector(Ki.sub(Yi),e)))}qi.add($i),Xi.add(Qi),Yi.add(tn)}t.isSkinnedMesh&&(t.boneTransform(h,qi),t.boneTransform(c,Xi),t.boneTransform(u,Yi));const p=function(t,e,i,n,r,s,a,o){let l;if(l=1===e.side?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,2!==e.side,o),null===l)return null;an.copy(o),an.applyMatrix4(t.matrixWorld);const h=i.ray.origin.distanceTo(an);return h<i.near||h>i.far?null:{distance:h,point:an.clone(),object:t}}(t,e,i,n,qi,Xi,Yi,sn);if(p){o&&(en.fromBufferAttribute(o,h),nn.fromBufferAttribute(o,c),rn.fromBufferAttribute(o,u),p.uv=yi.getUV(sn,qi,Xi,Yi,en,nn,rn,new Pt)),l&&(en.fromBufferAttribute(l,h),nn.fromBufferAttribute(l,c),rn.fromBufferAttribute(l,u),p.uv2=yi.getUV(sn,qi,Xi,Yi,en,nn,rn,new Pt));const t={a:h,b:c,c:u,normal:new se,materialIndex:0};yi.getNormal(qi,Xi,Yi,t.normal),p.face=t}return p}on.prototype.isMesh=!0;class hn extends Gi{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],h=[],c=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,_,g){const y=s/m,v=p/_,x=s/2,b=p/2,w=f/2,M=m+1,S=_+1;let E=0,T=0;const A=new se;for(let s=0;s<S;s++){const a=s*v-b;for(let o=0;o<M;o++){const u=o*y-x;A[t]=u*n,A[e]=a*r,A[i]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=f>0?1:-1,h.push(A.x,A.y,A.z),c.push(o/m),c.push(1-s/_),E+=1}}for(let t=0;t<_;t++)for(let e=0;e<m;e++){const i=u+e+M*t,n=u+e+M*(t+1),r=u+(e+1)+M*(t+1),s=u+(e+1)+M*t;o.push(i,n,s),o.push(n,r,s),T+=6}a.addGroup(d,T,g),d+=T,u+=E}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Di(l,3)),this.setAttribute("normal",new Di(h,3)),this.setAttribute("uv",new Di(c,2))}static fromJSON(t){return new hn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function cn(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function un(t){const e={};for(let i=0;i<t.length;i++){const n=cn(t[i]);for(const t in n)e[t]=n[t]}return e}const dn={clone:cn,merge:un};class pn extends xi{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cn(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}pn.prototype.isShaderMaterial=!0;class fn extends oi{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Fe,this.projectionMatrix=new Fe,this.projectionMatrixInverse=new Fe}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}fn.prototype.isCamera=!0;class mn extends fn{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*vt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*yt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*vt*Math.atan(Math.tan(.5*yt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*yt*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}mn.prototype.isPerspectiveCamera=!0;const _n=90;class gn extends oi{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new mn(_n,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new se(1,0,0)),this.add(n);const r=new mn(_n,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new se(-1,0,0)),this.add(r);const s=new mn(_n,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new se(0,1,0)),this.add(s);const a=new mn(_n,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new se(0,-1,0)),this.add(a);const o=new mn(_n,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new se(0,0,1)),this.add(o);const l=new mn(_n,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new se(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,a,o,l]=this.children,h=t.getRenderTarget(),c=t.toneMapping,u=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.toneMapping=c,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class yn extends Jt{constructor(t,e,i,n,r,a,o,l,h,c){super(t=void 0!==t?t:[],e=void 0!==e?e:s,i,n,r,a,o,l,h,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}yn.prototype.isCubeTexture=!0;class vn extends $t{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new yn(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:_}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",s=new hn(5,5,5),a=new pn({name:"CubemapFromEquirect",uniforms:cn(i),vertexShader:n,fragmentShader:r,side:1,blending:0});a.uniforms.tEquirect.value=e;const o=new on(s,a),l=e.minFilter;return e.minFilter===y&&(e.minFilter=_),new gn(1,10,this).update(t,o),e.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}vn.prototype.isWebGLCubeRenderTarget=!0;const xn=new se,bn=new se,wn=new Ct;class Mn{constructor(t=new se(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=xn.subVectors(i,e).cross(bn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(xn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||wn.getNormalMatrix(t),n=this.coplanarPoint(xn).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Mn.prototype.isPlane=!0;const Sn=new Ae,En=new se;class Tn{constructor(t=new Mn,e=new Mn,i=new Mn,n=new Mn,r=new Mn,s=new Mn){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],_=i[13],g=i[14],y=i[15];return e[0].setComponents(a-n,c-o,f-u,y-m).normalize(),e[1].setComponents(a+n,c+o,f+u,y+m).normalize(),e[2].setComponents(a+r,c+l,f+d,y+_).normalize(),e[3].setComponents(a-r,c-l,f-d,y-_).normalize(),e[4].setComponents(a-s,c-h,f-p,y-g).normalize(),e[5].setComponents(a+s,c+h,f+p,y+g).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Sn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Sn)}intersectsSprite(t){return Sn.center.set(0,0,0),Sn.radius=.7071067811865476,Sn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Sn)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(En.x=n.normal.x>0?t.max.x:t.min.x,En.y=n.normal.y>0?t.max.y:t.min.y,En.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(En)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function An(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Pn(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)o=t.FLOAT;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=t.HALF_FLOAT}else o=t.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=t.SHORT;else if(r instanceof Uint32Array)o=t.UNSIGNED_INT;else if(r instanceof Int32Array)o=t.INT;else if(r instanceof Int8Array)o=t.BYTE;else if(r instanceof Uint8Array)o=t.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=t.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,n,r){const s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class Cn extends Gi{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,h=o+1,c=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let t=0;t<h;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*c-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Di(p,3)),this.setAttribute("normal",new Di(f,3)),this.setAttribute("uv",new Di(m,2))}static fromJSON(t){return new Cn(t.width,t.height,t.widthSegments,t.heightSegments)}}const Ln={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Rn={common:{diffuse:{value:new Wt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ct},uv2Transform:{value:new Ct},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Wt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Wt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ct}},sprite:{diffuse:{value:new Wt(16777215)},opacity:{value:1},center:{value:new Pt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ct}}},In={basic:{uniforms:un([Rn.common,Rn.specularmap,Rn.envmap,Rn.aomap,Rn.lightmap,Rn.fog]),vertexShader:Ln.meshbasic_vert,fragmentShader:Ln.meshbasic_frag},lambert:{uniforms:un([Rn.common,Rn.specularmap,Rn.envmap,Rn.aomap,Rn.lightmap,Rn.emissivemap,Rn.fog,Rn.lights,{emissive:{value:new Wt(0)}}]),vertexShader:Ln.meshlambert_vert,fragmentShader:Ln.meshlambert_frag},phong:{uniforms:un([Rn.common,Rn.specularmap,Rn.envmap,Rn.aomap,Rn.lightmap,Rn.emissivemap,Rn.bumpmap,Rn.normalmap,Rn.displacementmap,Rn.fog,Rn.lights,{emissive:{value:new Wt(0)},specular:{value:new Wt(1118481)},shininess:{value:30}}]),vertexShader:Ln.meshphong_vert,fragmentShader:Ln.meshphong_frag},standard:{uniforms:un([Rn.common,Rn.envmap,Rn.aomap,Rn.lightmap,Rn.emissivemap,Rn.bumpmap,Rn.normalmap,Rn.displacementmap,Rn.roughnessmap,Rn.metalnessmap,Rn.fog,Rn.lights,{emissive:{value:new Wt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ln.meshphysical_vert,fragmentShader:Ln.meshphysical_frag},toon:{uniforms:un([Rn.common,Rn.aomap,Rn.lightmap,Rn.emissivemap,Rn.bumpmap,Rn.normalmap,Rn.displacementmap,Rn.gradientmap,Rn.fog,Rn.lights,{emissive:{value:new Wt(0)}}]),vertexShader:Ln.meshtoon_vert,fragmentShader:Ln.meshtoon_frag},matcap:{uniforms:un([Rn.common,Rn.bumpmap,Rn.normalmap,Rn.displacementmap,Rn.fog,{matcap:{value:null}}]),vertexShader:Ln.meshmatcap_vert,fragmentShader:Ln.meshmatcap_frag},points:{uniforms:un([Rn.points,Rn.fog]),vertexShader:Ln.points_vert,fragmentShader:Ln.points_frag},dashed:{uniforms:un([Rn.common,Rn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ln.linedashed_vert,fragmentShader:Ln.linedashed_frag},depth:{uniforms:un([Rn.common,Rn.displacementmap]),vertexShader:Ln.depth_vert,fragmentShader:Ln.depth_frag},normal:{uniforms:un([Rn.common,Rn.bumpmap,Rn.normalmap,Rn.displacementmap,{opacity:{value:1}}]),vertexShader:Ln.meshnormal_vert,fragmentShader:Ln.meshnormal_frag},sprite:{uniforms:un([Rn.sprite,Rn.fog]),vertexShader:Ln.sprite_vert,fragmentShader:Ln.sprite_frag},background:{uniforms:{uvTransform:{value:new Ct},t2D:{value:null}},vertexShader:Ln.background_vert,fragmentShader:Ln.background_frag},cube:{uniforms:un([Rn.envmap,{opacity:{value:1}}]),vertexShader:Ln.cube_vert,fragmentShader:Ln.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ln.equirect_vert,fragmentShader:Ln.equirect_frag},distanceRGBA:{uniforms:un([Rn.common,Rn.displacementmap,{referencePosition:{value:new se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ln.distanceRGBA_vert,fragmentShader:Ln.distanceRGBA_frag},shadow:{uniforms:un([Rn.lights,Rn.fog,{color:{value:new Wt(0)},opacity:{value:1}}]),vertexShader:Ln.shadow_vert,fragmentShader:Ln.shadow_frag}};function Dn(t,e,i,n,r,s){const a=new Wt(0);let o,l,c=!0===r?0:1,u=null,d=0,p=null;function f(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),c=e,f(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,f(a,c)},render:function(i,r){let s=!1,m=!0===r.isScene?r.background:null;m&&m.isTexture&&(m=e.get(m));const _=t.xr,g=_.getSession&&_.getSession();g&&"additive"===g.environmentBlendMode&&(m=null),null===m?f(a,c):m&&m.isColor&&(f(m,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),m&&(m.isCubeTexture||m.mapping===h)?(void 0===l&&(l=new on(new hn(1,1,1),new pn({name:"BackgroundCubeMaterial",uniforms:cn(In.cube.uniforms),vertexShader:In.cube.vertexShader,fragmentShader:In.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,u===m&&d===m.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new on(new Cn(2,2),new pn({name:"BackgroundMaterial",uniforms:cn(In.background.uniforms),vertexShader:In.background.vertexShader,fragmentShader:In.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&d===m.version&&p===t.toneMapping||(o.material.needsUpdate=!0,u=m,d=m.version,p=t.toneMapping),o.layers.enableAll(),i.unshift(o,o.geometry,o.material,0,0,null))}}}function On(t,e,i,n){const r=t.getParameter(t.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=p(null);let h=l,c=!1;function u(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){const t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){_(t,0)}function _(i,r){const s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r&&((n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function g(){const e=h.newAttributes,i=h.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function y(e,i,r,s,a,o){!0!==n.isWebGL2||r!==t.INT&&r!==t.UNSIGNED_INT?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function v(){x(),c=!0,h!==l&&(h=l,u(h.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,v,x){let b=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[a];return void 0===c&&(c=p(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),h[a]=c),c}(v,d,l);h!==e&&(h=e,u(h.object)),b=function(t,e,i,n){const r=h.attributes,s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o)if(o[e].location>=0){const i=r[e];let n=s[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;a++}return h.attributesNum!==a||h.index!==n}(r,v,d,x),b&&function(t,e,i,n){const r={},s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o)if(o[e].location>=0){let i=s[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[e]=n,a++}h.attributes=r,h.attributesNum=a,h.index=n}(r,v,d,x)}else{const t=!0===l.wireframe;h.geometry===v.id&&h.program===d.id&&h.wireframe===t||(h.geometry=v.id,h.program=d.id,h.wireframe=t,b=!0)}null!==x&&i.update(x,t.ELEMENT_ARRAY_BUFFER),(b||c)&&(c=!1,function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,h=a.getAttributes(),c=s.defaultAttributeValues;for(const e in h){const n=h[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;const h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)_(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<n.locationSize;t++)y(n.location+t,a/n.locationSize,c,e,l*u,(d+a/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)_(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(t.ARRAY_BUFFER,h);for(let t=0;t<n.locationSize;t++)y(n.location+t,a/n.locationSize,c,e,a*u,a/n.locationSize*t*u)}}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,d,v),null!==x&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(x).buffer))},reset:v,resetDefaultState:x,dispose:function(){v();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:g}}function Nn(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,n,a,o),i.update(a,s,o)}}function Fn(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),_=t.getParameter(t.MAX_VARYING_VECTORS),g=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,v=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:_,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:s?t.getParameter(t.MAX_SAMPLES):0}}function kn(t){const e=this;let i=null,n=0,r=!1,s=!1;const a=new Mn,o=new Ct,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,i,n,r){const s=null!==t?t.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(h,i),h[i+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==n||r;return r=e,i=c(t,s,0),n=t.length,a},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?c(null):h();else{const t=s?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=c(u,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function zn(t){let e=new WeakMap;function i(t,e){return e===o?t.mapping=s:e===l&&(t.mapping=a),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===o||s===l){if(e.has(r))return i(e.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const a=new vn(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}In.physical={uniforms:un([In.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Pt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Wt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Pt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Wt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Wt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ln.meshphysical_vert,fragmentShader:Ln.meshphysical_frag};class Un extends fn{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Un.prototype.isOrthographicCamera=!0;const Bn=[.125,.215,.35,.446,.526,.582],Hn=new Un,Gn=new Wt;let Vn=null;const Wn=(1+Math.sqrt(5))/2,jn=1/Wn,qn=[new se(1,1,1),new se(-1,1,1),new se(1,1,-1),new se(-1,1,-1),new se(0,Wn,jn),new se(0,Wn,-jn),new se(jn,0,Wn),new se(-jn,0,Wn),new se(Wn,jn,0),new se(-Wn,jn,0)];class Xn{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Vn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Kn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Jn(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Vn),t.scissorTest=!1,Zn(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===s||t.mapping===a?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Vn=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:_,minFilter:_,generateMipmaps:!1,type:M,format:E,encoding:at,depthBuffer:!1},n=Yn(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Yn(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Bn.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);i.push(s);let o=1/s;a>t-4?o=Bn[a-t+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,f=3,m=2,_=1,g=new Float32Array(f*p*d),y=new Float32Array(m*p*d),v=new Float32Array(_*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];v.set(r,_*p*t)}const x=new Gi;x.setAttribute("position",new Si(g,f)),x.setAttribute("uv",new Si(y,m)),x.setAttribute("faceIndex",new Si(v,_)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(20),r=new se(0,1,0);return new pn({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new on(this._lodPlanes[0],t);this._renderer.compile(e,Hn)}_sceneToCubeUV(t,e,i,n){const r=new mn(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(Gn),o.toneMapping=0,o.autoClear=!1;const c=new bi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new on(new hn,c);let d=!1;const p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,d=!0):(c.color.copy(Gn),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1===i?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e]));const l=this._cubeSize;Zn(n,i*l,e>2?l:0,l,l),o.setRenderTarget(n),d&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=h,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===s||t.mapping===a;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Kn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Jn());const r=n?this._cubemapMaterial:this._equirectMaterial,o=new on(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const l=this._cubeSize;Zn(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(o,Hn)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=qn[(e-1)%qn.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new on(this._lodPlanes[n],l),c=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let _=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?_+=i:t<f&&(_+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/_;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a);const{_lodMax:g}=this;c.dTheta.value=d,c.mipInt.value=g-i;const y=this._sizeLods[n];Zn(e,3*y*(n>g-4?n-g+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(e),o.render(h,Hn)}}function Yn(t,e,i){const n=new $t(t,e,i);return n.texture.mapping=h,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Zn(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Jn(){return new pn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Kn(){return new pn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function $n(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const h=r.mapping,c=h===o||h===l,u=h===s||h===a;if(c||u){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new Xn(t)),n=c?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(c&&s&&s.height>0||u&&s&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(s)){null===i&&(i=new Xn(t));const s=c?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Qn(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function tr(t,e,i,n){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,r=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(Lt(i)?Ri:Ci)(i,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const r=i.morphAttributes;for(const i in r){const n=r[i];for(let i=0,r=n.length;i<r;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function er(t,e,i,n){const r=n.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,a,e*o),i.update(n,s,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,u;if(r)c=t,u="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](s,l,a,n*o,h),i.update(l,s,h)}}function ir(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,r){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=r*(i/3);break;case t.LINES:e.lines+=r*(i/2);break;case t.LINE_STRIP:e.lines+=r*(i-1);break;case t.LINE_LOOP:e.lines+=r*i;break;case t.POINTS:e.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function nr(t,e){return t[0]-e[0]}function rr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function sr(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function ar(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,a=new Kt,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,h,c,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,f=void 0!==p?p.length:0;let m=s.get(h);if(void 0===m||m.count!==f){void 0!==m&&m.texture.dispose();const y=void 0!==h.morphAttributes.position,v=void 0!==h.morphAttributes.normal,x=void 0!==h.morphAttributes.color,b=h.morphAttributes.position||[],M=h.morphAttributes.normal||[],S=h.morphAttributes.color||[];let E=0;!0===y&&(E=1),!0===v&&(E=2),!0===x&&(E=3);let T=h.attributes.position.count*E,A=1;T>e.maxTextureSize&&(A=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const P=new Float32Array(T*A*4*f),C=new Qt(P,T,A,f);C.type=w,C.needsUpdate=!0;const L=4*E;for(let I=0;I<f;I++){const D=b[I],O=M[I],N=S[I],F=T*A*4*I;for(let k=0;k<D.count;k++){const z=k*L;!0===y&&(a.fromBufferAttribute(D,k),!0===D.normalized&&sr(a,D),P[F+z+0]=a.x,P[F+z+1]=a.y,P[F+z+2]=a.z,P[F+z+3]=0),!0===v&&(a.fromBufferAttribute(O,k),!0===O.normalized&&sr(a,O),P[F+z+4]=a.x,P[F+z+5]=a.y,P[F+z+6]=a.z,P[F+z+7]=0),!0===x&&(a.fromBufferAttribute(N,k),!0===N.normalized&&sr(a,N),P[F+z+8]=a.x,P[F+z+9]=a.y,P[F+z+10]=a.z,P[F+z+11]=4===N.itemSize?a.w:1)}}function R(){C.dispose(),s.delete(h),h.removeEventListener("dispose",R)}m={count:f,texture:C,size:new Pt(T,A)},s.set(h,m),h.addEventListener("dispose",R)}let _=0;for(let U=0;U<d.length;U++)_+=d[U];const g=h.morphTargetsRelative?1:1-_;u.getUniforms().setValue(t,"morphTargetBaseInfluence",g),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",m.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const B=void 0===d?0:d.length;let H=n[h.id];if(void 0===H||H.length!==B){H=[];for(let q=0;q<B;q++)H[q]=[q,0];n[h.id]=H}for(let X=0;X<B;X++){const Y=H[X];Y[0]=X,Y[1]=d[X]}H.sort(rr);for(let Z=0;Z<8;Z++)Z<B&&H[Z][1]?(o[Z][0]=H[Z][0],o[Z][1]=H[Z][1]):(o[Z][0]=Number.MAX_SAFE_INTEGER,o[Z][1]=0);o.sort(nr);const G=h.morphAttributes.position,V=h.morphAttributes.normal;let W=0;for(let J=0;J<8;J++){const K=o[J],$=K[0],Q=K[1];$!==Number.MAX_SAFE_INTEGER&&Q?(G&&h.getAttribute("morphTarget"+J)!==G[$]&&h.setAttribute("morphTarget"+J,G[$]),V&&h.getAttribute("morphNormal"+J)!==V[$]&&h.setAttribute("morphNormal"+J,V[$]),r[J]=Q,W+=Q):(G&&!0===h.hasAttribute("morphTarget"+J)&&h.deleteAttribute("morphTarget"+J),V&&!0===h.hasAttribute("morphNormal"+J)&&h.deleteAttribute("morphNormal"+J),r[J]=0)}const j=h.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",j),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function or(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(a){const o=n.render.frame,l=a.geometry,h=e.get(a,l);return r.get(h)!==o&&(e.update(h),r.set(h,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),i.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&i.update(a.instanceColor,t.ARRAY_BUFFER)),h},dispose:function(){r=new WeakMap}}}const lr=new Jt,hr=new Qt,cr=new ee,ur=new yn,dr=[],pr=[],fr=new Float32Array(16),mr=new Float32Array(9),_r=new Float32Array(4);function gr(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=dr[r];if(void 0===s&&(s=new Float32Array(r),dr[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function yr(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function vr(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function xr(t,e){let i=pr[e];void 0===i&&(i=new Int32Array(e),pr[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function br(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function wr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(yr(i,e))return;t.uniform2fv(this.addr,e),vr(i,e)}}function Mr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(yr(i,e))return;t.uniform3fv(this.addr,e),vr(i,e)}}function Sr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(yr(i,e))return;t.uniform4fv(this.addr,e),vr(i,e)}}function Er(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(yr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),vr(i,e)}else{if(yr(i,n))return;_r.set(n),t.uniformMatrix2fv(this.addr,!1,_r),vr(i,n)}}function Tr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(yr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),vr(i,e)}else{if(yr(i,n))return;mr.set(n),t.uniformMatrix3fv(this.addr,!1,mr),vr(i,n)}}function Ar(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(yr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),vr(i,e)}else{if(yr(i,n))return;fr.set(n),t.uniformMatrix4fv(this.addr,!1,fr),vr(i,n)}}function Pr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Cr(t,e){const i=this.cache;yr(i,e)||(t.uniform2iv(this.addr,e),vr(i,e))}function Lr(t,e){const i=this.cache;yr(i,e)||(t.uniform3iv(this.addr,e),vr(i,e))}function Rr(t,e){const i=this.cache;yr(i,e)||(t.uniform4iv(this.addr,e),vr(i,e))}function Ir(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Dr(t,e){const i=this.cache;yr(i,e)||(t.uniform2uiv(this.addr,e),vr(i,e))}function Or(t,e){const i=this.cache;yr(i,e)||(t.uniform3uiv(this.addr,e),vr(i,e))}function Nr(t,e){const i=this.cache;yr(i,e)||(t.uniform4uiv(this.addr,e),vr(i,e))}function Fr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||lr,r)}function kr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||cr,r)}function zr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||ur,r)}function Ur(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||hr,r)}function Br(t,e){t.uniform1fv(this.addr,e)}function Hr(t,e){const i=gr(e,this.size,2);t.uniform2fv(this.addr,i)}function Gr(t,e){const i=gr(e,this.size,3);t.uniform3fv(this.addr,i)}function Vr(t,e){const i=gr(e,this.size,4);t.uniform4fv(this.addr,i)}function Wr(t,e){const i=gr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function jr(t,e){const i=gr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function qr(t,e){const i=gr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Xr(t,e){t.uniform1iv(this.addr,e)}function Yr(t,e){t.uniform2iv(this.addr,e)}function Zr(t,e){t.uniform3iv(this.addr,e)}function Jr(t,e){t.uniform4iv(this.addr,e)}function Kr(t,e){t.uniform1uiv(this.addr,e)}function $r(t,e){t.uniform2uiv(this.addr,e)}function Qr(t,e){t.uniform3uiv(this.addr,e)}function ts(t,e){t.uniform4uiv(this.addr,e)}function es(t,e,i){const n=e.length,r=xr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||lr,r[t])}function is(t,e,i){const n=e.length,r=xr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||cr,r[t])}function ns(t,e,i){const n=e.length,r=xr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||ur,r[t])}function rs(t,e,i){const n=e.length,r=xr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||hr,r[t])}function ss(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return br;case 35664:return wr;case 35665:return Mr;case 35666:return Sr;case 35674:return Er;case 35675:return Tr;case 35676:return Ar;case 5124:case 35670:return Pr;case 35667:case 35671:return Cr;case 35668:case 35672:return Lr;case 35669:case 35673:return Rr;case 5125:return Ir;case 36294:return Dr;case 36295:return Or;case 36296:return Nr;case 35678:case 36198:case 36298:case 36306:case 35682:return Fr;case 35679:case 36299:case 36307:return kr;case 35680:case 36300:case 36308:case 36293:return zr;case 36289:case 36303:case 36311:case 36292:return Ur}}(e.type)}function as(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Br;case 35664:return Hr;case 35665:return Gr;case 35666:return Vr;case 35674:return Wr;case 35675:return jr;case 35676:return qr;case 5124:case 35670:return Xr;case 35667:case 35671:return Yr;case 35668:case 35672:return Zr;case 35669:case 35673:return Jr;case 5125:return Kr;case 36294:return $r;case 36295:return Qr;case 36296:return ts;case 35678:case 36198:case 36298:case 36306:case 35682:return es;case 35679:case 36299:case 36307:return is;case 35680:case 36300:case 36308:case 36293:return ns;case 36289:case 36303:case 36311:case 36292:return rs}}(e.type)}function os(t){this.id=t,this.seq=[],this.map={}}os.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const ls=/(\w+)(\])?(\[|\.)?/g;function hs(t,e){t.seq.push(e),t.map[e.id]=e}function cs(t,e,i){const n=t.name,r=n.length;for(ls.lastIndex=0;;){const s=ls.exec(n),a=ls.lastIndex;let o=s[1];const l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===r){hs(i,void 0===h?new ss(o,t,e):new as(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new os(o),hs(i,t)),i=t}}}function us(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);cs(i,t.getUniformLocation(e,i.name),this)}}function ds(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}us.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},us.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},us.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},us.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let ps=0;function fs(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[0]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const i=t.split("\n"),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=r;t<s;t++)n.push(t+1+": "+i[t]);return n.join("\n")}(t.getShaderSource(e),n)}return r}function ms(t,e){const i=function(t){switch(t){case at:return["Linear","( value )"];case ot:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function _s(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function gs(t){return""!==t}function ys(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function vs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const xs=/^[ \t]*#include +<([\w\d./]+)>/gm;function bs(t){return t.replace(xs,ws)}function ws(t,e){const i=Ln[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return bs(i)}const Ms=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ss=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Es(t){return t.replace(Ss,As).replace(Ms,Ts)}function Ts(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),As(0,e,i,n)}function As(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Ps(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Cs(t,e,i,n){const r=t.getContext(),o=i.defines;let l=i.vertexShader,c=i.fragmentShader;const u=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),d=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case s:case a:e="ENVMAP_TYPE_CUBE";break;case h:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),p=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===a&&(e="ENVMAP_MODE_REFRACTION"),e}(i),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),_=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(gs).join("\n")}(i),g=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),y=r.createProgram();let v,x,b=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(v=[g].filter(gs).join("\n"),v.length>0&&(v+="\n"),x=[_,g].filter(gs).join("\n"),x.length>0&&(x+="\n")):(v=[Ps(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(gs).join("\n"),x=[_,Ps(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Ln.tonemapping_pars_fragment:"",0!==i.toneMapping?_s("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ln.encodings_pars_fragment,ms("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(gs).join("\n")),l=bs(l),l=ys(l,i),l=vs(l,i),c=bs(c),c=ys(c,i),c=vs(c,i),l=Es(l),c=Es(c),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(b="#version 300 es\n",v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,x=["#define varying in",i.glslVersion===pt?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===pt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const w=b+v+l,M=b+x+c,S=ds(r,r.VERTEX_SHADER,w),E=ds(r,r.FRAGMENT_SHADER,M);if(r.attachShader(y,S),r.attachShader(y,E),void 0!==i.index0AttributeName?r.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(y).trim(),e=r.getShaderInfoLog(S).trim(),i=r.getShaderInfoLog(E).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(y,r.LINK_STATUS)){n=!1;const e=fs(r,S,"vertex"),i=fs(r,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(y,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:v},fragmentShader:{log:i,prefix:x}})}let T,A;return r.deleteShader(S),r.deleteShader(E),this.getUniforms=function(){return void 0===T&&(T=new us(r,y)),T},this.getAttributes=function(){return void 0===A&&(A=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let a=1;n.type===t.FLOAT_MAT2&&(a=2),n.type===t.FLOAT_MAT3&&(a=3),n.type===t.FLOAT_MAT4&&(a=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:a}}return i}(r,y)),A},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=ps++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=S,this.fragmentShader=E,this}let Ls=0;class Rs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new Is(t);e.set(t,i)}return e.get(t)}}class Is{constructor(t){this.id=Ls++,this.code=t,this.usedTimes=0}}function Ds(t,e,i,n,r,s,a){const o=new Xe,l=new Rs,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,p=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,c,_,g){const y=_.fog,v=g.geometry,x=s.isMeshStandardMaterial?_.environment:null,b=(s.isMeshStandardMaterial?i:e).get(s.envMap||x),w=b&&b.mapping===h?b.image.height:null,M=m[s.type];null!==s.precision&&(f=r.getMaxPrecision(s.precision),f!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",f,"instead."));const S=v.morphAttributes.position||v.morphAttributes.normal||v.morphAttributes.color,E=void 0!==S?S.length:0;let T,A,P,C,L=0;if(void 0!==v.morphAttributes.position&&(L=1),void 0!==v.morphAttributes.normal&&(L=2),void 0!==v.morphAttributes.color&&(L=3),M){const t=In[M];T=t.vertexShader,A=t.fragmentShader}else T=s.vertexShader,A=s.fragmentShader,l.update(s),P=l.getVertexShaderID(s),C=l.getFragmentShaderID(s);const R=t.getRenderTarget(),I=s.alphaTest>0,D=s.clearcoat>0;return{isWebGL2:u,shaderID:M,shaderName:s.type,vertexShader:T,fragmentShader:A,defines:s.defines,customVertexShaderID:P,customFragmentShaderID:C,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:f,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:p,outputEncoding:null===R?t.outputEncoding:!0===R.isXRRenderTarget?R.texture.encoding:at,map:!!s.map,matcap:!!s.matcap,envMap:!!b,envMapMode:b&&b.mapping,envMapCubeUVHeight:w,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===ot,clearcoat:D,clearcoatMap:D&&!!s.clearcoatMap,clearcoatRoughnessMap:D&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:D&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:I,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!v.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!v.attributes.color&&4===v.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!y,useFog:!0===s.fog,fogExp2:y&&y.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==v.morphAttributes.position,morphNormals:void 0!==v.morphAttributes.normal,morphColors:void 0!==v.morphAttributes.color,morphTargetsCount:E,morphTextureStride:L,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){o.disableAll(),e.isWebGL2&&o.enable(0),e.supportsVertexTextures&&o.enable(1),e.instancing&&o.enable(2),e.instancingColor&&o.enable(3),e.map&&o.enable(4),e.matcap&&o.enable(5),e.envMap&&o.enable(6),e.lightMap&&o.enable(7),e.aoMap&&o.enable(8),e.emissiveMap&&o.enable(9),e.bumpMap&&o.enable(10),e.normalMap&&o.enable(11),e.objectSpaceNormalMap&&o.enable(12),e.tangentSpaceNormalMap&&o.enable(13),e.clearcoat&&o.enable(14),e.clearcoatMap&&o.enable(15),e.clearcoatRoughnessMap&&o.enable(16),e.clearcoatNormalMap&&o.enable(17),e.displacementMap&&o.enable(18),e.specularMap&&o.enable(19),e.roughnessMap&&o.enable(20),e.metalnessMap&&o.enable(21),e.gradientMap&&o.enable(22),e.alphaMap&&o.enable(23),e.alphaTest&&o.enable(24),e.vertexColors&&o.enable(25),e.vertexAlphas&&o.enable(26),e.vertexUvs&&o.enable(27),e.vertexTangents&&o.enable(28),e.uvsVertexOnly&&o.enable(29),e.fog&&o.enable(30),t.push(o.mask),o.disableAll(),e.useFog&&o.enable(0),e.flatShading&&o.enable(1),e.logarithmicDepthBuffer&&o.enable(2),e.skinning&&o.enable(3),e.morphTargets&&o.enable(4),e.morphNormals&&o.enable(5),e.morphColors&&o.enable(6),e.premultipliedAlpha&&o.enable(7),e.shadowMapEnabled&&o.enable(8),e.physicallyCorrectLights&&o.enable(9),e.doubleSided&&o.enable(10),e.flipSided&&o.enable(11),e.useDepthPacking&&o.enable(12),e.dithering&&o.enable(13),e.specularIntensityMap&&o.enable(14),e.specularColorMap&&o.enable(15),e.transmission&&o.enable(16),e.transmissionMap&&o.enable(17),e.thicknessMap&&o.enable(18),e.sheen&&o.enable(19),e.sheenColorMap&&o.enable(20),e.sheenRoughnessMap&&o.enable(21),e.decodeVideoTexture&&o.enable(22),e.opaque&&o.enable(23),t.push(o.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=m[t.type];let i;if(e){const t=In[e];i=dn.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=c.length;t<e;t++){const e=c[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Cs(t,i,e,s),c.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=c.indexOf(t);c[e]=c[c.length-1],c.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:c,dispose:function(){l.dispose()}}}function Os(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Ns(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Fs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ks(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?n.push(c):!0===a.transparent?r.push(c):i.push(c)},unshift:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?n.unshift(c):!0===a.transparent?r.unshift(c):i.unshift(c)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Ns),n.length>1&&n.sort(e||Fs),r.length>1&&r.sort(e||Fs)}}}function zs(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new ks,t.set(e,[n])):i>=t.get(e).length?(n=new ks,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function Us(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new se,color:new Wt};break;case"SpotLight":i={position:new se,direction:new se,color:new Wt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new se,color:new Wt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new se,skyColor:new Wt,groundColor:new Wt};break;case"RectAreaLight":i={color:new Wt,position:new se,halfWidth:new se,halfHeight:new se}}return t[e.id]=i,i}}}let Bs=0;function Hs(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Gs(t,e){const i=new Us,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new se);const s=new se,a=new Fe,o=new Fe;return{setup:function(s,a){let o=0,l=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,m=0,_=0,g=0;s.sort(Hs);const y=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,v=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*v*y,l+=a.g*v*y,h+=a.b*v*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=b,r.directionalShadowMatrix[c]=e.shadow.matrix,m++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(v*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=e.shadow.matrix,g++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(a).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=b,r.pointShadowMatrix[u]=e.shadow.matrix,_++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(v*y),t.groundColor.copy(e.groundColor).multiplyScalar(v*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Rn.LTC_FLOAT_1,r.rectAreaLTC2=Rn.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Rn.LTC_HALF_1,r.rectAreaLTC2=Rn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=h;const v=r.hash;v.directionalLength===c&&v.pointLength===u&&v.spotLength===d&&v.rectAreaLength===p&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===_&&v.numSpotShadows===g||(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=_,r.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=u,v.spotLength=d,v.rectAreaLength=p,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=_,v.numSpotShadows=g,r.version=Bs++)},setupView:function(t,e){let i=0,n=0,l=0,h=0,c=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[h];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),h++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),c++}}},state:r}}function Vs(t,e){const i=new Gs(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function Ws(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new Vs(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new Vs(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class js extends xi{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}js.prototype.isMeshDepthMaterial=!0;class qs extends xi{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new se,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Xs(t,e,i){let n=new Tn;const r=new Pt,s=new Pt,a=new Kt,o=new js({depthPacking:3201}),l=new qs,h={},c=i.maxTextureSize,u={0:1,1:0,2:2},d=new pn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new Gi;m.setAttribute("position",new Si(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new on(m,d),g=this;function y(i,n){const r=e.update(_);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,f.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,d,_,null),f.uniforms.shadow_pass.value=i.mapPass.texture,f.uniforms.resolution.value=i.mapSize,f.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,f,_,null)}function v(e,i,n,r,s,a){let c=null;const d=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(c=void 0!==d?d:!0===n.isPointLight?l:o,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=c.uuid,e=i.uuid;let n=h[t];void 0===n&&(n={},h[t]=n);let r=n[e];void 0===r&&(r=c.clone(),n[e]=r),c=r}return c.visible=i.visible,c.wireframe=i.wireframe,c.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],c.alphaMap=i.alphaMap,c.alphaTest=i.alphaTest,c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.displacementMap=i.displacementMap,c.displacementScale=i.displacementScale,c.displacementBias=i.displacementBias,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,!0===n.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(n.matrixWorld),c.nearDistance=r,c.farDistance=s),c}function x(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],c=r[h.materialIndex];if(c&&c.visible){const e=v(i,c,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,h)}}}else if(r.visible){const e=v(i,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)x(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const f=u.getFrameExtents();if(r.multiply(f),s.copy(u.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(s.x=Math.floor(c/f.x),r.x=s.x*f.x,u.mapSize.x=s.x),r.y>c&&(s.y=Math.floor(c/f.y),r.y=s.y*f.y,u.mapSize.y=s.y)),null!==u.map||u.isPointLightShadow||3!==this.type||(u.map=new $t(r.x,r.y),u.map.texture.name=h.name+".shadowMap",u.mapPass=new $t(r.x,r.y),u.camera.updateProjectionMatrix()),null===u.map){const t={minFilter:p,magFilter:p,format:E};u.map=new $t(r.x,r.y,t),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const m=u.getViewportCount();for(let t=0;t<m;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),u.updateMatrices(h,t),n=u.getFrustum(),x(i,o,u.camera,h,this.type)}u.isPointLightShadow||3!==this.type||y(u,o),u.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(l,h,u)}}function Ys(t,e,i){const r=i.isWebGL2,s=new function(){let e=!1;const i=new Kt;let n=null;const r=new Kt(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(e){e?U(t.DEPTH_TEST):B(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},o=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(i){e||(i?U(t.STENCIL_TEST):B(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&s===a||(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null}}};let l={},h={},c=new WeakMap,u=[],d=null,p=!1,f=null,m=null,_=null,g=null,y=null,v=null,x=null,b=!1,w=null,M=null,S=null,E=null,T=null;const A=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let P=!1,C=0;const L=t.getParameter(t.VERSION);-1!==L.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(L)[1]),P=C>=1):-1!==L.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),P=C>=2);let R=null,I={};const D=t.getParameter(t.SCISSOR_BOX),O=t.getParameter(t.VIEWPORT),N=(new Kt).fromArray(D),F=(new Kt).fromArray(O);function k(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let e=0;e<n;e++)t.texImage2D(i+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return s}const z={};function U(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function B(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}z[t.TEXTURE_2D]=k(t.TEXTURE_2D,t.TEXTURE_2D,1),z[t.TEXTURE_CUBE_MAP]=k(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),U(t.DEPTH_TEST),a.setFunc(3),W(!1),j(1),U(t.CULL_FACE),V(0);const H={[n]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(r)H[103]=t.MIN,H[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(H[103]=t.MIN_EXT,H[104]=t.MAX_EXT)}const G={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA};function V(e,i,r,s,a,o,l,h){if(0!==e){if(!1===p&&(U(t.BLEND),p=!0),5===e)a=a||i,o=o||r,l=l||s,i===m&&a===y||(t.blendEquationSeparate(H[i],H[a]),m=i,y=a),r===_&&s===g&&o===v&&l===x||(t.blendFuncSeparate(G[r],G[s],G[o],G[l]),_=r,g=s,v=o,x=l),f=e,b=null;else if(e!==f||h!==b){if(m===n&&y===n||(t.blendEquation(t.FUNC_ADD),m=n,y=n),h)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}_=null,g=null,v=null,x=null,f=e,b=h}}else!0===p&&(B(t.BLEND),p=!1)}function W(e){w!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),w=e)}function j(e){0!==e?(U(t.CULL_FACE),e!==M&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):B(t.CULL_FACE),M=e}function q(e,i,n){e?(U(t.POLYGON_OFFSET_FILL),E===i&&T===n||(t.polygonOffset(i,n),E=i,T=n)):B(t.POLYGON_OFFSET_FILL)}function X(e){void 0===e&&(e=t.TEXTURE0+A-1),R!==e&&(t.activeTexture(e),R=e)}return{buffers:{color:s,depth:a,stencil:o},enable:U,disable:B,bindFramebuffer:function(e,i){return h[e]!==i&&(t.bindFramebuffer(e,i),h[e]=i,r&&(e===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,r){let s=u,a=!1;if(n)if(s=c.get(r),void 0===s&&(s=[],c.set(r,s)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(s.length!==e.length||s[0]!==t.COLOR_ATTACHMENT0){for(let i=0,n=e.length;i<n;i++)s[i]=t.COLOR_ATTACHMENT0+i;s.length=e.length,a=!0}}else s[0]!==t.COLOR_ATTACHMENT0&&(s[0]=t.COLOR_ATTACHMENT0,a=!0);else s[0]!==t.BACK&&(s[0]=t.BACK,a=!0);a&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:V,setMaterial:function(e,i){2===e.side?B(t.CULL_FACE):U(t.CULL_FACE);let n=1===e.side;i&&(n=!n),W(n),1===e.blending&&!1===e.transparent?V(0):V(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),s.setMask(e.colorWrite);const r=e.stencilWrite;o.setTest(r),r&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?U(t.SAMPLE_ALPHA_TO_COVERAGE):B(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:W,setCullFace:j,setLineWidth:function(e){e!==S&&(P&&t.lineWidth(e),S=e)},setPolygonOffset:q,setScissorTest:function(e){e?U(t.SCISSOR_TEST):B(t.SCISSOR_TEST)},activeTexture:X,bindTexture:function(e,i){null===R&&X();let n=I[R];void 0===n&&(n={type:void 0,texture:void 0},I[R]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||z[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=I[R];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===N.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),N.copy(e))},viewport:function(e){!1===F.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),F.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===r&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),l={},R=null,I={},h={},c=new WeakMap,u=[],d=null,p=!1,f=null,m=null,_=null,g=null,y=null,v=null,x=null,b=!1,w=null,M=null,S=null,E=null,T=null,N.set(0,0,t.canvas.width,t.canvas.height),F.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}}}function Zs(t,e,i,n,r,s,a){const o=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,P=r.maxTextureSize,C=r.maxSamples,L=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,R=/OculusBrowser/g.test(navigator.userAgent),I=new WeakMap;let D;const O=new WeakMap;let N=!1;try{N="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function F(t,e){return N?new OffscreenCanvas(t,e):Dt("canvas")}function k(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Tt:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===D&&(D=F(s,a));const o=i?F(s,a):D;return o.width=s,o.height=a,o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function z(t){return St(t.width)&&St(t.height)}function U(t,e){return t.generateMipmaps&&e&&t.minFilter!==p&&t.minFilter!==_}function B(e){t.generateMipmap(e)}function H(i,n,r,s,a=!1){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return n===t.RED&&(r===t.FLOAT&&(l=t.R32F),r===t.HALF_FLOAT&&(l=t.R16F),r===t.UNSIGNED_BYTE&&(l=t.R8)),n===t.RG&&(r===t.FLOAT&&(l=t.RG32F),r===t.HALF_FLOAT&&(l=t.RG16F),r===t.UNSIGNED_BYTE&&(l=t.RG8)),n===t.RGBA&&(r===t.FLOAT&&(l=t.RGBA32F),r===t.HALF_FLOAT&&(l=t.RGBA16F),r===t.UNSIGNED_BYTE&&(l=s===ot&&!1===a?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(l=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(l=t.RGB5_A1)),l!==t.R16F&&l!==t.R32F&&l!==t.RG16F&&l!==t.RG32F&&l!==t.RGBA16F&&l!==t.RGBA32F||e.get("EXT_color_buffer_float"),l}function G(t,e,i){return!0===U(t,i)||t.isFramebufferTexture&&t.minFilter!==p&&t.minFilter!==_?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function V(e){return e===p||e===f||e===m?t.NEAREST:t.LINEAR}function W(t){const e=t.target;e.removeEventListener("dispose",W),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=O.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&q(t),0===Object.keys(r).length&&O.delete(i)}n.remove(t)}(e),e.isVideoTexture&&I.delete(e)}function j(e){const i=e.target;i.removeEventListener("dispose",j),function(e){const i=e.texture,r=n.get(e),s=n.get(i);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function q(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete O.get(r)[i.__cacheKey],a.memory.textures--}let X=0;function Y(e,r){const s=n.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;I.get(t)!==e&&(I.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void Q(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D,s.__webglTexture)}const Z={[c]:t.REPEAT,[u]:t.CLAMP_TO_EDGE,[d]:t.MIRRORED_REPEAT},J={[p]:t.NEAREST,[f]:t.NEAREST_MIPMAP_NEAREST,[m]:t.NEAREST_MIPMAP_LINEAR,[_]:t.LINEAR,[g]:t.LINEAR_MIPMAP_NEAREST,[y]:t.LINEAR_MIPMAP_LINEAR};function K(i,s,a){if(a?(t.texParameteri(i,t.TEXTURE_WRAP_S,Z[s.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,Z[s.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,Z[s.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,J[s.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,J[s.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),s.wrapS===u&&s.wrapT===u||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,t.TEXTURE_MAG_FILTER,V(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,V(s.minFilter)),s.minFilter!==p&&s.minFilter!==_&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===w&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===M&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function $(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",W));const r=i.source;let s=O.get(r);void 0===s&&(s={},O.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&q(i)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return n}function Q(e,n,r){let a=t.TEXTURE_2D;n.isDataArrayTexture&&(a=t.TEXTURE_2D_ARRAY),n.isData3DTexture&&(a=t.TEXTURE_3D);const l=$(e,n),h=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(a,e.__webglTexture),h.version!==h.__currentVersion||!0===l){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const r=function(t){return!o&&(t.wrapS!==u||t.wrapT!==u||t.minFilter!==p&&t.minFilter!==_)}(n)&&!1===z(n.image);let c=k(n.image,r,!1,P);c=st(n,c);const d=z(c)||o,f=s.convert(n.format,n.encoding);let m,g=s.convert(n.type),y=H(n.internalFormat,f,g,n.encoding,n.isVideoTexture);K(a,n,d);const v=n.mipmaps,M=o&&!0!==n.isVideoTexture,C=void 0===e.__version||!0===l,L=G(n,c,d);if(n.isDepthTexture)y=t.DEPTH_COMPONENT,o?y=n.type===w?t.DEPTH_COMPONENT32F:n.type===b?t.DEPTH_COMPONENT24:n.type===S?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:n.type===w&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===T&&y===t.DEPTH_COMPONENT&&n.type!==x&&n.type!==b&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=x,g=s.convert(n.type)),n.format===A&&y===t.DEPTH_COMPONENT&&(y=t.DEPTH_STENCIL,n.type!==S&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=S,g=s.convert(n.type))),C&&(M?i.texStorage2D(t.TEXTURE_2D,1,y,c.width,c.height):i.texImage2D(t.TEXTURE_2D,0,y,c.width,c.height,0,f,g,null));else if(n.isDataTexture)if(v.length>0&&d){M&&C&&i.texStorage2D(t.TEXTURE_2D,L,y,v[0].width,v[0].height);for(let e=0,n=v.length;e<n;e++)m=v[e],M?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,g,m.data):i.texImage2D(t.TEXTURE_2D,e,y,m.width,m.height,0,f,g,m.data);n.generateMipmaps=!1}else M?(C&&i.texStorage2D(t.TEXTURE_2D,L,y,c.width,c.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,c.width,c.height,f,g,c.data)):i.texImage2D(t.TEXTURE_2D,0,y,c.width,c.height,0,f,g,c.data);else if(n.isCompressedTexture){M&&C&&i.texStorage2D(t.TEXTURE_2D,L,y,v[0].width,v[0].height);for(let e=0,r=v.length;e<r;e++)m=v[e],n.format!==E?null!==f?M?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,m.data):i.compressedTexImage2D(t.TEXTURE_2D,e,y,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M?i.texSubImage2D(t.TEXTURE_2D,e,0,0,m.width,m.height,f,g,m.data):i.texImage2D(t.TEXTURE_2D,e,y,m.width,m.height,0,f,g,m.data)}else if(n.isDataArrayTexture)M?(C&&i.texStorage3D(t.TEXTURE_2D_ARRAY,L,y,c.width,c.height,c.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,c.width,c.height,c.depth,f,g,c.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,y,c.width,c.height,c.depth,0,f,g,c.data);else if(n.isData3DTexture)M?(C&&i.texStorage3D(t.TEXTURE_3D,L,y,c.width,c.height,c.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,c.width,c.height,c.depth,f,g,c.data)):i.texImage3D(t.TEXTURE_3D,0,y,c.width,c.height,c.depth,0,f,g,c.data);else if(n.isFramebufferTexture){if(C)if(M)i.texStorage2D(t.TEXTURE_2D,L,y,c.width,c.height);else{let e=c.width,n=c.height;for(let r=0;r<L;r++)i.texImage2D(t.TEXTURE_2D,r,y,e,n,0,f,g,null),e>>=1,n>>=1}}else if(v.length>0&&d){M&&C&&i.texStorage2D(t.TEXTURE_2D,L,y,v[0].width,v[0].height);for(let e=0,n=v.length;e<n;e++)m=v[e],M?i.texSubImage2D(t.TEXTURE_2D,e,0,0,f,g,m):i.texImage2D(t.TEXTURE_2D,e,y,f,g,m);n.generateMipmaps=!1}else M?(C&&i.texStorage2D(t.TEXTURE_2D,L,y,c.width,c.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,f,g,c)):i.texImage2D(t.TEXTURE_2D,0,y,f,g,c);U(n,d)&&B(a),h.__currentVersion=h.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function tt(e,r,a,o,l){const h=s.convert(a.format,a.encoding),c=s.convert(a.type),u=H(a.internalFormat,h,c,a.encoding);n.get(r).__hasExternalTextures||(l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,h,c,null):i.texImage2D(l,0,u,r.width,r.height,0,h,c,null)),i.bindFramebuffer(t.FRAMEBUFFER,e),rt(r)?L.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,l,n.get(a).__webglTexture,0,nt(r)):t.framebufferTexture2D(t.FRAMEBUFFER,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(t.FRAMEBUFFER,null)}function et(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let r=t.DEPTH_COMPONENT16;if(n||rt(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===w?r=t.DEPTH_COMPONENT32F:e.type===b&&(r=t.DEPTH_COMPONENT24));const n=nt(i);rt(i)?L.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,r,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,r,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,r,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=nt(i);n&&!1===rt(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):rt(i)?L.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,r,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format,e.encoding),a=s.convert(e.type),o=H(e.internalFormat,r,a,e.encoding),l=nt(i);n&&!1===rt(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,l,o,i.width,i.height):rt(i)?L.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,l,o,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,o,i.width,i.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function it(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),Y(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,a=nt(r);if(r.depthTexture.format===T)rt(r)?L.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==A)throw new Error("Unknown depthTexture format");rt(r)?L.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),et(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),et(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function nt(t){return Math.min(C,t.samples)}function rt(t){const i=n.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function st(t,i){const n=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===ft||n!==at&&(n===ot?!1===o?!0===e.has("EXT_sRGB")&&r===E?(t.format=ft,t.minFilter=_,t.generateMipmaps=!1):i=qt.sRGBToLinear(i):r===E&&s===v||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=X;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),X+=1,t},this.resetTextureUnits=function(){X=0},this.setTexture2D=Y,this.setTexture2DArray=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?Q(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture))},this.setTexture3D=function(e,r){const s=n.get(e);e.version>0&&s.__version!==e.version?Q(s,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_3D,s.__webglTexture))},this.setTextureCube=function(e,r){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const a=$(e,n),l=n.source;if(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture),l.version!==l.__currentVersion||!0===a){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);const r=n.isCompressedTexture||n.image[0].isCompressedTexture,a=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=r||a?a?n.image[t].image:n.image[t]:k(n.image[t],!1,!0,h),c[t]=st(n,c[t]);const u=c[0],d=z(u)||o,p=s.convert(n.format,n.encoding),f=s.convert(n.type),m=H(n.internalFormat,p,f,n.encoding),_=o&&!0!==n.isVideoTexture,g=void 0===e.__version;let y,v=G(n,u,d);if(K(t.TEXTURE_CUBE_MAP,n,d),r){_&&g&&i.texStorage2D(t.TEXTURE_CUBE_MAP,v,m,u.width,u.height);for(let e=0;e<6;e++){y=c[e].mipmaps;for(let r=0;r<y.length;r++){const s=y[r];n.format!==E?null!==p?_?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,p,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,m,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,0,0,s.width,s.height,p,f,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,r,m,s.width,s.height,0,p,f,s.data)}}}else{y=n.mipmaps,_&&g&&(y.length>0&&v++,i.texStorage2D(t.TEXTURE_CUBE_MAP,v,m,c[0].width,c[0].height));for(let e=0;e<6;e++)if(a){_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,c[e].width,c[e].height,p,f,c[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,c[e].width,c[e].height,0,p,f,c[e].data);for(let n=0;n<y.length;n++){const r=y[n].image[e].image;_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,r.width,r.height,p,f,r.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,m,r.width,r.height,0,p,f,r.data)}}else{_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,p,f,c[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,m,p,f,c[e]);for(let n=0;n<y.length;n++){const r=y[n];_?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,p,f,r.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,m,p,f,r.image[e])}}}U(n,d)&&B(t.TEXTURE_CUBE_MAP),l.__currentVersion=l.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(a,e,r):(i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture))},this.rebindTextures=function(e,i,r){const s=n.get(e);void 0!==i&&tt(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),void 0!==r&&it(e)},this.setupRenderTarget=function(e){const l=e.texture,h=n.get(e),c=n.get(l);e.addEventListener("dispose",j),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=z(e)||o;if(u){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else if(h.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(o&&e.samples>0&&!1===rt(e)){h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,h.__webglColorRenderbuffer);const n=s.convert(l.format,l.encoding),r=s.convert(l.type),a=H(l.internalFormat,n,r,l.encoding),o=nt(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,a,e.width,e.height),i.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),et(h.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}if(u){i.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),K(t.TEXTURE_CUBE_MAP,l,p);for(let i=0;i<6;i++)tt(h.__webglFramebuffer[i],e,l,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i);U(l,p)&&B(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){const r=e.texture;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=n.get(a);i.bindTexture(t.TEXTURE_2D,o.__webglTexture),K(t.TEXTURE_2D,a,p),tt(h.__webglFramebuffer,e,a,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D),U(a,p)&&B(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,c.__webglTexture),K(n,l,p),tt(h.__webglFramebuffer,e,l,t.COLOR_ATTACHMENT0,n),U(l,p)&&B(n),i.unbindTexture()}e.depthBuffer&&it(e)},this.updateRenderTargetMipmap=function(e){const r=z(e)||o,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(U(o,r)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(o).__webglTexture;i.bindTexture(r,s),B(r),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===rt(e)){const r=e.width,s=e.height;let a=t.COLOR_BUFFER_BIT;const o=[t.COLOR_ATTACHMENT0],l=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;e.depthBuffer&&o.push(l);const h=n.get(e),c=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;!1===c&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),i.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer),!0===c&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[l]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,a,t.NEAREST),R&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,o),i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=it,this.setupFrameBufferTexture=tt,this.useMultisampledRTT=rt}function Js(t,e,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===v)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===x)return t.UNSIGNED_SHORT;if(1013===i)return t.INT;if(i===b)return t.UNSIGNED_INT;if(i===w)return t.FLOAT;if(i===M)return n?t.HALF_FLOAT:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return t.ALPHA;if(i===E)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===T)return t.DEPTH_COMPONENT;if(i===A)return t.DEPTH_STENCIL;if(1028===i)return t.RED;if(1022===i)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),t.RGBA;if(i===ft)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return t.RED_INTEGER;if(1030===i)return t.RG;if(1031===i)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===P||i===C||i===L||i===R)if(r===ot){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===P)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===C)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===L)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===R)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===P)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===C)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===L)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===R)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===I||i===D||i===O||i===N){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===I)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===D)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===O)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===N)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===F||i===k){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===F)return r===ot?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===k)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===z||i===U||i===B||i===H||i===G||i===V||i===W||i===j||i===q||i===X||i===Y||i===Z||i===J||i===K){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===z)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===U)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===B)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===H)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===G)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===V)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===W)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===j)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===q)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===X)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Y)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Z)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===J)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===K)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===$){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===$)return r===ot?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===S?n?t.UNSIGNED_INT_24_8:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}qs.prototype.isMeshDistanceMaterial=!0;class Ks extends mn{constructor(t=[]){super(),this.cameras=t}}Ks.prototype.isArrayCamera=!0;class $s extends oi{constructor(){super(),this.type="Group"}}$s.prototype.isGroup=!0;const Qs={type:"move"};class ta{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new $s,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new $s,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new se,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new se),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new $s,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new se,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new se),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Qs))),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new $s;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class ea extends Jt{constructor(t,e,i,n,r,s,a,o,l,h){if((h=void 0!==h?h:T)!==T&&h!==A)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===T&&(i=x),void 0===i&&h===A&&(i=S),super(null,n,r,s,a,o,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:p,this.minFilter=void 0!==o?o:p,this.flipY=!1,this.generateMipmaps=!1}}ea.prototype.isDepthTexture=!0;class ia extends mt{constructor(t,e){super();const i=this;let n=null,r=1,s=null,a="local-floor",o=null,l=null,h=null,c=null,u=null,d=null;const p=e.getContextAttributes();let f=null,m=null;const _=[],g=new Map,y=new mn;y.layers.enable(1),y.viewport=new Kt;const b=new mn;b.layers.enable(2),b.viewport=new Kt;const w=[y,b],M=new Ks;M.layers.enable(1),M.layers.enable(2);let P=null,C=null;function L(t){const e=g.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function R(){g.forEach((function(t,e){t.disconnect(e)})),g.clear(),P=null,C=null,t.setRenderTarget(f),u=null,c=null,h=null,n=null,m=null,k.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){const e=n.inputSources;for(let t=0;t<e.length;t++){const i="right"===e[t].handedness?1:0;g.set(e[t],_[i])}for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=g.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),g.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=g.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new ta,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new ta,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new ta,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o||s},this.setReferenceSpace=function(t){o=t},this.getBaseLayer=function(){return null!==c?c:u},this.getBinding=function(){return h},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(o){if(n=o,null!==n){if(f=t.getRenderTarget(),n.addEventListener("select",L),n.addEventListener("selectstart",L),n.addEventListener("selectend",L),n.addEventListener("squeeze",L),n.addEventListener("squeezestart",L),n.addEventListener("squeezeend",L),n.addEventListener("end",R),n.addEventListener("inputsourceschange",I),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:u}),m=new $t(u.framebufferWidth,u.framebufferHeight,{format:E,type:v,encoding:t.outputEncoding})}else{let i=null,s=null,a=null;p.depth&&(a=p.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=p.stencil?A:T,s=p.stencil?S:x);const o={colorFormat:t.outputEncoding===ot?e.SRGB8_ALPHA8:e.RGBA8,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(n,e),c=h.createProjectionLayer(o),n.updateRenderState({layers:[c]}),m=new $t(c.textureWidth,c.textureHeight,{format:E,type:v,depthTexture:new ea(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0}),t.properties.get(m).__ignoreDepthValues=c.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),s=await n.requestReferenceSpace(a),k.setContext(n),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new se,O=new se;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;M.near=b.near=y.near=t.near,M.far=b.far=y.far=t.far,P===M.near&&C===M.far||(n.updateRenderState({depthNear:M.near,depthFar:M.far}),P=M.near,C=M.far);const e=t.parent,i=M.cameras;N(M,e);for(let t=0;t<i.length;t++)N(i[t],e);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),t.position.copy(M.position),t.quaternion.copy(M.quaternion),t.scale.copy(M.scale),t.matrix.copy(M.matrix),t.matrixWorld.copy(M.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),O.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(O),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*c,p=a*u,f=n/(-c+u),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const _=a+f,g=o+f,y=d-m,v=p+(n-m),x=l*o/g*_,b=h*o/g*_;t.projectionMatrix.makePerspective(y,v,x,b,_,g)}(M,y,b):M.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let F=null;const k=new An;k.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o||s),d=i,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(m,u.framebuffer),t.setRenderTarget(m));let i=!1;e.length!==M.cameras.length&&(M.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==u)s=u.getViewport(r);else{const e=h.getViewSubImage(c,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(m,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}const a=w[n];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&M.matrix.copy(a.matrix),!0===i&&M.cameras.push(a)}}const r=n.inputSources;for(let t=0;t<_.length;t++){const e=r[t],n=g.get(e);void 0!==n&&n.update(e,i,o||s)}F&&F(e,i),d=null})),this.setAnimationLoop=function(t){F=t},this.dispose=function(){}}}function na(t,e){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,1===n.side&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),1===n.side&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);const r=e.get(n).envMap;if(r&&(i.envMap.value=r,i.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*e}let s,a;n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.roughnessMap?s=n.roughnessMap:n.metalnessMap?s=n.metalnessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap?s=n.emissiveMap:n.clearcoatMap?s=n.clearcoatMap:n.clearcoatNormalMap?s=n.clearcoatNormalMap:n.clearcoatRoughnessMap?s=n.clearcoatRoughnessMap:n.specularIntensityMap?s=n.specularIntensityMap:n.specularColorMap?s=n.specularColorMap:n.transmissionMap?s=n.transmissionMap:n.thicknessMap?s=n.thicknessMap:n.sheenColorMap?s=n.sheenColorMap:n.sheenRoughnessMap&&(s=n.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),i.uvTransform.value.copy(s.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),i.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(t,n):n.isMeshToonMaterial?(i(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(i(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(i(t,n),function(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,a)):n.isMeshMatcapMaterial?(i(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?i(t,n):n.isMeshDistanceMaterial?(i(t,n),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?i(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function ra(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=Dt("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,o=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let c;c=null!==i?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let u=null,d=null;const p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=at,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let _=!1,g=0,x=0,b=null,S=-1,T=null;const A=new Kt,P=new Kt;let C=null,L=e.width,R=e.height,I=1,D=null,O=null;const N=new Kt(0,0,L,R),F=new Kt(0,0,L,R);let k=!1;const z=new Tn;let U=!1,B=!1,H=null;const G=new Fe,V=new Pt,W=new se,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===b?I:1}let X,Y,Z,J,K,$,Q,tt,et,it,nt,rt,st,ot,lt,ht,ct,ut,dt,pt,ft,mt,_t,gt=i;function yt(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r140"),e.addEventListener("webglcontextlost",bt,!1),e.addEventListener("webglcontextrestored",wt,!1),null===gt){const e=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&e.shift(),gt=yt(e,t),null===gt)throw yt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===gt.getShaderPrecisionFormat&&(gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function vt(){X=new Qn(gt),Y=new Fn(gt,X,t),X.init(Y),mt=new Js(gt,X,Y),Z=new Ys(gt,X,Y),J=new ir(gt),K=new Os,$=new Zs(gt,X,Z,K,Y,mt,J),Q=new zn(m),tt=new $n(m),et=new Pn(gt,Y),_t=new On(gt,X,et,Y),it=new tr(gt,et,J,_t),nt=new or(gt,it,et,J),dt=new ar(gt,Y,$),ht=new kn(K),rt=new Ds(m,Q,tt,X,Y,_t,ht),st=new na(m,K),ot=new zs,lt=new Ws(X,Y),ut=new Dn(m,Q,Z,nt,c,a),ct=new Xs(m,nt,Y),pt=new Nn(gt,X,J,Y),ft=new er(gt,X,J,Y),J.programs=rt.programs,m.capabilities=Y,m.extensions=X,m.properties=K,m.renderLists=ot,m.shadowMap=ct,m.state=Z,m.info=J}vt();const xt=new ia(m,gt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function wt(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const t=J.autoReset,e=ct.enabled,i=ct.autoUpdate,n=ct.needsUpdate,r=ct.type;vt(),J.autoReset=t,ct.enabled=e,ct.autoUpdate=i,ct.needsUpdate=n,ct.type=r}function Mt(t){const e=t.target;e.removeEventListener("dispose",Mt),function(t){(function(t){const e=K.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),K.remove(t)}(e)}this.xr=xt,this.getContext=function(){return gt},this.getContextAttributes=function(){return gt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(L,R,!1))},this.getSize=function(t){return t.set(L,R)},this.setSize=function(t,i,n){xt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=t,R=i,e.width=Math.floor(t*I),e.height=Math.floor(i*I),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(L*I,R*I).floor()},this.setDrawingBufferSize=function(t,i,n){L=t,R=i,I=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(A)},this.getViewport=function(t){return t.copy(N)},this.setViewport=function(t,e,i,n){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,i,n),Z.viewport(A.copy(N).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,i,n){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,i,n),Z.scissor(P.copy(F).multiplyScalar(I).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(t){Z.setScissorTest(k=t)},this.setOpaqueSort=function(t){D=t},this.setTransparentSort=function(t){O=t},this.getClearColor=function(t){return t.copy(ut.getClearColor())},this.setClearColor=function(){ut.setClearColor.apply(ut,arguments)},this.getClearAlpha=function(){return ut.getClearAlpha()},this.setClearAlpha=function(){ut.setClearAlpha.apply(ut,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=gt.COLOR_BUFFER_BIT),e&&(n|=gt.DEPTH_BUFFER_BIT),i&&(n|=gt.STENCIL_BUFFER_BIT),gt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",bt,!1),e.removeEventListener("webglcontextrestored",wt,!1),ot.dispose(),lt.dispose(),K.dispose(),Q.dispose(),tt.dispose(),nt.dispose(),_t.dispose(),rt.dispose(),xt.dispose(),xt.removeEventListener("sessionstart",Et),xt.removeEventListener("sessionend",At),H&&(H.dispose(),H=null),Ct.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=j);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,i,n,r){!0!==e.isScene&&(e=j),$.resetTextureUnits();const s=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===b?m.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:at,l=(n.isMeshStandardMaterial?tt:Q).get(n.envMap||a),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,_=n.toneMapped?m.toneMapping:0,g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,y=void 0!==g?g.length:0,v=K.get(n),x=d.state.lights;if(!0===U&&(!0===B||t!==T)){const e=t===T&&n.id===S;ht.setState(n,t,e)}let w=!1;n.version===v.__version?v.needsLights&&v.lightsStateVersion!==x.state.version||v.outputEncoding!==o||r.isInstancedMesh&&!1===v.instancing?w=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?w=!0:r.isSkinnedMesh||!0!==v.skinning?v.envMap!==l||!0===n.fog&&v.fog!==s?w=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===ht.numPlanes&&v.numIntersection===ht.numIntersection?(v.vertexAlphas!==h||v.vertexTangents!==c||v.morphTargets!==u||v.morphNormals!==p||v.morphColors!==f||v.toneMapping!==_||!0===Y.isWebGL2&&v.morphTargetsCount!==y)&&(w=!0):w=!0:w=!0:w=!0:(w=!0,v.__version=n.version);let M=v.currentProgram;!0===w&&(M=Nt(n,e,r));let E=!1,A=!1,P=!1;const C=M.getUniforms(),L=v.uniforms;if(Z.useProgram(M.program)&&(E=!0,A=!0,P=!0),n.id!==S&&(S=n.id,A=!0),E||T!==t){if(C.setValue(gt,"projectionMatrix",t.projectionMatrix),Y.logarithmicDepthBuffer&&C.setValue(gt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),T!==t&&(T=t,A=!0,P=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=C.map.cameraPosition;void 0!==e&&e.setValue(gt,W.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&C.setValue(gt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&C.setValue(gt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){C.setOptional(gt,r,"bindMatrix"),C.setOptional(gt,r,"bindMatrixInverse");const t=r.skeleton;t&&(Y.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),C.setValue(gt,"boneTexture",t.boneTexture,$),C.setValue(gt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D=i.morphAttributes;var O,N;return(void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===Y.isWebGL2)&&dt.update(r,i,n,M),(A||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,C.setValue(gt,"receiveShadow",r.receiveShadow)),A&&(C.setValue(gt,"toneMappingExposure",m.toneMappingExposure),v.needsLights&&(N=P,(O=L).ambientLightColor.needsUpdate=N,O.lightProbe.needsUpdate=N,O.directionalLights.needsUpdate=N,O.directionalLightShadows.needsUpdate=N,O.pointLights.needsUpdate=N,O.pointLightShadows.needsUpdate=N,O.spotLights.needsUpdate=N,O.spotLightShadows.needsUpdate=N,O.rectAreaLights.needsUpdate=N,O.hemisphereLights.needsUpdate=N),s&&!0===n.fog&&st.refreshFogUniforms(L,s),st.refreshMaterialUniforms(L,n,I,R,H),us.upload(gt,v.uniformsList,L,$)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(us.upload(gt,v.uniformsList,L,$),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&C.setValue(gt,"center",r.center),C.setValue(gt,"modelViewMatrix",r.modelViewMatrix),C.setValue(gt,"normalMatrix",r.normalMatrix),C.setValue(gt,"modelMatrix",r.matrixWorld),M}(t,e,i,n,r);Z.setMaterial(n,a);let l=i.index;const h=i.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===n.wireframe&&(l=it.getWireframeAttribute(i),u=2),_t.setup(r,n,o,i,l);let p=pt;null!==l&&(c=et.get(l),p=ft,p.setIndex(c));const f=null!==l?l.count:h.count,_=i.drawRange.start*u,g=i.drawRange.count*u,y=null!==s?s.start*u:0,v=null!==s?s.count*u:1/0,x=Math.max(_,y),w=Math.min(f,_+g,y+v)-1,M=Math.max(0,w-x+1);if(0!==M){if(r.isMesh)!0===n.wireframe?(Z.setLineWidth(n.wireframeLinewidth*q()),p.setMode(gt.LINES)):p.setMode(gt.TRIANGLES);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),Z.setLineWidth(t*q()),r.isLineSegments?p.setMode(gt.LINES):r.isLineLoop?p.setMode(gt.LINE_LOOP):p.setMode(gt.LINE_STRIP)}else r.isPoints?p.setMode(gt.POINTS):r.isSprite&&p.setMode(gt.TRIANGLES);if(r.isInstancedMesh)p.renderInstances(x,M,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(x,M,t)}else p.render(x,M)}},this.compile=function(t,e){d=lt.get(t),d.init(),f.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(m.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++)Nt(i[n],t,e);else Nt(i,t,e)})),f.pop(),d=null};let St=null;function Et(){Ct.stop()}function At(){Ct.start()}const Ct=new An;function Lt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||z.intersectsSprite(t)){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(G);const e=nt.update(t),r=t.material;r.visible&&u.push(t,e,r,i,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==J.render.frame&&(t.skeleton.update(),t.skeleton.frame=J.render.frame),!t.frustumCulled||z.intersectsObject(t))){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(G);const e=nt.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&u.push(t,e,o,i,W.z,a)}}else r.visible&&u.push(t,e,r,i,W.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Lt(r[t],e,i,n)}function Rt(t,e,i,n){const r=t.opaque,a=t.transmissive,o=t.transparent;d.setupLightsView(i),a.length>0&&function(t,e,i){const n=Y.isWebGL2;null===H&&(H=new $t(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")?M:v,minFilter:y,samples:n&&!0===s?4:0})),m.getDrawingBufferSize(V),n?H.setSize(V.x,V.y):H.setSize(Tt(V.x),Tt(V.y));const r=m.getRenderTarget();m.setRenderTarget(H),m.clear();const a=m.toneMapping;m.toneMapping=0,It(t,e,i),m.toneMapping=a,$.updateMultisampleRenderTarget(H),$.updateRenderTargetMipmap(H),m.setRenderTarget(r)}(r,e,i),n&&Z.viewport(A.copy(n)),r.length>0&&It(r,e,i),a.length>0&&It(a,e,i),o.length>0&&It(o,e,i),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function It(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===n?s.material:n,h=s.group;a.layers.test(i.layers)&&Ot(a,e,i,o,l,h)}}function Ot(t,e,i,n,r,s){t.onBeforeRender(m,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(m,e,i,n,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=0,r.needsUpdate=!0,m.renderBufferDirect(i,e,n,r,t,s),r.side=2):m.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(m,e,i,n,r,s)}function Nt(t,e,i){!0!==e.isScene&&(e=j);const n=K.get(t),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=rt.getParameters(t,r.state,s,e,i),l=rt.getProgramCacheKey(o);let h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?tt:Q).get(t.envMap||n.environment),void 0===h&&(t.addEventListener("dispose",Mt),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===a)return Ft(t,o),c}else o.uniforms=rt.getUniforms(t),t.onBuild(i,o,m),t.onBeforeCompile(o,m),c=rt.acquireProgram(o,l),h.set(l,c),n.uniforms=o.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ht.uniform),Ft(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=c.getUniforms(),f=us.seqWithValue(p.seq,u);return n.currentProgram=c,n.uniformsList=f,c}function Ft(t,e){const i=K.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Ct.setAnimationLoop((function(t){St&&St(t)})),"undefined"!=typeof self&&Ct.setContext(self),this.setAnimationLoop=function(t){St=t,xt.setAnimationLoop(t),null===t?Ct.stop():Ct.start()},xt.addEventListener("sessionstart",Et),xt.addEventListener("sessionend",At),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===xt.enabled&&!0===xt.isPresenting&&(!0===xt.cameraAutoUpdate&&xt.updateCamera(e),e=xt.getCamera()),!0===t.isScene&&t.onBeforeRender(m,t,e,b),d=lt.get(t,f.length),d.init(),f.push(d),G.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),z.setFromProjectionMatrix(G),B=this.localClippingEnabled,U=ht.init(this.clippingPlanes,B,e),u=ot.get(t,p.length),u.init(),p.push(u),Lt(t,e,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(D,O),!0===U&&ht.beginShadows();const i=d.state.shadowsArray;if(ct.render(i,t,e),!0===U&&ht.endShadows(),!0===this.info.autoReset&&this.info.reset(),ut.render(u,t),d.setupLights(m.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Rt(u,t,n,n.viewport)}}else Rt(u,t,e);null!==b&&($.updateMultisampleRenderTarget(b),$.updateRenderTargetMipmap(b)),!0===t.isScene&&t.onAfterRender(m,t,e),_t.resetDefaultState(),S=-1,T=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(t,e,i){K.get(t.texture).__webglTexture=e,K.get(t.depthTexture).__webglTexture=i;const n=K.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=K.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){b=t,g=e,x=i;let n=!0;if(t){const e=K.get(t);void 0!==e.__useDefaultFramebuffer?(Z.bindFramebuffer(gt.FRAMEBUFFER,null),n=!1):void 0===e.__webglFramebuffer?$.setupRenderTarget(t):e.__hasExternalTextures&&$.rebindTextures(t,K.get(t.texture).__webglTexture,K.get(t.depthTexture).__webglTexture)}let r=null,s=!1,a=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(a=!0);const n=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=Y.isWebGL2&&t.samples>0&&!1===$.useMultisampledRTT(t)?K.get(t).__webglMultisampledFramebuffer:n,A.copy(t.viewport),P.copy(t.scissor),C=t.scissorTest}else A.copy(N).multiplyScalar(I).floor(),P.copy(F).multiplyScalar(I).floor(),C=k;if(Z.bindFramebuffer(gt.FRAMEBUFFER,r)&&Y.drawBuffers&&n&&Z.drawBuffers(t,r),Z.viewport(A),Z.scissor(P),Z.setScissorTest(C),s){const n=K.get(t.texture);gt.framebufferTexture2D(gt.FRAMEBUFFER,gt.COLOR_ATTACHMENT0,gt.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(a){const n=K.get(t.texture),r=e||0;gt.framebufferTextureLayer(gt.FRAMEBUFFER,gt.COLOR_ATTACHMENT0,n.__webglTexture,i||0,r)}S=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Z.bindFramebuffer(gt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==E&&mt.convert(o)!==gt.getParameter(gt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===M&&(X.has("EXT_color_buffer_half_float")||Y.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(l===v||mt.convert(l)===gt.getParameter(gt.IMPLEMENTATION_COLOR_READ_TYPE)||l===w&&(Y.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&gt.readPixels(e,i,n,r,mt.convert(o),mt.convert(l),s)}finally{const t=null!==b?K.get(b).__webglFramebuffer:null;Z.bindFramebuffer(gt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);$.setTexture2D(e,0),gt.copyTexSubImage2D(gt.TEXTURE_2D,i,0,0,t.x,t.y,r,s),Z.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,a=mt.convert(i.format),o=mt.convert(i.type);$.setTexture2D(i,0),gt.pixelStorei(gt.UNPACK_FLIP_Y_WEBGL,i.flipY),gt.pixelStorei(gt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),gt.pixelStorei(gt.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?gt.texSubImage2D(gt.TEXTURE_2D,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?gt.compressedTexSubImage2D(gt.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):gt.texSubImage2D(gt.TEXTURE_2D,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&gt.generateMipmap(gt.TEXTURE_2D),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=mt.convert(n.format),h=mt.convert(n.type);let c;if(n.isData3DTexture)$.setTexture3D(n,0),c=gt.TEXTURE_3D;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(n,0),c=gt.TEXTURE_2D_ARRAY}gt.pixelStorei(gt.UNPACK_FLIP_Y_WEBGL,n.flipY),gt.pixelStorei(gt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),gt.pixelStorei(gt.UNPACK_ALIGNMENT,n.unpackAlignment);const u=gt.getParameter(gt.UNPACK_ROW_LENGTH),d=gt.getParameter(gt.UNPACK_IMAGE_HEIGHT),p=gt.getParameter(gt.UNPACK_SKIP_PIXELS),f=gt.getParameter(gt.UNPACK_SKIP_ROWS),_=gt.getParameter(gt.UNPACK_SKIP_IMAGES),g=i.isCompressedTexture?i.mipmaps[0]:i.image;gt.pixelStorei(gt.UNPACK_ROW_LENGTH,g.width),gt.pixelStorei(gt.UNPACK_IMAGE_HEIGHT,g.height),gt.pixelStorei(gt.UNPACK_SKIP_PIXELS,t.min.x),gt.pixelStorei(gt.UNPACK_SKIP_ROWS,t.min.y),gt.pixelStorei(gt.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?gt.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,g.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),gt.compressedTexSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,g.data)):gt.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,g),gt.pixelStorei(gt.UNPACK_ROW_LENGTH,u),gt.pixelStorei(gt.UNPACK_IMAGE_HEIGHT,d),gt.pixelStorei(gt.UNPACK_SKIP_PIXELS,p),gt.pixelStorei(gt.UNPACK_SKIP_ROWS,f),gt.pixelStorei(gt.UNPACK_SKIP_IMAGES,_),0===r&&n.generateMipmaps&&gt.generateMipmap(c),Z.unbindTexture()},this.initTexture=function(t){$.setTexture2D(t,0),Z.unbindTexture()},this.resetState=function(){g=0,x=0,b=null,Z.reset(),_t.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ra.prototype.isWebGLRenderer=!0;class sa extends ra{}sa.prototype.isWebGL1Renderer=!0;class aa{constructor(t,e=25e-5){this.name="",this.color=new Wt(t),this.density=e}clone(){return new aa(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}aa.prototype.isFogExp2=!0;class oa{constructor(t,e=1,i=1e3){this.name="",this.color=new Wt(t),this.near=e,this.far=i}clone(){return new oa(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}oa.prototype.isFog=!0;class la extends oi{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}la.prototype.isScene=!0;class ha{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xt()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=xt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ha.prototype.isInterleavedBuffer=!0;const ca=new se;class ua{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ca.fromBufferAttribute(this,e),ca.applyMatrix4(t),this.setXYZ(e,ca.x,ca.y,ca.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ca.fromBufferAttribute(this,e),ca.applyNormalMatrix(t),this.setXYZ(e,ca.x,ca.y,ca.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ca.fromBufferAttribute(this,e),ca.transformDirection(t),this.setXYZ(e,ca.x,ca.y,ca.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new Si(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ua(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ua.prototype.isInterleavedBufferAttribute=!0;class da extends xi{constructor(t){super(),this.type="SpriteMaterial",this.color=new Wt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let pa;da.prototype.isSpriteMaterial=!0;const fa=new se,ma=new se,_a=new se,ga=new Pt,ya=new Pt,va=new Fe,xa=new se,ba=new se,wa=new se,Ma=new Pt,Sa=new Pt,Ea=new Pt;class Ta extends oi{constructor(t){if(super(),this.type="Sprite",void 0===pa){pa=new Gi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ha(t,5);pa.setIndex([0,1,2,0,2,3]),pa.setAttribute("position",new ua(e,3,0,!1)),pa.setAttribute("uv",new ua(e,2,3,!1))}this.geometry=pa,this.material=void 0!==t?t:new da,this.center=new Pt(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ma.setFromMatrixScale(this.matrixWorld),va.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_a.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ma.multiplyScalar(-_a.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;Aa(xa.set(-.5,-.5,0),_a,s,ma,n,r),Aa(ba.set(.5,-.5,0),_a,s,ma,n,r),Aa(wa.set(.5,.5,0),_a,s,ma,n,r),Ma.set(0,0),Sa.set(1,0),Ea.set(1,1);let a=t.ray.intersectTriangle(xa,ba,wa,!1,fa);if(null===a&&(Aa(ba.set(-.5,.5,0),_a,s,ma,n,r),Sa.set(0,1),a=t.ray.intersectTriangle(xa,wa,ba,!1,fa),null===a))return;const o=t.ray.origin.distanceTo(fa);o<t.near||o>t.far||e.push({distance:o,point:fa.clone(),uv:yi.getUV(fa,xa,ba,wa,Ma,Sa,Ea,new Pt),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function Aa(t,e,i,n,r,s){ga.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(ya.x=s*ga.x-r*ga.y,ya.y=r*ga.x+s*ga.y):ya.copy(ga),t.copy(e),t.x+=ya.x,t.y+=ya.y,t.applyMatrix4(va)}Ta.prototype.isSprite=!0;const Pa=new se,Ca=new se;class La extends oi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){Pa.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Pa);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Pa.setFromMatrixPosition(t.matrixWorld),Ca.setFromMatrixPosition(this.matrixWorld);const i=Pa.distanceTo(Ca)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const Ra=new se,Ia=new Kt,Da=new Kt,Oa=new se,Na=new Fe;class Fa extends on{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Fe,this.bindMatrixInverse=new Fe}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Kt,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Ia.fromBufferAttribute(n.attributes.skinIndex,t),Da.fromBufferAttribute(n.attributes.skinWeight,t),Ra.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Da.getComponent(t);if(0!==n){const r=Ia.getComponent(t);Na.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Oa.copy(Ra).applyMatrix4(Na),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}Fa.prototype.isSkinnedMesh=!0;class ka extends oi{constructor(){super(),this.type="Bone"}}ka.prototype.isBone=!0;class za extends Jt{constructor(t=null,e=1,i=1,n,r,s,a,o,l=1003,h=1003,c,u){super(null,s,a,o,l,h,n,r,c,u),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}za.prototype.isDataTexture=!0;const Ua=new Fe,Ba=new Fe;class Ha{constructor(t=[],e=[]){this.uuid=xt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Fe)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Fe;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Ba;Ua.multiplyMatrices(r,e[n]),Ua.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Ha(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=Et(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new za(e,t,t,E,w);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new ka),this.bones.push(r),this.boneInverses.push((new Fe).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class Ga extends Si{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Ga.prototype.isInstancedBufferAttribute=!0;const Va=new Fe,Wa=new Fe,ja=[],qa=new on;class Xa extends on{constructor(t,e,i){super(t,e),this.instanceMatrix=new Ga(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(qa.geometry=this.geometry,qa.material=this.material,void 0!==qa.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Va),Wa.multiplyMatrices(i,Va),qa.matrixWorld=Wa,qa.raycast(t,ja);for(let t=0,i=ja.length;t<i;t++){const i=ja[t];i.instanceId=r,i.object=this,e.push(i)}ja.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ga(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Xa.prototype.isInstancedMesh=!0;class Ya extends xi{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Wt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}Ya.prototype.isLineBasicMaterial=!0;const Za=new se,Ja=new se,Ka=new Fe,$a=new Ne,Qa=new Ae;class to extends oi{constructor(t=new Gi,e=new Ya){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Za.fromBufferAttribute(e,t-1),Ja.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Za.distanceTo(Ja);t.setAttribute("lineDistance",new Di(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Qa.copy(i.boundingSphere),Qa.applyMatrix4(n),Qa.radius+=r,!1===t.ray.intersectsSphere(Qa))return;Ka.copy(n).invert(),$a.copy(t.ray).applyMatrix4(Ka);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new se,h=new se,c=new se,u=new se,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n)for(let i=Math.max(0,s.start),a=Math.min(n.count,s.start+s.count)-1;i<a;i+=d){const s=n.getX(i),a=n.getX(i+1);if(l.fromBufferAttribute(r,s),h.fromBufferAttribute(r,a),$a.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){if(l.fromBufferAttribute(r,i),h.fromBufferAttribute(r,i+1),$a.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}to.prototype.isLine=!0;const eo=new se,io=new se;class no extends to{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)eo.fromBufferAttribute(e,t),io.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+eo.distanceTo(io);t.setAttribute("lineDistance",new Di(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}no.prototype.isLineSegments=!0;class ro extends to{constructor(t,e){super(t,e),this.type="LineLoop"}}ro.prototype.isLineLoop=!0;class so extends xi{constructor(t){super(),this.type="PointsMaterial",this.color=new Wt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}so.prototype.isPointsMaterial=!0;const ao=new Fe,oo=new Ne,lo=new Ae,ho=new se;class co extends oi{constructor(t=new Gi,e=new so){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),lo.copy(i.boundingSphere),lo.applyMatrix4(n),lo.radius+=r,!1===t.ray.intersectsSphere(lo))return;ao.copy(n).invert(),oo.copy(t.ray).applyMatrix4(ao);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position;if(null!==r)for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);ho.fromBufferAttribute(a,s),uo(ho,s,o,n,t,e,this)}else for(let i=Math.max(0,s.start),r=Math.min(a.count,s.start+s.count);i<r;i++)ho.fromBufferAttribute(a,i),uo(ho,i,o,n,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function uo(t,e,i,n,r,s,a){const o=oo.distanceSqToPoint(t);if(o<i){const i=new se;oo.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}co.prototype.isPoints=!0;class po extends Jt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.minFilter=void 0!==s?s:_,this.magFilter=void 0!==r?r:_,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}po.prototype.isVideoTexture=!0;class fo extends Jt{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=p,this.minFilter=p,this.generateMipmaps=!1,this.needsUpdate=!0}}fo.prototype.isFramebufferTexture=!0;class mo extends Jt{constructor(t,e,i,n,r,s,a,o,l,h,c,u){super(null,s,a,o,l,h,n,r,c,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}mo.prototype.isCompressedTexture=!0;class _o extends Jt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.needsUpdate=!0}}_o.prototype.isCanvasTexture=!0;class go{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const h=i[n];return(n+(s-h)/(i[n+1]-h))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),a=this.getPoint(r),o=e||(s.isVector2?new Pt:new se);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new se,n=[],r=[],s=[],a=new se,o=new Fe;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new se)}r[0]=new se,s[0]=new se;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(bt(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(bt(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class yo extends go{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new Pt,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}yo.prototype.isEllipseCurve=!0;class vo extends yo{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function xo(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,h=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,h*=a,r(e,i,l,h)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}vo.prototype.isArcCurve=!0;const bo=new se,wo=new xo,Mo=new xo,So=new xo;class Eo extends go{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new se){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?a=n[(l-1)%r]:(bo.subVectors(n[0],n[1]).add(n[0]),a=bo);const c=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(bo.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=bo),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),wo.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,i,n),Mo.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,i,n),So.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(wo.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),Mo.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),So.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return i.set(wo.calc(h),Mo.calc(h),So.calc(h)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new se).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function To(t,e,i,n,r){const s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function Ao(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Po(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}Eo.prototype.isCatmullRomCurve3=!0;class Co extends go{constructor(t=new Pt,e=new Pt,i=new Pt,n=new Pt){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Pt){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Po(t,n.x,r.x,s.x,a.x),Po(t,n.y,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Co.prototype.isCubicBezierCurve=!0;class Lo extends go{constructor(t=new se,e=new se,i=new se,n=new se){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new se){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Po(t,n.x,r.x,s.x,a.x),Po(t,n.y,r.y,s.y,a.y),Po(t,n.z,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Lo.prototype.isCubicBezierCurve3=!0;class Ro extends go{constructor(t=new Pt,e=new Pt){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Pt){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Pt;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ro.prototype.isLineCurve=!0;class Io extends go{constructor(t=new se,e=new se){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new se){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Do extends go{constructor(t=new Pt,e=new Pt,i=new Pt){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Pt){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Ao(t,n.x,r.x,s.x),Ao(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Do.prototype.isQuadraticBezierCurve=!0;class Oo extends go{constructor(t=new se,e=new se,i=new se){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new se){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Ao(t,n.x,r.x,s.x),Ao(t,n.y,r.y,s.y),Ao(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Oo.prototype.isQuadraticBezierCurve3=!0;class No extends go{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Pt){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],c=n[s>n.length-3?n.length-1:s+2];return i.set(To(a,o.x,l.x,h.x,c.x),To(a,o.y,l.y,h.y,c.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Pt).fromArray(i))}return this}}No.prototype.isSplineCurve=!0;var Fo=Object.freeze({__proto__:null,ArcCurve:vo,CatmullRomCurve3:Eo,CubicBezierCurve:Co,CubicBezierCurve3:Lo,EllipseCurve:yo,LineCurve:Ro,LineCurve3:Io,QuadraticBezierCurve:Do,QuadraticBezierCurve3:Oo,SplineCurve:No});class ko extends go{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Ro(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Fo[i.type]).fromJSON(i))}return this}}class zo extends ko{constructor(t){super(),this.type="Path",this.currentPoint=new Pt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Ro(this.currentPoint.clone(),new Pt(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Do(this.currentPoint.clone(),new Pt(t,e),new Pt(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const a=new Co(this.currentPoint.clone(),new Pt(t,e),new Pt(i,n),new Pt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new No(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){const l=new yo(t,e,i,n,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Uo extends Gi{constructor(t=[new Pt(0,.5),new Pt(.5,0),new Pt(0,-.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=bt(n,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],h=1/e,c=new se,u=new Pt,d=new se,p=new se,f=new se;let m=0,_=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,_=t[e+1].y-t[e].y,d.x=1*_,d.y=-m,d.z=0*_,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,_=t[e+1].y-t[e].y,d.x=1*_,d.y=-m,d.z=0*_,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=e;r++){const d=i+r*h*n,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=t.length-1;i++){c.x=t[i].x*p,c.y=t[i].y,c.z=t[i].x*f,s.push(c.x,c.y,c.z),u.x=r/e,u.y=i/(t.length-1),a.push(u.x,u.y);const n=o[3*i+0]*p,h=o[3*i+1],d=o[3*i+0]*f;l.push(n,h,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,a=n+t.length,o=n+t.length+1,l=n+1;r.push(s,a,l),r.push(o,l,a)}this.setIndex(r),this.setAttribute("position",new Di(s,3)),this.setAttribute("uv",new Di(a,2)),this.setAttribute("normal",new Di(l,3))}static fromJSON(t){return new Uo(t.points,t.segments,t.phiStart,t.phiLength)}}class Bo extends Uo{constructor(t=1,e=1,i=4,n=8){const r=new zo;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:i,radialSegments:n}}static fromJSON(t){return new Bo(t.radius,t.length,t.capSegments,t.radialSegments)}}class Ho extends Gi{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new se,h=new Pt;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,c=3;r<=e;r++,c+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),h.x=(s[c]/t+1)/2,h.y=(s[c+1]/t+1)/2,o.push(h.x,h.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Di(s,3)),this.setAttribute("normal",new Di(a,3)),this.setAttribute("uv",new Di(o,2))}static fromJSON(t){return new Ho(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Go extends Gi{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),r=Math.floor(r);const h=[],c=[],u=[],d=[];let p=0;const f=[],m=i/2;let _=0;function g(i){const r=p,s=new Pt,f=new se;let g=0;const y=!0===i?t:e,v=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,m*v,0),u.push(0,v,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*v,f.z=y*i,c.push(f.x,f.y,f.z),u.push(0,v,0),s.x=.5*i+.5,s.y=.5*r*v+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=x+t;!0===i?h.push(n,n+1,e):h.push(n+1,n,e),g+=3}l.addGroup(_,g,!0===i?1:2),_+=g}!function(){const s=new se,g=new se;let y=0;const v=(e-t)/i;for(let l=0;l<=r;l++){const h=[],_=l/r,y=_*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+a,l=Math.sin(r),f=Math.cos(r);g.x=y*l,g.y=-_*i+m,g.z=y*f,c.push(g.x,g.y,g.z),s.set(l,v,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-_),h.push(p++)}f.push(h)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];h.push(i,n,s),h.push(n,r,s),y+=6}l.addGroup(_,y,0),_+=y}(),!1===s&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(h),this.setAttribute("position",new Di(c,3)),this.setAttribute("normal",new Di(u,3)),this.setAttribute("uv",new Di(d,2))}static fromJSON(t){return new Go(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Vo extends Go{constructor(t=1,e=1,i=8,n=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new Vo(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Wo extends Gi{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function a(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const a=t.clone().lerp(i,n/r),o=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(s[t][i+1]),o(s[t+1][i]),o(s[t][i])):(o(s[t][i+1]),o(s[t+1][i+1]),o(s[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function h(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new se,n=new se,r=new se;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),a(i,n,r,t)}(n),function(t){const e=new se;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new se;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=c(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-a)}var e;(function(){const t=new se,e=new se,i=new se,n=new se,a=new Pt,o=new Pt,l=new Pt;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=c(n);h(a,d+0,t,p),h(o,d+2,e,p),h(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Di(r,3)),this.setAttribute("normal",new Di(r.slice(),3)),this.setAttribute("uv",new Di(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new Wo(t.vertices,t.indices,t.radius,t.details)}}class jo extends Wo{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new jo(t.radius,t.detail)}}const qo=new se,Xo=new se,Yo=new se,Zo=new yi;class Jo extends Gi{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(yt*e),s=t.getIndex(),a=t.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],h=["a","b","c"],c=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:o}=Zo;if(e.fromBufferAttribute(a,l[0]),i.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Zo.getNormal(Yo),c[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,c[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,c[2]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=c[t],n=c[e],s=Zo[h[t]],a=Zo[h[e]],o=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(Yo.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:Yo.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];qo.fromBufferAttribute(a,e),Xo.fromBufferAttribute(a,i),d.push(qo.x,qo.y,qo.z),d.push(Xo.x,Xo.y,Xo.z)}this.setAttribute("position",new Di(d,3))}}}class Ko extends zo{constructor(t){super(t),this.uuid=xt(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new zo).fromJSON(i))}return this}}function $o(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=vl(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=vl(s,t[s],t[s+1],a);return a&&pl(a,a.next)&&(xl(a),a=a.next),a}function Qo(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!pl(n,n.next)&&0!==dl(n.prev,n,n.next))n=n.next;else{if(xl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function tl(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=ll(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,h=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ,n);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(a>1)}(r)}(t,n,r,s);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?il(t,n,r,s):el(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),xl(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?tl(t=nl(Qo(t),e,i),e,i,n,r,s,2):2===a&&rl(t,e,i,n,r,s):tl(Qo(t),e,i,n,r,s,1);break}}function el(t){const e=t.prev,i=t,n=t.next;if(dl(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(cl(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&dl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function il(t,e,i,n){const r=t.prev,s=t,a=t.next;if(dl(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,h=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,c=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=ll(o,l,e,i,n),d=ll(h,c,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&cl(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&dl(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&cl(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&dl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&cl(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&dl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&cl(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&dl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function nl(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!pl(r,s)&&fl(r,n,n.next,s)&&gl(r,s)&&gl(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),xl(n),xl(n.next),n=t=s),n=n.next}while(n!==t);return Qo(n)}function rl(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&ul(a,t)){let o=yl(a,t);return a=Qo(a,a.next),o=Qo(o,o.next),tl(a,e,i,n,r,s),void tl(o,e,i,n,r,s)}t=t.next}a=a.next}while(a!==t)}function sl(t,e){return t.x-e.x}function al(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===a)return s;const o=s,l=s.x,h=s.y;let c,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&cl(r<h?n:a,r,l,h,r<h?a:n,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(n-i.x),gl(i,t)&&(c<u||c===u&&(i.x>s.x||i.x===s.x&&ol(s,i)))&&(s=i,u=c)),i=i.next}while(i!==o);return s}(t,e),e){const i=yl(e,t);Qo(e,e.next),Qo(i,i.next)}}function ol(t,e){return dl(t.prev,t,e.prev)<0&&dl(e.next,t,t.next)<0}function ll(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hl(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function cl(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function ul(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&fl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(gl(t,e)&&gl(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(dl(t.prev,t,e.prev)||dl(t,e.prev,e))||pl(t,e)&&dl(t.prev,t,t.next)>0&&dl(e.prev,e,e.next)>0)}function dl(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function pl(t,e){return t.x===e.x&&t.y===e.y}function fl(t,e,i,n){const r=_l(dl(t,e,i)),s=_l(dl(t,e,n)),a=_l(dl(i,n,t)),o=_l(dl(i,n,e));return r!==s&&a!==o||!(0!==r||!ml(t,i,e))||!(0!==s||!ml(t,n,e))||!(0!==a||!ml(i,t,n))||!(0!==o||!ml(i,e,n))}function ml(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function _l(t){return t>0?1:t<0?-1:0}function gl(t,e){return dl(t.prev,t,t.next)<0?dl(t,e,t.next)>=0&&dl(t,t.prev,e)>=0:dl(t,e,t.prev)<0||dl(t,t.next,e)<0}function yl(t,e){const i=new bl(t.i,t.x,t.y),n=new bl(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function vl(t,e,i,n){const r=new bl(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function xl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bl(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class wl{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return wl.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];Ml(t),Sl(i,t);let s=t.length;e.forEach(Ml);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,Sl(i,e[t]);const a=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=$o(t,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h,c,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,h=$o(t,o,l,n,!1),h===h.next&&(h.steiner=!0),r.push(hl(h));for(r.sort(sl),s=0;s<r.length;s++)al(r[s],i),i=Qo(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=h=t[0],l=c=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=0!==p?1/p:0}return tl(s,a,i,o,l,p),a}(i,n);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function Ml(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Sl(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class El extends Gi{constructor(t=new Ko([new Pt(.5,.5),new Pt(-.5,.5),new Pt(-.5,-.5),new Pt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++)s(t[e]);function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Tl;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let _,g,y,v,x,b=!1;f&&(_=f.getSpacedPoints(o),b=!0,h=!1,g=f.computeFrenetFrames(o,!1),y=new se,v=new se,x=new se),h||(p=0,c=0,u=0,d=0);const w=t.extractPoints(a);let M=w.shape;const S=w.holes;if(!wl.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];wl.isClockWise(e)&&(S[t]=e.reverse())}}const E=wl.triangulateShape(M,S),T=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function A(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const P=M.length,C=E.length;function L(t,e,i){let n,r,s;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=a*a+o*o,u=a*h-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-o/u,f=e.y+a/u,m=((i.x-h/d-p)*h-(i.y+l/d-f)*l)/(a*h-o*l);n=p+a*m-t.x,r=f+o*m-t.y;const _=n*n+r*r;if(_<=2)return new Pt(n,r);s=Math.sqrt(_/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(n=-o,r=a,s=Math.sqrt(c)):(n=a,r=o,s=Math.sqrt(c/2))}return new Pt(n/s,r/s)}const R=[];for(let t=0,e=T.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),R[t]=L(T[t],T[i],T[n]);const I=[];let D,O=R.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=L(e[t],e[n],e[r]);I.push(D),O=O.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],R[t],n);k(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],n);k(r.x,r.y,-i)}}}const N=u+d;for(let t=0;t<P;t++){const e=h?A(M[t],O[t],N):M[t];b?(v.copy(g.normals[0]).multiplyScalar(e.x),y.copy(g.binormals[0]).multiplyScalar(e.y),x.copy(_[0]).add(v).add(y),k(x.x,x.y,x.z)):k(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<P;e++){const i=h?A(M[e],O[e],N):M[e];b?(v.copy(g.normals[t]).multiplyScalar(i.x),y.copy(g.binormals[t]).multiplyScalar(i.y),x.copy(_[t]).add(v).add(y),k(x.x,x.y,x.z)):k(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],R[t],n);k(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],n);b?k(r.x,r.y+_[o-1].y,_[o-1].x+i):k(r.x,r.y,l+i)}}}function F(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*p;t<i;t++){const i=P*t,s=P*(t+1);U(e+n+i,e+r+i,e+r+s,e+n+s)}}}function k(t,e,i){s.push(t),s.push(e),s.push(i)}function z(t,e,r){B(t),B(e),B(r);const s=n.length/3,a=m.generateTopUV(i,n,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[2])}function U(t,e,r,s){B(t),B(e),B(s),B(e),B(r),B(s);const a=n.length/3,o=m.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function B(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(h){let t=0,e=P*t;for(let t=0;t<C;t++){const i=E[t];z(i[2]+e,i[1]+e,i[0]+e)}t=o+2*p,e=P*t;for(let t=0;t<C;t++){const i=E[t];z(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<C;t++){const e=E[t];z(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=E[t];z(e[0]+P*o,e[1]+P*o,e[2]+P*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;F(T,e),e+=T.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];F(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Di(n,3)),this.setAttribute("uv",new Di(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new Fo[n.type]).fromJSON(n)),new El(i,t.options)}}const Tl={generateTopUV:function(t,e,i,n,r){const s=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new Pt(s,a),new Pt(o,l),new Pt(h,c)]},generateSideWallUV:function(t,e,i,n,r,s){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],_=e[3*s+1],g=e[3*s+2];return Math.abs(o-c)<Math.abs(a-h)?[new Pt(a,1-l),new Pt(h,1-u),new Pt(d,1-f),new Pt(m,1-g)]:[new Pt(o,1-l),new Pt(c,1-u),new Pt(p,1-f),new Pt(_,1-g)]}};class Al extends Wo{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Al(t.radius,t.detail)}}class Pl extends Wo{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Pl(t.radius,t.detail)}}class Cl extends Gi{constructor(t=.5,e=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const a=[],o=[],l=[],h=[];let c=t;const u=(e-t)/(n=Math.max(1,n)),d=new se,p=new Pt;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=c*Math.cos(n),d.y=c*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,h.push(p.x,p.y)}c+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,o=n+i+2,l=n+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new Di(o,3)),this.setAttribute("normal",new Di(l,3)),this.setAttribute("uv",new Di(h,2))}static fromJSON(t){return new Cl(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Ll extends Gi{constructor(t=new Ko([new Pt(0,.5),new Pt(-.5,-.5),new Pt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=n.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===wl.isClockWise(h)&&(h=h.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===wl.isClockWise(e)&&(c[t]=e.reverse())}const u=wl.triangulateShape(h,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];h=h.concat(e)}for(let t=0,e=h.length;t<e;t++){const e=h[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+a,r=e[1]+a,s=e[2]+a;i.push(n,r,s),o+=3}}this.setIndex(i),this.setAttribute("position",new Di(n,3)),this.setAttribute("normal",new Di(r,3)),this.setAttribute("uv",new Di(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new Ll(i,t.curveSegments)}}class Rl extends Gi{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const h=[],c=new se,u=new se,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const _=[],g=d/i;let y=0;0==d&&0==s?y=.5/e:d==i&&o==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){const o=i/e;c.x=-t*Math.cos(n+o*r)*Math.sin(s+g*a),c.y=t*Math.cos(s+g*a),c.z=t*Math.sin(n+o*r)*Math.sin(s+g*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-g),_.push(l++)}h.push(_)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=h[t][n+1],r=h[t][n],a=h[t+1][n],l=h[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Di(p,3)),this.setAttribute("normal",new Di(f,3)),this.setAttribute("uv",new Di(m,2))}static fromJSON(t){return new Rl(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Il extends Wo{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Il(t.radius,t.detail)}}class Dl extends Gi{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],a=[],o=[],l=[],h=new se,c=new se,u=new se;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const p=d/n*r,f=s/i*Math.PI*2;c.x=(t+e*Math.cos(f))*Math.cos(p),c.y=(t+e*Math.cos(f))*Math.sin(p),c.z=e*Math.sin(f),a.push(c.x,c.y,c.z),h.x=t*Math.cos(p),h.y=t*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,a=(n+1)*(t-1)+e,o=(n+1)*t+e;s.push(i,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Di(a,3)),this.setAttribute("normal",new Di(o,3)),this.setAttribute("uv",new Di(l,2))}static fromJSON(t){return new Dl(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Ol extends Gi{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const a=[],o=[],l=[],h=[],c=new se,u=new se,d=new se,p=new se,f=new se,m=new se,_=new se;for(let a=0;a<=i;++a){const y=a/i*r*Math.PI*2;g(y,r,s,t,d),g(y+.01,r,s,t,p),m.subVectors(p,d),_.addVectors(p,d),f.crossVectors(m,_),_.crossVectors(f,m),f.normalize(),_.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);c.x=d.x+(s*_.x+p*f.x),c.y=d.y+(s*_.y+p*f.y),c.z=d.z+(s*_.z+p*f.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(a/i),h.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;a.push(i,r,o),a.push(r,s,o)}function g(t,e,i,n,r){const s=Math.cos(t),a=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Di(o,3)),this.setAttribute("normal",new Di(l,3)),this.setAttribute("uv",new Di(h,2))}static fromJSON(t){return new Ol(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Nl extends Gi{constructor(t=new Oo(new se(-1,-1,0),new se(-1,1,0),new se(1,1,0)),e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new se,o=new se,l=new Pt;let h=new se;const c=[],u=[],d=[],p=[];function f(r){h=t.getPointAt(r/e,h);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=h.x+i*o.x,a.y=h.y+i*o.y,a.z=h.z+i*o.z,c.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)f(t);f(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;p.push(i,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Di(c,3)),this.setAttribute("normal",new Di(u,3)),this.setAttribute("uv",new Di(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Nl((new Fo[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Fl extends Gi{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new se,r=new se;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],h=l.start;for(let t=h,o=h+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),h=a.getX(t+(o+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,h),!0===kl(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;n.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===kl(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Di(e,3))}}}function kl(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var zl=Object.freeze({__proto__:null,BoxGeometry:hn,BoxBufferGeometry:hn,CapsuleGeometry:Bo,CapsuleBufferGeometry:Bo,CircleGeometry:Ho,CircleBufferGeometry:Ho,ConeGeometry:Vo,ConeBufferGeometry:Vo,CylinderGeometry:Go,CylinderBufferGeometry:Go,DodecahedronGeometry:jo,DodecahedronBufferGeometry:jo,EdgesGeometry:Jo,ExtrudeGeometry:El,ExtrudeBufferGeometry:El,IcosahedronGeometry:Al,IcosahedronBufferGeometry:Al,LatheGeometry:Uo,LatheBufferGeometry:Uo,OctahedronGeometry:Pl,OctahedronBufferGeometry:Pl,PlaneGeometry:Cn,PlaneBufferGeometry:Cn,PolyhedronGeometry:Wo,PolyhedronBufferGeometry:Wo,RingGeometry:Cl,RingBufferGeometry:Cl,ShapeGeometry:Ll,ShapeBufferGeometry:Ll,SphereGeometry:Rl,SphereBufferGeometry:Rl,TetrahedronGeometry:Il,TetrahedronBufferGeometry:Il,TorusGeometry:Dl,TorusBufferGeometry:Dl,TorusKnotGeometry:Ol,TorusKnotBufferGeometry:Ol,TubeGeometry:Nl,TubeBufferGeometry:Nl,WireframeGeometry:Fl});class Ul extends xi{constructor(t){super(),this.type="ShadowMaterial",this.color=new Wt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}Ul.prototype.isShadowMaterial=!0;class Bl extends pn{constructor(t){super(t),this.type="RawShaderMaterial"}}Bl.prototype.isRawShaderMaterial=!0;class Hl extends xi{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Wt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}Hl.prototype.isMeshStandardMaterial=!0;class Gl extends Hl{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Pt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return bt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Wt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Wt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Wt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Gl.prototype.isMeshPhysicalMaterial=!0;class Vl extends xi{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Wt(16777215),this.specular=new Wt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}Vl.prototype.isMeshPhongMaterial=!0;class Wl extends xi{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Wt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Wl.prototype.isMeshToonMaterial=!0;class jl extends xi{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}jl.prototype.isMeshNormalMaterial=!0;class ql extends xi{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Wt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}ql.prototype.isMeshLambertMaterial=!0;class Xl extends xi{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Wt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}Xl.prototype.isMeshMatcapMaterial=!0;class Yl extends Ya{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Yl.prototype.isLineDashedMaterial=!0;const Zl={ShadowMaterial:Ul,SpriteMaterial:da,RawShaderMaterial:Bl,ShaderMaterial:pn,PointsMaterial:so,MeshPhysicalMaterial:Gl,MeshStandardMaterial:Hl,MeshPhongMaterial:Vl,MeshToonMaterial:Wl,MeshNormalMaterial:jl,MeshLambertMaterial:ql,MeshDepthMaterial:js,MeshDistanceMaterial:qs,MeshBasicMaterial:bi,MeshMatcapMaterial:Xl,LineDashedMaterial:Yl,LineBasicMaterial:Ya,Material:xi};xi.fromType=function(t){return new Zl[t]};const Jl={arraySlice:function(t,e,i){return Jl.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[a++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(e.push(s.time),i.push.apply(i,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(e.push(s.time),i.push(a)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],h=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)h.push(e.values[t*o+i])}}0!==l.length&&(e.times=Jl.convertArray(l,e.times.constructor),e.values=Jl.convertArray(h,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=o,e=l-o;d=Jl.arraySlice(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+o,e=t+l-o;d=Jl.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(s),d=Jl.arraySlice(t.resultBuffer,e,i)}"quaternion"===r&&(new re).fromArray(d).normalize().conjugate().toArray(d);const p=a.times.length;for(let t=0;t<p;++t){const e=t*c+h;if("quaternion"===r)re.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=c-2*h;for(let i=0;i<t;++i)a.values[e+i]-=d[i]}}}return t.blendMode=st,t}};class Kl{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Kl.prototype.beforeStart_=Kl.prototype.copySampleValue_,Kl.prototype.afterEnd_=Kl.prototype.copySampleValue_;class $l extends Kl{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:it,endingEnd:it}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case nt:r=t,a=2*e-i;break;case rt:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case nt:s=t,o=2*i-e;break;case rt:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}const l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,_=-u*m+2*u*f-u*p,g=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,v=d*m-d*f;for(let t=0;t!==a;++t)r[t]=_*s[h+t]+g*s[l+t]+y*s[o+t]+v*s[c+t];return r}}class Ql extends Kl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=(i-e)/(n-e),c=1-h;for(let t=0;t!==a;++t)r[t]=s[l+t]*c+s[o+t]*h;return r}}class th extends Kl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class eh{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Jl.convertArray(e,this.TimeBufferType),this.values=Jl.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Jl.convertArray(t.times,Array),values:Jl.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new th(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Ql(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new $l(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Q:e=this.InterpolantFactoryMethodDiscrete;break;case tt:e=this.InterpolantFactoryMethodLinear;break;case et:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Q;case this.InterpolantFactoryMethodLinear:return tt;case this.InterpolantFactoryMethodSmooth:return et}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=Jl.arraySlice(i,r,s),this.values=Jl.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&Jl.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=Jl.arraySlice(this.times),e=Jl.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===et,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)r=!0;else{const t=a*i,n=t-i,s=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[n+a]||i!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const n=a*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,a=0;a!==i;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=Jl.arraySlice(t,0,s),this.values=Jl.arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=Jl.arraySlice(this.times,0),e=Jl.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}eh.prototype.TimeBufferType=Float32Array,eh.prototype.ValueBufferType=Float32Array,eh.prototype.DefaultInterpolation=tt;class ih extends eh{}ih.prototype.ValueTypeName="bool",ih.prototype.ValueBufferType=Array,ih.prototype.DefaultInterpolation=Q,ih.prototype.InterpolantFactoryMethodLinear=void 0,ih.prototype.InterpolantFactoryMethodSmooth=void 0;class nh extends eh{}nh.prototype.ValueTypeName="color";class rh extends eh{}rh.prototype.ValueTypeName="number";class sh extends Kl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e);let l=t*a;for(let t=l+a;l!==t;l+=4)re.slerpFlat(r,0,s,l-a,s,l,o);return r}}class ah extends eh{InterpolantFactoryMethodLinear(t){return new sh(this.times,this.values,this.getValueSize(),t)}}ah.prototype.ValueTypeName="quaternion",ah.prototype.DefaultInterpolation=tt,ah.prototype.InterpolantFactoryMethodSmooth=void 0;class oh extends eh{}oh.prototype.ValueTypeName="string",oh.prototype.ValueBufferType=Array,oh.prototype.DefaultInterpolation=Q,oh.prototype.InterpolantFactoryMethodLinear=void 0,oh.prototype.InterpolantFactoryMethodSmooth=void 0;class lh extends eh{}lh.prototype.ValueTypeName="vector";class hh{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=xt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(ch(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(eh.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=Jl.getKeyframeOrder(a);a=Jl.sortedArray(a,1,l),o=Jl.sortedArray(o,1,l),n||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new rh(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],a=[];Jl.flattenJSON(i,s,a,n),0!==s.length&&r.push(new t(e,s,a))}},n=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new rh(".morphTargetInfluence["+i+"]",t,s))}o=t.length*s}else{const s=".bones["+e[t].name+"]";i(lh,s+".position",r,"pos",n),i(ah,s+".quaternion",r,"rot",n),i(lh,s+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ch(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return rh;case"vector":case"vector2":case"vector3":case"vector4":return lh;case"color":return nh;case"quaternion":return ah;case"bool":case"boolean":return ih;case"string":return oh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Jl.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const uh={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class dh{constructor(t,e,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===s&&void 0!==n.onStart&&n.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const ph=new dh;class fh{constructor(t){this.manager=void 0!==t?t:ph,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const mh={};class _h extends fh{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=uh.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==mh[t])return void mh[t].push({onLoad:e,onProgress:i,onError:n});mh[t]=[],mh[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=mh[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{o+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{uh.add(t,e);const i=mh[t];delete mh[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=mh[t];if(void 0===i)throw this.manager.itemError(t),e;delete mh[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class gh extends fh{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=uh.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=Dt("img");function o(){h(),uh.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class yh extends fh{constructor(t){super(t)}load(t,e,i,n){const r=new yn,s=new gh(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(i){s.load(t[i],(function(t){r.images[i]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)o(e);return r}}class vh extends fh{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new za,a=new _h(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){const i=r.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:u,s.wrapT=void 0!==i.wrapT?i.wrapT:u,s.magFilter=void 0!==i.magFilter?i.magFilter:_,s.minFilter=void 0!==i.minFilter?i.minFilter:_,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=y),1===i.mipmapCount&&(s.minFilter=_),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i))}),i,n),s}}class xh extends fh{constructor(t){super(t)}load(t,e,i,n){const r=new Jt,s=new gh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class bh extends oi{constructor(t,e=1){super(),this.type="Light",this.color=new Wt(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}bh.prototype.isLight=!0;class wh extends bh{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.groundColor=new Wt(e)}copy(t){return bh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}wh.prototype.isHemisphereLight=!0;const Mh=new Fe,Sh=new se,Eh=new se;class Th{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Pt(512,512),this.map=null,this.mapPass=null,this.matrix=new Fe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Tn,this._frameExtents=new Pt(1,1),this._viewportCount=1,this._viewports=[new Kt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Sh.setFromMatrixPosition(t.matrixWorld),e.position.copy(Sh),Eh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Eh),e.updateMatrixWorld(),Mh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mh),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Ah extends Th{constructor(){super(new mn(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*vt*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Ah.prototype.isSpotLightShadow=!0;class Ph extends bh{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.target=new oi,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new Ah}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Ph.prototype.isSpotLight=!0;const Ch=new Fe,Lh=new se,Rh=new se;class Ih extends Th{constructor(){super(new mn(90,1,.5,500)),this._frameExtents=new Pt(4,2),this._viewportCount=6,this._viewports=[new Kt(2,1,1,1),new Kt(0,1,1,1),new Kt(3,1,1,1),new Kt(1,1,1,1),new Kt(3,0,1,1),new Kt(1,0,1,1)],this._cubeDirections=[new se(1,0,0),new se(-1,0,0),new se(0,0,1),new se(0,0,-1),new se(0,1,0),new se(0,-1,0)],this._cubeUps=[new se(0,1,0),new se(0,1,0),new se(0,1,0),new se(0,1,0),new se(0,0,1),new se(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Lh.setFromMatrixPosition(t.matrixWorld),i.position.copy(Lh),Rh.copy(i.position),Rh.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Rh),i.updateMatrixWorld(),n.makeTranslation(-Lh.x,-Lh.y,-Lh.z),Ch.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ch)}}Ih.prototype.isPointLightShadow=!0;class Dh extends bh{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Ih}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Dh.prototype.isPointLight=!0;class Oh extends Th{constructor(){super(new Un(-5,5,5,-5,.5,500))}}Oh.prototype.isDirectionalLightShadow=!0;class Nh extends bh{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.target=new oi,this.shadow=new Oh}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Nh.prototype.isDirectionalLight=!0;class Fh extends bh{constructor(t,e){super(t,e),this.type="AmbientLight"}}Fh.prototype.isAmbientLight=!0;class kh extends bh{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}kh.prototype.isRectAreaLight=!0;class zh{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new se)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}zh.prototype.isSphericalHarmonics3=!0;class Uh extends bh{constructor(t=new zh,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Uh.prototype.isLightProbe=!0;class Bh extends fh{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new _h(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=xi.fromType(t.type);if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new Wt).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new Wt).setHex(r.value);break;case"v2":n.uniforms[e].value=(new Pt).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new se).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new Kt).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new Ct).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new Fe).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Pt).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Pt).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=i(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}}class Hh{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Gh extends Gi{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Gh.prototype.isInstancedBufferGeometry=!0;class Vh extends fh{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new _h(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),a=It(r.type,s),o=new ha(a,r.stride);return o.uuid=r.uuid,e[n]=o,o}const r=t.isInstancedBufferGeometry?new Gh:new Gi,s=t.data.index;if(void 0!==s){const t=It(s.type,s.array);r.setIndex(new Si(t,1))}const a=t.data.attributes;for(const e in a){const i=a[e];let s;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);s=new ua(e,i.itemSize,i.offset,i.normalized)}else{const t=It(i.type,i.array);s=new(i.isInstancedBufferAttribute?Ga:Si)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let a;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);a=new ua(e,r.itemSize,r.offset,r.normalized)}else{const t=It(r.type,r.array);a=new Si(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const h=t.data.boundingSphere;if(void 0!==h){const t=new se;void 0!==h.center&&t.fromArray(h.center),r.boundingSphere=new Ae(t,h.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const Wh={UVMapping:r,CubeReflectionMapping:s,CubeRefractionMapping:a,EquirectangularReflectionMapping:o,EquirectangularRefractionMapping:l,CubeUVReflectionMapping:h},jh={RepeatWrapping:c,ClampToEdgeWrapping:u,MirroredRepeatWrapping:d},qh={NearestFilter:p,NearestMipmapNearestFilter:f,NearestMipmapLinearFilter:m,LinearFilter:_,LinearMipmapNearestFilter:g,LinearMipmapLinearFilter:y};class Xh extends fh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=uh.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){uh.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}let Yh;Xh.prototype.isImageBitmapLoader=!0;const Zh={getContext:function(){return void 0===Yh&&(Yh=new(window.AudioContext||window.webkitAudioContext)),Yh},setContext:function(t){Yh=t}};class Jh extends fh{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new _h(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);Zh.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}}class Kh extends Uh{constructor(t,e,i=1){super(void 0,i);const n=(new Wt).set(t),r=(new Wt).set(e),s=new se(n.r,n.g,n.b),a=new se(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}}Kh.prototype.isHemisphereLightProbe=!0;class $h extends Uh{constructor(t,e=1){super(void 0,e);const i=(new Wt).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}$h.prototype.isAmbientLightProbe=!0;const Qh=new Fe,tc=new Fe,ec=new Fe;class ic{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=nc();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function nc(){return("undefined"==typeof performance?Date:performance).now()}const rc=new se,sc=new re,ac=new se,oc=new se;class lc extends oi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const hc=new se,cc=new re,uc=new se,dc=new se;class pc{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}class fc{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){a.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){re.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;re.multiplyQuaternionsFlat(t,s,t,e,t,i),re.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[i+a]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const mc=new RegExp("[\\[\\]\\.:\\/]","g"),_c="[^\\[\\]\\.:\\/]",gc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",yc=/((?:WC+[\/:])*)/.source.replace("WC",_c),vc=/(WCOD+)?/.source.replace("WCOD",gc),xc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_c),bc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_c),wc=new RegExp("^"+yc+vc+xc+bc+"$"),Mc=["material","materials","bones"];class Sc{constructor(t,e,i){this.path=e,this.parsedPath=i||Sc.parseTrackName(e),this.node=Sc.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Sc.Composite(t,e,i):new Sc(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(mc,"")}static parseTrackName(t){const e=wc.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Mc.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=Sc.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Sc.Composite=class{constructor(t,e,i){const n=i||Sc.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Sc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Sc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Sc.prototype.GetterByBindingType=[Sc.prototype._getValue_direct,Sc.prototype._getValue_array,Sc.prototype._getValue_arrayElement,Sc.prototype._getValue_toArray],Sc.prototype.SetterByBindingTypeAndVersioning=[[Sc.prototype._setValue_direct,Sc.prototype._setValue_direct_setNeedsUpdate,Sc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Sc.prototype._setValue_array,Sc.prototype._setValue_array_setNeedsUpdate,Sc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Sc.prototype._setValue_arrayElement,Sc.prototype._setValue_arrayElement_setNeedsUpdate,Sc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Sc.prototype._setValue_fromArray,Sc.prototype._setValue_fromArray_setNeedsUpdate,Sc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ec{constructor(){this.uuid=xt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let a,o=t.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){const c=arguments[h],u=c.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(c);for(let t=0,e=s;t!==e;++t)r[t].push(new Sc(c,i[t],n[t]))}else if(d<l){a=t[d];const o=--l,h=t[o];e[h.uuid]=d,t[d]=h,e[u]=o,t[o]=c;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new Sc(c,i[t],n[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,h=t[s];e[h.uuid]=l,t[l]=h,e[o]=s,t[s]=a;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[l];e[l]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],h=--s,c=t[h];e[o.uuid]=l,t[l]=o,e[c.uuid]=a,t[a]=c,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[a],r=e[h];e[l]=n,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);n=r.length,i[t]=n,s.push(t),a.push(e),r.push(c);for(let i=h,n=o.length;i!==n;++i){const n=o[i];c[i]=new Sc(n,t,e)}return c}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=i,s[i]=o,s.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}Ec.prototype.isAnimationObjectGroup=!0;class Tc{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:it,endingEnd:it};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===st)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(a);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=2202===i;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=nt,n.endingEnd=nt):(n.endingStart=t?this.zeroSlopeAtStart?nt:it:rt,n.endingEnd=e?this.zeroSlopeAtEnd?nt:it:rt)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}}class Ac extends mt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let h=l[o];void 0===h&&(h={},l[o]=h);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let c=h[l];if(void 0!==c)++c.referenceCount,s[t]=c;else{if(c=s[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;c=new fc(Sc.create(i,l,n),r.ValueTypeName,r.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),s[t]=c}a[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Ql(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?hh.findByName(n,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:2500),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const h=new Tc(this,s,e,i);return this._bindAction(h,l),this._addInactiveAction(h,a,r),h}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?hh.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==i;++a)e[a]._update(n,t,r,s);const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Ac.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Pc{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Pc(void 0===this.value.clone?this.value:this.value.clone())}}class Cc extends ha{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}Cc.prototype.isInstancedInterleavedBuffer=!0;class Lc{constructor(t,e,i,n,r){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}function Rc(t,e){return t.distance-e.distance}function Ic(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)Ic(n[t],e,i,!0)}}Lc.prototype.isGLBufferAttribute=!0;const Dc=new Pt;class Oc{constructor(t=new Pt(1/0,1/0),e=new Pt(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Dc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Dc.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Oc.prototype.isBox2=!0;const Nc=new se,Fc=new se;class kc{constructor(t=new se,e=new se){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Nc.subVectors(t,this.start),Fc.subVectors(this.end,this.start);const i=Fc.dot(Fc);let n=Fc.dot(Nc)/i;return e&&(n=bt(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const zc=new se,Uc=new se,Bc=new Fe,Hc=new Fe;class Gc extends no{constructor(t){const e=Vc(t),i=new Gi,n=[],r=[],s=new Wt(0,0,1),a=new Wt(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Di(n,3)),i.setAttribute("color",new Di(r,3)),super(i,new Ya({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Hc.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Bc.multiplyMatrices(Hc,r.matrixWorld),Uc.setFromMatrixPosition(Bc),n.setXYZ(i,Uc.x,Uc.y,Uc.z),Bc.multiplyMatrices(Hc,r.parent.matrixWorld),Uc.setFromMatrixPosition(Bc),n.setXYZ(i+1,Uc.x,Uc.y,Uc.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Vc(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,Vc(t.children[i]));return e}const Wc=new se,jc=new Wt,qc=new Wt;class Xc extends no{constructor(t=10,e=10,i=4473924,n=8947848){i=new Wt(i),n=new Wt(n);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,h=0,c=-a;t<=e;t++,c+=s){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);const e=t===r?i:n;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new Gi;h.setAttribute("position",new Di(o,3)),h.setAttribute("color",new Di(l,3)),super(h,new Ya({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Yc=new se,Zc=new se,Jc=new se,Kc=new se,$c=new fn;function Qc(t,e,i,n,r,s,a){Kc.set(r,s,a).unproject(n);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],Kc.x,Kc.y,Kc.z)}}const tu=new le;class eu extends no{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Gi;r.setIndex(new Si(i,1)),r.setAttribute("position",new Si(n,3)),super(r,new Ya({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&tu.setFromObject(this.object),tu.isEmpty())return;const e=tu.min,i=tu.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return no.prototype.copy.call(this,t),this.object=t.object,this}}const iu=new se;let nu,ru;class su extends no{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Gi;i.setAttribute("position",new Di(e,3)),i.setAttribute("color",new Di([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Ya({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Wt,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const au=new ArrayBuffer(4),ou=new Float32Array(au),lu=new Uint32Array(au),hu=new Uint32Array(512),cu=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(hu[t]=0,hu[256|t]=32768,cu[t]=24,cu[256|t]=24):e<-14?(hu[t]=1024>>-e-14,hu[256|t]=1024>>-e-14|32768,cu[t]=-e-1,cu[256|t]=-e-1):e<=15?(hu[t]=e+15<<10,hu[256|t]=e+15<<10|32768,cu[t]=13,cu[256|t]=13):e<128?(hu[t]=31744,hu[256|t]=64512,cu[t]=24,cu[256|t]=24):(hu[t]=31744,hu[256|t]=64512,cu[t]=13,cu[256|t]=13)}const uu=new Uint32Array(2048),du=new Uint32Array(64),pu=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;0==(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,uu[t]=e|i}for(let t=1024;t<2048;++t)uu[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)du[t]=t<<23;du[31]=1199570944,du[32]=2147483648;for(let t=33;t<63;++t)du[t]=2147483648+(t-32<<23);du[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(pu[t]=1024);go.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(go.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},zo.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},Xc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Gc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},fh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Hh.extractUrlBase(t)},fh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Oc.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Oc.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Oc.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Oc.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},le.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},le.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},le.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},le.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},le.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},qe.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Ae.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Tn.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},kc.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ct.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Ct.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Ct.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ct.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},Ct.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ct.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Fe.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Fe.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Fe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new se).setFromMatrixColumn(this,3)},Fe.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Fe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Fe.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Fe.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Fe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Fe.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Fe.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Fe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Fe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Fe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Fe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Fe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Fe.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Fe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Fe.prototype.makeFrustum=function(t,e,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,s)},Fe.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Mn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},re.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},re.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ne.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ne.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Ne.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},yi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},yi.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},yi.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},yi.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},yi.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},yi.barycoordFromPoint=function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),yi.getBarycoord(t,e,i,n,r)},yi.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),yi.getNormal(t,e,i,n)},Ko.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Ko.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new El(this,t)},Ko.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ll(this,t)},Pt.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Pt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Pt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},se.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},se.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},se.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},se.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},se.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},se.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},se.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},se.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},se.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Kt.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Kt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},oi.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},oi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},oi.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},oi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},oi.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(oi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),on.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(on.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Fa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},mn.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(bh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Si.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===dt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(dt)}}}),Si.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?dt:ut),this},Si.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Si.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Gi.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Gi.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Si(arguments[1],arguments[2])))},Gi.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Gi.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Gi.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Gi.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Gi.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Gi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ha.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?dt:ut),this},ha.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},El.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},El.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},El.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},la.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Pc.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(xi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Wt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(pn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),ra.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},ra.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},ra.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},ra.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},ra.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},ra.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},ra.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},ra.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},ra.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},ra.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},ra.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},ra.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},ra.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},ra.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},ra.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},ra.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},ra.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},ra.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},ra.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},ra.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},ra.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},ra.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},ra.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},ra.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},ra.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(ra.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?ot:at}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Xs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties($t.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),lc.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Jh).load(t,(function(t){e.setBuffer(t)})),this},pc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},gn.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},gn.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},qt.crossOrigin=void 0,qt.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new xh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},qt.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new yh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},qt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},qt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const fu={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i),e.ACESFilmicToneMapping=4,e.AddEquation=n,e.AddOperation=2,e.AdditiveAnimationBlendMode=st,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=Fh,e.AmbientLightProbe=$h,e.AnimationClip=hh,e.AnimationLoader=class extends fh{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new _h(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=hh.parse(t[i]);e.push(n)}return e}},e.AnimationMixer=Ac,e.AnimationObjectGroup=Ec,e.AnimationUtils=Jl,e.ArcCurve=vo,e.ArrayCamera=Ks,e.ArrowHelper=class extends oi{constructor(t=new se(0,0,1),e=new se(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===nu&&(nu=new Gi,nu.setAttribute("position",new Di([0,0,0,0,1,0],3)),ru=new Go(0,.5,1,5,1),ru.translate(0,-.5,0)),this.position.copy(e),this.line=new to(nu,new Ya({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new on(ru,new bi({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{iu.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(iu,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},e.Audio=lc,e.AudioAnalyser=pc,e.AudioContext=Zh,e.AudioListener=class extends oi{constructor(){super(),this.type="AudioListener",this.context=Zh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ic}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(rc,sc,ac),oc.set(0,0,-1).applyQuaternion(sc),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(rc.x,t),e.positionY.linearRampToValueAtTime(rc.y,t),e.positionZ.linearRampToValueAtTime(rc.z,t),e.forwardX.linearRampToValueAtTime(oc.x,t),e.forwardY.linearRampToValueAtTime(oc.y,t),e.forwardZ.linearRampToValueAtTime(oc.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(rc.x,rc.y,rc.z),e.setOrientation(oc.x,oc.y,oc.z,i.x,i.y,i.z)}},e.AudioLoader=Jh,e.AxesHelper=su,e.AxisHelper=class extends su{constructor(t){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),super(t)}},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=class extends vh{constructor(t){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),super(t)}},e.Bone=ka,e.BooleanKeyframeTrack=ih,e.BoundingBoxHelper=class extends eu{constructor(t,e){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),super(t,e)}},e.Box2=Oc,e.Box3=le,e.Box3Helper=class extends no{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Gi;n.setIndex(new Si(i,1)),n.setAttribute("position",new Di([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Ya({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},e.BoxBufferGeometry=hn,e.BoxGeometry=hn,e.BoxHelper=eu,e.BufferAttribute=Si,e.BufferGeometry=Gi,e.BufferGeometryLoader=Vh,e.ByteType=1010,e.Cache=uh,e.Camera=fn,e.CameraHelper=class extends no{constructor(t){const e=new Gi,i=new Ya({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={},a=new Wt(16755200),o=new Wt(16711680),l=new Wt(43775),h=new Wt(16777215),c=new Wt(3355443);function u(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}u("n1","n2",a),u("n2","n4",a),u("n4","n3",a),u("n3","n1",a),u("f1","f2",a),u("f2","f4",a),u("f4","f3",a),u("f3","f1",a),u("n1","f1",a),u("n2","f2",a),u("n3","f3",a),u("n4","f4",a),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.setAttribute("position",new Di(n,3)),e.setAttribute("color",new Di(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;$c.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qc("c",e,t,$c,0,0,-1),Qc("t",e,t,$c,0,0,1),Qc("n1",e,t,$c,-1,-1,-1),Qc("n2",e,t,$c,1,-1,-1),Qc("n3",e,t,$c,-1,1,-1),Qc("n4",e,t,$c,1,1,-1),Qc("f1",e,t,$c,-1,-1,1),Qc("f2",e,t,$c,1,-1,1),Qc("f3",e,t,$c,-1,1,1),Qc("f4",e,t,$c,1,1,1),Qc("u1",e,t,$c,.7,1.1,-1),Qc("u2",e,t,$c,-.7,1.1,-1),Qc("u3",e,t,$c,0,2,-1),Qc("cf1",e,t,$c,-1,0,1),Qc("cf2",e,t,$c,1,0,1),Qc("cf3",e,t,$c,0,-1,1),Qc("cf4",e,t,$c,0,1,1),Qc("cn1",e,t,$c,-1,0,-1),Qc("cn2",e,t,$c,1,0,-1),Qc("cn3",e,t,$c,0,-1,-1),Qc("cn4",e,t,$c,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=_o,e.CapsuleBufferGeometry=Bo,e.CapsuleGeometry=Bo,e.CatmullRomCurve3=Eo,e.CineonToneMapping=3,e.CircleBufferGeometry=Ho,e.CircleGeometry=Ho,e.ClampToEdgeWrapping=u,e.Clock=ic,e.Color=Wt,e.ColorKeyframeTrack=nh,e.ColorManagement=kt,e.CompressedTexture=mo,e.CompressedTextureLoader=class extends fh{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],a=new mo,o=new _h(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function h(h){o.load(t[h],(function(t){const i=r.parse(t,!0);s[h]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=_),a.image=s,a.format=i.format,a.needsUpdate=!0,e&&e(a))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)h(e);else o.load(t,(function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}a.image=s}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=_),a.format=i.format,a.needsUpdate=!0,e&&e(a)}),i,n);return a}},e.ConeBufferGeometry=Vo,e.ConeGeometry=Vo,e.CubeCamera=gn,e.CubeReflectionMapping=s,e.CubeRefractionMapping=a,e.CubeTexture=yn,e.CubeTextureLoader=yh,e.CubeUVReflectionMapping=h,e.CubicBezierCurve=Co,e.CubicBezierCurve3=Lo,e.CubicInterpolant=$l,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=go,e.CurvePath=ko,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=Go,e.CylinderGeometry=Go,e.Cylindrical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}},e.Data3DTexture=ee,e.DataArrayTexture=Qt,e.DataTexture=za,e.DataTexture2DArray=class extends Qt{constructor(t,e,i,n){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(t,e,i,n)}},e.DataTexture3D=class extends ee{constructor(t,e,i,n){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(t,e,i,n)}},e.DataTextureLoader=vh,e.DataUtils=class{static toHalfFloat(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=bt(t,-65504,65504),ou[0]=t;const e=lu[0],i=e>>23&511;return hu[i]+((8388607&e)>>cu[i])}static fromHalfFloat(t){const e=t>>10;return lu[0]=uu[pu[e]+(1023&t)]+du[e],ou[0]}},e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=ph,e.DepthFormat=T,e.DepthStencilFormat=A,e.DepthTexture=ea,e.DirectionalLight=Nh,e.DirectionalLightHelper=class extends oi{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new Gi;n.setAttribute("position",new Di([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Ya({fog:!1,toneMapped:!1});this.lightPlane=new to(n,r),this.add(this.lightPlane),n=new Gi,n.setAttribute("position",new Di([0,0,0,0,0,1],3)),this.targetLine=new to(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Yc.setFromMatrixPosition(this.light.matrixWorld),Zc.setFromMatrixPosition(this.light.target.matrixWorld),Jc.subVectors(Zc,Yc),this.lightPlane.lookAt(Zc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Zc),this.targetLine.scale.z=Jc.length()}},e.DiscreteInterpolant=th,e.DodecahedronBufferGeometry=jo,e.DodecahedronGeometry=jo,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=class extends Si{constructor(t,e){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),super(t,e),this.setUsage(dt)}},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=dt,e.DynamicReadUsage=35049,e.EdgesGeometry=Jo,e.EdgesHelper=class extends no{constructor(t,e){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),super(new Jo(t.geometry),new Ya({color:void 0!==e?e:16777215}))}},e.EllipseCurve=yo,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=o,e.EquirectangularRefractionMapping=l,e.Euler=qe,e.EventDispatcher=mt,e.ExtrudeBufferGeometry=El,e.ExtrudeGeometry=El,e.FaceColors=1,e.FileLoader=_h,e.FlatShading=1,e.Float16BufferAttribute=Ii,e.Float32Attribute=class extends Di{constructor(t,e){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),super(t,e)}},e.Float32BufferAttribute=Di,e.Float64Attribute=class extends Oi{constructor(t,e){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),super(t,e)}},e.Float64BufferAttribute=Oi,e.FloatType=w,e.Fog=oa,e.FogExp2=aa,e.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},e.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},e.FramebufferTexture=fo,e.FrontSide=0,e.Frustum=Tn,e.GLBufferAttribute=Lc,e.GLSL1="100",e.GLSL3=pt,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Xc,e.Group=$s,e.HalfFloatType=M,e.HemisphereLight=wh,e.HemisphereLightHelper=class extends oi{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new Pl(e);n.rotateY(.5*Math.PI),this.material=new bi({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new Si(s,3)),this.add(new on(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");jc.copy(this.light.color),qc.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?jc:qc;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Wc.setFromMatrixPosition(this.light.matrixWorld).negate())}},e.HemisphereLightProbe=Kh,e.IcosahedronBufferGeometry=Al,e.IcosahedronGeometry=Al,e.ImageBitmapLoader=Xh,e.ImageLoader=gh,e.ImageUtils=qt,e.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Ga,e.InstancedBufferGeometry=Gh,e.InstancedInterleavedBuffer=Cc,e.InstancedMesh=Xa,e.Int16Attribute=class extends Pi{constructor(t,e){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),super(t,e)}},e.Int16BufferAttribute=Pi,e.Int32Attribute=class extends Li{constructor(t,e){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),super(t,e)}},e.Int32BufferAttribute=Li,e.Int8Attribute=class extends Ei{constructor(t,e){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),super(t,e)}},e.Int8BufferAttribute=Ei,e.IntType=1013,e.InterleavedBuffer=ha,e.InterleavedBufferAttribute=ua,e.Interpolant=Kl,e.InterpolateDiscrete=Q,e.InterpolateLinear=tt,e.InterpolateSmooth=et,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=ct,e.KeyframeTrack=eh,e.LOD=La,e.LatheBufferGeometry=Uo,e.LatheGeometry=Uo,e.Layers=Xe,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=bh,e.LightProbe=Uh,e.Line=to,e.Line3=kc,e.LineBasicMaterial=Ya,e.LineCurve=Ro,e.LineCurve3=Io,e.LineDashedMaterial=Yl,e.LineLoop=ro,e.LinePieces=1,e.LineSegments=no,e.LineStrip=0,e.LinearEncoding=at,e.LinearFilter=_,e.LinearInterpolant=Ql,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=y,e.LinearMipmapNearestFilter=g,e.LinearSRGBColorSpace=ht,e.LinearToneMapping=1,e.Loader=fh,e.LoaderUtils=Hh,e.LoadingManager=dh,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=xi,e.MaterialLoader=Bh,e.Math=At,e.MathUtils=At,e.Matrix3=Ct,e.Matrix4=Fe,e.MaxEquation=104,e.Mesh=on,e.MeshBasicMaterial=bi,e.MeshDepthMaterial=js,e.MeshDistanceMaterial=qs,e.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},e.MeshLambertMaterial=ql,e.MeshMatcapMaterial=Xl,e.MeshNormalMaterial=jl,e.MeshPhongMaterial=Vl,e.MeshPhysicalMaterial=Gl,e.MeshStandardMaterial=Hl,e.MeshToonMaterial=Wl,e.MinEquation=103,e.MirroredRepeatWrapping=d,e.MixOperation=1,e.MultiMaterial=function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=p,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=m,e.NearestMipmapNearestFilter=f,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColorSpace="",e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=2500,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=rh,e.Object3D=oi,e.ObjectLoader=class extends fh{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?Hh.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new _h(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),i,n)}async loadAsync(t,e){const i=""===this.path?Hh.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new _h(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,i),h=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,h),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,n,a,s,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Ko).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Ha).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new Vh;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in zl?s=zl[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),i[a.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Bh;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const n=s.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),t.push(i[n.uuid])}n[s.uuid]=t}else void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=hh.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:It(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new dh(e);r=new gh(i),r.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){const t=[];for(let e=0,i=r.length;e<i;e++){const i=s(r[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new za(i.data,i.width,i.height)))}n[i.uuid]=new Xt(t)}else{const t=s(i.url);n[i.uuid]=new Xt(t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function r(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:It(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new gh(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],n=await r(i);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new za(n.data,n.width,n.height)))}i[n.uuid]=new Xt(t)}else{const t=await r(n.url);i[n.uuid]=new Xt(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image],o=a.data;let l;Array.isArray(o)?(l=new yn,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new za:new Jt,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,Wh)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],jh),l.wrapT=i(s.wrap[1],jh)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,qh)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,qh)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),n[s.uuid]=l}return n}parseObject(t,e,i,n,r){let s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function h(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function c(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":s=new la,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Wt(t.background):s.background=c(t.background)),void 0!==t.environment&&(s.environment=c(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new oa(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new aa(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new mn(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Un(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Fh(t.color,t.intensity);break;case"DirectionalLight":s=new Nh(t.color,t.intensity);break;case"PointLight":s=new Dh(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new kh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Ph(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new wh(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Uh).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=h(t.material),s=new Fa(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=h(t.material),s=new on(a,o);break;case"InstancedMesh":a=l(t.geometry),o=h(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;s=new Xa(a,o,e),s.instanceMatrix=new Ga(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new Ga(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new La;break;case"Line":s=new to(l(t.geometry),h(t.material));break;case"LineLoop":s=new ro(l(t.geometry),h(t.material));break;case"LineSegments":s=new no(l(t.geometry),h(t.material));break;case"PointCloud":case"Points":s=new co(l(t.geometry),h(t.material));break;case"Sprite":s=new Ta(h(t.material));break;case"Group":s=new $s;break;case"Bone":s=new ka;break;default:s=new oi}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=Pl,e.OctahedronGeometry=Pl,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=Un,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=Xn,e.ParametricGeometry=class extends Gi{constructor(){console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),super()}},e.Particle=class extends Ta{constructor(t){console.warn("THREE.Particle has been renamed to THREE.Sprite."),super(t)}},e.ParticleBasicMaterial=class extends so{constructor(t){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),super(t)}},e.ParticleSystem=class extends co{constructor(t,e){console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),super(t,e)}},e.ParticleSystemMaterial=class extends so{constructor(t){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),super(t)}},e.Path=zo,e.PerspectiveCamera=mn,e.Plane=Mn,e.PlaneBufferGeometry=Cn,e.PlaneGeometry=Cn,e.PlaneHelper=class extends to{constructor(t,e=1,i=16776960){const n=i,r=new Gi;r.setAttribute("position",new Di([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Ya({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Gi;s.setAttribute("position",new Di([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new on(s,new bi({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},e.PointCloud=class extends co{constructor(t,e){console.warn("THREE.PointCloud has been renamed to THREE.Points."),super(t,e)}},e.PointCloudMaterial=class extends so{constructor(t){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),super(t)}},e.PointLight=Dh,e.PointLightHelper=class extends on{constructor(t,e,i){super(new Rl(e,4,2),new bi({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},e.Points=co,e.PointsMaterial=so,e.PolarGridHelper=class extends no{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new Wt(r),s=new Wt(s);const a=[],o=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,h=Math.cos(n)*t;a.push(0,0,0),a.push(l,0,h);const c=1&i?r:s;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let e=0;e<=i;e++){const l=1&e?r:s,h=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*h,r=Math.cos(e)*h;a.push(i,0,r),o.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*h,r=Math.cos(e)*h,a.push(i,0,r),o.push(l.r,l.g,l.b)}}const l=new Gi;l.setAttribute("position",new Di(a,3)),l.setAttribute("color",new Di(o,3)),super(l,new Ya({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},e.PolyhedronBufferGeometry=Wo,e.PolyhedronGeometry=Wo,e.PositionalAudio=class extends lc{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(hc,cc,uc),dc.set(0,0,1).applyQuaternion(cc);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(hc.x,t),e.positionY.linearRampToValueAtTime(hc.y,t),e.positionZ.linearRampToValueAtTime(hc.z,t),e.orientationX.linearRampToValueAtTime(dc.x,t),e.orientationY.linearRampToValueAtTime(dc.y,t),e.orientationZ.linearRampToValueAtTime(dc.z,t)}else e.setPosition(hc.x,hc.y,hc.z),e.setOrientation(dc.x,dc.y,dc.z)}},e.PropertyBinding=Sc,e.PropertyMixer=fc,e.QuadraticBezierCurve=Do,e.QuadraticBezierCurve3=Oo,e.Quaternion=re,e.QuaternionKeyframeTrack=ah,e.QuaternionLinearInterpolant=sh,e.REVISION=i,e.RGBADepthPacking=3201,e.RGBAFormat=E,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=Z,e.RGBA_ASTC_10x5_Format=q,e.RGBA_ASTC_10x6_Format=X,e.RGBA_ASTC_10x8_Format=Y,e.RGBA_ASTC_12x10_Format=J,e.RGBA_ASTC_12x12_Format=K,e.RGBA_ASTC_4x4_Format=z,e.RGBA_ASTC_5x4_Format=U,e.RGBA_ASTC_5x5_Format=B,e.RGBA_ASTC_6x5_Format=H,e.RGBA_ASTC_6x6_Format=G,e.RGBA_ASTC_8x5_Format=V,e.RGBA_ASTC_8x6_Format=W,e.RGBA_ASTC_8x8_Format=j,e.RGBA_BPTC_Format=$,e.RGBA_ETC2_EAC_Format=k,e.RGBA_PVRTC_2BPPV1_Format=N,e.RGBA_PVRTC_4BPPV1_Format=O,e.RGBA_S3TC_DXT1_Format=C,e.RGBA_S3TC_DXT3_Format=L,e.RGBA_S3TC_DXT5_Format=R,e.RGBFormat=1022,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=F,e.RGB_PVRTC_2BPPV1_Format=D,e.RGB_PVRTC_4BPPV1_Format=I,e.RGB_S3TC_DXT1_Format=P,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=Bl,e.Ray=Ne,e.Raycaster=class{constructor(t,e,i=0,n=1/0){this.ray=new Ne(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new Xe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Ic(t,this,i,e),i.sort(Rc),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)Ic(t[n],this,i,e);return i.sort(Rc),i}},e.RectAreaLight=kh,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=c,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Cl,e.RingGeometry=Cl,e.SRGBColorSpace=lt,e.Scene=la,e.SceneUtils=fu,e.ShaderChunk=Ln,e.ShaderLib=In,e.ShaderMaterial=pn,e.ShadowMaterial=Ul,e.Shape=Ko,e.ShapeBufferGeometry=Ll,e.ShapeGeometry=Ll,e.ShapePath=class{constructor(){this.type="ShapePath",this.color=new Wt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new zo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Ko;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],a=e[s],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],o=-o,a=e[r],l=-l),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return n}const r=wl.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return i(s);let a,o,l;const h=[];if(1===s.length)return o=s[0],l=new Ko,l.curves=o.curves,h.push(l),h;let c=!r(s[0].getPoints());c=t?!c:c;const u=[],d=[];let p,f,m=[],_=0;d[_]=void 0,m[_]=[];for(let e=0,i=s.length;e<i;e++)o=s[e],p=o.getPoints(),a=r(p),a=t?!a:a,a?(!c&&d[_]&&_++,d[_]={s:new Ko,p},d[_].s.curves=o.curves,c&&_++,m[_]=[]):m[_].push({h:o,p:p[0]});if(!d[0])return i(s);if(d.length>1){let t=!1,e=0;for(let t=0,e=d.length;t<e;t++)u[t]=[];for(let i=0,r=d.length;i<r;i++){const r=m[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<d.length;r++)n(a.p,d[r].p)&&(i!==r&&e++,o?(o=!1,u[r].push(a)):t=!0);o&&u[i].push(a)}}e>0&&!1===t&&(m=u)}for(let t=0,e=d.length;t<e;t++){l=d[t].s,h.push(l),f=m[t];for(let t=0,e=f.length;t<e;t++)l.holes.push(f[t].h)}return h}},e.ShapeUtils=wl,e.ShortType=1011,e.Skeleton=Ha,e.SkeletonHelper=Gc,e.SkinnedMesh=Fa,e.SmoothShading=2,e.Source=Xt,e.Sphere=Ae,e.SphereBufferGeometry=Rl,e.SphereGeometry=Rl,e.Spherical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(bt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},e.SphericalHarmonics3=zh,e.SplineCurve=No,e.SpotLight=Ph,e.SpotLightHelper=class extends oi{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new Gi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Di(n,3));const r=new Ya({fog:!1,toneMapped:!1});this.cone=new no(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),zc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(zc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},e.Sprite=Ta,e.SpriteMaterial=da,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=ut,e.StaticReadUsage=35045,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new mn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new mn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,ec.copy(t.projectionMatrix);const i=e.eyeSep/2,n=i*e.near/e.focus,r=e.near*Math.tan(yt*e.fov*.5)/e.zoom;let s,a;tc.elements[12]=-i,Qh.elements[12]=i,s=-r*e.aspect+n,a=r*e.aspect+n,ec.elements[0]=2*e.near/(a-s),ec.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(ec),s=-r*e.aspect-n,a=r*e.aspect-n,ec.elements[0]=2*e.near/(a-s),ec.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(ec)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(tc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Qh)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=oh,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=Il,e.TetrahedronGeometry=Il,e.TextGeometry=class extends Gi{constructor(){console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),super()}},e.Texture=Jt,e.TextureLoader=xh,e.TorusBufferGeometry=Dl,e.TorusGeometry=Dl,e.TorusKnotBufferGeometry=Ol,e.TorusKnotGeometry=Ol,e.Triangle=yi,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Nl,e.TubeGeometry=Nl,e.UVMapping=r,e.Uint16Attribute=class extends Ci{constructor(t,e){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),super(t,e)}},e.Uint16BufferAttribute=Ci,e.Uint32Attribute=class extends Ri{constructor(t,e){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),super(t,e)}},e.Uint32BufferAttribute=Ri,e.Uint8Attribute=class extends Ti{constructor(t,e){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),super(t,e)}},e.Uint8BufferAttribute=Ti,e.Uint8ClampedAttribute=class extends Ai{constructor(t,e){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),super(t,e)}},e.Uint8ClampedBufferAttribute=Ai,e.Uniform=Pc,e.UniformsLib=Rn,e.UniformsUtils=dn,e.UnsignedByteType=v,e.UnsignedInt248Type=S,e.UnsignedIntType=b,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShortType=x,e.VSMShadowMap=3,e.Vector2=Pt,e.Vector3=se,e.Vector4=Kt,e.VectorKeyframeTrack=lh,e.Vertex=class extends se{constructor(t,e,i){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),super(t,e,i)}},e.VertexColors=2,e.VideoTexture=po,e.WebGL1Renderer=sa,e.WebGL3DRenderTarget=ie,e.WebGLArrayRenderTarget=te,e.WebGLCubeRenderTarget=vn,e.WebGLMultipleRenderTargets=ne,e.WebGLMultisampleRenderTarget=class extends $t{constructor(t,e,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(t,e,i),this.samples=4}},e.WebGLRenderTarget=$t,e.WebGLRenderTargetCube=class extends vn{constructor(t,e,i){console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),super(t,i)}},e.WebGLRenderer=ra,e.WebGLUtils=Js,e.WireframeGeometry=Fl,e.WireframeHelper=class extends no{constructor(t,e){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),super(new Fl(t.geometry),new Ya({color:void 0!==e?e:16777215}))}},e.WrapAroundEnding=rt,e.XHRLoader=class extends _h{constructor(t){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),super(t)}},e.ZeroCurvatureEnding=it,e.ZeroFactor=200,e.ZeroSlopeEnding=nt,e.ZeroStencilOp=0,e._SRGBAFormat=ft,e.sRGBEncoding=ot},9477:(t,e,i)=>{"use strict";i.d(e,{$V:()=>Tl,DvJ:()=>wi,FM8:()=>tt,HW6:()=>po,IEO:()=>qs,Ilk:()=>ft,Kj0:()=>xi,Ltg:()=>bt,Ny0:()=>ma,Pa4:()=>Tt,RsA:()=>n,TlE:()=>je,Tme:()=>Pe,TyD:()=>f,_12:()=>Gi,_Li:()=>r,_fP:()=>Et,a$l:()=>Ye,bnF:()=>Fa,ehD:()=>s,ejS:()=>oa,fHI:()=>Na,fQA:()=>Ol,iKG:()=>$i,iMs:()=>Ml,jyz:()=>Ti,nls:()=>$s,oa8:()=>po,pBf:()=>j,u9r:()=>ii,uWy:()=>d,vBJ:()=>Ge,x12:()=>ra,xEZ:()=>xt,xfE:()=>o,xo$:()=>fo,yGw:()=>ne,ywz:()=>g,zHn:()=>ie});const n={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r=1,s=2,a=100,o=300,l=301,h=302,c=306,u=1e3,d=1001,p=1002,f=1003,m=1006,_=1008,g=1009,y=1012,v=1014,x=1015,b=1016,w=1020,M=1023,S=1026,E=1027,T=33776,A=33777,P=33778,C=33779,L=2300,R=2301,I=2302,D=2400,O=2401,N=2402,F=3e3,k=3001,z="srgb",U="srgb-linear",B=7680,H=35044,G=35048,V="300 es",W=1035;class j{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const q=[];for(let t=0;t<256;t++)q[t]=(t<16?"0":"")+t.toString(16);const X=Math.PI/180,Y=180/Math.PI;function Z(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(q[255&t]+q[t>>8&255]+q[t>>16&255]+q[t>>24&255]+"-"+q[255&e]+q[e>>8&255]+"-"+q[e>>16&15|64]+q[e>>24&255]+"-"+q[63&i|128]+q[i>>8&255]+"-"+q[i>>16&255]+q[i>>24&255]+q[255&n]+q[n>>8&255]+q[n>>16&255]+q[n>>24&255]).toLowerCase()}function J(t,e,i){return Math.max(e,Math.min(i,t))}function K(t,e,i){return(1-i)*t+i*e}function $(t){return 0==(t&t-1)&&0!==t}function Q(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}class tt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}tt.prototype.isVector2=!0;class et{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=a,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],_=n[6],g=n[1],y=n[4],v=n[7],x=n[2],b=n[5],w=n[8];return r[0]=s*f+a*g+o*x,r[3]=s*m+a*y+o*b,r[6]=s*_+a*v+o*w,r[1]=l*f+h*g+c*x,r[4]=l*m+h*y+c*b,r[7]=l*_+h*v+c*w,r[2]=u*f+d*g+p*x,r[5]=u*m+d*y+p*b,r[8]=u*_+d*v+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8];return e*s*h-e*a*l-i*r*h+i*a*o+n*r*l-n*s*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=h*s-a*l,u=a*o-h*r,d=l*r-s*o,p=e*c+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=c*f,t[1]=(n*l-h*i)*f,t[2]=(a*i-n*s)*f,t[3]=u*f,t[4]=(h*e-n*o)*f,t[5]=(n*r-a*e)*f,t[6]=d*f,t[7]=(i*o-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],h=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*h,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*h,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function it(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}function nt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function rt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function st(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}et.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const at={[z]:{[U]:rt},[U]:{[z]:st}},ot={legacyMode:!0,get workingColorSpace(){return U},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(at[e]&&void 0!==at[e][i]){const n=at[e][i];return t.r=n(t.r),t.g=n(t.g),t.b=n(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},lt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ht={r:0,g:0,b:0},ct={h:0,s:0,l:0},ut={h:0,s:0,l:0};function dt(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function pt(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class ft{constructor(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,ot.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n="srgb-linear"){return this.r=t,this.g=e,this.b=i,ot.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n="srgb-linear"){if(t=(t%(r=1)+r)%r,e=J(e,0,1),i=J(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=dt(r,n,t+1/3),this.g=dt(r,n,t),this.b=dt(r,n,t-1/3)}var r;return ot.toWorkingColorSpace(this,n),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,ot.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,ot.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(t[1])/360,r=parseInt(t[2],10)/100,s=parseInt(t[3],10)/100;return i(t[4]),this.setHSL(n,r,s,e)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,ot.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,ot.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=lt[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=rt(t.r),this.g=rt(t.g),this.b=rt(t.b),this}copyLinearToSRGB(t){return this.r=st(t.r),this.g=st(t.g),this.b=st(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return ot.fromWorkingColorSpace(pt(this,ht),t),J(255*ht.r,0,255)<<16^J(255*ht.g,0,255)<<8^J(255*ht.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){ot.fromWorkingColorSpace(pt(this,ht),e);const i=ht.r,n=ht.g,r=ht.b,s=Math.max(i,n,r),a=Math.min(i,n,r);let o,l;const h=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=h<=.5?t/(s+a):t/(2-s-a),s){case i:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-i)/t+2;break;case r:o=(i-n)/t+4}o/=6}return t.h=o,t.s=l,t.l=h,t}getRGB(t,e="srgb-linear"){return ot.fromWorkingColorSpace(pt(this,ht),e),t.r=ht.r,t.g=ht.g,t.b=ht.b,t}getStyle(t="srgb"){return ot.fromWorkingColorSpace(pt(this,ht),t),t!==z?`color(${t} ${ht.r} ${ht.g} ${ht.b})`:`rgb(${255*ht.r|0},${255*ht.g|0},${255*ht.b|0})`}offsetHSL(t,e,i){return this.getHSL(ct),ct.h+=t,ct.s+=e,ct.l+=i,this.setHSL(ct.h,ct.s,ct.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(ct),t.getHSL(ut);const i=K(ct.h,ut.h,e),n=K(ct.s,ut.s,e),r=K(ct.l,ut.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let mt;ft.NAMES=lt,ft.prototype.isColor=!0,ft.prototype.r=1,ft.prototype.g=1,ft.prototype.b=1;class _t{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===mt&&(mt=nt("canvas")),mt.width=t.width,mt.height=t.height;const i=mt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=mt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=nt("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*rt(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*rt(e[t]/255)):e[t]=rt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class gt{constructor(t=null){this.uuid=Z(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(yt(n[e].image)):t.push(yt(n[e]))}else t=yt(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function yt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?_t.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}gt.prototype.isSource=!0;let vt=0;class xt extends j{constructor(t=xt.DEFAULT_IMAGE,e=xt.DEFAULT_MAPPING,i=d,n=d,r=1006,s=1008,a=1023,o=g,l=1,h=3e3){super(),Object.defineProperty(this,"id",{value:vt++}),this.uuid=Z(),this.name="",this.source=new gt(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new tt(0,0),this.repeat=new tt(1,1),this.center=new tt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new et,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==o)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case u:t.x=t.x-Math.floor(t.x);break;case d:t.x=t.x<0?0:1;break;case p:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case u:t.y=t.y-Math.floor(t.y);break;case d:t.y=t.y<0?0:1;break;case p:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}xt.DEFAULT_IMAGE=null,xt.DEFAULT_MAPPING=o,xt.prototype.isTexture=!0;class bt{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,a=.1,o=t.elements,l=o[0],h=o[4],c=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],_=o[10];if(Math.abs(h-u)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(h+u)<a&&Math.abs(c+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+_-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,g=(_+1)/2,y=(h+u)/4,v=(c+f)/4,x=(p+m)/4;return t>o&&t>g?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=v/i):o>g?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=y/n,r=x/n):g<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(g),i=v/r,n=x/r),this.set(i,n,r,e),this}let g=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(g)<.001&&(g=1),this.x=(m-p)/g,this.y=(c-f)/g,this.z=(u-h)/g,this.w=Math.acos((l+d+_-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}bt.prototype.isVector4=!0;class wt extends j{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new bt(0,0,t,e),this.scissorTest=!1,this.viewport=new bt(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new xt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:m,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new gt(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}wt.prototype.isWebGLRenderTarget=!0;class Mt extends xt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=f,this.minFilter=f,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Mt.prototype.isDataArrayTexture=!0,class extends wt{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Mt(null,t,e,i),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class St extends xt{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=f,this.minFilter=f,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}St.prototype.isData3DTexture=!0,class extends wt{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new St(null,t,e,i),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class extends wt{constructor(t,e,i,n={}){super(t,e,n);const r=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}.prototype.isWebGLMultipleRenderTargets=!0;class Et{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(n/2),c=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>c){const t=2*Math.sqrt(1+i-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-i-c);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(J(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+s*a+n*l-r*o,this._y=n*h+s*o+r*a-i*l,this._z=r*h+s*l+i*o-n*a,this._w=s*h-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}Et.prototype.isQuaternion=!0;class Tt{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Pt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Pt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,h=o*i+a*e-r*n,c=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+h*-a-c*-s,this.y=h*o+u*-s+c*-r-l*-a,this.z=c*o+u*-a+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return At.copy(this).projectOnVector(t),this.sub(At)}reflect(t){return this.sub(At.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(J(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Tt.prototype.isVector3=!0;const At=new Tt,Pt=new Et;class Ct{constructor(t=new Tt(1/0,1/0,1/0),e=new Tt(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>s&&(s=h),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Rt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)Rt.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(Rt)}else null===i.boundingBox&&i.computeBoundingBox(),It.copy(i.boundingBox),It.applyMatrix4(t.matrixWorld),this.union(It);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Rt),Rt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ut),Bt.subVectors(this.max,Ut),Dt.subVectors(t.a,Ut),Ot.subVectors(t.b,Ut),Nt.subVectors(t.c,Ut),Ft.subVectors(Ot,Dt),kt.subVectors(Nt,Ot),zt.subVectors(Dt,Nt);let e=[0,-Ft.z,Ft.y,0,-kt.z,kt.y,0,-zt.z,zt.y,Ft.z,0,-Ft.x,kt.z,0,-kt.x,zt.z,0,-zt.x,-Ft.y,Ft.x,0,-kt.y,kt.x,0,-zt.y,zt.x,0];return!!Vt(e,Dt,Ot,Nt,Bt)&&(e=[1,0,0,0,1,0,0,0,1],!!Vt(e,Dt,Ot,Nt,Bt)&&(Ht.crossVectors(Ft,kt),e=[Ht.x,Ht.y,Ht.z],Vt(e,Dt,Ot,Nt,Bt)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Rt.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Rt).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Lt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Lt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Lt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Lt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Lt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Lt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Lt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Lt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Lt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Ct.prototype.isBox3=!0;const Lt=[new Tt,new Tt,new Tt,new Tt,new Tt,new Tt,new Tt,new Tt],Rt=new Tt,It=new Ct,Dt=new Tt,Ot=new Tt,Nt=new Tt,Ft=new Tt,kt=new Tt,zt=new Tt,Ut=new Tt,Bt=new Tt,Ht=new Tt,Gt=new Tt;function Vt(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){Gt.fromArray(t,s);const a=r.x*Math.abs(Gt.x)+r.y*Math.abs(Gt.y)+r.z*Math.abs(Gt.z),o=e.dot(Gt),l=i.dot(Gt),h=n.dot(Gt);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>a)return!1}return!0}const Wt=new Ct,jt=new Tt,qt=new Tt,Xt=new Tt;class Yt{constructor(t=new Tt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Wt.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Xt.subVectors(t,this.center);const e=Xt.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(Xt.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?qt.set(0,0,1).multiplyScalar(t.radius):qt.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(jt.copy(t.center).add(qt)),this.expandByPoint(jt.copy(t.center).sub(qt)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Zt=new Tt,Jt=new Tt,Kt=new Tt,$t=new Tt,Qt=new Tt,te=new Tt,ee=new Tt;class ie{constructor(t=new Tt,e=new Tt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Zt)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Zt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Zt.copy(this.direction).multiplyScalar(e).add(this.origin),Zt.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Jt.copy(t).add(e).multiplyScalar(.5),Kt.copy(e).sub(t).normalize(),$t.copy(this.origin).sub(Jt);const r=.5*t.distanceTo(e),s=-this.direction.dot(Kt),a=$t.dot(this.direction),o=-$t.dot(Kt),l=$t.lengthSq(),h=Math.abs(1-s*s);let c,u,d,p;if(h>0)if(c=s*o-a,u=s*a-o,p=r*h,c>=0)if(u>=-p)if(u<=p){const t=1/h;c*=t,u*=t,d=c*(c+s*u+2*a)+u*(s*c+u+2*o)+l}else u=r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u=-r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u<=-p?(c=Math.max(0,-(-s*r+a)),u=c>0?-r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l):u<=p?(c=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(c=Math.max(0,-(s*r+a)),u=c>0?r:Math.min(Math.max(-r,-o),r),d=-c*c+u*(u+2*o)+l);else u=s>0?-r:r,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(Kt).multiplyScalar(u).add(Jt),d}intersectSphere(t,e){Zt.subVectors(t.center,this.origin);const i=Zt.dot(this.direction),n=Zt.dot(Zt)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,s=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,s=(t.min.y-u.y)*h),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),c>=0?(a=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(a=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Zt)}intersectTriangle(t,e,i,n,r){Qt.subVectors(e,t),te.subVectors(i,t),ee.crossVectors(Qt,te);let s,a=this.direction.dot(ee);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}$t.subVectors(this.origin,t);const o=s*this.direction.dot(te.crossVectors($t,te));if(o<0)return null;const l=s*this.direction.dot(Qt.cross($t));if(l<0)return null;if(o+l>a)return null;const h=-s*$t.dot(ee);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ne{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){const _=this.elements;return _[0]=t,_[4]=e,_[8]=i,_[12]=n,_[1]=r,_[5]=s,_[9]=a,_[13]=o,_[2]=l,_[6]=h,_[10]=c,_[14]=u,_[3]=d,_[7]=p,_[11]=f,_[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ne).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/re.setFromMatrixColumn(t,0).length(),r=1/re.setFromMatrixColumn(t,1).length(),s=1/re.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=n*c+i,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ae,t,oe)}lookAt(t,e,i){const n=this.elements;return ce.subVectors(t,e),0===ce.lengthSq()&&(ce.z=1),ce.normalize(),le.crossVectors(i,ce),0===le.lengthSq()&&(1===Math.abs(i.z)?ce.x+=1e-4:ce.z+=1e-4,ce.normalize(),le.crossVectors(i,ce)),le.normalize(),he.crossVectors(ce,le),n[0]=le.x,n[4]=he.x,n[8]=ce.x,n[1]=le.y,n[5]=he.y,n[9]=ce.y,n[2]=le.z,n[6]=he.z,n[10]=ce.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],_=i[14],g=i[3],y=i[7],v=i[11],x=i[15],b=n[0],w=n[4],M=n[8],S=n[12],E=n[1],T=n[5],A=n[9],P=n[13],C=n[2],L=n[6],R=n[10],I=n[14],D=n[3],O=n[7],N=n[11],F=n[15];return r[0]=s*b+a*E+o*C+l*D,r[4]=s*w+a*T+o*L+l*O,r[8]=s*M+a*A+o*R+l*N,r[12]=s*S+a*P+o*I+l*F,r[1]=h*b+c*E+u*C+d*D,r[5]=h*w+c*T+u*L+d*O,r[9]=h*M+c*A+u*R+d*N,r[13]=h*S+c*P+u*I+d*F,r[2]=p*b+f*E+m*C+_*D,r[6]=p*w+f*T+m*L+_*O,r[10]=p*M+f*A+m*R+_*N,r[14]=p*S+f*P+m*I+_*F,r[3]=g*b+y*E+v*C+x*D,r[7]=g*w+y*T+v*L+x*O,r[11]=g*M+y*A+v*R+x*N,r[15]=g*S+y*P+v*I+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-n*l*c-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+i*s*d+r*a*h-i*l*h)+t[15]*(-n*a*h-e*o*c+e*a*u+n*s*c-i*s*u+i*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],_=t[15],g=c*m*l-f*u*l+f*o*d-a*m*d-c*o*_+a*u*_,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*_-s*u*_,v=h*f*l-p*c*l+p*a*d-s*f*d-h*a*_+s*c*_,x=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,b=e*g+i*y+n*v+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=g*w,t[1]=(f*u*r-c*m*r-f*n*d+i*m*d+c*n*_-i*u*_)*w,t[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*_+i*o*_)*w,t[3]=(c*o*r-a*u*r-c*n*l+i*u*l+a*n*d-i*o*d)*w,t[4]=y*w,t[5]=(h*m*r-p*u*r+p*n*d-e*m*d-h*n*_+e*u*_)*w,t[6]=(p*o*r-s*m*r-p*n*l+e*m*l+s*n*_-e*o*_)*w,t[7]=(s*u*r-h*o*r+h*n*l-e*u*l-s*n*d+e*o*d)*w,t[8]=v*w,t[9]=(p*c*r-h*f*r-p*i*d+e*f*d+h*i*_-e*c*_)*w,t[10]=(s*f*r-p*a*r+p*i*l-e*f*l-s*i*_+e*a*_)*w,t[11]=(h*a*r-s*c*r-h*i*l+e*c*l+s*i*d-e*a*d)*w,t[12]=x*w,t[13]=(h*f*n-p*c*n+p*i*u-e*f*u-h*i*m+e*c*m)*w,t[14]=(p*a*n-s*f*n-p*i*o+e*f*o+s*i*m-e*a*m)*w,t[15]=(s*c*n-h*a*n+h*i*o-e*c*o-s*i*u+e*a*u)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+i,h*o-n*s,0,l*o-n*a,h*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,_=a*c,g=o*l,y=o*h,v=o*c,x=i.x,b=i.y,w=i.z;return n[0]=(1-(f+_))*x,n[1]=(d+v)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-v)*b,n[5]=(1-(u+_))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(m-g)*w,n[10]=(1-(u+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=re.set(n[0],n[1],n[2]).length();const s=re.set(n[4],n[5],n[6]).length(),a=re.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],se.copy(this);const o=1/r,l=1/s,h=1/a;return se.elements[0]*=o,se.elements[1]*=o,se.elements[2]*=o,se.elements[4]*=l,se.elements[5]*=l,se.elements[6]*=l,se.elements[8]*=h,se.elements[9]*=h,se.elements[10]*=h,e.setFromRotationMatrix(se),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),h=1/(s-r),c=(e+t)*o,u=(i+n)*l,d=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}ne.prototype.isMatrix4=!0;const re=new Tt,se=new ne,ae=new Tt(0,0,0),oe=new Tt(1,1,1),le=new Tt,he=new Tt,ce=new Tt,ue=new ne,de=new Et;class pe{constructor(t=0,e=0,i=0,n=pe.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(J(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-J(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(J(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-J(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(J(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-J(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return ue.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ue,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return de.setFromEuler(this),this.setFromQuaternion(de,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}pe.prototype.isEuler=!0,pe.DefaultOrder="XYZ",pe.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class fe{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let me=0;const _e=new Tt,ge=new Et,ye=new ne,ve=new Tt,xe=new Tt,be=new Tt,we=new Et,Me=new Tt(1,0,0),Se=new Tt(0,1,0),Ee=new Tt(0,0,1),Te={type:"added"},Ae={type:"removed"};class Pe extends j{constructor(){super(),Object.defineProperty(this,"id",{value:me++}),this.uuid=Z(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pe.DefaultUp.clone();const t=new Tt,e=new pe,i=new Et,n=new Tt(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ne},normalMatrix:{value:new et}}),this.matrix=new ne,this.matrixWorld=new ne,this.matrixAutoUpdate=Pe.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ge.setFromAxisAngle(t,e),this.quaternion.multiply(ge),this}rotateOnWorldAxis(t,e){return ge.setFromAxisAngle(t,e),this.quaternion.premultiply(ge),this}rotateX(t){return this.rotateOnAxis(Me,t)}rotateY(t){return this.rotateOnAxis(Se,t)}rotateZ(t){return this.rotateOnAxis(Ee,t)}translateOnAxis(t,e){return _e.copy(t).applyQuaternion(this.quaternion),this.position.add(_e.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Me,t)}translateY(t){return this.translateOnAxis(Se,t)}translateZ(t){return this.translateOnAxis(Ee,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ye.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ve.copy(t):ve.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),xe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ye.lookAt(xe,ve,this.up):ye.lookAt(ve,xe,this.up),this.quaternion.setFromRotationMatrix(ye),n&&(ye.extractRotation(n.matrixWorld),ge.setFromRotationMatrix(ye),this.quaternion.premultiply(ge.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Te)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ae)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Ae)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ye.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ye.multiply(t.parent.matrixWorld)),t.applyMatrix4(ye),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,t,be),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,we,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),h=s(t.animations),c=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),h.length>0&&(i.animations=h),c.length>0&&(i.nodes=c)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Pe.DefaultUp=new Tt(0,1,0),Pe.DefaultMatrixAutoUpdate=!0,Pe.prototype.isObject3D=!0;const Ce=new Tt,Le=new Tt,Re=new Tt,Ie=new Tt,De=new Tt,Oe=new Tt,Ne=new Tt,Fe=new Tt,ke=new Tt,ze=new Tt;class Ue{constructor(t=new Tt,e=new Tt,i=new Tt){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Ce.subVectors(t,e),n.cross(Ce);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){Ce.subVectors(n,e),Le.subVectors(i,e),Re.subVectors(t,e);const s=Ce.dot(Ce),a=Ce.dot(Le),o=Ce.dot(Re),l=Le.dot(Le),h=Le.dot(Re),c=s*l-a*a;if(0===c)return r.set(-2,-1,-1);const u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Ie),Ie.x>=0&&Ie.y>=0&&Ie.x+Ie.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,Ie),o.set(0,0),o.addScaledVector(r,Ie.x),o.addScaledVector(s,Ie.y),o.addScaledVector(a,Ie.z),o}static isFrontFacing(t,e,i,n){return Ce.subVectors(i,e),Le.subVectors(t,e),Ce.cross(Le).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ce.subVectors(this.c,this.b),Le.subVectors(this.a,this.b),.5*Ce.cross(Le).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ue.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Ue.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return Ue.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return Ue.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ue.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;De.subVectors(n,i),Oe.subVectors(r,i),Fe.subVectors(t,i);const o=De.dot(Fe),l=Oe.dot(Fe);if(o<=0&&l<=0)return e.copy(i);ke.subVectors(t,n);const h=De.dot(ke),c=Oe.dot(ke);if(h>=0&&c<=h)return e.copy(n);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return s=o/(o-h),e.copy(i).addScaledVector(De,s);ze.subVectors(t,r);const d=De.dot(ze),p=Oe.dot(ze);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(Oe,a);const m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return Ne.subVectors(r,n),a=(c-h)/(c-h+(d-p)),e.copy(n).addScaledVector(Ne,a);const _=1/(m+f+u);return s=f*_,a=u*_,e.copy(i).addScaledVector(De,s).addScaledVector(Oe,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Be=0;class He extends j{constructor(){super(),Object.defineProperty(this,"id",{value:Be++}),this.uuid=Z(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=a,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=B,this.stencilZFail=B,this.stencilZPass=B,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}He.prototype.isMaterial=!0,He.fromType=function(){return null};class Ge extends He{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Ge.prototype.isMeshBasicMaterial=!0;const Ve=new Tt,We=new tt;class je{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=H,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new ft),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new tt),e[i++]=r.x,e[i++]=r.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new Tt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new bt),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)We.fromBufferAttribute(this,e),We.applyMatrix3(t),this.setXY(e,We.x,We.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)Ve.fromBufferAttribute(this,e),Ve.applyMatrix3(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Ve.fromBufferAttribute(this,e),Ve.applyMatrix4(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Ve.fromBufferAttribute(this,e),Ve.applyNormalMatrix(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Ve.fromBufferAttribute(this,e),Ve.transformDirection(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==H&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}je.prototype.isBufferAttribute=!0;class qe extends je{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Xe extends je{constructor(t,e,i){super(new Uint32Array(t),e,i)}}(class extends je{constructor(t,e,i){super(new Uint16Array(t),e,i)}}).prototype.isFloat16BufferAttribute=!0;class Ye extends je{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Ze=0;const Je=new ne,Ke=new Pe,$e=new Tt,Qe=new Ct,ti=new Ct,ei=new Tt;class ii extends j{constructor(){super(),Object.defineProperty(this,"id",{value:Ze++}),this.uuid=Z(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(it(t)?Xe:qe)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new et).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Je.makeRotationFromQuaternion(t),this.applyMatrix4(Je),this}rotateX(t){return Je.makeRotationX(t),this.applyMatrix4(Je),this}rotateY(t){return Je.makeRotationY(t),this.applyMatrix4(Je),this}rotateZ(t){return Je.makeRotationZ(t),this.applyMatrix4(Je),this}translate(t,e,i){return Je.makeTranslation(t,e,i),this.applyMatrix4(Je),this}scale(t,e,i){return Je.makeScale(t,e,i),this.applyMatrix4(Je),this}lookAt(t){return Ke.lookAt(t),Ke.updateMatrix(),this.applyMatrix4(Ke.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($e).negate(),this.translate($e.x,$e.y,$e.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Ye(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ct);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Tt(-1/0,-1/0,-1/0),new Tt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Qe.setFromBufferAttribute(i),this.morphTargetsRelative?(ei.addVectors(this.boundingBox.min,Qe.min),this.boundingBox.expandByPoint(ei),ei.addVectors(this.boundingBox.max,Qe.max),this.boundingBox.expandByPoint(ei)):(this.boundingBox.expandByPoint(Qe.min),this.boundingBox.expandByPoint(Qe.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Yt);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Tt,1/0);if(t){const i=this.boundingSphere.center;if(Qe.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];ti.setFromBufferAttribute(i),this.morphTargetsRelative?(ei.addVectors(Qe.min,ti.min),Qe.expandByPoint(ei),ei.addVectors(Qe.max,ti.max),Qe.expandByPoint(ei)):(Qe.expandByPoint(ti.min),Qe.expandByPoint(ti.max))}Qe.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)ei.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(ei));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)ei.fromBufferAttribute(s,e),a&&($e.fromBufferAttribute(t,e),ei.add($e)),n=Math.max(n,i.distanceToSquared(ei))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new je(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],h=[];for(let t=0;t<a;t++)l[t]=new Tt,h[t]=new Tt;const c=new Tt,u=new Tt,d=new Tt,p=new tt,f=new tt,m=new tt,_=new Tt,g=new Tt;function y(t,e,i){c.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),f.fromArray(s,2*e),m.fromArray(s,2*i),u.sub(c),d.sub(c),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(_.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),g.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[t].add(_),l[e].add(_),l[i].add(_),h[t].add(g),h[e].add(g),h[i].add(g))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let t=0,e=v.length;t<e;++t){const e=v[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)y(i[t+0],i[t+1],i[t+2])}const x=new Tt,b=new Tt,w=new Tt,M=new Tt;function S(t){w.fromArray(r,3*t),M.copy(w);const e=l[t];x.copy(e),x.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(M,e);const i=b.dot(h[t])<0?-1:1;o[4*t]=x.x,o[4*t+1]=x.y,o[4*t+2]=x.z,o[4*t+3]=i}for(let t=0,e=v.length;t<e;++t){const e=v[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new je(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new Tt,r=new Tt,s=new Tt,a=new Tt,o=new Tt,l=new Tt,h=new Tt,c=new Tt;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),a.add(h),o.add(h),l.add(h),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),h.subVectors(s,r),c.subVectors(n,r),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,s=t.attributes[n],a=s.array,o=s.itemSize*e,l=Math.min(a.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=a[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)ei.fromBufferAttribute(t,e),ei.normalize(),t.setXYZ(e,ei.x,ei.y,ei.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new je(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ii,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],a=r[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}ii.prototype.isBufferGeometry=!0;const ni=new ne,ri=new ie,si=new Yt,ai=new Tt,oi=new Tt,li=new Tt,hi=new Tt,ci=new Tt,ui=new Tt,di=new Tt,pi=new Tt,fi=new Tt,mi=new tt,_i=new tt,gi=new tt,yi=new Tt,vi=new Tt;class xi extends Pe{constructor(t=new ii,e=new Ge){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),si.copy(i.boundingSphere),si.applyMatrix4(r),!1===t.ray.intersectsSphere(si))return;if(ni.copy(r).invert(),ri.copy(t.ray).applyMatrix4(ni),null!==i.boundingBox&&!1===ri.intersectsBox(i.boundingBox))return;let s;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,c=i.attributes.uv2,u=i.groups,d=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,p=u.length;i<p;i++){const p=u[i],f=n[p.materialIndex];for(let i=Math.max(p.start,d.start),n=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),d=r.getX(i+2);s=bi(this,f,t,ri,a,o,l,h,c,n,u,d),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else for(let i=Math.max(0,d.start),u=Math.min(r.count,d.start+d.count);i<u;i+=3){const u=r.getX(i),d=r.getX(i+1),p=r.getX(i+2);s=bi(this,n,t,ri,a,o,l,h,c,u,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}else if(void 0!==a)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],p=n[r.materialIndex];for(let i=Math.max(r.start,d.start),n=Math.min(a.count,Math.min(r.start+r.count,d.start+d.count));i<n;i+=3)s=bi(this,p,t,ri,a,o,l,h,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}else for(let i=Math.max(0,d.start),r=Math.min(a.count,d.start+d.count);i<r;i+=3)s=bi(this,n,t,ri,a,o,l,h,c,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function bi(t,e,i,n,a,o,l,h,c,u,d,p){ai.fromBufferAttribute(a,u),oi.fromBufferAttribute(a,d),li.fromBufferAttribute(a,p);const f=t.morphTargetInfluences;if(o&&f){di.set(0,0,0),pi.set(0,0,0),fi.set(0,0,0);for(let t=0,e=o.length;t<e;t++){const e=f[t],i=o[t];0!==e&&(hi.fromBufferAttribute(i,u),ci.fromBufferAttribute(i,d),ui.fromBufferAttribute(i,p),l?(di.addScaledVector(hi,e),pi.addScaledVector(ci,e),fi.addScaledVector(ui,e)):(di.addScaledVector(hi.sub(ai),e),pi.addScaledVector(ci.sub(oi),e),fi.addScaledVector(ui.sub(li),e)))}ai.add(di),oi.add(pi),li.add(fi)}t.isSkinnedMesh&&(t.boneTransform(u,ai),t.boneTransform(d,oi),t.boneTransform(p,li));const m=function(t,e,i,n,a,o,l,h){let c;if(c=e.side===r?n.intersectTriangle(l,o,a,!0,h):n.intersectTriangle(a,o,l,e.side!==s,h),null===c)return null;vi.copy(h),vi.applyMatrix4(t.matrixWorld);const u=i.ray.origin.distanceTo(vi);return u<i.near||u>i.far?null:{distance:u,point:vi.clone(),object:t}}(t,e,i,n,ai,oi,li,yi);if(m){h&&(mi.fromBufferAttribute(h,u),_i.fromBufferAttribute(h,d),gi.fromBufferAttribute(h,p),m.uv=Ue.getUV(yi,ai,oi,li,mi,_i,gi,new tt)),c&&(mi.fromBufferAttribute(c,u),_i.fromBufferAttribute(c,d),gi.fromBufferAttribute(c,p),m.uv2=Ue.getUV(yi,ai,oi,li,mi,_i,gi,new tt));const t={a:u,b:d,c:p,normal:new Tt,materialIndex:0};Ue.getNormal(ai,oi,li,t.normal),m.face=t}return m}xi.prototype.isMesh=!0;class wi extends ii{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],h=[],c=[];let u=0,d=0;function p(t,e,i,n,r,s,p,f,m,_,g){const y=s/m,v=p/_,x=s/2,b=p/2,w=f/2,M=m+1,S=_+1;let E=0,T=0;const A=new Tt;for(let s=0;s<S;s++){const a=s*v-b;for(let o=0;o<M;o++){const u=o*y-x;A[t]=u*n,A[e]=a*r,A[i]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=f>0?1:-1,h.push(A.x,A.y,A.z),c.push(o/m),c.push(1-s/_),E+=1}}for(let t=0;t<_;t++)for(let e=0;e<m;e++){const i=u+e+M*t,n=u+e+M*(t+1),r=u+(e+1)+M*(t+1),s=u+(e+1)+M*t;o.push(i,n,s),o.push(n,r,s),T+=6}a.addGroup(d,T,g),d+=T,u+=E}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Ye(l,3)),this.setAttribute("normal",new Ye(h,3)),this.setAttribute("uv",new Ye(c,2))}static fromJSON(t){return new wi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Mi(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Si(t){const e={};for(let i=0;i<t.length;i++){const n=Mi(t[i]);for(const t in n)e[t]=n[t]}return e}const Ei={clone:Mi,merge:Si};class Ti extends He{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Mi(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}Ti.prototype.isShaderMaterial=!0;class Ai extends Pe{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ne,this.projectionMatrix=new ne,this.projectionMatrixInverse=new ne}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ai.prototype.isCamera=!0;class Pi extends Ai{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Y*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*X*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Y*Math.atan(Math.tan(.5*X*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*X*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}Pi.prototype.isPerspectiveCamera=!0;const Ci=90;class Li extends Pe{constructor(t,e,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Pi(Ci,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Tt(1,0,0)),this.add(n);const r=new Pi(Ci,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Tt(-1,0,0)),this.add(r);const s=new Pi(Ci,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Tt(0,1,0)),this.add(s);const a=new Pi(Ci,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Tt(0,-1,0)),this.add(a);const o=new Pi(Ci,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Tt(0,0,1)),this.add(o);const l=new Pi(Ci,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Tt(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,a,o,l]=this.children,h=t.getRenderTarget(),c=t.toneMapping,u=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.toneMapping=c,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class Ri extends xt{constructor(t,e,i,n,r,s,a,o,h,c){super(t=void 0!==t?t:[],e=void 0!==e?e:l,i,n,r,s,a,o,h,c),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Ri.prototype.isCubeTexture=!0;class Ii extends wt{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new Ri(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:m}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",s="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new wi(5,5,5),o=new Ti({name:"CubemapFromEquirect",uniforms:Mi(i),vertexShader:n,fragmentShader:s,side:r,blending:0});o.uniforms.tEquirect.value=e;const l=new xi(a,o),h=e.minFilter;return e.minFilter===_&&(e.minFilter=m),new Li(1,10,this).update(t,l),e.minFilter=h,l.geometry.dispose(),l.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}Ii.prototype.isWebGLCubeRenderTarget=!0;const Di=new Tt,Oi=new Tt,Ni=new et;class Fi{constructor(t=new Tt(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Di.subVectors(i,e).cross(Oi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Di),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Ni.getNormalMatrix(t),n=this.coplanarPoint(Di).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Fi.prototype.isPlane=!0;const ki=new Yt,zi=new Tt;class Ui{constructor(t=new Fi,e=new Fi,i=new Fi,n=new Fi,r=new Fi,s=new Fi){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],_=i[13],g=i[14],y=i[15];return e[0].setComponents(a-n,c-o,f-u,y-m).normalize(),e[1].setComponents(a+n,c+o,f+u,y+m).normalize(),e[2].setComponents(a+r,c+l,f+d,y+_).normalize(),e[3].setComponents(a-r,c-l,f-d,y-_).normalize(),e[4].setComponents(a-s,c-h,f-p,y-g).normalize(),e[5].setComponents(a+s,c+h,f+p,y+g).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),ki.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ki)}intersectsSprite(t){return ki.center.set(0,0,0),ki.radius=.7071067811865476,ki.applyMatrix4(t.matrixWorld),this.intersectsSphere(ki)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(zi.x=n.normal.x>0?t.max.x:t.min.x,zi.y=n.normal.y>0?t.max.y:t.min.y,zi.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(zi)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Bi(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Hi(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)o=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=5131}else o=5123;else if(r instanceof Int16Array)o=5122;else if(r instanceof Uint32Array)o=5125;else if(r instanceof Int32Array)o=5124;else if(r instanceof Int8Array)o=5120;else if(r instanceof Uint8Array)o=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=5121}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,n,r){const s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class Gi extends ii{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,h=o+1,c=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let t=0;t<h;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*c-r;p.push(n,-e,0),f.push(0,0,1),m.push(i/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Ye(p,3)),this.setAttribute("normal",new Ye(f,3)),this.setAttribute("uv",new Ye(m,2))}static fromJSON(t){return new Gi(t.width,t.height,t.widthSegments,t.heightSegments)}}const Vi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Wi={common:{diffuse:{value:new ft(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new et},uv2Transform:{value:new et},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new tt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ft(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ft(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new et}},sprite:{diffuse:{value:new ft(16777215)},opacity:{value:1},center:{value:new tt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new et}}},ji={basic:{uniforms:Si([Wi.common,Wi.specularmap,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.fog]),vertexShader:Vi.meshbasic_vert,fragmentShader:Vi.meshbasic_frag},lambert:{uniforms:Si([Wi.common,Wi.specularmap,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.fog,Wi.lights,{emissive:{value:new ft(0)}}]),vertexShader:Vi.meshlambert_vert,fragmentShader:Vi.meshlambert_frag},phong:{uniforms:Si([Wi.common,Wi.specularmap,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.fog,Wi.lights,{emissive:{value:new ft(0)},specular:{value:new ft(1118481)},shininess:{value:30}}]),vertexShader:Vi.meshphong_vert,fragmentShader:Vi.meshphong_frag},standard:{uniforms:Si([Wi.common,Wi.envmap,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.roughnessmap,Wi.metalnessmap,Wi.fog,Wi.lights,{emissive:{value:new ft(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag},toon:{uniforms:Si([Wi.common,Wi.aomap,Wi.lightmap,Wi.emissivemap,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.gradientmap,Wi.fog,Wi.lights,{emissive:{value:new ft(0)}}]),vertexShader:Vi.meshtoon_vert,fragmentShader:Vi.meshtoon_frag},matcap:{uniforms:Si([Wi.common,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,Wi.fog,{matcap:{value:null}}]),vertexShader:Vi.meshmatcap_vert,fragmentShader:Vi.meshmatcap_frag},points:{uniforms:Si([Wi.points,Wi.fog]),vertexShader:Vi.points_vert,fragmentShader:Vi.points_frag},dashed:{uniforms:Si([Wi.common,Wi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vi.linedashed_vert,fragmentShader:Vi.linedashed_frag},depth:{uniforms:Si([Wi.common,Wi.displacementmap]),vertexShader:Vi.depth_vert,fragmentShader:Vi.depth_frag},normal:{uniforms:Si([Wi.common,Wi.bumpmap,Wi.normalmap,Wi.displacementmap,{opacity:{value:1}}]),vertexShader:Vi.meshnormal_vert,fragmentShader:Vi.meshnormal_frag},sprite:{uniforms:Si([Wi.sprite,Wi.fog]),vertexShader:Vi.sprite_vert,fragmentShader:Vi.sprite_frag},background:{uniforms:{uvTransform:{value:new et},t2D:{value:null}},vertexShader:Vi.background_vert,fragmentShader:Vi.background_frag},cube:{uniforms:Si([Wi.envmap,{opacity:{value:1}}]),vertexShader:Vi.cube_vert,fragmentShader:Vi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vi.equirect_vert,fragmentShader:Vi.equirect_frag},distanceRGBA:{uniforms:Si([Wi.common,Wi.displacementmap,{referencePosition:{value:new Tt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vi.distanceRGBA_vert,fragmentShader:Vi.distanceRGBA_frag},shadow:{uniforms:Si([Wi.lights,Wi.fog,{color:{value:new ft(0)},opacity:{value:1}}]),vertexShader:Vi.shadow_vert,fragmentShader:Vi.shadow_frag}};function qi(t,e,i,n,s,a){const o=new ft(0);let l,h,u=!0===s?0:1,d=null,p=0,f=null;function m(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,a)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),u=e,m(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,m(o,u)},render:function(i,s){let a=!1,_=!0===s.isScene?s.background:null;_&&_.isTexture&&(_=e.get(_));const g=t.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(_=null),null===_?m(o,u):_&&_.isColor&&(m(_,1),a=!0),(t.autoClear||a)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),_&&(_.isCubeTexture||_.mapping===c)?(void 0===h&&(h=new xi(new wi(1,1,1),new Ti({name:"BackgroundCubeMaterial",uniforms:Mi(ji.cube.uniforms),vertexShader:ji.cube.vertexShader,fragmentShader:ji.cube.fragmentShader,side:r,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,d===_&&p===_.version&&f===t.toneMapping||(h.material.needsUpdate=!0,d=_,p=_.version,f=t.toneMapping),h.layers.enableAll(),i.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(void 0===l&&(l=new xi(new Gi(2,2),new Ti({name:"BackgroundMaterial",uniforms:Mi(ji.background.uniforms),vertexShader:ji.background.vertexShader,fragmentShader:ji.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=_,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),d===_&&p===_.version&&f===t.toneMapping||(l.material.needsUpdate=!0,d=_,p=_.version,f=t.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null))}}}function Xi(t,e,i,n){const r=t.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=p(null);let h=l,c=!1;function u(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function f(){const t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){_(t,0)}function _(i,r){const s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r&&((n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function g(){const e=h.newAttributes,i=h.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function y(e,i,r,s,a,o){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function v(){x(),c=!0,h!==l&&(h=l,u(h.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,v,x){let b=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[a];return void 0===c&&(c=p(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),h[a]=c),c}(v,d,l);h!==e&&(h=e,u(h.object)),b=function(t,e,i,n){const r=h.attributes,s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o)if(o[e].location>=0){const i=r[e];let n=s[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;a++}return h.attributesNum!==a||h.index!==n}(r,v,d,x),b&&function(t,e,i,n){const r={},s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o)if(o[e].location>=0){let i=s[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[e]=n,a++}h.attributes=r,h.attributesNum=a,h.index=n}(r,v,d,x)}else{const t=!0===l.wireframe;h.geometry===v.id&&h.program===d.id&&h.wireframe===t||(h.geometry=v.id,h.program=d.id,h.wireframe=t,b=!0)}null!==x&&i.update(x,34963),(b||c)&&(c=!1,function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;f();const l=o.attributes,h=a.getAttributes(),c=s.defaultAttributeValues;for(const e in h){const n=h[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;const h=l.buffer,c=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)_(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(34962,h);for(let t=0;t<n.locationSize;t++)y(n.location+t,a/n.locationSize,c,e,l*u,(d+a/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)_(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)m(n.location+t);t.bindBuffer(34962,h);for(let t=0;t<n.locationSize;t++)y(n.location+t,a/n.locationSize,c,e,a*u,a/n.locationSize*t*u)}}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}g()}(r,l,d,v),null!==x&&t.bindBuffer(34963,i.get(x).buffer))},reset:v,resetDefaultState:x,dispose:function(){v();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:g}}function Yi(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,n,a,o),i.update(a,s,o)}}function Zi(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),h=!0===i.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),_=t.getParameter(36348),g=t.getParameter(36349),y=u>0,v=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:_,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:v,floatVertexTextures:y&&v,maxSamples:s?t.getParameter(36183):0}}function Ji(t){const e=this;let i=null,n=0,r=!1,s=!1;const a=new Fi,o=new et,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,i,n,r){const s=null!==t?t.length:0;let h=null;if(0!==s){if(h=l.value,!0!==r||null===h){const e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(h,i),h[i+3]=a.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==n||r;return r=e,i=c(t,s,0),n=t.length,a},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,f=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?c(null):h();else{const t=s?0:n,e=4*t;let r=f.clippingState||null;l.value=r,r=c(u,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Ki(t){let e=new WeakMap;function i(t,e){return 303===e?t.mapping=l:304===e&&(t.mapping=h),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(303===s||304===s){if(e.has(r))return i(e.get(r).texture,r.mapping);{const s=r.image;if(s&&s.height>0){const a=new Ii(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}ji.physical={uniforms:Si([ji.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new tt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ft(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new tt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ft(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ft(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Vi.meshphysical_vert,fragmentShader:Vi.meshphysical_frag};class $i extends Ai{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}$i.prototype.isOrthographicCamera=!0;const Qi=[.125,.215,.35,.446,.526,.582],tn=new $i,en=new ft;let nn=null;const rn=(1+Math.sqrt(5))/2,sn=1/rn,an=[new Tt(1,1,1),new Tt(-1,1,1),new Tt(1,1,-1),new Tt(-1,1,-1),new Tt(0,rn,sn),new Tt(0,rn,-sn),new Tt(sn,0,rn),new Tt(-sn,0,rn),new Tt(rn,sn,0),new Tt(-rn,sn,0)];class on{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){nn=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=un(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=cn(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(nn),t.scissorTest=!1,hn(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===l||t.mapping===h?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),nn=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:m,minFilter:m,generateMipmaps:!1,type:b,format:M,encoding:F,depthBuffer:!1},n=ln(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ln(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Qi.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);i.push(s);let o=1/s;a>t-4?o=Qi[a-t+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,f=3,m=2,_=1,g=new Float32Array(f*p*d),y=new Float32Array(m*p*d),v=new Float32Array(_*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];v.set(r,_*p*t)}const x=new ii;x.setAttribute("position",new je(g,f)),x.setAttribute("uv",new je(y,m)),x.setAttribute("faceIndex",new je(v,_)),e.push(x),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(20),r=new Tt(0,1,0);return new Ti({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new xi(this._lodPlanes[0],t);this._renderer.compile(e,tn)}_sceneToCubeUV(t,e,i,n){const s=new Pi(90,1,e,i),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,c=l.toneMapping;l.getClearColor(en),l.toneMapping=0,l.autoClear=!1;const u=new Ge({name:"PMREM.Background",side:r,depthWrite:!1,depthTest:!1}),d=new xi(new wi,u);let p=!1;const f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,p=!0):(u.color.copy(en),p=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(s.up.set(0,a[e],0),s.lookAt(o[e],0,0)):1===i?(s.up.set(0,0,a[e]),s.lookAt(0,o[e],0)):(s.up.set(0,a[e],0),s.lookAt(0,0,o[e]));const r=this._cubeSize;hn(n,i*r,e>2?r:0,r,r),l.setRenderTarget(n),p&&l.render(d,s),l.render(t,s)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=c,l.autoClear=h,t.background=f}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===l||t.mapping===h;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=un()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=cn());const r=n?this._cubemapMaterial:this._equirectMaterial,s=new xi(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const a=this._cubeSize;hn(e,0,0,3*a,2*a),i.setRenderTarget(e),i.render(s,tn)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=an[(e-1)%an.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new xi(this._lodPlanes[n],l),c=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let _=0;for(let t=0;t<20;++t){const e=t/p,i=Math.exp(-e*e/2);m.push(i),0===t?_+=i:t<f&&(_+=2*i)}for(let t=0;t<m.length;t++)m[t]=m[t]/_;c.envMap.value=t.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a);const{_lodMax:g}=this;c.dTheta.value=d,c.mipInt.value=g-i;const y=this._sizeLods[n];hn(e,3*y*(n>g-4?n-g+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(e),o.render(h,tn)}}function ln(t,e,i){const n=new wt(t,e,i);return n.texture.mapping=c,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function hn(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function cn(){return new Ti({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function un(){return new Ti({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function dn(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=303===s||304===s,o=s===l||s===h;if(a||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=e.get(r);return null===i&&(i=new on(t)),n=a?i.fromEquirectangular(r,n):i.fromCubemap(r,n),e.set(r,n),n.texture}if(e.has(r))return e.get(r).texture;{const s=r.image;if(a&&s&&s.height>0||o&&s&&function(t){let e=0;for(let i=0;i<6;i++)void 0!==t[i]&&e++;return 6===e}(s)){null===i&&(i=new on(t));const s=a?i.fromEquirectangular(r):i.fromCubemap(r);return e.set(r,s),r.addEventListener("dispose",n),s.texture}return null}}}return r},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function pn(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function fn(t,e,i,n){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,r=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(it(i)?Xe:qe)(i,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function mn(t,e,i,n){const r=n.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,a,e*o),i.update(n,s,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,u;if(r)c=t,u="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](s,l,a,n*o,h),i.update(l,s,h)}}function _n(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function gn(t,e){return t[0]-e[0]}function yn(t,e){return Math.abs(e[1])-Math.abs(t[1])}function vn(t,e){let i=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),t.divideScalar(i)}function xn(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,a=new bt,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,h,c,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,f=void 0!==p?p.length:0;let m=s.get(h);if(void 0===m||m.count!==f){void 0!==m&&m.texture.dispose();const y=void 0!==h.morphAttributes.position,v=void 0!==h.morphAttributes.normal,b=void 0!==h.morphAttributes.color,w=h.morphAttributes.position||[],M=h.morphAttributes.normal||[],S=h.morphAttributes.color||[];let E=0;!0===y&&(E=1),!0===v&&(E=2),!0===b&&(E=3);let T=h.attributes.position.count*E,A=1;T>e.maxTextureSize&&(A=Math.ceil(T/e.maxTextureSize),T=e.maxTextureSize);const P=new Float32Array(T*A*4*f),C=new Mt(P,T,A,f);C.type=x,C.needsUpdate=!0;const L=4*E;for(let I=0;I<f;I++){const D=w[I],O=M[I],N=S[I],F=T*A*4*I;for(let k=0;k<D.count;k++){const z=k*L;!0===y&&(a.fromBufferAttribute(D,k),!0===D.normalized&&vn(a,D),P[F+z+0]=a.x,P[F+z+1]=a.y,P[F+z+2]=a.z,P[F+z+3]=0),!0===v&&(a.fromBufferAttribute(O,k),!0===O.normalized&&vn(a,O),P[F+z+4]=a.x,P[F+z+5]=a.y,P[F+z+6]=a.z,P[F+z+7]=0),!0===b&&(a.fromBufferAttribute(N,k),!0===N.normalized&&vn(a,N),P[F+z+8]=a.x,P[F+z+9]=a.y,P[F+z+10]=a.z,P[F+z+11]=4===N.itemSize?a.w:1)}}function R(){C.dispose(),s.delete(h),h.removeEventListener("dispose",R)}m={count:f,texture:C,size:new tt(T,A)},s.set(h,m),h.addEventListener("dispose",R)}let _=0;for(let U=0;U<d.length;U++)_+=d[U];const g=h.morphTargetsRelative?1:1-_;u.getUniforms().setValue(t,"morphTargetBaseInfluence",g),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",m.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const B=void 0===d?0:d.length;let H=n[h.id];if(void 0===H||H.length!==B){H=[];for(let q=0;q<B;q++)H[q]=[q,0];n[h.id]=H}for(let X=0;X<B;X++){const Y=H[X];Y[0]=X,Y[1]=d[X]}H.sort(yn);for(let Z=0;Z<8;Z++)Z<B&&H[Z][1]?(o[Z][0]=H[Z][0],o[Z][1]=H[Z][1]):(o[Z][0]=Number.MAX_SAFE_INTEGER,o[Z][1]=0);o.sort(gn);const G=h.morphAttributes.position,V=h.morphAttributes.normal;let W=0;for(let J=0;J<8;J++){const K=o[J],$=K[0],Q=K[1];$!==Number.MAX_SAFE_INTEGER&&Q?(G&&h.getAttribute("morphTarget"+J)!==G[$]&&h.setAttribute("morphTarget"+J,G[$]),V&&h.getAttribute("morphNormal"+J)!==V[$]&&h.setAttribute("morphNormal"+J,V[$]),r[J]=Q,W+=Q):(G&&!0===h.hasAttribute("morphTarget"+J)&&h.deleteAttribute("morphTarget"+J),V&&!0===h.hasAttribute("morphNormal"+J)&&h.deleteAttribute("morphNormal"+J),r[J]=0)}const j=h.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",j),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function bn(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const a=n.render.frame,o=t.geometry,l=e.get(t,o);return r.get(l)!==a&&(e.update(l),r.set(l,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const wn=new xt,Mn=new Mt,Sn=new St,En=new Ri,Tn=[],An=[],Pn=new Float32Array(16),Cn=new Float32Array(9),Ln=new Float32Array(4);function Rn(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=Tn[r];if(void 0===s&&(s=new Float32Array(r),Tn[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function In(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Dn(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function On(t,e){let i=An[e];void 0===i&&(i=new Int32Array(e),An[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Nn(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Fn(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(In(i,e))return;t.uniform2fv(this.addr,e),Dn(i,e)}}function kn(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(In(i,e))return;t.uniform3fv(this.addr,e),Dn(i,e)}}function zn(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(In(i,e))return;t.uniform4fv(this.addr,e),Dn(i,e)}}function Un(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(In(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Dn(i,e)}else{if(In(i,n))return;Ln.set(n),t.uniformMatrix2fv(this.addr,!1,Ln),Dn(i,n)}}function Bn(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(In(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Dn(i,e)}else{if(In(i,n))return;Cn.set(n),t.uniformMatrix3fv(this.addr,!1,Cn),Dn(i,n)}}function Hn(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(In(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Dn(i,e)}else{if(In(i,n))return;Pn.set(n),t.uniformMatrix4fv(this.addr,!1,Pn),Dn(i,n)}}function Gn(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Vn(t,e){const i=this.cache;In(i,e)||(t.uniform2iv(this.addr,e),Dn(i,e))}function Wn(t,e){const i=this.cache;In(i,e)||(t.uniform3iv(this.addr,e),Dn(i,e))}function jn(t,e){const i=this.cache;In(i,e)||(t.uniform4iv(this.addr,e),Dn(i,e))}function qn(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Xn(t,e){const i=this.cache;In(i,e)||(t.uniform2uiv(this.addr,e),Dn(i,e))}function Yn(t,e){const i=this.cache;In(i,e)||(t.uniform3uiv(this.addr,e),Dn(i,e))}function Zn(t,e){const i=this.cache;In(i,e)||(t.uniform4uiv(this.addr,e),Dn(i,e))}function Jn(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||wn,r)}function Kn(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||Sn,r)}function $n(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||En,r)}function Qn(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||Mn,r)}function tr(t,e){t.uniform1fv(this.addr,e)}function er(t,e){const i=Rn(e,this.size,2);t.uniform2fv(this.addr,i)}function ir(t,e){const i=Rn(e,this.size,3);t.uniform3fv(this.addr,i)}function nr(t,e){const i=Rn(e,this.size,4);t.uniform4fv(this.addr,i)}function rr(t,e){const i=Rn(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function sr(t,e){const i=Rn(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function ar(t,e){const i=Rn(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function or(t,e){t.uniform1iv(this.addr,e)}function lr(t,e){t.uniform2iv(this.addr,e)}function hr(t,e){t.uniform3iv(this.addr,e)}function cr(t,e){t.uniform4iv(this.addr,e)}function ur(t,e){t.uniform1uiv(this.addr,e)}function dr(t,e){t.uniform2uiv(this.addr,e)}function pr(t,e){t.uniform3uiv(this.addr,e)}function fr(t,e){t.uniform4uiv(this.addr,e)}function mr(t,e,i){const n=e.length,r=On(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||wn,r[t])}function _r(t,e,i){const n=e.length,r=On(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||Sn,r[t])}function gr(t,e,i){const n=e.length,r=On(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||En,r[t])}function yr(t,e,i){const n=e.length,r=On(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||Mn,r[t])}function vr(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Nn;case 35664:return Fn;case 35665:return kn;case 35666:return zn;case 35674:return Un;case 35675:return Bn;case 35676:return Hn;case 5124:case 35670:return Gn;case 35667:case 35671:return Vn;case 35668:case 35672:return Wn;case 35669:case 35673:return jn;case 5125:return qn;case 36294:return Xn;case 36295:return Yn;case 36296:return Zn;case 35678:case 36198:case 36298:case 36306:case 35682:return Jn;case 35679:case 36299:case 36307:return Kn;case 35680:case 36300:case 36308:case 36293:return $n;case 36289:case 36303:case 36311:case 36292:return Qn}}(e.type)}function xr(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return tr;case 35664:return er;case 35665:return ir;case 35666:return nr;case 35674:return rr;case 35675:return sr;case 35676:return ar;case 5124:case 35670:return or;case 35667:case 35671:return lr;case 35668:case 35672:return hr;case 35669:case 35673:return cr;case 5125:return ur;case 36294:return dr;case 36295:return pr;case 36296:return fr;case 35678:case 36198:case 36298:case 36306:case 35682:return mr;case 35679:case 36299:case 36307:return _r;case 35680:case 36300:case 36308:case 36293:return gr;case 36289:case 36303:case 36311:case 36292:return yr}}(e.type)}function br(t){this.id=t,this.seq=[],this.map={}}br.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}};const wr=/(\w+)(\])?(\[|\.)?/g;function Mr(t,e){t.seq.push(e),t.map[e.id]=e}function Sr(t,e,i){const n=t.name,r=n.length;for(wr.lastIndex=0;;){const s=wr.exec(n),a=wr.lastIndex;let o=s[1];const l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===r){Mr(i,void 0===h?new vr(o,t,e):new xr(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new br(o),Mr(i,t)),i=t}}}function Er(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);Sr(i,t.getUniformLocation(e,i.name),this)}}function Tr(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}Er.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},Er.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},Er.upload=function(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}},Er.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let Ar=0;function Pr(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[0]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const i=t.split("\n"),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=r;t<s;t++)n.push(t+1+": "+i[t]);return n.join("\n")}(t.getShaderSource(e),n)}return r}function Cr(t,e){const i=function(t){switch(t){case F:return["Linear","( value )"];case k:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Lr(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Rr(t){return""!==t}function Ir(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Dr(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Or=/^[ \t]*#include +<([\w\d./]+)>/gm;function Nr(t){return t.replace(Or,Fr)}function Fr(t,e){const i=Vi[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return Nr(i)}const kr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,zr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ur(t){return t.replace(zr,Hr).replace(kr,Br)}function Br(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Hr(0,e,i,n)}function Hr(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Gr(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Vr(t,e,i,n){const r=t.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const u=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),d=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case l:case h:e="ENVMAP_TYPE_CUBE";break;case c:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),p=function(t){let e="ENVMAP_MODE_REFLECTION";return t.envMap&&t.envMapMode===h&&(e="ENVMAP_MODE_REFRACTION"),e}(i),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),_=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Rr).join("\n")}(i),g=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),y=r.createProgram();let v,x,b=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(v=[g].filter(Rr).join("\n"),v.length>0&&(v+="\n"),x=[_,g].filter(Rr).join("\n"),x.length>0&&(x+="\n")):(v=[Gr(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Rr).join("\n"),x=[_,Gr(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",i.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Vi.tonemapping_pars_fragment:"",0!==i.toneMapping?Lr("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Vi.encodings_pars_fragment,Cr("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Rr).join("\n")),a=Nr(a),a=Ir(a,i),a=Dr(a,i),o=Nr(o),o=Ir(o,i),o=Dr(o,i),a=Ur(a),o=Ur(o),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(b="#version 300 es\n",v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,x=["#define varying in",i.glslVersion===V?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===V?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+x);const w=b+x+o,M=Tr(r,35633,b+v+a),S=Tr(r,35632,w);if(r.attachShader(y,M),r.attachShader(y,S),void 0!==i.index0AttributeName?r.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),t.debug.checkShaderErrors){const t=r.getProgramInfoLog(y).trim(),e=r.getShaderInfoLog(M).trim(),i=r.getShaderInfoLog(S).trim();let n=!0,s=!0;if(!1===r.getProgramParameter(y,35714)){n=!1;const e=Pr(r,M,"vertex"),i=Pr(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:v},fragmentShader:{log:i,prefix:x}})}let E,T;return r.deleteShader(M),r.deleteShader(S),this.getUniforms=function(){return void 0===E&&(E=new Er(r,y)),E},this.getAttributes=function(){return void 0===T&&(T=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let a=1;35674===n.type&&(a=2),35675===n.type&&(a=3),35676===n.type&&(a=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:a}}return i}(r,y)),T},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=Ar++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=S,this}let Wr=0;class jr{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const i=new qr(t);e.set(t,i)}return e.get(t)}}class qr{constructor(t){this.id=Wr++,this.code=t,this.usedTimes=0}}function Xr(t,e,i,n,a,o,l){const h=new fe,u=new jr,d=[],p=a.isWebGL2,f=a.logarithmicDepthBuffer,m=a.vertexTextures;let _=a.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,h,d,y,v){const x=y.fog,b=v.geometry,w=o.isMeshStandardMaterial?y.environment:null,M=(o.isMeshStandardMaterial?i:e).get(o.envMap||w),S=M&&M.mapping===c?M.image.height:null,E=g[o.type];null!==o.precision&&(_=a.getMaxPrecision(o.precision),_!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",_,"instead."));const T=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,A=void 0!==T?T.length:0;let P,C,L,R,I=0;if(void 0!==b.morphAttributes.position&&(I=1),void 0!==b.morphAttributes.normal&&(I=2),void 0!==b.morphAttributes.color&&(I=3),E){const t=ji[E];P=t.vertexShader,C=t.fragmentShader}else P=o.vertexShader,C=o.fragmentShader,u.update(o),L=u.getVertexShaderID(o),R=u.getFragmentShaderID(o);const D=t.getRenderTarget(),O=o.alphaTest>0,N=o.clearcoat>0;return{isWebGL2:p,shaderID:E,shaderName:o.type,vertexShader:P,fragmentShader:C,defines:o.defines,customVertexShaderID:L,customFragmentShaderID:R,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:_,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:m,outputEncoding:null===D?t.outputEncoding:!0===D.isXRRenderTarget?D.texture.encoding:F,map:!!o.map,matcap:!!o.matcap,envMap:!!M,envMapMode:M&&M.mapping,envMapCubeUVHeight:S,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===k,clearcoat:N,clearcoatMap:N&&!!o.clearcoatMap,clearcoatRoughnessMap:N&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:N&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&1===o.blending,alphaMap:!!o.alphaMap,alphaTest:O,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!b.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!x,useFog:!0===o.fog,fogExp2:x&&x.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:f,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:A,morphTextureStride:I,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&d.length>0,shadowMapType:t.shadowMap.type,toneMapping:o.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:o.side===s,flipSided:o.side===r,useDepthPacking:!!o.depthPacking,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||n.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){h.disableAll(),e.isWebGL2&&h.enable(0),e.supportsVertexTextures&&h.enable(1),e.instancing&&h.enable(2),e.instancingColor&&h.enable(3),e.map&&h.enable(4),e.matcap&&h.enable(5),e.envMap&&h.enable(6),e.lightMap&&h.enable(7),e.aoMap&&h.enable(8),e.emissiveMap&&h.enable(9),e.bumpMap&&h.enable(10),e.normalMap&&h.enable(11),e.objectSpaceNormalMap&&h.enable(12),e.tangentSpaceNormalMap&&h.enable(13),e.clearcoat&&h.enable(14),e.clearcoatMap&&h.enable(15),e.clearcoatRoughnessMap&&h.enable(16),e.clearcoatNormalMap&&h.enable(17),e.displacementMap&&h.enable(18),e.specularMap&&h.enable(19),e.roughnessMap&&h.enable(20),e.metalnessMap&&h.enable(21),e.gradientMap&&h.enable(22),e.alphaMap&&h.enable(23),e.alphaTest&&h.enable(24),e.vertexColors&&h.enable(25),e.vertexAlphas&&h.enable(26),e.vertexUvs&&h.enable(27),e.vertexTangents&&h.enable(28),e.uvsVertexOnly&&h.enable(29),e.fog&&h.enable(30),t.push(h.mask),h.disableAll(),e.useFog&&h.enable(0),e.flatShading&&h.enable(1),e.logarithmicDepthBuffer&&h.enable(2),e.skinning&&h.enable(3),e.morphTargets&&h.enable(4),e.morphNormals&&h.enable(5),e.morphColors&&h.enable(6),e.premultipliedAlpha&&h.enable(7),e.shadowMapEnabled&&h.enable(8),e.physicallyCorrectLights&&h.enable(9),e.doubleSided&&h.enable(10),e.flipSided&&h.enable(11),e.useDepthPacking&&h.enable(12),e.dithering&&h.enable(13),e.specularIntensityMap&&h.enable(14),e.specularColorMap&&h.enable(15),e.transmission&&h.enable(16),e.transmissionMap&&h.enable(17),e.thicknessMap&&h.enable(18),e.sheen&&h.enable(19),e.sheenColorMap&&h.enable(20),e.sheenRoughnessMap&&h.enable(21),e.decodeVideoTexture&&h.enable(22),e.opaque&&h.enable(23),t.push(h.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=g[t.type];let i;if(e){const t=ji[e];i=Ei.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=d.length;t<e;t++){const e=d[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Vr(t,i,e,o),d.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=d.indexOf(t);d[e]=d[d.length-1],d.pop(),t.destroy()}},releaseShaderCache:function(t){u.remove(t)},programs:d,dispose:function(){u.dispose()}}}function Yr(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Zr(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Jr(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Kr(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?n.push(c):!0===a.transparent?r.push(c):i.push(c)},unshift:function(t,e,a,o,l,h){const c=s(t,e,a,o,l,h);a.transmission>0?n.unshift(c):!0===a.transparent?r.unshift(c):i.unshift(c)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Zr),n.length>1&&n.sort(e||Jr),r.length>1&&r.sort(e||Jr)}}}function $r(){let t=new WeakMap;return{get:function(e,i){let n;return!1===t.has(e)?(n=new Kr,t.set(e,[n])):i>=t.get(e).length?(n=new Kr,t.get(e).push(n)):n=t.get(e)[i],n},dispose:function(){t=new WeakMap}}}function Qr(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Tt,color:new ft};break;case"SpotLight":i={position:new Tt,direction:new Tt,color:new ft,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Tt,color:new ft,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Tt,skyColor:new ft,groundColor:new ft};break;case"RectAreaLight":i={color:new ft,position:new Tt,halfWidth:new Tt,halfHeight:new Tt}}return t[e.id]=i,i}}}let ts=0;function es(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function is(t,e){const i=new Qr,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new tt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new Tt);const s=new Tt,a=new ne,o=new ne;return{setup:function(s,a){let o=0,l=0,h=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,m=0,_=0,g=0;s.sort(es);const y=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,v=e.intensity,x=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*v*y,l+=a.g*v*y,h+=a.b*v*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],v);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[c]=i,r.directionalShadowMap[c]=b,r.directionalShadowMatrix[c]=e.shadow.matrix,m++}r.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(v*y),t.distance=x,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[d]=i,r.spotShadowMap[d]=b,r.spotShadowMatrix[d]=e.shadow.matrix,g++}r.spot[d]=t,d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(a).multiplyScalar(v),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=b,r.pointShadowMatrix[u]=e.shadow.matrix,_++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(v*y),t.groundColor.copy(e.groundColor).multiplyScalar(v*y),r.hemi[f]=t,f++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Wi.LTC_FLOAT_1,r.rectAreaLTC2=Wi.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Wi.LTC_HALF_1,r.rectAreaLTC2=Wi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=h;const v=r.hash;v.directionalLength===c&&v.pointLength===u&&v.spotLength===d&&v.rectAreaLength===p&&v.hemiLength===f&&v.numDirectionalShadows===m&&v.numPointShadows===_&&v.numSpotShadows===g||(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=_,r.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=u,v.spotLength=d,v.rectAreaLength=p,v.hemiLength=f,v.numDirectionalShadows=m,v.numPointShadows=_,v.numSpotShadows=g,r.version=ts++)},setupView:function(t,e){let i=0,n=0,l=0,h=0,c=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[h];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),h++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),c++}}},state:r}}function ns(t,e){const i=new is(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function rs(t,e){let i=new WeakMap;return{get:function(n,r=0){let s;return!1===i.has(n)?(s=new ns(t,e),i.set(n,[s])):r>=i.get(n).length?(s=new ns(t,e),i.get(n).push(s)):s=i.get(n)[r],s},dispose:function(){i=new WeakMap}}}class ss extends He{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}ss.prototype.isMeshDepthMaterial=!0;class as extends He{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Tt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function os(t,e,i){let n=new Ui;const a=new tt,o=new tt,l=new bt,h=new ss({depthPacking:3201}),c=new as,u={},d=i.maxTextureSize,p={0:r,1:0,2:s},m=new Ti({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new tt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=m.clone();_.defines.HORIZONTAL_PASS=1;const g=new ii;g.setAttribute("position",new je(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new xi(g,m),v=this;function x(i,n){const r=e.update(y);m.defines.VSM_SAMPLES!==i.blurSamples&&(m.defines.VSM_SAMPLES=i.blurSamples,_.defines.VSM_SAMPLES=i.blurSamples,m.needsUpdate=!0,_.needsUpdate=!0),m.uniforms.shadow_pass.value=i.map.texture,m.uniforms.resolution.value=i.mapSize,m.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,m,y,null),_.uniforms.shadow_pass.value=i.mapPass.texture,_.uniforms.resolution.value=i.mapSize,_.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,_,y,null)}function b(e,i,n,r,s,a){let o=null;const l=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(o=void 0!==l?l:!0===n.isPointLight?c:h,t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=o.uuid,e=i.uuid;let n=u[t];void 0===n&&(n={},u[t]=n);let r=n[e];void 0===r&&(r=o.clone(),n[e]=r),o=r}return o.visible=i.visible,o.wireframe=i.wireframe,o.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:p[i.side],o.alphaMap=i.alphaMap,o.alphaTest=i.alphaTest,o.clipShadows=i.clipShadows,o.clippingPlanes=i.clippingPlanes,o.clipIntersection=i.clipIntersection,o.displacementMap=i.displacementMap,o.displacementScale=i.displacementScale,o.displacementBias=i.displacementBias,o.wireframeLinewidth=i.wireframeLinewidth,o.linewidth=i.linewidth,!0===n.isPointLight&&!0===o.isMeshDistanceMaterial&&(o.referencePosition.setFromMatrixPosition(n.matrixWorld),o.nearDistance=r,o.farDistance=s),o}function w(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,h=e.length;l<h;l++){const h=e[l],c=r[h.materialIndex];if(c&&c.visible){const e=b(i,c,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,h)}}}else if(r.visible){const e=b(i,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)w(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,r){if(!1===v.enabled)return;if(!1===v.autoUpdate&&!1===v.needsUpdate)return;if(0===e.length)return;const s=t.getRenderTarget(),h=t.getActiveCubeFace(),c=t.getActiveMipmapLevel(),u=t.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let s=0,h=e.length;s<h;s++){const h=e[s],c=h.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;a.copy(c.mapSize);const p=c.getFrameExtents();if(a.multiply(p),o.copy(c.mapSize),(a.x>d||a.y>d)&&(a.x>d&&(o.x=Math.floor(d/p.x),a.x=o.x*p.x,c.mapSize.x=o.x),a.y>d&&(o.y=Math.floor(d/p.y),a.y=o.y*p.y,c.mapSize.y=o.y)),null!==c.map||c.isPointLightShadow||3!==this.type||(c.map=new wt(a.x,a.y),c.map.texture.name=h.name+".shadowMap",c.mapPass=new wt(a.x,a.y),c.camera.updateProjectionMatrix()),null===c.map){const t={minFilter:f,magFilter:f,format:M};c.map=new wt(a.x,a.y,t),c.map.texture.name=h.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const m=c.getViewportCount();for(let t=0;t<m;t++){const e=c.getViewport(t);l.set(o.x*e.x,o.y*e.y,o.x*e.z,o.y*e.w),u.viewport(l),c.updateMatrices(h,t),n=c.getFrustum(),w(i,r,c.camera,h,this.type)}c.isPointLightShadow||3!==this.type||x(c,r),c.needsUpdate=!1}v.needsUpdate=!1,t.setRenderTarget(s,h,c)}}function ls(t,e,i){const n=i.isWebGL2,o=new function(){let e=!1;const i=new bt;let n=null;const r=new bt(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},l=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?H(2929):G(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},h=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(t){e||(t?H(2960):G(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&s===a||(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,h=null}}};let c={},u={},d=new WeakMap,p=[],f=null,m=!1,_=null,g=null,y=null,v=null,x=null,b=null,w=null,M=!1,S=null,E=null,T=null,A=null,P=null;const C=t.getParameter(35661);let L=!1,R=0;const I=t.getParameter(7938);-1!==I.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(I)[1]),L=R>=1):-1!==I.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),L=R>=2);let D=null,O={};const N=t.getParameter(3088),F=t.getParameter(2978),k=(new bt).fromArray(N),z=(new bt).fromArray(F);function U(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return s}const B={};function H(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function G(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}B[3553]=U(3553,3553,1),B[34067]=U(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),H(2929),l.setFunc(3),q(!1),X(1),H(2884),j(0);const V={[a]:32774,101:32778,102:32779};if(n)V[103]=32775,V[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(V[103]=t.MIN_EXT,V[104]=t.MAX_EXT)}const W={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function j(e,i,n,r,s,o,l,h){if(0!==e){if(!1===m&&(H(3042),m=!0),5===e)s=s||i,o=o||n,l=l||r,i===g&&s===x||(t.blendEquationSeparate(V[i],V[s]),g=i,x=s),n===y&&r===v&&o===b&&l===w||(t.blendFuncSeparate(W[n],W[r],W[o],W[l]),y=n,v=r,b=o,w=l),_=e,M=null;else if(e!==_||h!==M){if(g===a&&x===a||(t.blendEquation(32774),g=a,x=a),h)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}y=null,v=null,b=null,w=null,_=e,M=h}}else!0===m&&(G(3042),m=!1)}function q(e){S!==e&&(e?t.frontFace(2304):t.frontFace(2305),S=e)}function X(e){0!==e?(H(2884),e!==E&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):G(2884),E=e}function Y(e,i,n){e?(H(32823),A===i&&P===n||(t.polygonOffset(i,n),A=i,P=n)):G(32823)}function Z(e){void 0===e&&(e=33984+C-1),D!==e&&(t.activeTexture(e),D=e)}return{buffers:{color:o,depth:l,stencil:h},enable:H,disable:G,bindFramebuffer:function(e,i){return u[e]!==i&&(t.bindFramebuffer(e,i),u[e]=i,n&&(36009===e&&(u[36160]=i),36160===e&&(u[36009]=i)),!0)},drawBuffers:function(n,r){let s=p,a=!1;if(n)if(s=d.get(r),void 0===s&&(s=[],d.set(r,s)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,i=t.length;e<i;e++)s[e]=36064+e;s.length=t.length,a=!0}}else 36064!==s[0]&&(s[0]=36064,a=!0);else 1029!==s[0]&&(s[0]=1029,a=!0);a&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return f!==e&&(t.useProgram(e),f=e,!0)},setBlending:j,setMaterial:function(t,e){t.side===s?G(2884):H(2884);let i=t.side===r;e&&(i=!i),q(i),1===t.blending&&!1===t.transparent?j(0):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),o.setMask(t.colorWrite);const n=t.stencilWrite;h.setTest(n),n&&(h.setMask(t.stencilWriteMask),h.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),h.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(32926):G(32926)},setFlipSided:q,setCullFace:X,setLineWidth:function(e){e!==T&&(L&&t.lineWidth(e),T=e)},setPolygonOffset:Y,setScissorTest:function(t){t?H(3089):G(3089)},activeTexture:Z,bindTexture:function(e,i){null===D&&Z();let n=O[D];void 0===n&&(n={type:void 0,texture:void 0},O[D]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||B[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=O[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===k.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),k.copy(e))},viewport:function(e){!1===z.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),z.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===n&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},D=null,O={},u={},d=new WeakMap,p=[],f=null,m=!1,_=null,g=null,y=null,v=null,x=null,b=null,w=null,M=!1,S=null,E=null,T=null,A=null,P=null,k.set(0,0,t.canvas.width,t.canvas.height),z.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),h.reset()}}}function hs(t,e,i,n,r,s,a){const o=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,c=r.maxTextureSize,T=r.maxSamples,A=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,P=/OculusBrowser/g.test(navigator.userAgent),C=new WeakMap;let L;const R=new WeakMap;let I=!1;try{I="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function D(t,e){return I?new OffscreenCanvas(t,e):nt("canvas")}function O(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Q:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===L&&(L=D(s,a));const o=i?D(s,a):L;return o.width=s,o.height=a,o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function N(t){return $(t.width)&&$(t.height)}function z(t,e){return t.generateMipmaps&&e&&t.minFilter!==f&&t.minFilter!==m}function U(e){t.generateMipmap(e)}function B(i,n,r,s,a=!1){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return 6403===n&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===n&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===n&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===k&&!1===a?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function H(t,e,i){return!0===z(t,i)||t.isFramebufferTexture&&t.minFilter!==f&&t.minFilter!==m?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function G(t){return t===f||1004===t||1005===t?9728:9729}function V(t){const e=t.target;e.removeEventListener("dispose",V),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=R.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&q(t),0===Object.keys(r).length&&R.delete(i)}n.remove(t)}(e),e.isVideoTexture&&C.delete(e)}function j(e){const i=e.target;i.removeEventListener("dispose",j),function(e){const i=e.texture,r=n.get(e),s=n.get(i);if(void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function q(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete R.get(r)[i.__cacheKey],a.memory.textures--}let X=0;function Y(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;C.get(t)!==e&&(C.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const i=t.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void et(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}const Z={[u]:10497,[d]:33071,[p]:33648},J={[f]:9728,1004:9984,1005:9986,[m]:9729,1007:9985,[_]:9987};function K(i,s,a){if(a?(t.texParameteri(i,10242,Z[s.wrapS]),t.texParameteri(i,10243,Z[s.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,Z[s.wrapR]),t.texParameteri(i,10240,J[s.magFilter]),t.texParameteri(i,10241,J[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),s.wrapS===d&&s.wrapT===d||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,G(s.magFilter)),t.texParameteri(i,10241,G(s.minFilter)),s.minFilter!==f&&s.minFilter!==m&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===x&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===b&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function tt(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",V));const r=i.source;let s=R.get(r);void 0===s&&(s={},R.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&q(i)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return n}function et(e,n,r){let a=3553;n.isDataArrayTexture&&(a=35866),n.isData3DTexture&&(a=32879);const l=tt(e,n),h=n.source;if(i.activeTexture(33984+r),i.bindTexture(a,e.__webglTexture),h.version!==h.__currentVersion||!0===l){t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const r=function(t){return!o&&(t.wrapS!==d||t.wrapT!==d||t.minFilter!==f&&t.minFilter!==m)}(n)&&!1===N(n.image);let u=O(n.image,r,!1,c);u=lt(n,u);const p=N(u)||o,_=s.convert(n.format,n.encoding);let g,b=s.convert(n.type),T=B(n.internalFormat,_,b,n.encoding,n.isVideoTexture);K(a,n,p);const A=n.mipmaps,P=o&&!0!==n.isVideoTexture,C=void 0===e.__version||!0===l,L=H(n,u,p);if(n.isDepthTexture)T=6402,o?T=n.type===x?36012:n.type===v?33190:n.type===w?35056:33189:n.type===x&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===S&&6402===T&&n.type!==y&&n.type!==v&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=y,b=s.convert(n.type)),n.format===E&&6402===T&&(T=34041,n.type!==w&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=w,b=s.convert(n.type))),C&&(P?i.texStorage2D(3553,1,T,u.width,u.height):i.texImage2D(3553,0,T,u.width,u.height,0,_,b,null));else if(n.isDataTexture)if(A.length>0&&p){P&&C&&i.texStorage2D(3553,L,T,A[0].width,A[0].height);for(let t=0,e=A.length;t<e;t++)g=A[t],P?i.texSubImage2D(3553,t,0,0,g.width,g.height,_,b,g.data):i.texImage2D(3553,t,T,g.width,g.height,0,_,b,g.data);n.generateMipmaps=!1}else P?(C&&i.texStorage2D(3553,L,T,u.width,u.height),i.texSubImage2D(3553,0,0,0,u.width,u.height,_,b,u.data)):i.texImage2D(3553,0,T,u.width,u.height,0,_,b,u.data);else if(n.isCompressedTexture){P&&C&&i.texStorage2D(3553,L,T,A[0].width,A[0].height);for(let t=0,e=A.length;t<e;t++)g=A[t],n.format!==M?null!==_?P?i.compressedTexSubImage2D(3553,t,0,0,g.width,g.height,_,g.data):i.compressedTexImage2D(3553,t,T,g.width,g.height,0,g.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):P?i.texSubImage2D(3553,t,0,0,g.width,g.height,_,b,g.data):i.texImage2D(3553,t,T,g.width,g.height,0,_,b,g.data)}else if(n.isDataArrayTexture)P?(C&&i.texStorage3D(35866,L,T,u.width,u.height,u.depth),i.texSubImage3D(35866,0,0,0,0,u.width,u.height,u.depth,_,b,u.data)):i.texImage3D(35866,0,T,u.width,u.height,u.depth,0,_,b,u.data);else if(n.isData3DTexture)P?(C&&i.texStorage3D(32879,L,T,u.width,u.height,u.depth),i.texSubImage3D(32879,0,0,0,0,u.width,u.height,u.depth,_,b,u.data)):i.texImage3D(32879,0,T,u.width,u.height,u.depth,0,_,b,u.data);else if(n.isFramebufferTexture){if(C)if(P)i.texStorage2D(3553,L,T,u.width,u.height);else{let t=u.width,e=u.height;for(let n=0;n<L;n++)i.texImage2D(3553,n,T,t,e,0,_,b,null),t>>=1,e>>=1}}else if(A.length>0&&p){P&&C&&i.texStorage2D(3553,L,T,A[0].width,A[0].height);for(let t=0,e=A.length;t<e;t++)g=A[t],P?i.texSubImage2D(3553,t,0,0,_,b,g):i.texImage2D(3553,t,T,_,b,g);n.generateMipmaps=!1}else P?(C&&i.texStorage2D(3553,L,T,u.width,u.height),i.texSubImage2D(3553,0,0,0,_,b,u)):i.texImage2D(3553,0,T,_,b,u);z(n,p)&&U(a),h.__currentVersion=h.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function it(e,r,a,o,l){const h=s.convert(a.format,a.encoding),c=s.convert(a.type),u=B(a.internalFormat,h,c,a.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,h,c,null):i.texImage2D(l,0,u,r.width,r.height,0,h,c,null)),i.bindFramebuffer(36160,e),ot(r)?A.framebufferTexture2DMultisampleEXT(36160,o,l,n.get(a).__webglTexture,0,at(r)):t.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function rt(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||ot(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===x?r=36012:e.type===v&&(r=33190));const n=at(i);ot(i)?A.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=at(i);n&&!1===ot(i)?t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):ot(i)?A.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):t.renderbufferStorage(36161,34041,i.width,i.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,r=s.convert(e.format,e.encoding),a=s.convert(e.type),o=B(e.internalFormat,r,a,e.encoding),l=at(i);n&&!1===ot(i)?t.renderbufferStorageMultisample(36161,l,o,i.width,i.height):ot(i)?A.renderbufferStorageMultisampleEXT(36161,l,o,i.width,i.height):t.renderbufferStorage(36161,o,i.width,i.height)}t.bindRenderbuffer(36161,null)}function st(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),Y(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,a=at(r);if(r.depthTexture.format===S)ot(r)?A.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,a):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==E)throw new Error("Unknown depthTexture format");ot(r)?A.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,a):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),rt(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),rt(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function at(t){return Math.min(T,t.samples)}function ot(t){const i=n.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function lt(t,i){const n=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===W||n!==F&&(n===k?!1===o?!0===e.has("EXT_sRGB")&&r===M?(t.format=W,t.minFilter=m,t.generateMipmaps=!1):i=_t.sRGBToLinear(i):r===M&&s===g||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=X;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),X+=1,t},this.resetTextureUnits=function(){X=0},this.setTexture2D=Y,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?et(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?et(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(e,r){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const a=tt(e,n),l=n.source;if(i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),l.version!==l.__currentVersion||!0===a){t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const r=n.isCompressedTexture||n.image[0].isCompressedTexture,a=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=r||a?a?n.image[t].image:n.image[t]:O(n.image[t],!1,!0,h),c[t]=lt(n,c[t]);const u=c[0],d=N(u)||o,p=s.convert(n.format,n.encoding),f=s.convert(n.type),m=B(n.internalFormat,p,f,n.encoding),_=o&&!0!==n.isVideoTexture,g=void 0===e.__version;let y,v=H(n,u,d);if(K(34067,n,d),r){_&&g&&i.texStorage2D(34067,v,m,u.width,u.height);for(let t=0;t<6;t++){y=c[t].mipmaps;for(let e=0;e<y.length;e++){const r=y[e];n.format!==M?null!==p?_?i.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,p,r.data):i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?i.texSubImage2D(34069+t,e,0,0,r.width,r.height,p,f,r.data):i.texImage2D(34069+t,e,m,r.width,r.height,0,p,f,r.data)}}}else{y=n.mipmaps,_&&g&&(y.length>0&&v++,i.texStorage2D(34067,v,m,c[0].width,c[0].height));for(let t=0;t<6;t++)if(a){_?i.texSubImage2D(34069+t,0,0,0,c[t].width,c[t].height,p,f,c[t].data):i.texImage2D(34069+t,0,m,c[t].width,c[t].height,0,p,f,c[t].data);for(let e=0;e<y.length;e++){const n=y[e].image[t].image;_?i.texSubImage2D(34069+t,e+1,0,0,n.width,n.height,p,f,n.data):i.texImage2D(34069+t,e+1,m,n.width,n.height,0,p,f,n.data)}}else{_?i.texSubImage2D(34069+t,0,0,0,p,f,c[t]):i.texImage2D(34069+t,0,m,p,f,c[t]);for(let e=0;e<y.length;e++){const n=y[e];_?i.texSubImage2D(34069+t,e+1,0,0,p,f,n.image[t]):i.texImage2D(34069+t,e+1,m,p,f,n.image[t])}}}z(n,d)&&U(34067),l.__currentVersion=l.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(a,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,a.__webglTexture))},this.rebindTextures=function(t,e,i){const r=n.get(t);void 0!==e&&it(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==i&&st(t)},this.setupRenderTarget=function(e){const l=e.texture,h=n.get(e),c=n.get(l);e.addEventListener("dispose",j),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=N(e)||o;if(u){h.__webglFramebuffer=[];for(let e=0;e<6;e++)h.__webglFramebuffer[e]=t.createFramebuffer()}else if(h.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(o&&e.samples>0&&!1===ot(e)){h.__webglMultisampledFramebuffer=t.createFramebuffer(),h.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,h.__webglColorRenderbuffer);const n=s.convert(l.format,l.encoding),r=s.convert(l.type),a=B(l.internalFormat,n,r,l.encoding),o=at(e);t.renderbufferStorageMultisample(36161,o,a,e.width,e.height),i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,h.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(h.__webglDepthRenderbuffer=t.createRenderbuffer(),rt(h.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}if(u){i.bindTexture(34067,c.__webglTexture),K(34067,l,p);for(let t=0;t<6;t++)it(h.__webglFramebuffer[t],e,l,36064,34069+t);z(l,p)&&U(34067),i.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=n.get(s);i.bindTexture(3553,a.__webglTexture),K(3553,s,p),it(h.__webglFramebuffer,e,s,36064+r,3553),z(s,p)&&U(3553)}i.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(t,c.__webglTexture),K(t,l,p),it(h.__webglFramebuffer,e,l,36064,t),z(l,p)&&U(t),i.unbindTexture()}e.depthBuffer&&st(e)},this.updateRenderTargetMipmap=function(t){const e=N(t)||o,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=r.length;s<a;s++){const a=r[s];if(z(a,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(a).__webglTexture;i.bindTexture(e,r),U(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===ot(e)){const r=e.width,s=e.height;let a=16384;const o=[36064],l=e.stencilBuffer?33306:36096;e.depthBuffer&&o.push(l);const h=n.get(e),c=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;!1===c&&(e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024)),i.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,h.__webglFramebuffer),!0===c&&(t.invalidateFramebuffer(36008,[l]),t.invalidateFramebuffer(36009,[l])),t.blitFramebuffer(0,0,r,s,0,0,r,s,a,9728),P&&t.invalidateFramebuffer(36008,o),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=st,this.setupFrameBufferTexture=it,this.useMultisampledRTT=ot}function cs(t,e,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===g)return 5121;if(1017===i)return 32819;if(1018===i)return 32820;if(1010===i)return 5120;if(1011===i)return 5122;if(i===y)return 5123;if(1013===i)return 5124;if(i===v)return 5125;if(i===x)return 5126;if(i===b)return n?5131:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return 6406;if(i===M)return 6408;if(1024===i)return 6409;if(1025===i)return 6410;if(i===S)return 6402;if(i===E)return 34041;if(1028===i)return 6403;if(1022===i)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(i===W)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return 36244;if(1030===i)return 33319;if(1031===i)return 33320;if(1033===i)return 36249;if(i===T||i===A||i===P||i===C)if(r===k){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===T)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===A)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===P)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===C)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===T)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===A)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===P)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===C)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===i)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===i)return r===k?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return r===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===i){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(36492===i)return r===k?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===w?n?34042:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}as.prototype.isMeshDistanceMaterial=!0;class us extends Pi{constructor(t=[]){super(),this.cameras=t}}us.prototype.isArrayCamera=!0;class ds extends Pe{constructor(){super(),this.type="Group"}}ds.prototype.isGroup=!0;const ps={type:"move"};class fs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ds,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ds,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Tt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Tt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ds,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Tt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Tt),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&(n=e.getPose(t.targetRaySpace,i),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ps))),l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new ds;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,h=.005;l.inputState.pinching&&a>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class ms extends xt{constructor(t,e,i,n,r,s,a,o,l,h){if((h=void 0!==h?h:S)!==S&&h!==E)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===S&&(i=y),void 0===i&&h===E&&(i=w),super(null,n,r,s,a,o,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:f,this.minFilter=void 0!==o?o:f,this.flipY=!1,this.generateMipmaps=!1}}ms.prototype.isDepthTexture=!0;class _s extends j{constructor(t,e){super();const i=this;let n=null,r=1,s=null,a="local-floor",o=null,l=null,h=null,c=null,u=null,d=null;const p=e.getContextAttributes();let f=null,m=null;const _=[],v=new Map,x=new Pi;x.layers.enable(1),x.viewport=new bt;const b=new Pi;b.layers.enable(2),b.viewport=new bt;const T=[x,b],A=new us;A.layers.enable(1),A.layers.enable(2);let P=null,C=null;function L(t){const e=v.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function R(){v.forEach((function(t,e){t.disconnect(e)})),v.clear(),P=null,C=null,t.setRenderTarget(f),u=null,c=null,h=null,n=null,m=null,z.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){const e=n.inputSources;for(let t=0;t<e.length;t++){const i="right"===e[t].handedness?1:0;v.set(e[t],_[i])}for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=v.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),v.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=v.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=_[t];return void 0===e&&(e=new fs,_[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=_[t];return void 0===e&&(e=new fs,_[t]=e),e.getGripSpace()},this.getHand=function(t){let e=_[t];return void 0===e&&(e=new fs,_[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o||s},this.setReferenceSpace=function(t){o=t},this.getBaseLayer=function(){return null!==c?c:u},this.getBinding=function(){return h},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(o){if(n=o,null!==n){if(f=t.getRenderTarget(),n.addEventListener("select",L),n.addEventListener("selectstart",L),n.addEventListener("selectend",L),n.addEventListener("squeeze",L),n.addEventListener("squeezestart",L),n.addEventListener("squeezeend",L),n.addEventListener("end",R),n.addEventListener("inputsourceschange",I),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:u}),m=new wt(u.framebufferWidth,u.framebufferHeight,{format:M,type:g,encoding:t.outputEncoding})}else{let i=null,s=null,a=null;p.depth&&(a=p.stencil?35056:33190,i=p.stencil?E:S,s=p.stencil?w:y);const o={colorFormat:t.outputEncoding===k?35907:32856,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(n,e),c=h.createProjectionLayer(o),n.updateRenderState({layers:[c]}),m=new wt(c.textureWidth,c.textureHeight,{format:M,type:g,depthTexture:new ms(c.textureWidth,c.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0}),t.properties.get(m).__ignoreDepthValues=c.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),s=await n.requestReferenceSpace(a),z.setContext(n),z.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new Tt,O=new Tt;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;A.near=b.near=x.near=t.near,A.far=b.far=x.far=t.far,P===A.near&&C===A.far||(n.updateRenderState({depthNear:A.near,depthFar:A.far}),P=A.near,C=A.far);const e=t.parent,i=A.cameras;N(A,e);for(let t=0;t<i.length;t++)N(i[t],e);A.matrixWorld.decompose(A.position,A.quaternion,A.scale),t.position.copy(A.position),t.quaternion.copy(A.quaternion),t.scale.copy(A.scale),t.matrix.copy(A.matrix),t.matrixWorld.copy(A.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),O.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(O),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*c,p=a*u,f=n/(-c+u),m=f*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const _=a+f,g=o+f,y=d-m,v=p+(n-m),x=l*o/g*_,b=h*o/g*_;t.projectionMatrix.makePerspective(y,v,x,b,_,g)}(A,x,b):A.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return A},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==c&&(c.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let F=null;const z=new Bi;z.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o||s),d=i,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(m,u.framebuffer),t.setRenderTarget(m));let i=!1;e.length!==A.cameras.length&&(A.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==u)s=u.getViewport(r);else{const e=h.getViewSubImage(c,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(m,e.colorTexture,c.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}const a=T[n];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&A.matrix.copy(a.matrix),!0===i&&A.cameras.push(a)}}const r=n.inputSources;for(let t=0;t<_.length;t++){const e=r[t],n=v.get(e);void 0!==n&&n.update(e,i,o||s)}F&&F(e,i),d=null})),this.setAnimationLoop=function(t){F=t},this.dispose=function(){}}}function gs(t,e){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,n.side===r&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),n.side===r&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);const s=e.get(n).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*e}let a,o;n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?a=n.map:n.specularMap?a=n.specularMap:n.displacementMap?a=n.displacementMap:n.normalMap?a=n.normalMap:n.bumpMap?a=n.bumpMap:n.roughnessMap?a=n.roughnessMap:n.metalnessMap?a=n.metalnessMap:n.alphaMap?a=n.alphaMap:n.emissiveMap?a=n.emissiveMap:n.clearcoatMap?a=n.clearcoatMap:n.clearcoatNormalMap?a=n.clearcoatNormalMap:n.clearcoatRoughnessMap?a=n.clearcoatRoughnessMap:n.specularIntensityMap?a=n.specularIntensityMap:n.specularColorMap?a=n.specularColorMap:n.transmissionMap?a=n.transmissionMap:n.thicknessMap?a=n.thicknessMap:n.sheenColorMap?a=n.sheenColorMap:n.sheenRoughnessMap&&(a=n.sheenRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),i.uvTransform.value.copy(a.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),i.uv2Transform.value.copy(o.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,s,a,o){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(t,n):n.isMeshToonMaterial?(i(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(i(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(i(t,n),function(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap)),e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===r&&t.clearcoatNormalScale.value.negate())),e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)),t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,o)):n.isMeshMatcapMaterial?(i(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?i(t,n):n.isMeshDistanceMaterial?(i(t,n),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?i(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,s,a):n.isSpriteMaterial?function(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.alphaTest>0&&(t.alphaTest.value=e.alphaTest),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function ys(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=nt("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,l=void 0===t.premultipliedAlpha||t.premultipliedAlpha,h=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let d;d=null!==i?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let p=null,f=null;const m=[],y=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=F,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const v=this;let w=!1,S=0,E=0,T=null,A=-1,P=null;const C=new bt,L=new bt;let R=null,I=e.width,D=e.height,O=1,N=null,k=null;const z=new bt(0,0,I,D),U=new bt(0,0,I,D);let B=!1;const H=new Ui;let G=!1,V=!1,W=null;const j=new ne,q=new tt,X=new Tt,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Z(){return null===T?O:1}let J,K,$,et,it,rt,st,at,ot,lt,ht,ct,ut,dt,pt,ft,mt,_t,gt,yt,vt,xt,Mt,St=i;function Et(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r140"),e.addEventListener("webglcontextlost",Ct,!1),e.addEventListener("webglcontextrestored",Lt,!1),null===St){const e=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&e.shift(),St=Et(e,t),null===St)throw Et(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===St.getShaderPrecisionFormat&&(St.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function At(){J=new pn(St),K=new Zi(St,J,t),J.init(K),xt=new cs(St,J,K),$=new ls(St,J,K),et=new _n(St),it=new Yr,rt=new hs(St,J,$,it,K,xt,et),st=new Ki(v),at=new dn(v),ot=new Hi(St,K),Mt=new Xi(St,J,ot,K),lt=new fn(St,ot,et,Mt),ht=new bn(St,lt,ot,et),gt=new xn(St,K,rt),ft=new Ji(it),ct=new Xr(v,st,at,J,K,Mt,ft),ut=new gs(v,it),dt=new $r,pt=new rs(J,K),_t=new qi(v,st,$,ht,d,l),mt=new os(v,ht,K),yt=new Yi(St,J,et,K),vt=new mn(St,J,et,K),et.programs=ct.programs,v.capabilities=K,v.extensions=J,v.properties=it,v.renderLists=dt,v.shadowMap=mt,v.state=$,v.info=et}At();const Pt=new _s(v,St);function Ct(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Lt(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const t=et.autoReset,e=mt.enabled,i=mt.autoUpdate,n=mt.needsUpdate,r=mt.type;At(),et.autoReset=t,mt.enabled=e,mt.autoUpdate=i,mt.needsUpdate=n,mt.type=r}function Rt(t){const e=t.target;e.removeEventListener("dispose",Rt),function(t){(function(t){const e=it.get(t).programs;void 0!==e&&(e.forEach((function(t){ct.releaseProgram(t)})),t.isShaderMaterial&&ct.releaseShaderCache(t))})(t),it.remove(t)}(e)}this.xr=Pt,this.getContext=function(){return St},this.getContextAttributes=function(){return St.getContextAttributes()},this.forceContextLoss=function(){const t=J.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=J.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(t){void 0!==t&&(O=t,this.setSize(I,D,!1))},this.getSize=function(t){return t.set(I,D)},this.setSize=function(t,i,n){Pt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=t,D=i,e.width=Math.floor(t*O),e.height=Math.floor(i*O),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(I*O,D*O).floor()},this.setDrawingBufferSize=function(t,i,n){I=t,D=i,O=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(C)},this.getViewport=function(t){return t.copy(z)},this.setViewport=function(t,e,i,n){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,i,n),$.viewport(C.copy(z).multiplyScalar(O).floor())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,i,n){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,i,n),$.scissor(L.copy(U).multiplyScalar(O).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(t){$.setScissorTest(B=t)},this.setOpaqueSort=function(t){N=t},this.setTransparentSort=function(t){k=t},this.getClearColor=function(t){return t.copy(_t.getClearColor())},this.setClearColor=function(){_t.setClearColor.apply(_t,arguments)},this.getClearAlpha=function(){return _t.getClearAlpha()},this.setClearAlpha=function(){_t.setClearAlpha.apply(_t,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=16384),e&&(n|=256),i&&(n|=1024),St.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ct,!1),e.removeEventListener("webglcontextrestored",Lt,!1),dt.dispose(),pt.dispose(),it.dispose(),st.dispose(),at.dispose(),ht.dispose(),Mt.dispose(),ct.dispose(),Pt.dispose(),Pt.removeEventListener("sessionstart",Dt),Pt.removeEventListener("sessionend",Ot),W&&(W.dispose(),W=null),Nt.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=Y);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,i,n,r){!0!==e.isScene&&(e=Y),rt.resetTextureUnits();const s=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===T?v.outputEncoding:!0===T.isXRRenderTarget?T.texture.encoding:F,l=(n.isMeshStandardMaterial?at:st).get(n.envMap||a),h=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color,m=n.toneMapped?v.toneMapping:0,_=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,g=void 0!==_?_.length:0,y=it.get(n),x=f.state.lights;if(!0===G&&(!0===V||t!==P)){const e=t===P&&n.id===A;ft.setState(n,t,e)}let b=!1;n.version===y.__version?y.needsLights&&y.lightsStateVersion!==x.state.version||y.outputEncoding!==o||r.isInstancedMesh&&!1===y.instancing?b=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?b=!0:r.isSkinnedMesh||!0!==y.skinning?y.envMap!==l||!0===n.fog&&y.fog!==s?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ft.numPlanes&&y.numIntersection===ft.numIntersection?(y.vertexAlphas!==h||y.vertexTangents!==c||y.morphTargets!==u||y.morphNormals!==d||y.morphColors!==p||y.toneMapping!==m||!0===K.isWebGL2&&y.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,y.__version=n.version);let w=y.currentProgram;!0===b&&(w=Bt(n,e,r));let M=!1,S=!1,E=!1;const C=w.getUniforms(),L=y.uniforms;if($.useProgram(w.program)&&(M=!0,S=!0,E=!0),n.id!==A&&(A=n.id,S=!0),M||P!==t){if(C.setValue(St,"projectionMatrix",t.projectionMatrix),K.logarithmicDepthBuffer&&C.setValue(St,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),P!==t&&(P=t,S=!0,E=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=C.map.cameraPosition;void 0!==e&&e.setValue(St,X.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&C.setValue(St,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&C.setValue(St,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){C.setOptional(St,r,"bindMatrix"),C.setOptional(St,r,"bindMatrixInverse");const t=r.skeleton;t&&(K.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),C.setValue(St,"boneTexture",t.boneTexture,rt),C.setValue(St,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const R=i.morphAttributes;var I,N;return(void 0!==R.position||void 0!==R.normal||void 0!==R.color&&!0===K.isWebGL2)&&gt.update(r,i,n,w),(S||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,C.setValue(St,"receiveShadow",r.receiveShadow)),S&&(C.setValue(St,"toneMappingExposure",v.toneMappingExposure),y.needsLights&&(N=E,(I=L).ambientLightColor.needsUpdate=N,I.lightProbe.needsUpdate=N,I.directionalLights.needsUpdate=N,I.directionalLightShadows.needsUpdate=N,I.pointLights.needsUpdate=N,I.pointLightShadows.needsUpdate=N,I.spotLights.needsUpdate=N,I.spotLightShadows.needsUpdate=N,I.rectAreaLights.needsUpdate=N,I.hemisphereLights.needsUpdate=N),s&&!0===n.fog&&ut.refreshFogUniforms(L,s),ut.refreshMaterialUniforms(L,n,O,D,W),Er.upload(St,y.uniformsList,L,rt)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Er.upload(St,y.uniformsList,L,rt),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&C.setValue(St,"center",r.center),C.setValue(St,"modelViewMatrix",r.modelViewMatrix),C.setValue(St,"normalMatrix",r.normalMatrix),C.setValue(St,"modelMatrix",r.matrixWorld),w}(t,e,i,n,r);$.setMaterial(n,a);let l=i.index;const h=i.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===n.wireframe&&(l=lt.getWireframeAttribute(i),u=2),Mt.setup(r,n,o,i,l);let d=yt;null!==l&&(c=ot.get(l),d=vt,d.setIndex(c));const p=null!==l?l.count:h.count,m=i.drawRange.start*u,_=i.drawRange.count*u,g=null!==s?s.start*u:0,y=null!==s?s.count*u:1/0,x=Math.max(m,g),b=Math.min(p,m+_,g+y)-1,w=Math.max(0,b-x+1);if(0!==w){if(r.isMesh)!0===n.wireframe?($.setLineWidth(n.wireframeLinewidth*Z()),d.setMode(1)):d.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),$.setLineWidth(t*Z()),r.isLineSegments?d.setMode(1):r.isLineLoop?d.setMode(2):d.setMode(3)}else r.isPoints?d.setMode(0):r.isSprite&&d.setMode(4);if(r.isInstancedMesh)d.renderInstances(x,w,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);d.renderInstances(x,w,t)}else d.render(x,w)}},this.compile=function(t,e){f=pt.get(t),f.init(),y.push(f),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),f.setupLights(v.physicallyCorrectLights),t.traverse((function(e){const i=e.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++)Bt(i[n],t,e);else Bt(i,t,e)})),y.pop(),f=null};let It=null;function Dt(){Nt.stop()}function Ot(){Nt.start()}const Nt=new Bi;function Ft(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||H.intersectsSprite(t)){n&&X.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=ht.update(t),r=t.material;r.visible&&p.push(t,e,r,i,X.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==et.render.frame&&(t.skeleton.update(),t.skeleton.frame=et.render.frame),!t.frustumCulled||H.intersectsObject(t))){n&&X.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=ht.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&p.push(t,e,o,i,X.z,a)}}else r.visible&&p.push(t,e,r,i,X.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Ft(r[t],e,i,n)}function kt(t,e,i,n){const r=t.opaque,s=t.transmissive,a=t.transparent;f.setupLightsView(i),s.length>0&&function(t,e,i){const n=K.isWebGL2;null===W&&(W=new wt(1,1,{generateMipmaps:!0,type:J.has("EXT_color_buffer_half_float")?b:g,minFilter:_,samples:n&&!0===o?4:0})),v.getDrawingBufferSize(q),n?W.setSize(q.x,q.y):W.setSize(Q(q.x),Q(q.y));const r=v.getRenderTarget();v.setRenderTarget(W),v.clear();const s=v.toneMapping;v.toneMapping=0,zt(t,e,i),v.toneMapping=s,rt.updateMultisampleRenderTarget(W),rt.updateRenderTargetMipmap(W),v.setRenderTarget(r)}(r,e,i),n&&$.viewport(C.copy(n)),r.length>0&&zt(r,e,i),s.length>0&&zt(s,e,i),a.length>0&&zt(a,e,i),$.buffers.depth.setTest(!0),$.buffers.depth.setMask(!0),$.buffers.color.setMask(!0),$.setPolygonOffset(!1)}function zt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===n?s.material:n,h=s.group;a.layers.test(i.layers)&&Ut(a,e,i,o,l,h)}}function Ut(t,e,i,n,a,o){t.onBeforeRender(v,e,i,n,a,o),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),a.onBeforeRender(v,e,i,n,t,o),!0===a.transparent&&a.side===s?(a.side=r,a.needsUpdate=!0,v.renderBufferDirect(i,e,n,a,t,o),a.side=0,a.needsUpdate=!0,v.renderBufferDirect(i,e,n,a,t,o),a.side=s):v.renderBufferDirect(i,e,n,a,t,o),t.onAfterRender(v,e,i,n,a,o)}function Bt(t,e,i){!0!==e.isScene&&(e=Y);const n=it.get(t),r=f.state.lights,s=f.state.shadowsArray,a=r.state.version,o=ct.getParameters(t,r.state,s,e,i),l=ct.getProgramCacheKey(o);let h=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?at:st).get(t.envMap||n.environment),void 0===h&&(t.addEventListener("dispose",Rt),h=new Map,n.programs=h);let c=h.get(l);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===a)return Ht(t,o),c}else o.uniforms=ct.getUniforms(t),t.onBuild(i,o,v),t.onBeforeCompile(o,v),c=ct.acquireProgram(o,l),h.set(l,c),n.uniforms=o.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ft.uniform),Ht(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const d=c.getUniforms(),p=Er.seqWithValue(d.seq,u);return n.currentProgram=c,n.uniformsList=p,c}function Ht(t,e){const i=it.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Nt.setAnimationLoop((function(t){It&&It(t)})),"undefined"!=typeof self&&Nt.setContext(self),this.setAnimationLoop=function(t){It=t,Pt.setAnimationLoop(t),null===t?Nt.stop():Nt.start()},Pt.addEventListener("sessionstart",Dt),Pt.addEventListener("sessionend",Ot),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Pt.enabled&&!0===Pt.isPresenting&&(!0===Pt.cameraAutoUpdate&&Pt.updateCamera(e),e=Pt.getCamera()),!0===t.isScene&&t.onBeforeRender(v,t,e,T),f=pt.get(t,y.length),f.init(),y.push(f),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),H.setFromProjectionMatrix(j),V=this.localClippingEnabled,G=ft.init(this.clippingPlanes,V,e),p=dt.get(t,m.length),p.init(),m.push(p),Ft(t,e,0,v.sortObjects),p.finish(),!0===v.sortObjects&&p.sort(N,k),!0===G&&ft.beginShadows();const i=f.state.shadowsArray;if(mt.render(i,t,e),!0===G&&ft.endShadows(),!0===this.info.autoReset&&this.info.reset(),_t.render(p,t),f.setupLights(v.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];kt(p,t,n,n.viewport)}}else kt(p,t,e);null!==T&&(rt.updateMultisampleRenderTarget(T),rt.updateRenderTargetMipmap(T)),!0===t.isScene&&t.onAfterRender(v,t,e),Mt.resetDefaultState(),A=-1,P=null,y.pop(),f=y.length>0?y[y.length-1]:null,m.pop(),p=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(t,e,i){it.get(t.texture).__webglTexture=e,it.get(t.depthTexture).__webglTexture=i;const n=it.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===J.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=it.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){T=t,S=e,E=i;let n=!0;if(t){const e=it.get(t);void 0!==e.__useDefaultFramebuffer?($.bindFramebuffer(36160,null),n=!1):void 0===e.__webglFramebuffer?rt.setupRenderTarget(t):e.__hasExternalTextures&&rt.rebindTextures(t,it.get(t.texture).__webglTexture,it.get(t.depthTexture).__webglTexture)}let r=null,s=!1,a=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(a=!0);const n=it.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=K.isWebGL2&&t.samples>0&&!1===rt.useMultisampledRTT(t)?it.get(t).__webglMultisampledFramebuffer:n,C.copy(t.viewport),L.copy(t.scissor),R=t.scissorTest}else C.copy(z).multiplyScalar(O).floor(),L.copy(U).multiplyScalar(O).floor(),R=B;if($.bindFramebuffer(36160,r)&&K.drawBuffers&&n&&$.drawBuffers(t,r),$.viewport(C),$.scissor(L),$.setScissorTest(R),s){const n=it.get(t.texture);St.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(a){const n=it.get(t.texture),r=e||0;St.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}A=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=it.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){$.bindFramebuffer(36160,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==M&&xt.convert(o)!==St.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===b&&(J.has("EXT_color_buffer_half_float")||K.isWebGL2&&J.has("EXT_color_buffer_float"));if(!(l===g||xt.convert(l)===St.getParameter(35738)||l===x&&(K.isWebGL2||J.has("OES_texture_float")||J.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&St.readPixels(e,i,n,r,xt.convert(o),xt.convert(l),s)}finally{const t=null!==T?it.get(T).__webglFramebuffer:null;$.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);rt.setTexture2D(e,0),St.copyTexSubImage2D(3553,i,0,0,t.x,t.y,r,s),$.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,a=xt.convert(i.format),o=xt.convert(i.type);rt.setTexture2D(i,0),St.pixelStorei(37440,i.flipY),St.pixelStorei(37441,i.premultiplyAlpha),St.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?St.texSubImage2D(3553,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?St.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):St.texSubImage2D(3553,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&St.generateMipmap(3553),$.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=xt.convert(n.format),h=xt.convert(n.type);let c;if(n.isData3DTexture)rt.setTexture3D(n,0),c=32879;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");rt.setTexture2DArray(n,0),c=35866}St.pixelStorei(37440,n.flipY),St.pixelStorei(37441,n.premultiplyAlpha),St.pixelStorei(3317,n.unpackAlignment);const u=St.getParameter(3314),d=St.getParameter(32878),p=St.getParameter(3316),f=St.getParameter(3315),m=St.getParameter(32877),_=i.isCompressedTexture?i.mipmaps[0]:i.image;St.pixelStorei(3314,_.width),St.pixelStorei(32878,_.height),St.pixelStorei(3316,t.min.x),St.pixelStorei(3315,t.min.y),St.pixelStorei(32877,t.min.z),i.isDataTexture||i.isData3DTexture?St.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,_.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),St.compressedTexSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,_.data)):St.texSubImage3D(c,r,e.x,e.y,e.z,s,a,o,l,h,_),St.pixelStorei(3314,u),St.pixelStorei(32878,d),St.pixelStorei(3316,p),St.pixelStorei(3315,f),St.pixelStorei(32877,m),0===r&&n.generateMipmaps&&St.generateMipmap(c),$.unbindTexture()},this.initTexture=function(t){rt.setTexture2D(t,0),$.unbindTexture()},this.resetState=function(){S=0,E=0,T=null,$.reset(),Mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ys.prototype.isWebGLRenderer=!0,class extends ys{}.prototype.isWebGL1Renderer=!0;class vs{constructor(t,e=25e-5){this.name="",this.color=new ft(t),this.density=e}clone(){return new vs(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}vs.prototype.isFogExp2=!0;class xs{constructor(t,e=1,i=1e3){this.name="",this.color=new ft(t),this.near=e,this.far=i}clone(){return new xs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}xs.prototype.isFog=!0;class bs extends Pe{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}bs.prototype.isScene=!0;class ws{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=H,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Z()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Z()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Z()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ws.prototype.isInterleavedBuffer=!0;const Ms=new Tt;class Ss{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Ms.fromBufferAttribute(this,e),Ms.applyMatrix4(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Ms.fromBufferAttribute(this,e),Ms.applyNormalMatrix(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Ms.fromBufferAttribute(this,e),Ms.transformDirection(t),this.setXYZ(e,Ms.x,Ms.y,Ms.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new je(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ss(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Ss.prototype.isInterleavedBufferAttribute=!0;class Es extends He{constructor(t){super(),this.type="SpriteMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Ts;Es.prototype.isSpriteMaterial=!0;const As=new Tt,Ps=new Tt,Cs=new Tt,Ls=new tt,Rs=new tt,Is=new ne,Ds=new Tt,Os=new Tt,Ns=new Tt,Fs=new tt,ks=new tt,zs=new tt;function Us(t,e,i,n,r,s){Ls.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(Rs.x=s*Ls.x-r*Ls.y,Rs.y=r*Ls.x+s*Ls.y):Rs.copy(Ls),t.copy(e),t.x+=Rs.x,t.y+=Rs.y,t.applyMatrix4(Is)}(class extends Pe{constructor(t){if(super(),this.type="Sprite",void 0===Ts){Ts=new ii;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ws(t,5);Ts.setIndex([0,1,2,0,2,3]),Ts.setAttribute("position",new Ss(e,3,0,!1)),Ts.setAttribute("uv",new Ss(e,2,3,!1))}this.geometry=Ts,this.material=void 0!==t?t:new Es,this.center=new tt(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ps.setFromMatrixScale(this.matrixWorld),Is.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Cs.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ps.multiplyScalar(-Cs.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;Us(Ds.set(-.5,-.5,0),Cs,s,Ps,n,r),Us(Os.set(.5,-.5,0),Cs,s,Ps,n,r),Us(Ns.set(.5,.5,0),Cs,s,Ps,n,r),Fs.set(0,0),ks.set(1,0),zs.set(1,1);let a=t.ray.intersectTriangle(Ds,Os,Ns,!1,As);if(null===a&&(Us(Os.set(-.5,.5,0),Cs,s,Ps,n,r),ks.set(0,1),a=t.ray.intersectTriangle(Ds,Ns,Os,!1,As),null===a))return;const o=t.ray.origin.distanceTo(As);o<t.near||o>t.far||e.push({distance:o,point:As.clone(),uv:Ue.getUV(As,Ds,Os,Ns,Fs,ks,zs,new tt),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}).prototype.isSprite=!0;const Bs=new Tt,Hs=new bt,Gs=new bt,Vs=new Tt,Ws=new ne;class js extends xi{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ne,this.bindMatrixInverse=new ne}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new bt,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Hs.fromBufferAttribute(n.attributes.skinIndex,t),Gs.fromBufferAttribute(n.attributes.skinWeight,t),Bs.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=Gs.getComponent(t);if(0!==n){const r=Hs.getComponent(t);Ws.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Vs.copy(Bs).applyMatrix4(Ws),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}js.prototype.isSkinnedMesh=!0;(class extends Pe{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;class qs extends xt{constructor(t=null,e=1,i=1,n,r,s,a,o,l=f,h=f,c,u){super(null,s,a,o,l,h,n,r,c,u),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}qs.prototype.isDataTexture=!0;class Xs extends je{constructor(t,e,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Xs.prototype.isInstancedBufferAttribute=!0;const Ys=new ne,Zs=new ne,Js=[],Ks=new xi;(class extends xi{constructor(t,e,i){super(t,e),this.instanceMatrix=new Xs(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Ks.geometry=this.geometry,Ks.material=this.material,void 0!==Ks.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Ys),Zs.multiplyMatrices(i,Ys),Ks.matrixWorld=Zs,Ks.raycast(t,Js);for(let t=0,i=Js.length;t<i;t++){const i=Js[t];i.instanceId=r,i.object=this,e.push(i)}Js.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Xs(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class $s extends He{constructor(t){super(),this.type="LineBasicMaterial",this.color=new ft(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}$s.prototype.isLineBasicMaterial=!0;const Qs=new Tt,ta=new Tt,ea=new ne,ia=new ie,na=new Yt;class ra extends Pe{constructor(t=new ii,e=new $s){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Qs.fromBufferAttribute(e,t-1),ta.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Qs.distanceTo(ta);t.setAttribute("lineDistance",new Ye(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),na.copy(i.boundingSphere),na.applyMatrix4(n),na.radius+=r,!1===t.ray.intersectsSphere(na))return;ea.copy(n).invert(),ia.copy(t.ray).applyMatrix4(ea);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new Tt,h=new Tt,c=new Tt,u=new Tt,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n)for(let i=Math.max(0,s.start),a=Math.min(n.count,s.start+s.count)-1;i<a;i+=d){const s=n.getX(i),a=n.getX(i+1);if(l.fromBufferAttribute(r,s),h.fromBufferAttribute(r,a),ia.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const d=t.ray.origin.distanceTo(u);d<t.near||d>t.far||e.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(let i=Math.max(0,s.start),n=Math.min(r.count,s.start+s.count)-1;i<n;i+=d){if(l.fromBufferAttribute(r,i),h.fromBufferAttribute(r,i+1),ia.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ra.prototype.isLine=!0;const sa=new Tt,aa=new Tt;class oa extends ra{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)sa.fromBufferAttribute(e,t),aa.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+sa.distanceTo(aa);t.setAttribute("lineDistance",new Ye(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}oa.prototype.isLineSegments=!0;(class extends ra{constructor(t,e){super(t,e),this.type="LineLoop"}}).prototype.isLineLoop=!0;class la extends He{constructor(t){super(),this.type="PointsMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}la.prototype.isPointsMaterial=!0;const ha=new ne,ca=new ie,ua=new Yt,da=new Tt;function pa(t,e,i,n,r,s,a){const o=ca.distanceSqToPoint(t);if(o<i){const i=new Tt;ca.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}(class extends Pe{constructor(t=new ii,e=new la){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),ua.copy(i.boundingSphere),ua.applyMatrix4(n),ua.radius+=r,!1===t.ray.intersectsSphere(ua))return;ha.copy(n).invert(),ca.copy(t.ray).applyMatrix4(ha);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position;if(null!==r)for(let i=Math.max(0,s.start),l=Math.min(r.count,s.start+s.count);i<l;i++){const s=r.getX(i);da.fromBufferAttribute(a,s),pa(da,s,o,n,t,e,this)}else for(let i=Math.max(0,s.start),r=Math.min(a.count,s.start+s.count);i<r;i++)da.fromBufferAttribute(a,i),pa(da,i,o,n,t,e,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class extends xt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.minFilter=void 0!==s?s:m,this.magFilter=void 0!==r?r:m,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class extends xt{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=f,this.minFilter=f,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class extends xt{constructor(t,e,i,n,r,s,a,o,l,h,c,u){super(null,s,a,o,l,h,n,r,c,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class extends xt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class fa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const h=i[n];return(n+(s-h)/(i[n+1]-h))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),a=this.getPoint(r),o=e||(s.isVector2?new tt:new Tt);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Tt,n=[],r=[],s=[],a=new Tt,o=new ne;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new Tt)}r[0]=new Tt,s[0]=new Tt;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(J(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(J(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ma extends fa{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new tt,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}ma.prototype.isEllipseCurve=!0;class _a extends ma{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.type="ArcCurve"}}function ga(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,h=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,h*=a,r(e,i,l,h)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}_a.prototype.isArcCurve=!0;const ya=new Tt,va=new ga,xa=new ga,ba=new ga;class wa extends fa{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new Tt){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),h=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?a=n[(l-1)%r]:(ya.subVectors(n[0],n[1]).add(n[0]),a=ya);const c=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(ya.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=ya),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),va.initNonuniformCatmullRom(a.x,c.x,u.x,o.x,e,i,n),xa.initNonuniformCatmullRom(a.y,c.y,u.y,o.y,e,i,n),ba.initNonuniformCatmullRom(a.z,c.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(va.initCatmullRom(a.x,c.x,u.x,o.x,this.tension),xa.initCatmullRom(a.y,c.y,u.y,o.y,this.tension),ba.initCatmullRom(a.z,c.z,u.z,o.z,this.tension));return i.set(va.calc(h),xa.calc(h),ba.calc(h)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Tt).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function Ma(t,e,i,n,r){const s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function Sa(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function Ea(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}wa.prototype.isCatmullRomCurve3=!0;class Ta extends fa{constructor(t=new tt,e=new tt,i=new tt,n=new tt){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new tt){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Ea(t,n.x,r.x,s.x,a.x),Ea(t,n.y,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ta.prototype.isCubicBezierCurve=!0;class Aa extends fa{constructor(t=new Tt,e=new Tt,i=new Tt,n=new Tt){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Tt){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(Ea(t,n.x,r.x,s.x,a.x),Ea(t,n.y,r.y,s.y,a.y),Ea(t,n.z,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Aa.prototype.isCubicBezierCurve3=!0;class Pa extends fa{constructor(t=new tt,e=new tt){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new tt){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new tt;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Pa.prototype.isLineCurve=!0;class Ca extends fa{constructor(t=new tt,e=new tt,i=new tt){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new tt){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Sa(t,n.x,r.x,s.x),Sa(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ca.prototype.isQuadraticBezierCurve=!0;class La extends fa{constructor(t=new Tt,e=new Tt,i=new Tt){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Tt){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(Sa(t,n.x,r.x,s.x),Sa(t,n.y,r.y,s.y),Sa(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}La.prototype.isQuadraticBezierCurve3=!0;class Ra extends fa{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new tt){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],h=n[s>n.length-2?n.length-1:s+1],c=n[s>n.length-3?n.length-1:s+2];return i.set(Ma(a,o.x,l.x,h.x,c.x),Ma(a,o.y,l.y,h.y,c.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new tt).fromArray(i))}return this}}Ra.prototype.isSplineCurve=!0;var Ia=Object.freeze({__proto__:null,ArcCurve:_a,CatmullRomCurve3:wa,CubicBezierCurve:Ta,CubicBezierCurve3:Aa,EllipseCurve:ma,LineCurve:Pa,LineCurve3:class extends fa{constructor(t=new Tt,e=new Tt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new Tt){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Ca,QuadraticBezierCurve3:La,SplineCurve:Ra});class Da extends fa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Pa(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Ia[i.type]).fromJSON(i))}return this}}class Oa extends Da{constructor(t){super(),this.type="Path",this.currentPoint=new tt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new Pa(this.currentPoint.clone(),new tt(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Ca(this.currentPoint.clone(),new tt(t,e),new tt(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const a=new Ta(this.currentPoint.clone(),new tt(t,e),new tt(i,n),new tt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Ra(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){const l=new ma(t,e,i,n,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Na extends ii{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),r=Math.floor(r);const h=[],c=[],u=[],d=[];let p=0;const f=[],m=i/2;let _=0;function g(i){const r=p,s=new tt,f=new Tt;let g=0;const y=!0===i?t:e,v=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,m*v,0),u.push(0,v,0),d.push(.5,.5),p++;const x=p;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*v,f.z=y*i,c.push(f.x,f.y,f.z),u.push(0,v,0),s.x=.5*i+.5,s.y=.5*r*v+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=x+t;!0===i?h.push(n,n+1,e):h.push(n+1,n,e),g+=3}l.addGroup(_,g,!0===i?1:2),_+=g}!function(){const s=new Tt,g=new Tt;let y=0;const v=(e-t)/i;for(let l=0;l<=r;l++){const h=[],_=l/r,y=_*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+a,l=Math.sin(r),f=Math.cos(r);g.x=y*l,g.y=-_*i+m,g.z=y*f,c.push(g.x,g.y,g.z),s.set(l,v,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-_),h.push(p++)}f.push(h)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=f[e][t],n=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];h.push(i,n,s),h.push(n,r,s),y+=6}l.addGroup(_,y,0),_+=y}(),!1===s&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(h),this.setAttribute("position",new Ye(c,3)),this.setAttribute("normal",new Ye(u,3)),this.setAttribute("uv",new Ye(d,2))}static fromJSON(t){return new Na(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}new Tt,new Tt,new Tt,new Ue;class Fa extends Oa{constructor(t){super(t),this.uuid=Z(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Oa).fromJSON(i))}return this}}function ka(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=ro(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=ro(s,t[s],t[s+1],a);return a&&$a(a,a.next)&&(so(a),a=a.next),a}function za(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!$a(n,n.next)&&0!==Ka(n.prev,n,n.next))n=n.next;else{if(so(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Ua(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=Xa(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,h=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ,n);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(a>1)}(r)}(t,n,r,s);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?Ha(t,n,r,s):Ba(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),so(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?Ua(t=Ga(za(t),e,i),e,i,n,r,s,2):2===a&&Va(t,e,i,n,r,s):Ua(za(t),e,i,n,r,s,1);break}}function Ba(t){const e=t.prev,i=t,n=t.next;if(Ka(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Za(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Ka(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Ha(t,e,i,n){const r=t.prev,s=t,a=t.next;if(Ka(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,h=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,c=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Xa(o,l,e,i,n),d=Xa(h,c,e,i,n);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&Za(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&Ka(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&Za(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Ka(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Za(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&Ka(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&Za(r.x,r.y,s.x,s.y,a.x,a.y,f.x,f.y)&&Ka(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Ga(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!$a(r,s)&&Qa(r,n,n.next,s)&&io(r,s)&&io(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),so(n),so(n.next),n=t=s),n=n.next}while(n!==t);return za(n)}function Va(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Ja(a,t)){let o=no(a,t);return a=za(a,a.next),o=za(o,o.next),Ua(a,e,i,n,r,s),void Ua(o,e,i,n,r,s)}t=t.next}a=a.next}while(a!==t)}function Wa(t,e){return t.x-e.x}function ja(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===a)return s;const o=s,l=s.x,h=s.y;let c,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&Za(r<h?n:a,r,l,h,r<h?a:n,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(n-i.x),io(i,t)&&(c<u||c===u&&(i.x>s.x||i.x===s.x&&qa(s,i)))&&(s=i,u=c)),i=i.next}while(i!==o);return s}(t,e),e){const i=no(e,t);za(e,e.next),za(i,i.next)}}function qa(t,e){return Ka(t.prev,t,e.prev)<0&&Ka(e.next,t,t.next)<0}function Xa(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ya(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Za(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function Ja(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Qa(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(io(t,e)&&io(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Ka(t.prev,t,e.prev)||Ka(t,e.prev,e))||$a(t,e)&&Ka(t.prev,t,t.next)>0&&Ka(e.prev,e,e.next)>0)}function Ka(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function $a(t,e){return t.x===e.x&&t.y===e.y}function Qa(t,e,i,n){const r=eo(Ka(t,e,i)),s=eo(Ka(t,e,n)),a=eo(Ka(i,n,t)),o=eo(Ka(i,n,e));return r!==s&&a!==o||!(0!==r||!to(t,i,e))||!(0!==s||!to(t,n,e))||!(0!==a||!to(i,t,n))||!(0!==o||!to(i,e,n))}function to(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function eo(t){return t>0?1:t<0?-1:0}function io(t,e){return Ka(t.prev,t,t.next)<0?Ka(t,e,t.next)>=0&&Ka(t,t.prev,e)>=0:Ka(t,e,t.prev)<0||Ka(t,t.next,e)<0}function no(t,e){const i=new ao(t.i,t.x,t.y),n=new ao(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function ro(t,e,i,n){const r=new ao(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function so(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ao(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class oo{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return oo.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];lo(t),ho(i,t);let s=t.length;e.forEach(lo);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,ho(i,e[t]);const a=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=ka(t,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,h,c,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,a,o,l,h;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,h=ka(t,o,l,n,!1),h===h.next&&(h.steiner=!0),r.push(Ya(h));for(r.sort(Wa),s=0;s<r.length;s++)ja(r[s],i),i=za(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=h=t[0],l=c=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=0!==p?1/p:0}return Ua(s,a,i,o,l,p),a}(i,n);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function lo(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function ho(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class co extends ii{constructor(t=new Fa([new tt(.5,.5),new tt(-.5,.5),new tt(-.5,-.5),new tt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++)s(t[e]);function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:1,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:c-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:uo;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let _,g,y,v,x,b=!1;f&&(_=f.getSpacedPoints(o),b=!0,h=!1,g=f.computeFrenetFrames(o,!1),y=new Tt,v=new Tt,x=new Tt),h||(p=0,c=0,u=0,d=0);const w=t.extractPoints(a);let M=w.shape;const S=w.holes;if(!oo.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];oo.isClockWise(e)&&(S[t]=e.reverse())}}const E=oo.triangulateShape(M,S),T=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function A(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const P=M.length,C=E.length;function L(t,e,i){let n,r,s;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=a*a+o*o,u=a*h-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-o/u,f=e.y+a/u,m=((i.x-h/d-p)*h-(i.y+l/d-f)*l)/(a*h-o*l);n=p+a*m-t.x,r=f+o*m-t.y;const _=n*n+r*r;if(_<=2)return new tt(n,r);s=Math.sqrt(_/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(n=-o,r=a,s=Math.sqrt(c)):(n=a,r=o,s=Math.sqrt(c/2))}return new tt(n/s,r/s)}const R=[];for(let t=0,e=T.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),R[t]=L(T[t],T[i],T[n]);const I=[];let D,O=R.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=L(e[t],e[n],e[r]);I.push(D),O=O.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],R[t],n);k(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],n);k(r.x,r.y,-i)}}}const N=u+d;for(let t=0;t<P;t++){const e=h?A(M[t],O[t],N):M[t];b?(v.copy(g.normals[0]).multiplyScalar(e.x),y.copy(g.binormals[0]).multiplyScalar(e.y),x.copy(_[0]).add(v).add(y),k(x.x,x.y,x.z)):k(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<P;e++){const i=h?A(M[e],O[e],N):M[e];b?(v.copy(g.normals[t]).multiplyScalar(i.x),y.copy(g.binormals[t]).multiplyScalar(i.y),x.copy(_[t]).add(v).add(y),k(x.x,x.y,x.z)):k(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=T.length;t<e;t++){const e=A(T[t],R[t],n);k(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],D[t],n);b?k(r.x,r.y+_[o-1].y,_[o-1].x+i):k(r.x,r.y,l+i)}}}function F(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*p;t<i;t++){const i=P*t,s=P*(t+1);U(e+n+i,e+r+i,e+r+s,e+n+s)}}}function k(t,e,i){s.push(t),s.push(e),s.push(i)}function z(t,e,r){B(t),B(e),B(r);const s=n.length/3,a=m.generateTopUV(i,n,s-3,s-2,s-1);H(a[0]),H(a[1]),H(a[2])}function U(t,e,r,s){B(t),B(e),B(s),B(e),B(r),B(s);const a=n.length/3,o=m.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function B(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function H(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(h){let t=0,e=P*t;for(let t=0;t<C;t++){const i=E[t];z(i[2]+e,i[1]+e,i[0]+e)}t=o+2*p,e=P*t;for(let t=0;t<C;t++){const i=E[t];z(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<C;t++){const e=E[t];z(e[2],e[1],e[0])}for(let t=0;t<C;t++){const e=E[t];z(e[0]+P*o,e[1]+P*o,e[2]+P*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;F(T,e),e+=T.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];F(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Ye(n,3)),this.setAttribute("uv",new Ye(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);return void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new Ia[n.type]).fromJSON(n)),new co(i,t.options)}}const uo={generateTopUV:function(t,e,i,n,r){const s=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new tt(s,a),new tt(o,l),new tt(h,c)]},generateSideWallUV:function(t,e,i,n,r,s){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],_=e[3*s+1],g=e[3*s+2];return Math.abs(o-c)<Math.abs(a-h)?[new tt(a,1-l),new tt(h,1-u),new tt(d,1-f),new tt(m,1-g)]:[new tt(o,1-l),new tt(c,1-u),new tt(p,1-f),new tt(_,1-g)]}};class po extends ii{constructor(t=new Fa([new tt(0,.5),new tt(-.5,-.5),new tt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=n.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===oo.isClockWise(h)&&(h=h.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===oo.isClockWise(e)&&(c[t]=e.reverse())}const u=oo.triangulateShape(h,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];h=h.concat(e)}for(let t=0,e=h.length;t<e;t++){const e=h[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+a,r=e[1]+a,s=e[2]+a;i.push(n,r,s),o+=3}}this.setIndex(i),this.setAttribute("position",new Ye(n,3)),this.setAttribute("normal",new Ye(r,3)),this.setAttribute("uv",new Ye(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new po(i,t.curveSegments)}}class fo extends ii{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const h=[],c=new Tt,u=new Tt,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){const _=[],g=d/i;let y=0;0==d&&0==s?y=.5/e:d==i&&o==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){const o=i/e;c.x=-t*Math.cos(n+o*r)*Math.sin(s+g*a),c.y=t*Math.cos(s+g*a),c.z=t*Math.sin(n+o*r)*Math.sin(s+g*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-g),_.push(l++)}h.push(_)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=h[t][n+1],r=h[t][n],a=h[t+1][n],l=h[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Ye(p,3)),this.setAttribute("normal",new Ye(f,3)),this.setAttribute("uv",new Ye(m,2))}static fromJSON(t){return new fo(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class mo extends He{constructor(t){super(),this.type="ShadowMaterial",this.color=new ft(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}mo.prototype.isShadowMaterial=!0;class _o extends Ti{constructor(t){super(t),this.type="RawShaderMaterial"}}_o.prototype.isRawShaderMaterial=!0;class go extends He{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ft(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}go.prototype.isMeshStandardMaterial=!0;class yo extends go{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new tt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return J(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new ft(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ft(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ft(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}yo.prototype.isMeshPhysicalMaterial=!0;class vo extends He{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new ft(16777215),this.specular=new ft(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}vo.prototype.isMeshPhongMaterial=!0;class xo extends He{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ft(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}xo.prototype.isMeshToonMaterial=!0;class bo extends He{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}bo.prototype.isMeshNormalMaterial=!0;class wo extends He{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}wo.prototype.isMeshLambertMaterial=!0;class Mo extends He{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ft(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new tt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}Mo.prototype.isMeshMatcapMaterial=!0;class So extends $s{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}So.prototype.isLineDashedMaterial=!0;const Eo={ShadowMaterial:mo,SpriteMaterial:Es,RawShaderMaterial:_o,ShaderMaterial:Ti,PointsMaterial:la,MeshPhysicalMaterial:yo,MeshStandardMaterial:go,MeshPhongMaterial:vo,MeshToonMaterial:xo,MeshNormalMaterial:bo,MeshLambertMaterial:wo,MeshDepthMaterial:ss,MeshDistanceMaterial:as,MeshBasicMaterial:Ge,MeshMatcapMaterial:Mo,LineDashedMaterial:So,LineBasicMaterial:$s,Material:He};He.fromType=function(t){return new Eo[t]};const To={arraySlice:function(t,e,i){return To.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[a++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(e.push(s.time),i.push.apply(i,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(e.push(s.time),i.push(a)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],h=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)h.push(e.values[t*o+i])}}0!==l.length&&(e.times=To.convertArray(l,e.times.constructor),e.values=To.convertArray(h,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=o,e=l-o;d=To.arraySlice(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+o,e=t+l-o;d=To.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(s),d=To.arraySlice(t.resultBuffer,e,i)}"quaternion"===r&&(new Et).fromArray(d).normalize().conjugate().toArray(d);const p=a.times.length;for(let t=0;t<p;++t){const e=t*c+h;if("quaternion"===r)Et.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=c-2*h;for(let i=0;i<t;++i)a.values[e+i]-=d[i]}}}return t.blendMode=2501,t}};class Ao{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Ao.prototype.beforeStart_=Ao.prototype.copySampleValue_,Ao.prototype.afterEnd_=Ao.prototype.copySampleValue_;class Po extends Ao{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:D,endingEnd:D}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case O:r=t,a=2*e-i;break;case N:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case O:s=t,o=2*i-e;break;case N:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}const l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),f=p*p,m=f*p,_=-u*m+2*u*f-u*p,g=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,v=d*m-d*f;for(let t=0;t!==a;++t)r[t]=_*s[h+t]+g*s[l+t]+y*s[o+t]+v*s[c+t];return r}}class Co extends Ao{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,h=(i-e)/(n-e),c=1-h;for(let t=0;t!==a;++t)r[t]=s[l+t]*c+s[o+t]*h;return r}}class Lo extends Ao{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Ro{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=To.convertArray(e,this.TimeBufferType),this.values=To.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:To.convertArray(t.times,Array),values:To.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Lo(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Co(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Po(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case L:e=this.InterpolantFactoryMethodDiscrete;break;case R:e=this.InterpolantFactoryMethodLinear;break;case I:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return L;case this.InterpolantFactoryMethodLinear:return R;case this.InterpolantFactoryMethodSmooth:return I}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=To.arraySlice(i,r,s),this.values=To.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&To.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=To.arraySlice(this.times),e=To.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===I,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)r=!0;else{const t=a*i,n=t-i,s=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[n+a]||i!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const n=a*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,a=0;a!==i;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=To.arraySlice(t,0,s),this.values=To.arraySlice(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=To.arraySlice(this.times,0),e=To.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Ro.prototype.TimeBufferType=Float32Array,Ro.prototype.ValueBufferType=Float32Array,Ro.prototype.DefaultInterpolation=R;class Io extends Ro{}Io.prototype.ValueTypeName="bool",Io.prototype.ValueBufferType=Array,Io.prototype.DefaultInterpolation=L,Io.prototype.InterpolantFactoryMethodLinear=void 0,Io.prototype.InterpolantFactoryMethodSmooth=void 0;class Do extends Ro{}Do.prototype.ValueTypeName="color";class Oo extends Ro{}Oo.prototype.ValueTypeName="number";class No extends Ao{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e);let l=t*a;for(let t=l+a;l!==t;l+=4)Et.slerpFlat(r,0,s,l-a,s,l,o);return r}}class Fo extends Ro{InterpolantFactoryMethodLinear(t){return new No(this.times,this.values,this.getValueSize(),t)}}Fo.prototype.ValueTypeName="quaternion",Fo.prototype.DefaultInterpolation=R,Fo.prototype.InterpolantFactoryMethodSmooth=void 0;class ko extends Ro{}ko.prototype.ValueTypeName="string",ko.prototype.ValueBufferType=Array,ko.prototype.DefaultInterpolation=L,ko.prototype.InterpolantFactoryMethodLinear=void 0,ko.prototype.InterpolantFactoryMethodSmooth=void 0;class zo extends Ro{}zo.prototype.ValueTypeName="vector";class Uo{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Z(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(Bo(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(Ro.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=To.getKeyframeOrder(a);a=To.sortedArray(a,1,l),o=To.sortedArray(o,1,l),n||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new Oo(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],a=[];To.flattenJSON(i,s,a,n),0!==s.length&&r.push(new t(e,s,a))}},n=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new Oo(".morphTargetInfluence["+i+"]",t,s))}o=t.length*s}else{const s=".bones["+e[t].name+"]";i(zo,s+".position",r,"pos",n),i(Fo,s+".quaternion",r,"rot",n),i(zo,s+".scale",r,"scl",n)}}return 0===n.length?null:new this(r,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Bo(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Oo;case"vector":case"vector2":case"vector3":case"vector4":return zo;case"color":return Do;case"quaternion":return Fo;case"bool":case"boolean":return Io;case"string":return ko}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];To.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Ho={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};const Go=new class{constructor(t,e,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===s&&void 0!==n.onStart&&n.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}};class Vo{constructor(t){this.manager=void 0!==t?t:Go,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Wo={};class jo extends Vo{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Ho.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==Wo[t])return void Wo[t].push({onLoad:e,onProgress:i,onError:n});Wo[t]=[],Wo[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=Wo[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{o+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{Ho.add(t,e);const i=Wo[t];delete Wo[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=Wo[t];if(void 0===i)throw this.manager.itemError(t),e;delete Wo[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class qo extends Vo{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ho.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=nt("img");function o(){h(),Ho.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){h(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class Xo extends Vo{constructor(t){super(t)}load(t,e,i,n){const r=new Ri,s=new qo(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(i){s.load(t[i],(function(t){r.images[i]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)o(e);return r}}class Yo extends Vo{constructor(t){super(t)}load(t,e,i,n){const r=new xt,s=new qo(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}}class Zo extends Pe{constructor(t,e=1){super(),this.type="Light",this.color=new ft(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}Zo.prototype.isLight=!0;(class extends Zo{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Pe.DefaultUp),this.updateMatrix(),this.groundColor=new ft(e)}copy(t){return Zo.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}).prototype.isHemisphereLight=!0;const Jo=new ne,Ko=new Tt,$o=new Tt;class Qo{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new tt(512,512),this.map=null,this.mapPass=null,this.matrix=new ne,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ui,this._frameExtents=new tt(1,1),this._viewportCount=1,this._viewports=[new bt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Ko.setFromMatrixPosition(t.matrixWorld),e.position.copy(Ko),$o.setFromMatrixPosition(t.target.matrixWorld),e.lookAt($o),e.updateMatrixWorld(),Jo.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jo),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class tl extends Qo{constructor(){super(new Pi(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=2*Y*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}tl.prototype.isSpotLightShadow=!0;(class extends Zo{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(Pe.DefaultUp),this.updateMatrix(),this.target=new Pe,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.shadow=new tl}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isSpotLight=!0;const el=new ne,il=new Tt,nl=new Tt;class rl extends Qo{constructor(){super(new Pi(90,1,.5,500)),this._frameExtents=new tt(4,2),this._viewportCount=6,this._viewports=[new bt(2,1,1,1),new bt(0,1,1,1),new bt(3,1,1,1),new bt(1,1,1,1),new bt(3,0,1,1),new bt(1,0,1,1)],this._cubeDirections=[new Tt(1,0,0),new Tt(-1,0,0),new Tt(0,0,1),new Tt(0,0,-1),new Tt(0,1,0),new Tt(0,-1,0)],this._cubeUps=[new Tt(0,1,0),new Tt(0,1,0),new Tt(0,1,0),new Tt(0,1,0),new Tt(0,0,1),new Tt(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),il.setFromMatrixPosition(t.matrixWorld),i.position.copy(il),nl.copy(i.position),nl.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(nl),i.updateMatrixWorld(),n.makeTranslation(-il.x,-il.y,-il.z),el.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(el)}}rl.prototype.isPointLightShadow=!0;(class extends Zo{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new rl}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}).prototype.isPointLight=!0;class sl extends Qo{constructor(){super(new $i(-5,5,5,-5,.5,500))}}sl.prototype.isDirectionalLightShadow=!0;(class extends Zo{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Pe.DefaultUp),this.updateMatrix(),this.target=new Pe,this.shadow=new sl}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}).prototype.isDirectionalLight=!0;(class extends Zo{constructor(t,e){super(t,e),this.type="AmbientLight"}}).prototype.isAmbientLight=!0;(class extends Zo{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}).prototype.isRectAreaLight=!0;class al{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Tt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}al.prototype.isSphericalHarmonics3=!0;class ol extends Zo{constructor(t=new al,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}ol.prototype.isLightProbe=!0;let ll;(class extends ii{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}).prototype.isInstancedBufferGeometry=!0,class extends Vo{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=Ho.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){Ho.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}.prototype.isImageBitmapLoader=!0;class hl extends Vo{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new jo(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);(void 0===ll&&(ll=new(window.AudioContext||window.webkitAudioContext)),ll).decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}}(class extends ol{constructor(t,e,i=1){super(void 0,i);const n=(new ft).set(t),r=(new ft).set(e),s=new Tt(n.r,n.g,n.b),a=new Tt(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}}).prototype.isHemisphereLightProbe=!0,class extends ol{constructor(t,e=1){super(void 0,e);const i=(new ft).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class cl{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){a.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){Et.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;Et.multiplyQuaternionsFlat(t,s,t,e,t,i),Et.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[i+a]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const ul=new RegExp("[\\[\\]\\.:\\/]","g"),dl="[^\\[\\]\\.:\\/]",pl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",fl=/((?:WC+[\/:])*)/.source.replace("WC",dl),ml=/(WCOD+)?/.source.replace("WCOD",pl),_l=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",dl),gl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",dl),yl=new RegExp("^"+fl+ml+_l+gl+"$"),vl=["material","materials","bones"];class xl{constructor(t,e,i){this.path=e,this.parsedPath=i||xl.parseTrackName(e),this.node=xl.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new xl.Composite(t,e,i):new xl(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(ul,"")}static parseTrackName(t){const e=yl.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==vl.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=xl.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}xl.Composite=class{constructor(t,e,i){const n=i||xl.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},xl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},xl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},xl.prototype.GetterByBindingType=[xl.prototype._getValue_direct,xl.prototype._getValue_array,xl.prototype._getValue_arrayElement,xl.prototype._getValue_toArray],xl.prototype.SetterByBindingTypeAndVersioning=[[xl.prototype._setValue_direct,xl.prototype._setValue_direct_setNeedsUpdate,xl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xl.prototype._setValue_array,xl.prototype._setValue_array_setNeedsUpdate,xl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xl.prototype._setValue_arrayElement,xl.prototype._setValue_arrayElement_setNeedsUpdate,xl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xl.prototype._setValue_fromArray,xl.prototype._setValue_fromArray_setNeedsUpdate,xl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class bl{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:D,endingEnd:D};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(a);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;null!==i&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=2202===i;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=O,n.endingEnd=O):(n.endingStart=t?this.zeroSlopeAtStart?O:D:N,n.endingEnd=e?this.zeroSlopeAtEnd?O:D:N)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}}(class extends j{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let h=l[o];void 0===h&&(h={},l[o]=h);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let c=h[l];if(void 0!==c)++c.referenceCount,s[t]=c;else{if(c=s[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;c=new cl(xl.create(i,l,n),r.ValueTypeName,r.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),s[t]=c}a[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Co(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?Uo.findByName(n,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:2500),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const h=new bl(this,s,e,i);return this._bindAction(h,l),this._addInactiveAction(h,a,r),h}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?Uo.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==i;++a)e[a]._update(n,t,r,s);const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class wl{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new wl(void 0===this.value.clone?this.value:this.value.clone())}}(class extends ws{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class Ml{constructor(t,e,i=0,n=1/0){this.ray=new ie(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new fe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return El(t,this,i,e),i.sort(Sl),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)El(t[n],this,i,e);return i.sort(Sl),i}}function Sl(t,e){return t.distance-e.distance}function El(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)El(n[t],e,i,!0)}}class Tl{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(J(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const Al=new tt;class Pl{constructor(t=new tt(1/0,1/0),e=new tt(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Al.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Al.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Pl.prototype.isBox2=!0;const Cl=new Tt,Ll=new ne,Rl=new ne;function Il(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,Il(t.children[i]));return e}const Dl=new Ct;class Ol extends oa{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new ii;r.setIndex(new je(i,1)),r.setAttribute("position",new je(n,3)),super(r,new $s({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Dl.setFromObject(this.object),Dl.isEmpty())return;const e=Dl.min,i=Dl.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return oa.prototype.copy.call(this,t),this.object=t.object,this}}const Nl=new ArrayBuffer(4),Fl=(new Float32Array(Nl),new Uint32Array(Nl),new Uint32Array(512)),kl=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(Fl[t]=0,Fl[256|t]=32768,kl[t]=24,kl[256|t]=24):e<-14?(Fl[t]=1024>>-e-14,Fl[256|t]=1024>>-e-14|32768,kl[t]=-e-1,kl[256|t]=-e-1):e<=15?(Fl[t]=e+15<<10,Fl[256|t]=e+15<<10|32768,kl[t]=13,kl[256|t]=13):e<128?(Fl[t]=31744,Fl[256|t]=64512,kl[t]=24,kl[256|t]=24):(Fl[t]=31744,Fl[256|t]=64512,kl[t]=13,kl[256|t]=13)}const zl=new Uint32Array(2048),Ul=new Uint32Array(64),Bl=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;0==(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,zl[t]=e|i}for(let t=1024;t<2048;++t)zl[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)Ul[t]=t<<23;Ul[31]=1199570944,Ul[32]=2147483648;for(let t=33;t<63;++t)Ul[t]=2147483648+(t-32<<23);Ul[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(Bl[t]=1024);fa.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(fa.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Oa.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends oa{constructor(t=10,e=10,i=4473924,n=8947848){i=new ft(i),n=new ft(n);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,h=0,c=-a;t<=e;t++,c+=s){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);const e=t===r?i:n;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new ii;h.setAttribute("position",new Ye(o,3)),h.setAttribute("color",new Ye(l,3)),super(h,new $s({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends oa{constructor(t){const e=Il(t),i=new ii,n=[],r=[],s=new ft(0,0,1),a=new ft(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Ye(n,3)),i.setAttribute("color",new Ye(r,3)),super(i,new $s({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Rl.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Ll.multiplyMatrices(Rl,r.matrixWorld),Cl.setFromMatrixPosition(Ll),n.setXYZ(i,Cl.x,Cl.y,Cl.z),Ll.multiplyMatrices(Rl,r.parent.matrixWorld),Cl.setFromMatrixPosition(Ll),n.setXYZ(i+1,Cl.x,Cl.y,Cl.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Vo.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}.extractUrlBase(t)},Vo.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Pl.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Pl.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Pl.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Pl.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},Ct.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Ct.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ct.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Ct.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Ct.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},pe.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Yt.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ui.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},et.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},et.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},et.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},et.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},et.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},et.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},ne.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},ne.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},ne.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Tt).setFromMatrixColumn(this,3)},ne.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},ne.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ne.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ne.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},ne.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ne.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ne.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ne.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ne.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ne.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},ne.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ne.prototype.makeFrustum=function(t,e,i,n,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,s)},ne.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Fi.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Et.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Et.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},ie.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ie.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},ie.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},Ue.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ue.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},Ue.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},Ue.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},Ue.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},Ue.barycoordFromPoint=function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ue.getBarycoord(t,e,i,n,r)},Ue.normal=function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ue.getNormal(t,e,i,n)},Fa.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Fa.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new co(this,t)},Fa.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new po(this,t)},tt.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},tt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},tt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Tt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Tt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Tt.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},Tt.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},Tt.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},Tt.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},Tt.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},Tt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Tt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},bt.prototype.fromAttribute=function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},bt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Pe.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},Pe.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Pe.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},Pe.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Pe.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Pe.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),xi.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(xi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),js.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Pi.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Zo.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(je.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===G},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(G)}}}),je.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?G:H),this},je.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},je.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ii.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},ii.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new je(arguments[1],arguments[2])))},ii.prototype.addDrawCall=function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},ii.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ii.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ii.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},ii.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(ii.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ws.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?G:H),this},ws.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},co.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},co.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},co.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},bs.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},wl.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(He.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ft}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Ti.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),ys.prototype.clearTarget=function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},ys.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},ys.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},ys.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},ys.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},ys.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},ys.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},ys.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},ys.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},ys.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},ys.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},ys.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},ys.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},ys.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},ys.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},ys.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},ys.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},ys.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},ys.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},ys.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},ys.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},ys.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},ys.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},ys.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},ys.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(ys.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?k:F}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(os.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(wt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),class extends Pe{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new hl).load(t,(function(t){e.setBuffer(t)})),this},Li.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Li.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)},_t.crossOrigin=void 0,_t.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Yo;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},_t.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Xo;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,i,void 0,n);return e&&(s.mapping=e),s},_t.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},_t.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"140"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="140")},1245:(t,e,i)=>{"use strict";i.d(e,{y:()=>r});var n=i(7802);class r{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,a,o,l,h,c,u,d,p,f,m){const _=this.elements;return _[0]=t,_[4]=e,_[8]=i,_[12]=n,_[1]=r,_[5]=s,_[9]=a,_[13]=o,_[2]=l,_[6]=h,_[10]=c,_[14]=u,_[3]=d,_[7]=p,_[11]=f,_[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new r).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/s.setFromMatrixColumn(t,0).length(),r=1/s.setFromMatrixColumn(t,1).length(),a=1/s.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*c,e[5]=s*h,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t-r*a,e[4]=-s*c,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*h,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*h,i=s*c,n=a*h,r=a*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=r-t*c,e[8]=n*c+i,e[1]=c,e[5]=s*h,e[9]=-a*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-r*c}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=s*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=a*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(o,t,l)}lookAt(t,e,i){const n=this.elements;return u.subVectors(t,e),0===u.lengthSq()&&(u.z=1),u.normalize(),h.crossVectors(i,u),0===h.lengthSq()&&(1===Math.abs(i.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),h.crossVectors(i,u)),h.normalize(),c.crossVectors(u,h),n[0]=h.x,n[4]=c.x,n[8]=u.x,n[1]=h.y,n[5]=c.y,n[9]=u.y,n[2]=h.z,n[6]=c.z,n[10]=u.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],_=i[14],g=i[3],y=i[7],v=i[11],x=i[15],b=n[0],w=n[4],M=n[8],S=n[12],E=n[1],T=n[5],A=n[9],P=n[13],C=n[2],L=n[6],R=n[10],I=n[14],D=n[3],O=n[7],N=n[11],F=n[15];return r[0]=s*b+a*E+o*C+l*D,r[4]=s*w+a*T+o*L+l*O,r[8]=s*M+a*A+o*R+l*N,r[12]=s*S+a*P+o*I+l*F,r[1]=h*b+c*E+u*C+d*D,r[5]=h*w+c*T+u*L+d*O,r[9]=h*M+c*A+u*R+d*N,r[13]=h*S+c*P+u*I+d*F,r[2]=p*b+f*E+m*C+_*D,r[6]=p*w+f*T+m*L+_*O,r[10]=p*M+f*A+m*R+_*N,r[14]=p*S+f*P+m*I+_*F,r[3]=g*b+y*E+v*C+x*D,r[7]=g*w+y*T+v*L+x*O,r[11]=g*M+y*A+v*R+x*N,r[15]=g*S+y*P+v*I+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-n*l*c-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*h-r*o*h)+t[11]*(+e*l*c-e*a*d-r*s*c+i*s*d+r*a*h-i*l*h)+t[15]*(-n*a*h-e*o*c+e*a*u+n*s*c-i*s*u+i*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],_=t[15],g=c*m*l-f*u*l+f*o*d-a*m*d-c*o*_+a*u*_,y=p*u*l-h*m*l-p*o*d+s*m*d+h*o*_-s*u*_,v=h*f*l-p*c*l+p*a*d-s*f*d-h*a*_+s*c*_,x=p*c*o-h*f*o-p*a*u+s*f*u+h*a*m-s*c*m,b=e*g+i*y+n*v+r*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=g*w,t[1]=(f*u*r-c*m*r-f*n*d+i*m*d+c*n*_-i*u*_)*w,t[2]=(a*m*r-f*o*r+f*n*l-i*m*l-a*n*_+i*o*_)*w,t[3]=(c*o*r-a*u*r-c*n*l+i*u*l+a*n*d-i*o*d)*w,t[4]=y*w,t[5]=(h*m*r-p*u*r+p*n*d-e*m*d-h*n*_+e*u*_)*w,t[6]=(p*o*r-s*m*r-p*n*l+e*m*l+s*n*_-e*o*_)*w,t[7]=(s*u*r-h*o*r+h*n*l-e*u*l-s*n*d+e*o*d)*w,t[8]=v*w,t[9]=(p*c*r-h*f*r-p*i*d+e*f*d+h*i*_-e*c*_)*w,t[10]=(s*f*r-p*a*r+p*i*l-e*f*l-s*i*_+e*a*_)*w,t[11]=(h*a*r-s*c*r-h*i*l+e*c*l+s*i*d-e*a*d)*w,t[12]=x*w,t[13]=(h*f*n-p*c*n+p*i*u-e*f*u-h*i*m+e*c*m)*w,t[14]=(p*a*n-s*f*n-p*i*o+e*f*o+s*i*m-e*a*m)*w,t[15]=(s*c*n-h*a*n+h*i*o-e*c*o-s*i*u+e*a*u)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,h=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,h*a+i,h*o-n*s,0,l*o-n*a,h*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,h=s+s,c=a+a,u=r*l,d=r*h,p=r*c,f=s*h,m=s*c,_=a*c,g=o*l,y=o*h,v=o*c,x=i.x,b=i.y,w=i.z;return n[0]=(1-(f+_))*x,n[1]=(d+v)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(d-v)*b,n[5]=(1-(u+_))*b,n[6]=(m+g)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(m-g)*w,n[10]=(1-(u+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=s.set(n[0],n[1],n[2]).length();const o=s.set(n[4],n[5],n[6]).length(),l=s.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],a.copy(this);const h=1/r,c=1/o,u=1/l;return a.elements[0]*=h,a.elements[1]*=h,a.elements[2]*=h,a.elements[4]*=c,a.elements[5]*=c,a.elements[6]*=c,a.elements[8]*=u,a.elements[9]*=u,a.elements[10]*=u,e.setFromRotationMatrix(a),i.x=r,i.y=o,i.z=l,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),h=1/(s-r),c=(e+t)*o,u=(i+n)*l,d=(s+r)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}r.prototype.isMatrix4=!0;const s=new n.P,a=new r,o=new n.P(0,0,0),l=new n.P(1,1,1),h=new n.P,c=new n.P,u=new n.P},7802:(t,e,i)=>{"use strict";i.d(e,{P:()=>a});const n=[];for(let t=0;t<256;t++)n[t]=(t<16?"0":"")+t.toString(16);function r(t,e,i){return Math.max(e,Math.min(i,t))}Math.PI,Math.PI;class s{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(c!==f||o!==u||l!==d||h!==p){let t=1-a;const e=o*u+l*d+h*p+c*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+h*c+o*d-l*u,t[e+1]=o*p+h*u+l*c-a*d,t[e+2]=l*p+h*d+a*u-o*c,t[e+3]=h*p-a*c-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(n/2),c=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>c){const t=2*Math.sqrt(1+i-a-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>c){const t=2*Math.sqrt(1+a-i-c);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(r(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+s*a+n*l-r*o,this._y=n*h+s*o+r*a-i*l,this._z=r*h+s*l+i*o-n*a,this._w=s*h-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=s*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}s.prototype.isQuaternion=!0;class a{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(l.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(l.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,h=o*i+a*e-r*n,c=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+h*-a-c*-s,this.y=h*o+u*-s+c*-r-l*-a,this.z=c*o+u*-a+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return o.copy(this).projectOnVector(t),this.sub(o)}reflect(t){return this.sub(o.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(r(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}a.prototype.isVector3=!0;const o=new a,l=new s},4012:t=>{"use strict";t.exports={i8:"0.140.2"}},4147:t=>{"use strict";t.exports={i8:"0.32.1"}}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}return i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(8270)})()));